import{r as D,j as v}from"./react-Bg_vEni-.js";import{e as xt,f as E,T as St,d as A,c as rt,q as O,w as W,h as M,u as J,m as Ut,p as ft}from"./firebase-C3aZpI0W.js";import{d as j,u as Vt}from"../index-Dgt8Lr4V.js";import{E as _t}from"./jspdf.es.min-3c6yj3HK.js";import"./vendor-D_4iK-Jm.js";const Gt=async(e,t,i,r,n,a,s)=>{try{await xt(E(j,"weeklyTrips"),{companyId:e,agencyId:s,departure:t,arrival:i,price:r,horaires:n,places:a,active:!0,createdAt:St.now()})}catch(l){throw console.error("Erreur lors de la création du trajet hebdomadaire :",l),l}},Qt=["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],dt=async e=>{var c;const t=A(j,"weeklyTrips",e),i=await rt(t);if(!i.exists())return;const r=i.data(),{companyId:n,agencyId:a,departure:s,arrival:l,price:h,horaires:o}=r,f=r.places||30;if(!o||typeof o!="object"){console.warn("⛔ Horaires invalides ou absents pour ce WeeklyTrip.");return}for(const w in o)o[w]=o[w].filter(y=>y&&y.trim()!=="");let u="Compagnie";if(n){const w=await rt(A(j,"compagnies",n));w.exists()&&(u=((c=w.data())==null?void 0:c.nom)||"Compagnie")}const g=new Date,p=Array.from({length:8},(w,y)=>{const x=new Date(g);return x.setDate(x.getDate()+y),x});for(const w of p){const y=Qt[w.getDay()],x=w.toISOString().split("T")[0];if(!(!o[y]||o[y].length===0))for(const P of o[y]){const C=O(E(j,"dailyTrips"),W("companyId","==",n),W("agencyId","==",a),W("departure","==",s),W("arrival","==",l),W("date","==",x),W("time","==",P)),F=await M(C);if(F.docs.length>1&&console.warn(`⚠️ Plusieurs dailyTrips identiques trouvés pour ${x} ${P}`),F.empty)await xt(E(j,"dailyTrips"),{companyId:n,agencyId:a,companyName:u,departure:s,arrival:l,price:h,time:P,date:x,day:y,places:f,createdAt:St.now(),weeklyTripId:e}),console.log(`✔️ Ajouté : ${s} → ${l} à ${P} le ${x}`);else{const N=F.docs[0].id;await J(A(j,"dailyTrips",N),{price:h,places:f,companyName:u,weeklyTripId:e,agencyId:a}),console.log(`✅ Mis à jour : ${s} → ${l} à ${P} le ${x}`)}}}};function bt(e,t,i,r,n){r=r||{};var a=1.15,s=n.internal.scaleFactor,l=n.internal.getFontSize()/s,h=n.getLineHeightFactor?n.getLineHeightFactor():a,o=l*h,f=/\r\n|\r|\n/g,u="",g=1;if((r.valign==="middle"||r.valign==="bottom"||r.halign==="center"||r.halign==="right")&&(u=typeof e=="string"?e.split(f):e,g=u.length||1),i+=l*(2-a),r.valign==="middle"?i-=g/2*o:r.valign==="bottom"&&(i-=g*o),r.halign==="center"||r.halign==="right"){var p=l;if(r.halign==="center"&&(p*=.5),u&&g>=1){for(var c=0;c<u.length;c++)n.text(u[c],t-n.getStringUnitWidth(u[c])*p,i),i+=o;return n}t-=n.getStringUnitWidth(e)*p}return r.halign==="justify"?n.text(e,t,i,{maxWidth:r.maxWidth||100,align:"justify"}):n.text(e,t,i),n}var ut={},I=function(){function e(t){this.jsPDFDocument=t,this.userStyles={textColor:t.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:t.internal.getFontSize(),fontStyle:t.internal.getFont().fontStyle,font:t.internal.getFont().fontName,lineWidth:t.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:t.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return e.setDefaults=function(t,i){i===void 0&&(i=null),i?i.__autoTableDocumentDefaults=t:ut=t},e.unifyColor=function(t){return Array.isArray(t)?t:typeof t=="number"?[t,t,t]:typeof t=="string"?[t]:null},e.prototype.applyStyles=function(t,i){var r,n,a;i===void 0&&(i=!1),t.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(t.fontStyle);var s=this.jsPDFDocument.internal.getFont(),l=s.fontStyle,h=s.fontName;if(t.font&&(h=t.font),t.fontStyle){l=t.fontStyle;var o=this.getFontList()[h];o&&o.indexOf(l)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(o[0]),l=o[0])}if(this.jsPDFDocument.setFont(h,l),t.fontSize&&this.jsPDFDocument.setFontSize(t.fontSize),!i){var f=e.unifyColor(t.fillColor);f&&(r=this.jsPDFDocument).setFillColor.apply(r,f),f=e.unifyColor(t.textColor),f&&(n=this.jsPDFDocument).setTextColor.apply(n,f),f=e.unifyColor(t.lineColor),f&&(a=this.jsPDFDocument).setDrawColor.apply(a,f),typeof t.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(t.lineWidth)}},e.prototype.splitTextToSize=function(t,i,r){return this.jsPDFDocument.splitTextToSize(t,i,r)},e.prototype.rect=function(t,i,r,n,a){return this.jsPDFDocument.rect(t,i,r,n,a)},e.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},e.prototype.getTextWidth=function(t){return this.jsPDFDocument.getTextWidth(t)},e.prototype.getDocument=function(){return this.jsPDFDocument},e.prototype.setPage=function(t){this.jsPDFDocument.setPage(t)},e.prototype.addPage=function(){return this.jsPDFDocument.addPage()},e.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},e.prototype.getGlobalOptions=function(){return ut||{}},e.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},e.prototype.pageSize=function(){var t=this.jsPDFDocument.internal.pageSize;return t.width==null&&(t={width:t.getWidth(),height:t.getHeight()}),t},e.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},e.prototype.getLineHeightFactor=function(){var t=this.jsPDFDocument;return t.getLineHeightFactor?t.getLineHeightFactor():1.15},e.prototype.getLineHeight=function(t){return t/this.scaleFactor()*this.getLineHeightFactor()},e.prototype.pageNumber=function(){var t=this.jsPDFDocument.internal.getCurrentPageInfo();return t?t.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},e}(),it=function(e,t){return it=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i[n]=r[n])},it(e,t)};function Ct(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");it(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var jt=function(e){Ct(t,e);function t(i){var r=e.call(this)||this;return r._element=i,r}return t}(Array);function Xt(e){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/e,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function Zt(e){var t={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return t[e]}function U(e,t,i){i.applyStyles(t,!0);var r=Array.isArray(e)?e:[e],n=r.map(function(a){return i.getTextWidth(a)}).reduce(function(a,s){return Math.max(a,s)},0);return n}function Pt(e,t,i,r){var n=t.settings.tableLineWidth,a=t.settings.tableLineColor;e.applyStyles({lineWidth:n,lineColor:a});var s=Dt(n,!1);s&&e.rect(i.x,i.y,t.getWidth(e.pageSize().width),r.y-i.y,s)}function Dt(e,t){var i=e>0,r=t||t===0;return i&&r?"DF":i?"S":r?"F":null}function _(e,t){var i,r,n,a;if(e=e||t,Array.isArray(e)){if(e.length>=4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===3)return{top:e[0],right:e[1],bottom:e[2],left:e[1]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]};e.length===1?e=e[0]:e=t}return typeof e=="object"?(typeof e.vertical=="number"&&(e.top=e.vertical,e.bottom=e.vertical),typeof e.horizontal=="number"&&(e.right=e.horizontal,e.left=e.horizontal),{left:(i=e.left)!==null&&i!==void 0?i:t,top:(r=e.top)!==null&&r!==void 0?r:t,right:(n=e.right)!==null&&n!==void 0?n:t,bottom:(a=e.bottom)!==null&&a!==void 0?a:t}):(typeof e!="number"&&(e=t),{top:e,right:e,bottom:e,left:e})}function Ht(e,t){var i=_(t.settings.margin,0);return e.pageSize().width-(i.left+i.right)}function te(e,t,i,r,n){var a={},s=1.3333333333333333,l=Q(t,function(C){return n.getComputedStyle(C).backgroundColor});l!=null&&(a.fillColor=l);var h=Q(t,function(C){return n.getComputedStyle(C).color});h!=null&&(a.textColor=h);var o=re(r,i);o&&(a.cellPadding=o);var f="borderTopColor",u=s*i,g=r.borderTopWidth;if(r.borderBottomWidth===g&&r.borderRightWidth===g&&r.borderLeftWidth===g){var p=(parseFloat(g)||0)/u;p&&(a.lineWidth=p)}else a.lineWidth={top:(parseFloat(r.borderTopWidth)||0)/u,right:(parseFloat(r.borderRightWidth)||0)/u,bottom:(parseFloat(r.borderBottomWidth)||0)/u,left:(parseFloat(r.borderLeftWidth)||0)/u},a.lineWidth.top||(a.lineWidth.right?f="borderRightColor":a.lineWidth.bottom?f="borderBottomColor":a.lineWidth.left&&(f="borderLeftColor"));var c=Q(t,function(C){return n.getComputedStyle(C)[f]});c!=null&&(a.lineColor=c);var w=["left","right","center","justify"];w.indexOf(r.textAlign)!==-1&&(a.halign=r.textAlign),w=["middle","bottom","top"],w.indexOf(r.verticalAlign)!==-1&&(a.valign=r.verticalAlign);var y=parseInt(r.fontSize||"");isNaN(y)||(a.fontSize=y/s);var x=ee(r);x&&(a.fontStyle=x);var P=(r.fontFamily||"").toLowerCase();return e.indexOf(P)!==-1&&(a.font=P),a}function ee(e){var t="";return(e.fontWeight==="bold"||e.fontWeight==="bolder"||parseInt(e.fontWeight)>=700)&&(t="bold"),(e.fontStyle==="italic"||e.fontStyle==="oblique")&&(t+="italic"),t}function Q(e,t){var i=Ft(e,t);if(!i)return null;var r=i.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!r||!Array.isArray(r))return null;var n=[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],a=parseInt(r[4]);return a===0||isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Ft(e,t){var i=t(e);return i==="rgba(0, 0, 0, 0)"||i==="transparent"||i==="initial"||i==="inherit"?e.parentElement==null?null:Ft(e.parentElement,t):i}function re(e,t){var i=[e.paddingTop,e.paddingRight,e.paddingBottom,e.paddingLeft],r=96/(72/t),n=(parseInt(e.lineHeight)-parseInt(e.fontSize))/t/2,a=i.map(function(l){return parseInt(l||"0")/r}),s=_(a,0);return n>s.top&&(s.top=n),n>s.bottom&&(s.bottom=n),s}function Tt(e,t,i,r,n){var a,s;r===void 0&&(r=!1),n===void 0&&(n=!1);var l;typeof t=="string"?l=i.document.querySelector(t):l=t;var h=Object.keys(e.getFontList()),o=e.scaleFactor(),f=[],u=[],g=[];if(!l)return console.error("Html table could not be found with input: ",t),{head:f,body:u,foot:g};for(var p=0;p<l.rows.length;p++){var c=l.rows[p],w=(s=(a=c==null?void 0:c.parentElement)===null||a===void 0?void 0:a.tagName)===null||s===void 0?void 0:s.toLowerCase(),y=ie(h,o,i,c,r,n);y&&(w==="thead"?f.push(y):w==="tfoot"?g.push(y):u.push(y))}return{head:f,body:u,foot:g}}function ie(e,t,i,r,n,a){for(var s=new jt(r),l=0;l<r.cells.length;l++){var h=r.cells[l],o=i.getComputedStyle(h);if(n||o.display!=="none"){var f=void 0;a&&(f=te(e,h,t,o,i)),s.push({rowSpan:h.rowSpan,colSpan:h.colSpan,styles:f,_element:h,content:ne(h)})}}var u=i.getComputedStyle(r);if(s.length>0&&(n||u.display!=="none"))return s}function ne(e){var t=e.cloneNode(!0);return t.innerHTML=t.innerHTML.replace(/\n/g,"").replace(/ +/g," "),t.innerHTML=t.innerHTML.split(/<br.*?>/).map(function(i){return i.trim()}).join(`
`),t.innerText||t.textContent||""}function ae(e,t,i){for(var r=0,n=[e,t,i];r<n.length;r++){var a=n[r];a&&typeof a!="object"&&console.error("The options parameter should be of type object, is: "+typeof a),a.startY&&typeof a.startY!="number"&&(console.error("Invalid value for startY option",a.startY),delete a.startY)}}function R(e,t,i,r,n){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(e),s=1;s<arguments.length;s++){var l=arguments[s];if(l!=null)for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(a[h]=l[h])}return a}function Wt(e,t){var i=new I(e),r=i.getDocumentOptions(),n=i.getGlobalOptions();ae(n,r,t);var a=R({},n,r,t),s;typeof window<"u"&&(s=window);var l=oe(n,r,t),h=se(n,r,t),o=le(i,a),f=fe(i,a,s);return{id:t.tableId,content:f,hooks:h,styles:l,settings:o}}function oe(e,t,i){for(var r={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},n=function(h){if(h==="columnStyles"){var o=e[h],f=t[h],u=i[h];r.columnStyles=R({},o,f,u)}else{var g=[e,t,i],p=g.map(function(c){return c[h]||{}});r[h]=R({},p[0],p[1],p[2])}},a=0,s=Object.keys(r);a<s.length;a++){var l=s[a];n(l)}return r}function se(e,t,i){for(var r=[e,t,i],n={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},a=0,s=r;a<s.length;a++){var l=s[a];l.didParseCell&&n.didParseCell.push(l.didParseCell),l.willDrawCell&&n.willDrawCell.push(l.willDrawCell),l.didDrawCell&&n.didDrawCell.push(l.didDrawCell),l.willDrawPage&&n.willDrawPage.push(l.willDrawPage),l.didDrawPage&&n.didDrawPage.push(l.didDrawPage)}return n}function le(e,t){var i,r,n,a,s,l,h,o,f,u,g,p,c=_(t.margin,40/e.scaleFactor()),w=(i=he(e,t.startY))!==null&&i!==void 0?i:c.top,y;t.showFoot===!0?y="everyPage":t.showFoot===!1?y="never":y=(r=t.showFoot)!==null&&r!==void 0?r:"everyPage";var x;t.showHead===!0?x="everyPage":t.showHead===!1?x="never":x=(n=t.showHead)!==null&&n!==void 0?n:"everyPage";var P=(a=t.useCss)!==null&&a!==void 0?a:!1,C=t.theme||(P?"plain":"striped"),F=!!t.horizontalPageBreak,N=(s=t.horizontalPageBreakRepeat)!==null&&s!==void 0?s:null;return{includeHiddenHtml:(l=t.includeHiddenHtml)!==null&&l!==void 0?l:!1,useCss:P,theme:C,startY:w,margin:c,pageBreak:(h=t.pageBreak)!==null&&h!==void 0?h:"auto",rowPageBreak:(o=t.rowPageBreak)!==null&&o!==void 0?o:"auto",tableWidth:(f=t.tableWidth)!==null&&f!==void 0?f:"auto",showHead:x,showFoot:y,tableLineWidth:(u=t.tableLineWidth)!==null&&u!==void 0?u:0,tableLineColor:(g=t.tableLineColor)!==null&&g!==void 0?g:200,horizontalPageBreak:F,horizontalPageBreakRepeat:N,horizontalPageBreakBehaviour:(p=t.horizontalPageBreakBehaviour)!==null&&p!==void 0?p:"afterAllRows"}}function he(e,t){var i=e.getLastAutoTable(),r=e.scaleFactor(),n=e.pageNumber(),a=!1;if(i&&i.startPageNumber){var s=i.startPageNumber+i.pageNumber-1;a=s===n}return typeof t=="number"?t:(t==null||t===!1)&&a&&(i==null?void 0:i.finalY)!=null?i.finalY+20/r:null}function fe(e,t,i){var r=t.head||[],n=t.body||[],a=t.foot||[];if(t.html){var s=t.includeHiddenHtml;if(i){var l=Tt(e,t.html,i,s,t.useCss)||{};r=l.head||r,n=l.body||r,a=l.foot||r}else console.error("Cannot parse html in non browser environment")}var h=t.columns||de(r,n,a);return{columns:h,head:r,body:n,foot:a}}function de(e,t,i){var r=e[0]||t[0]||i[0]||[],n=[];return Object.keys(r).filter(function(a){return a!=="_element"}).forEach(function(a){var s=1,l;Array.isArray(r)?l=r[parseInt(a)]:l=r[a],typeof l=="object"&&!Array.isArray(l)&&(s=(l==null?void 0:l.colSpan)||1);for(var h=0;h<s;h++){var o=void 0;Array.isArray(r)?o=n.length:o=a+(h>0?"_".concat(h):"");var f={dataKey:o};n.push(f)}}),n}var nt=function(){function e(t,i,r){this.table=i,this.pageNumber=i.pageNumber,this.settings=i.settings,this.cursor=r,this.doc=t.getDocument()}return e}(),ue=function(e){Ct(t,e);function t(i,r,n,a,s,l){var h=e.call(this,i,r,l)||this;return h.cell=n,h.row=a,h.column=s,h.section=a.section,h}return t}(nt),ge=function(){function e(t,i){this.pageNumber=1,this.id=t.id,this.settings=t.settings,this.styles=t.styles,this.hooks=t.hooks,this.columns=i.columns,this.head=i.head,this.body=i.body,this.foot=i.foot}return e.prototype.getHeadHeight=function(t){return this.head.reduce(function(i,r){return i+r.getMaxCellHeight(t)},0)},e.prototype.getFootHeight=function(t){return this.foot.reduce(function(i,r){return i+r.getMaxCellHeight(t)},0)},e.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},e.prototype.callCellHooks=function(t,i,r,n,a,s){for(var l=0,h=i;l<h.length;l++){var o=h[l],f=new ue(t,this,r,n,a,s),u=o(f)===!1;if(r.text=Array.isArray(r.text)?r.text:[r.text],u)return!1}return!0},e.prototype.callEndPageHooks=function(t,i){t.applyStyles(t.userStyles);for(var r=0,n=this.hooks.didDrawPage;r<n.length;r++){var a=n[r];a(new nt(t,this,i))}},e.prototype.callWillDrawPageHooks=function(t,i){for(var r=0,n=this.hooks.willDrawPage;r<n.length;r++){var a=n[r];a(new nt(t,this,i))}},e.prototype.getWidth=function(t){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var i=this.columns.reduce(function(n,a){return n+a.wrappedWidth},0);return i}else{var r=this.settings.margin;return t-r.left-r.right}},e}(),kt=function(){function e(t,i,r,n,a){a===void 0&&(a=!1),this.height=0,this.raw=t,t instanceof jt&&(this.raw=t._element,this.element=t._element),this.index=i,this.section=r,this.cells=n,this.spansMultiplePages=a}return e.prototype.getMaxCellHeight=function(t){var i=this;return t.reduce(function(r,n){var a;return Math.max(r,((a=i.cells[n.index])===null||a===void 0?void 0:a.height)||0)},0)},e.prototype.hasRowSpan=function(t){var i=this;return t.filter(function(r){var n=i.cells[r.index];return n?n.rowSpan>1:!1}).length>0},e.prototype.canEntireRowFit=function(t,i){return this.getMaxCellHeight(i)<=t},e.prototype.getMinimumRowHeight=function(t,i){var r=this;return t.reduce(function(n,a){var s=r.cells[a.index];if(!s)return 0;var l=i.getLineHeight(s.styles.fontSize),h=s.padding("vertical"),o=h+l;return o>n?o:n},0)},e}(),At=function(){function e(t,i,r){var n;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=i,this.section=r,this.raw=t;var a=t;t!=null&&typeof t=="object"&&!Array.isArray(t)?(this.rowSpan=t.rowSpan||1,this.colSpan=t.colSpan||1,a=(n=t.content)!==null&&n!==void 0?n:t,t._element&&(this.raw=t._element)):(this.rowSpan=1,this.colSpan=1);var s=a!=null?""+a:"",l=/\r\n|\r|\n/g;this.text=s.split(l)}return e.prototype.getTextPos=function(){var t;if(this.styles.valign==="top")t=this.y+this.padding("top");else if(this.styles.valign==="bottom")t=this.y+this.height-this.padding("bottom");else{var i=this.height-this.padding("vertical");t=this.y+i/2+this.padding("top")}var r;if(this.styles.halign==="right")r=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var n=this.width-this.padding("horizontal");r=this.x+n/2+this.padding("left")}else r=this.x+this.padding("left");return{x:r,y:t}},e.prototype.getContentHeight=function(t,i){i===void 0&&(i=1.15);var r=Array.isArray(this.text)?this.text.length:1,n=this.styles.fontSize/t*i,a=r*n+this.padding("vertical");return Math.max(a,this.styles.minCellHeight)},e.prototype.padding=function(t){var i=_(this.styles.cellPadding,0);return t==="vertical"?i.top+i.bottom:t==="horizontal"?i.left+i.right:i[t]},e}(),pe=function(){function e(t,i,r){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=t,this.raw=i,this.index=r}return e.prototype.getMaxCustomCellWidth=function(t){for(var i=0,r=0,n=t.allRows();r<n.length;r++){var a=n[r],s=a.cells[this.index];s&&typeof s.styles.cellWidth=="number"&&(i=Math.max(i,s.styles.cellWidth))}return i},e}();function ce(e,t){ve(e,t);var i=[],r=0;t.columns.forEach(function(a){var s=a.getMaxCustomCellWidth(t);s?a.width=s:(a.width=a.wrappedWidth,i.push(a)),r+=a.width});var n=t.getWidth(e.pageSize().width)-r;n&&(n=at(i,n,function(a){return Math.max(a.minReadableWidth,a.minWidth)})),n&&(n=at(i,n,function(a){return a.minWidth})),n=Math.abs(n),!t.settings.horizontalPageBreak&&n>.1/e.scaleFactor()&&(n=n<1?n:Math.round(n),console.warn("Of the table content, ".concat(n," units width could not fit page"))),me(t),we(t,e),ye(t)}function ve(e,t){var i=e.scaleFactor(),r=t.settings.horizontalPageBreak,n=Ht(e,t);t.allRows().forEach(function(a){for(var s=0,l=t.columns;s<l.length;s++){var h=l[s],o=a.cells[h.index];if(o){var f=t.hooks.didParseCell;t.callCellHooks(e,f,o,a,h,null);var u=o.padding("horizontal");o.contentWidth=U(o.text,o.styles,e)+u;var g=U(o.text.join(" ").split(/[^\S\u00A0]+/),o.styles,e);if(o.minReadableWidth=g+o.padding("horizontal"),typeof o.styles.cellWidth=="number")o.minWidth=o.styles.cellWidth,o.wrappedWidth=o.styles.cellWidth;else if(o.styles.cellWidth==="wrap"||r===!0)o.contentWidth>n?(o.minWidth=n,o.wrappedWidth=n):(o.minWidth=o.contentWidth,o.wrappedWidth=o.contentWidth);else{var p=10/i;o.minWidth=o.styles.minCellWidth||p,o.wrappedWidth=o.contentWidth,o.minWidth>o.wrappedWidth&&(o.wrappedWidth=o.minWidth)}}}}),t.allRows().forEach(function(a){for(var s=0,l=t.columns;s<l.length;s++){var h=l[s],o=a.cells[h.index];if(o&&o.colSpan===1)h.wrappedWidth=Math.max(h.wrappedWidth,o.wrappedWidth),h.minWidth=Math.max(h.minWidth,o.minWidth),h.minReadableWidth=Math.max(h.minReadableWidth,o.minReadableWidth);else{var f=t.styles.columnStyles[h.dataKey]||t.styles.columnStyles[h.index]||{},u=f.cellWidth||f.minCellWidth;u&&typeof u=="number"&&(h.minWidth=u,h.wrappedWidth=u)}o&&(o.colSpan>1&&!h.minWidth&&(h.minWidth=o.minWidth),o.colSpan>1&&!h.wrappedWidth&&(h.wrappedWidth=o.minWidth))}})}function at(e,t,i){for(var r=t,n=e.reduce(function(p,c){return p+c.wrappedWidth},0),a=0;a<e.length;a++){var s=e[a],l=s.wrappedWidth/n,h=r*l,o=s.width+h,f=i(s),u=o<f?f:o;t-=u-s.width,s.width=u}if(t=Math.round(t*1e10)/1e10,t){var g=e.filter(function(p){return t<0?p.width>i(p):!0});g.length&&(t=at(g,t,i))}return t}function ye(e){for(var t={},i=1,r=e.allRows(),n=0;n<r.length;n++)for(var a=r[n],s=0,l=e.columns;s<l.length;s++){var h=l[s],o=t[h.index];if(i>1)i--,delete a.cells[h.index];else if(o)o.cell.height+=a.height,i=o.cell.colSpan,delete a.cells[h.index],o.left--,o.left<=1&&delete t[h.index];else{var f=a.cells[h.index];if(!f)continue;if(f.height=a.height,f.rowSpan>1){var u=r.length-n,g=f.rowSpan>u?u:f.rowSpan;t[h.index]={cell:f,left:g,row:a}}}}}function me(e){for(var t=e.allRows(),i=0;i<t.length;i++)for(var r=t[i],n=null,a=0,s=0,l=0;l<e.columns.length;l++){var h=e.columns[l];if(s-=1,s>1&&e.columns[l+1])a+=h.width,delete r.cells[h.index];else if(n){var o=n;delete r.cells[h.index],n=null,o.width=h.width+a}else{var o=r.cells[h.index];if(!o)continue;if(s=o.colSpan,a=0,o.colSpan>1){n=o,a+=h.width;continue}o.width=h.width+a}}}function we(e,t){for(var i={count:0,height:0},r=0,n=e.allRows();r<n.length;r++){for(var a=n[r],s=0,l=e.columns;s<l.length;s++){var h=l[s],o=a.cells[h.index];if(o){t.applyStyles(o.styles,!0);var f=o.width-o.padding("horizontal");if(o.styles.overflow==="linebreak")o.text=t.splitTextToSize(o.text,f+1/t.scaleFactor(),{fontSize:o.styles.fontSize});else if(o.styles.overflow==="ellipsize")o.text=gt(o.text,f,o.styles,t,"...");else if(o.styles.overflow==="hidden")o.text=gt(o.text,f,o.styles,t,"");else if(typeof o.styles.overflow=="function"){var u=o.styles.overflow(o.text,f);typeof u=="string"?o.text=[u]:o.text=u}o.contentHeight=o.getContentHeight(t.scaleFactor(),t.getLineHeightFactor());var g=o.contentHeight/o.rowSpan;o.rowSpan>1&&i.count*i.height<g*o.rowSpan?i={height:g,count:o.rowSpan}:i&&i.count>0&&i.height>g&&(g=i.height),g>a.height&&(a.height=g)}}i.count--}}function gt(e,t,i,r,n){return e.map(function(a){return xe(a,t,i,r,n)})}function xe(e,t,i,r,n){var a=1e4*r.scaleFactor();if(t=Math.ceil(t*a)/a,t>=U(e,i,r))return e;for(;t<U(e+n,i,r)&&!(e.length<=1);)e=e.substring(0,e.length-1);return e.trim()+n}function Rt(e,t){var i=new I(e),r=Se(t,i.scaleFactor()),n=new ge(t,r);return ce(i,n),i.applyStyles(i.userStyles),n}function Se(e,t){var i=e.content,r=Ce(i.columns);if(i.head.length===0){var n=pt(r,"head");n&&i.head.push(n)}if(i.foot.length===0){var n=pt(r,"foot");n&&i.foot.push(n)}var a=e.settings.theme,s=e.styles;return{columns:r,head:X("head",i.head,r,s,a,t),body:X("body",i.body,r,s,a,t),foot:X("foot",i.foot,r,s,a,t)}}function X(e,t,i,r,n,a){var s={},l=t.map(function(h,o){for(var f=0,u={},g=0,p=0,c=0,w=i;c<w.length;c++){var y=w[c];if(s[y.index]==null||s[y.index].left===0)if(p===0){var x=void 0;Array.isArray(h)?x=h[y.index-g-f]:x=h[y.dataKey];var P={};typeof x=="object"&&!Array.isArray(x)&&(P=(x==null?void 0:x.styles)||{});var C=je(e,y,o,n,r,a,P),F=new At(x,C,e);u[y.dataKey]=F,u[y.index]=F,p=F.colSpan-1,s[y.index]={left:F.rowSpan-1,times:p}}else p--,g++;else s[y.index].left--,p=s[y.index].times,f++}return new kt(h,o,e,u)});return l}function pt(e,t){var i={};return e.forEach(function(r){if(r.raw!=null){var n=be(t,r.raw);n!=null&&(i[r.dataKey]=n)}}),Object.keys(i).length>0?i:null}function be(e,t){if(e==="head"){if(typeof t=="object")return t.header||null;if(typeof t=="string"||typeof t=="number")return t}else if(e==="foot"&&typeof t=="object")return t.footer;return null}function Ce(e){return e.map(function(t,i){var r,n;return typeof t=="object"?n=(r=t.dataKey)!==null&&r!==void 0?r:i:n=i,new pe(n,t,i)})}function je(e,t,i,r,n,a,s){var l=Zt(r),h;e==="head"?h=n.headStyles:e==="body"?h=n.bodyStyles:e==="foot"&&(h=n.footStyles);var o=R({},l.table,l[e],n.styles,h),f=n.columnStyles[t.dataKey]||n.columnStyles[t.index]||{},u=e==="body"?f:{},g=e==="body"&&i%2===0?R({},l.alternateRow,n.alternateRowStyles):{},p=Xt(a),c=R({},p,o,g,u);return R(c,s)}function Pe(e,t,i){var r;i===void 0&&(i={});var n=Ht(e,t),a=new Map,s=[],l=[],h=[];Array.isArray(t.settings.horizontalPageBreakRepeat)?h=t.settings.horizontalPageBreakRepeat:(typeof t.settings.horizontalPageBreakRepeat=="string"||typeof t.settings.horizontalPageBreakRepeat=="number")&&(h=[t.settings.horizontalPageBreakRepeat]),h.forEach(function(g){var p=t.columns.find(function(c){return c.dataKey===g||c.index===g});p&&!a.has(p.index)&&(a.set(p.index,!0),s.push(p.index),l.push(t.columns[p.index]),n-=p.wrappedWidth)});for(var o=!0,f=(r=i==null?void 0:i.start)!==null&&r!==void 0?r:0;f<t.columns.length;){if(a.has(f)){f++;continue}var u=t.columns[f].wrappedWidth;if(o||n>=u)o=!1,s.push(f),l.push(t.columns[f]),n-=u;else break;f++}return{colIndexes:s,columns:l,lastIndex:f-1}}function De(e,t){for(var i=[],r=0;r<t.columns.length;r++){var n=Pe(e,t,{start:r});n.columns.length&&(i.push(n),r=n.lastIndex)}return i}function zt(e,t){var i=t.settings,r=i.startY,n=i.margin,a={x:n.left,y:r},s=t.getHeadHeight(t.columns)+t.getFootHeight(t.columns),l=r+n.bottom+s;if(i.pageBreak==="avoid"){var h=t.body,o=h.reduce(function(g,p){return g+p.height},0);l+=o}var f=new I(e);(i.pageBreak==="always"||i.startY!=null&&l>f.pageSize().height)&&(Lt(f),a.y=n.top),t.callWillDrawPageHooks(f,a);var u=R({},a);t.startPageNumber=f.pageNumber(),i.horizontalPageBreak?He(f,t,u,a):(f.applyStyles(f.userStyles),(i.showHead==="firstPage"||i.showHead==="everyPage")&&t.head.forEach(function(g){return z(f,t,g,a,t.columns)}),f.applyStyles(f.userStyles),t.body.forEach(function(g,p){var c=p===t.body.length-1;V(f,t,g,c,u,a,t.columns)}),f.applyStyles(f.userStyles),(i.showFoot==="lastPage"||i.showFoot==="everyPage")&&t.foot.forEach(function(g){return z(f,t,g,a,t.columns)})),Pt(f,t,u,a),t.callEndPageHooks(f,a),t.finalY=a.y,e.lastAutoTable=t,f.applyStyles(f.userStyles)}function He(e,t,i,r){var n=De(e,t),a=t.settings;if(a.horizontalPageBreakBehaviour==="afterAllRows")n.forEach(function(o,f){e.applyStyles(e.userStyles),f>0?Y(e,t,i,r,o.columns,!0):ct(e,t,r,o.columns),Fe(e,t,i,r,o.columns),Z(e,t,r,o.columns)});else for(var s=-1,l=n[0],h=function(){var o=s;if(l){e.applyStyles(e.userStyles);var f=l.columns;s>=0?Y(e,t,i,r,f,!0):ct(e,t,r,f),o=vt(e,t,s+1,r,f),Z(e,t,r,f)}var u=o-s;n.slice(1).forEach(function(g){e.applyStyles(e.userStyles),Y(e,t,i,r,g.columns,!0),vt(e,t,s+1,r,g.columns,u),Z(e,t,r,g.columns)}),s=o};s<t.body.length-1;)h()}function ct(e,t,i,r){var n=t.settings;e.applyStyles(e.userStyles),(n.showHead==="firstPage"||n.showHead==="everyPage")&&t.head.forEach(function(a){return z(e,t,a,i,r)})}function Fe(e,t,i,r,n){e.applyStyles(e.userStyles),t.body.forEach(function(a,s){var l=s===t.body.length-1;V(e,t,a,l,i,r,n)})}function vt(e,t,i,r,n,a){e.applyStyles(e.userStyles),a=a??t.body.length;var s=Math.min(i+a,t.body.length),l=-1;return t.body.slice(i,s).forEach(function(h,o){var f=i+o===t.body.length-1,u=Nt(e,t,f,r);h.canEntireRowFit(u,n)&&(z(e,t,h,r,n),l=i+o)}),l}function Z(e,t,i,r){var n=t.settings;e.applyStyles(e.userStyles),(n.showFoot==="lastPage"||n.showFoot==="everyPage")&&t.foot.forEach(function(a){return z(e,t,a,i,r)})}function Te(e,t,i){var r=i.getLineHeight(e.styles.fontSize),n=e.padding("vertical"),a=Math.floor((t-n)/r);return Math.max(0,a)}function We(e,t,i,r){var n={};e.spansMultiplePages=!0,e.height=0;for(var a=0,s=0,l=i.columns;s<l.length;s++){var h=l[s],o=e.cells[h.index];if(o){Array.isArray(o.text)||(o.text=[o.text]);var f=new At(o.raw,o.styles,o.section);f=R(f,o),f.text=[];var u=Te(o,t,r);o.text.length>u&&(f.text=o.text.splice(u,o.text.length));var g=r.scaleFactor(),p=r.getLineHeightFactor();o.contentHeight=o.getContentHeight(g,p),o.contentHeight>=t&&(o.contentHeight=t,f.styles.minCellHeight-=t),o.contentHeight>e.height&&(e.height=o.contentHeight),f.contentHeight=f.getContentHeight(g,p),f.contentHeight>a&&(a=f.contentHeight),n[h.index]=f}}var c=new kt(e.raw,-1,e.section,n,!0);c.height=a;for(var w=0,y=i.columns;w<y.length;w++){var h=y[w],f=c.cells[h.index];f&&(f.height=c.height);var o=e.cells[h.index];o&&(o.height=e.height)}return c}function ke(e,t,i,r){var n=e.pageSize().height,a=r.settings.margin,s=a.top+a.bottom,l=n-s;t.section==="body"&&(l-=r.getHeadHeight(r.columns)+r.getFootHeight(r.columns));var h=t.getMinimumRowHeight(r.columns,e),o=h<i;if(h>l)return console.error("Will not be able to print row ".concat(t.index," correctly since it's minimum height is larger than page height")),!0;if(!o)return!1;var f=t.hasRowSpan(r.columns),u=t.getMaxCellHeight(r.columns)>l;return u?(f&&console.error("The content of row ".concat(t.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(f||r.settings.rowPageBreak==="avoid")}function V(e,t,i,r,n,a,s){var l=Nt(e,t,r,a);if(i.canEntireRowFit(l,s))z(e,t,i,a,s);else if(ke(e,i,l,t)){var h=We(i,l,t,e);z(e,t,i,a,s),Y(e,t,n,a,s),V(e,t,h,r,n,a,s)}else Y(e,t,n,a,s),V(e,t,i,r,n,a,s)}function z(e,t,i,r,n){r.x=t.settings.margin.left;for(var a=0,s=n;a<s.length;a++){var l=s[a],h=i.cells[l.index];if(!h){r.x+=l.width;continue}e.applyStyles(h.styles),h.x=r.x,h.y=r.y;var o=t.callCellHooks(e,t.hooks.willDrawCell,h,i,l,r);if(o===!1){r.x+=l.width;continue}Ae(e,h,r);var f=h.getTextPos();bt(h.text,f.x,f.y,{halign:h.styles.halign,valign:h.styles.valign,maxWidth:Math.ceil(h.width-h.padding("left")-h.padding("right"))},e.getDocument()),t.callCellHooks(e,t.hooks.didDrawCell,h,i,l,r),r.x+=l.width}r.y+=i.height}function Ae(e,t,i){var r=t.styles;if(e.getDocument().setFillColor(e.getDocument().getFillColor()),typeof r.lineWidth=="number"){var n=Dt(r.lineWidth,r.fillColor);n&&e.rect(t.x,i.y,t.width,t.height,n)}else typeof r.lineWidth=="object"&&(r.fillColor&&e.rect(t.x,i.y,t.width,t.height,"F"),Re(e,t,i,r.lineWidth))}function Re(e,t,i,r){var n,a,s,l;r.top&&(n=i.x,a=i.y,s=i.x+t.width,l=i.y,r.right&&(s+=.5*r.right),r.left&&(n-=.5*r.left),h(r.top,n,a,s,l)),r.bottom&&(n=i.x,a=i.y+t.height,s=i.x+t.width,l=i.y+t.height,r.right&&(s+=.5*r.right),r.left&&(n-=.5*r.left),h(r.bottom,n,a,s,l)),r.left&&(n=i.x,a=i.y,s=i.x,l=i.y+t.height,r.top&&(a-=.5*r.top),r.bottom&&(l+=.5*r.bottom),h(r.left,n,a,s,l)),r.right&&(n=i.x+t.width,a=i.y,s=i.x+t.width,l=i.y+t.height,r.top&&(a-=.5*r.top),r.bottom&&(l+=.5*r.bottom),h(r.right,n,a,s,l));function h(o,f,u,g,p){e.getDocument().setLineWidth(o),e.getDocument().line(f,u,g,p,"S")}}function Nt(e,t,i,r){var n=t.settings.margin.bottom,a=t.settings.showFoot;return(a==="everyPage"||a==="lastPage"&&i)&&(n+=t.getFootHeight(t.columns)),e.pageSize().height-r.y-n}function Y(e,t,i,r,n,a){n===void 0&&(n=[]),a===void 0&&(a=!1),e.applyStyles(e.userStyles),t.settings.showFoot==="everyPage"&&!a&&t.foot.forEach(function(l){return z(e,t,l,r,n)}),t.callEndPageHooks(e,r);var s=t.settings.margin;Pt(e,t,i,r),Lt(e),t.pageNumber++,r.x=s.left,r.y=s.top,i.y=s.top,t.callWillDrawPageHooks(e,r),t.settings.showHead==="everyPage"&&(t.head.forEach(function(l){return z(e,t,l,r,n)}),e.applyStyles(e.userStyles))}function Lt(e){var t=e.pageNumber();e.setPage(t+1);var i=e.pageNumber();return i===t?(e.addPage(),!0):!1}function ze(e){e.API.autoTable=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=t[0],n=Wt(this,r),a=Rt(this,n);return zt(this,a),this},e.API.lastAutoTable=!1,e.API.autoTableText=function(t,i,r,n){bt(t,i,r,n,this)},e.API.autoTableSetDefaults=function(t){return I.setDefaults(t,this),this},e.autoTableSetDefaults=function(t,i){I.setDefaults(t,i)},e.API.autoTableHtmlToJson=function(t,i){var r;if(i===void 0&&(i=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var n=new I(this),a=Tt(n,t,window,i,!1),s=a.head,l=a.body,h=((r=s[0])===null||r===void 0?void 0:r.map(function(o){return o.content}))||[];return{columns:h,rows:l,data:l}}}var tt;function Ne(e,t){var i=Wt(e,t),r=Rt(e,i);zt(e,r)}try{if(typeof window<"u"&&window){var yt=window,mt=yt.jsPDF||((tt=yt.jspdf)===null||tt===void 0?void 0:tt.jsPDF);mt&&ze(mt)}}catch(e){console.error("Could not apply autoTable plugin",e)}const wt=({label:e,value:t,onChange:i})=>{const[r,n]=D.useState([]);return D.useEffect(()=>{(async()=>{const l=(await M(E(j,"villes"))).docs.map(h=>h.data().nom);n(l)})()},[]),v.jsxs("div",{children:[v.jsx("label",{className:"block font-medium mb-1",children:e}),v.jsx("input",{list:"liste-villes",className:"w-full border px-3 py-2 rounded",value:t,onChange:a=>i(a.target.value),placeholder:"Entrer une ville"}),v.jsx("datalist",{id:"liste-villes",children:r.map((a,s)=>v.jsx("option",{value:a},s))})]})},Le=async(e,t)=>{const i=n=>n.trim().toLowerCase().replace(/\s+/g," ").replace(/\b\w/g,a=>a.toUpperCase()),r=[e,t].map(i);for(const n of r){const a=A(j,"villes",n);(await rt(a)).exists()||await Ut(a,{nom:n})}};console.log("🚍 AgenceTrajetsPage affichée !");const et=["lundi","mardi","mercredi","jeudi","vendredi","samedi","dimanche"],Oe=()=>{const{user:e}=Vt(),[t,i]=D.useState(""),[r,n]=D.useState(""),[a,s]=D.useState(""),[l,h]=D.useState(""),[o,f]=D.useState({}),[u,g]=D.useState(""),[p,c]=D.useState(!1),[w,y]=D.useState([]),[x,P]=D.useState(null),[C,F]=D.useState(null),[N,Et]=D.useState(""),[$,ot]=D.useState(""),[q,G]=D.useState(1),st=10;D.useEffect(()=>{K()},[e,q,N,$]);const K=async()=>{if(!(e!=null&&e.agencyId))return;const d=O(E(j,"weeklyTrips"),W("agencyId","==",e.agencyId)),k=(await M(d)).docs.map(T=>({id:T.id,...T.data()})).sort((T,B)=>{var L,ht;return(((L=B.createdAt)==null?void 0:L.seconds)||0)-(((ht=T.createdAt)==null?void 0:ht.seconds)||0)}).filter(T=>{var B,L;return(T.departure.toLowerCase().includes(N.toLowerCase())||T.arrival.toLowerCase().includes(N.toLowerCase()))&&($===""||((L=(B=T.horaires)==null?void 0:B[$])==null?void 0:L.length)>0)}).slice((q-1)*st,q*st);y(k)},Bt=async d=>{if(confirm("Voulez-vous vraiment supprimer ce trajet ?")){c(!0);try{await ft(A(j,"weeklyTrips",d));const m=await M(O(E(j,"dailyTrips"),W("weeklyTripId","==",d)));for(const S of m.docs)await ft(A(j,"dailyTrips",S.id));K(),g("🗑️ Trajet supprimé avec succès.")}catch(m){console.error(m),g("❌ Erreur lors de la suppression du trajet.")}finally{c(!1)}}},Mt=(d,m,S)=>{f(b=>{const H={...b};return H[d]||(H[d]=[]),H[d][m]=S,H})},It=d=>{f(m=>({...m,[d]:[...m[d]||[],""]}))},$t=(d,m)=>{f(S=>{const b={...S};return b[d]?(b[d].splice(m,1),b):S})},lt=d=>d.charAt(0).toUpperCase()+d.slice(1).toLowerCase(),Ot=()=>{i(""),n(""),s(""),h(""),f({}),F(null)},Yt=()=>{const d=new _t;d.text("Liste des trajets",14,14),Ne(d,{head:[["Départ","Arrivée","Prix","Places"]],body:w.map(m=>[m.departure,m.arrival,`${m.price} FCFA`,m.places||""])}),d.save("trajets_agence.pdf")},qt=async()=>{if(!(e!=null&&e.agencyId)||!(e!=null&&e.companyId))return g("Agence ou compagnie non reconnue.");c(!0),g("");const d={};for(const b in o){const H=o[b].filter(k=>k&&k.trim()!=="");H.length>0&&(d[b]=H)}const m=lt(t.trim()),S=lt(r.trim());if(!m||!S||!a.trim()||!l.trim()||Object.keys(d).length===0)return c(!1),g("Merci de remplir tous les champs y compris le nombre de places.");try{if(C){const b=A(j,"weeklyTrips",C);await J(b,{departure:m,arrival:S,price:parseInt(a),places:parseInt(l),horaires:d}),await dt(C),g("✅ Trajet modifié avec succès.")}else{await Gt(e.companyId,m,S,parseInt(a),d,parseInt(l),e.agencyId),await Le(m,S);const H=(await M(O(E(j,"weeklyTrips"),W("agencyId","==",e.agencyId)))).docs.filter(k=>k.data().departure===m&&k.data().arrival===S).sort((k,T)=>{var B,L;return(((B=T.data().createdAt)==null?void 0:B.seconds)||0)-(((L=k.data().createdAt)==null?void 0:L.seconds)||0)})[0];H&&await dt(H.id),g("✅ Trajet ajouté avec succès !")}Ot(),K()}catch(b){console.error(b),g("❌ Erreur lors de l'enregistrement du trajet.")}finally{c(!1)}},Kt=async(d,m)=>{c(!0);try{await J(A(j,"weeklyTrips",d),{active:!m});const S=await M(O(E(j,"dailyTrips"),W("weeklyTripId","==",d)));for(const b of S.docs)await J(A(j,"dailyTrips",b.id),{active:!m});K(),g(m?"🚫 Trajet désactivé.":"✅ Trajet activé.")}catch(S){console.error(S),g("❌ Erreur lors du changement d'état.")}finally{c(!1)}},Jt=d=>{i(d.departure),n(d.arrival),s(d.price.toString()),h((d.places||"").toString()),f(d.horaires),F(d.id),window.scrollTo({top:0,behavior:"smooth"})};return v.jsxs("div",{className:"p-4 grid md:grid-cols-2 gap-6",children:[v.jsxs("div",{children:[v.jsx("h2",{className:"text-xl font-bold mb-4",children:C?"Modifier le trajet":"Ajouter un trajet"}),v.jsxs("div",{className:"mb-4 flex flex-col gap-2",children:[v.jsx(wt,{label:"Ville de départ",value:t,onChange:i}),v.jsx(wt,{label:"Ville d'arrivée",value:r,onChange:n}),v.jsx("input",{type:"number",placeholder:"Prix",value:a,onChange:d=>s(d.target.value),className:"border p-2"}),v.jsx("input",{type:"number",placeholder:"Nombre de places",value:l,onChange:d=>h(d.target.value),className:"border p-2"})]}),et.map(d=>v.jsxs("div",{className:"mb-2",children:[v.jsxs("p",{className:"font-semibold",children:[d," :"]}),(o[d]||[]).map((m,S)=>v.jsxs("div",{className:"flex gap-2 my-1",children:[v.jsx("input",{type:"time",value:m,onChange:b=>Mt(d,S,b.target.value),className:"border p-1"}),v.jsx("button",{type:"button",onClick:()=>$t(d,S),className:"text-red-600",children:"Supprimer"})]},S)),v.jsx("button",{type:"button",onClick:()=>It(d),className:"bg-blue-500 text-white px-2 py-1 rounded mt-1",children:"+ Ajouter une heure"})]},d)),v.jsx("button",{onClick:qt,disabled:p,className:"mt-4 bg-green-600 text-white px-4 py-2 rounded",children:p?"Traitement en cours...":C?"Mettre à jour":"Ajouter le trajet"}),u&&v.jsx("p",{className:"mt-2 text-sm text-blue-700 font-semibold",children:u})]}),v.jsxs("div",{children:[v.jsxs("div",{className:"flex justify-between items-center mb-4",children:[v.jsx("h2",{className:"text-xl font-bold",children:"Liste des trajets"}),v.jsx("button",{onClick:Yt,className:"bg-purple-600 text-white px-3 py-1 rounded",children:"📄 Exporter en PDF"})]}),v.jsx("input",{type:"text",placeholder:"Rechercher...",value:N,onChange:d=>{Et(d.target.value),G(1)},className:"border mb-4 p-2 w-full"}),v.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[v.jsx("button",{onClick:()=>ot(""),className:`px-3 py-1 rounded ${$===""?"bg-blue-700 text-white":"bg-gray-200"}`,children:"Tous"}),et.map(d=>v.jsx("button",{onClick:()=>ot(d),className:`px-3 py-1 rounded ${$===d?"bg-blue-700 text-white":"bg-gray-200"}`,children:d},d))]}),w.map(d=>v.jsxs("div",{className:"border rounded p-3 mb-2 shadow",children:[v.jsxs("div",{className:`cursor-pointer font-semibold ${d.active?"text-green-700":"text-red-500"}`,onClick:()=>P(x===d.id?null:d.id),children:[d.departure," → ",d.arrival," (",d.active?"Actif":"Inactif",")"]}),x===d.id&&v.jsxs("div",{className:"mt-2 text-sm",children:[v.jsxs("p",{children:["Prix : ",d.price," FCFA"]}),v.jsxs("p",{children:["Places : ",d.places||"NC"]}),et.map(m=>{var H;const S=(H=d.horaires)==null?void 0:H[m];if(!S||S.length===0)return null;const b=[...S].sort();return v.jsxs("p",{children:[v.jsxs("strong",{children:[m," :"]})," ",b.join(", ")]},m)}),v.jsxs("div",{className:"mt-2 flex gap-2 flex-wrap",children:[v.jsx("button",{onClick:()=>Bt(d.id),disabled:p,className:"bg-red-600 text-white px-2 py-1 rounded",children:"Supprimer"}),v.jsx("button",{onClick:()=>Jt(d),disabled:p,className:"bg-yellow-500 text-white px-2 py-1 rounded",children:"Modifier"}),v.jsx("button",{onClick:()=>Kt(d.id,d.active),disabled:p,className:`px-2 py-1 rounded text-white ${d.active?"bg-gray-600":"bg-green-600"}`,children:d.active?"Désactiver":"Activer"})]})]})]},d.id)),!p&&w.length===0&&v.jsx("div",{className:"text-gray-600 text-sm text-center mt-4",children:"Aucun trajet enregistré pour cette agence."}),v.jsxs("div",{className:"flex justify-between mt-4",children:[v.jsx("button",{onClick:()=>G(d=>Math.max(1,d-1)),disabled:q===1,className:"bg-gray-300 px-3 py-1 rounded",children:"Précédent"}),v.jsx("button",{onClick:()=>G(d=>d+1),className:"bg-gray-300 px-3 py-1 rounded",children:"Suivant"})]})]})]})};export{Oe as default};
