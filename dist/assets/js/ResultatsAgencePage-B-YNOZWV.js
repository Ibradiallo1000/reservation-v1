import{u as fe,b as be,b5 as ye,r as n,j as e,d as je,e as Ne,M as ve,f as we,aV as J,T as ke,Q as Ce}from"./react-BKlva80Y.js";import{q as F,j as U,w as b,k as q}from"./firebase-1zyXmG6H.js";import{d as M}from"../index-DdVw6ij9.js";import"./vendor-CZDa83Cj.js";const y=(a,p=1)=>{const h=parseInt(a.slice(1,3),16),j=parseInt(a.slice(3,5),16),w=parseInt(a.slice(5,7),16);return`rgba(${h}, ${j}, ${w}, ${p})`},K=a=>{if(a.length<7)return"#000000";const p=parseInt(a.slice(1,3),16),h=parseInt(a.slice(3,5),16),j=parseInt(a.slice(5,7),16);return(.299*p+.587*h+.114*j)/255>.5?"#000000":"#ffffff"},Ie=({company:a})=>{const p=fe(),{slug:h}=be(),[j]=ye(),w=j.get("departure")||"",W=j.get("arrival")||"",z=t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),N=z(w),k=z(W),[d,X]=n.useState(null),[Se,$e]=n.useState(null),[V,Z]=n.useState([]),[ee,C]=n.useState(!0),[Q,D]=n.useState(null),[se,re]=n.useState([]),[S,_]=n.useState(""),[v,A]=n.useState(""),te=n.useMemo(()=>{const t=a.couleurPrimaire||"#3b82f6",l=a.couleurSecondaire||"#93c5fd";return{colors:{primary:t,secondary:l,text:K(t),textOnPrimary:K(t),background:"#ffffff"},classes:{card:"bg-white rounded-xl shadow-sm border border-gray-200",button:"transition-all hover:scale-105 active:scale-95",animations:"transition-all duration-300 ease-in-out",header:"sticky top-0 z-50 px-4 py-3"}}},[a]),{colors:r,classes:f}=te,ae=t=>{const l=new Date;return Array.from({length:t},(i,c)=>{const o=new Date(l);return o.setDate(l.getDate()+c),o.toISOString().split("T")[0]})};n.useEffect(()=>{(async()=>{if(!a.id){D("Compagnie non disponible"),C(!1);return}try{const l=F(U(M,"agences"),b("ville","==",N),b("companyId","==",a.id)),i=await q(l);if(!i.empty){const c=i.docs[0],o=c.data();X({id:c.id,ville:o.ville,quartier:o.quartier,pays:o.pays,telephone:o.telephone,nomAgence:o.nomAgence})}}catch(l){console.error("Erreur Firestore:",l),D("Erreur lors du chargement des agences")}finally{C(!1)}})()},[a.id,N]),n.useEffect(()=>{(async()=>{if(d!=null&&d.id){C(!0);try{const l=ae(8),i=["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],c=F(U(M,"reservations"),b("statut","==","payé")),x=(await q(c)).docs.map(m=>m.data()),T=F(U(M,"weeklyTrips"),b("agencyId","==",d.id),b("departure","==",N),b("arrival","==",k),b("active","==",!0)),I=await q(T),s=[];for(const m of I.docs){const E=m.data(),{horaires:R,price:ce,places:de=30,agencyId:me,companyId:ue}=E;for(const $ of l){const xe=new Date($),ge=i[xe.getDay()],B=(R==null?void 0:R[ge])||[];if(B.length!==0)for(const L of B){const G=`${m.id}_${$}_${L.replace(/\s+/g,"")}`,pe=new Date(`${$}T${L}`),he=x.filter(O=>O.trajetId===G).reduce((O,Y)=>O+(Y.seatsGo||1)+(Y.seatsReturn||0),0),H=Math.max(0,de-he);pe>new Date&&s.push({id:G,departure:E.departure,arrival:E.arrival,date:$,time:L,price:ce,places:H,companyId:ue,agencyId:me,compagnieNom:a.nom,logoUrl:a.logoUrl,remainingSeats:H})}}}const g={};s.forEach(m=>{g[m.date]||(g[m.date]=[]),g[m.date].push(m)}),re(Object.keys(g)),_(m=>g[m]?m:Object.keys(g)[0]||""),Z(s)}catch(l){console.error("Erreur Firestore:",l),D("Erreur lors du chargement des trajets aller")}finally{C(!1)}}})()},[d==null?void 0:d.id,N,k,a.nom,a.logoUrl]);const u=n.useMemo(()=>V.filter(t=>t.date===S),[V,S]);n.useEffect(()=>{var t;if(u.length>0){const i=((t=[...u].sort((c,o)=>c.time.localeCompare(o.time))[0])==null?void 0:t.time)||"";A(c=>u.some(x=>x.time===c)?c:i)}else A("")},[S,u]);const P=(t,l)=>new Date(`${t}T${l}`).getTime()<new Date().getTime(),le=t=>new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"}),oe=t=>{t&&p(`/${h}/booking`,{state:{tripData:t,companyInfo:{id:a.id,nom:a.nom,logoUrl:a.logoUrl,primaryColor:r.primary,slug:a.slug}}})},ne=n.useMemo(()=>{var t;return((t=u.find(l=>l.time===v))==null?void 0:t.price)||0},[v,u]);if(ee)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",style:{background:r.background},children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2",style:{borderColor:r.primary}})});if(Q)return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen p-4 text-center",style:{background:r.background},children:e.jsxs("div",{className:`p-4 rounded-lg max-w-md ${f.card}`,children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-gray-900",children:"Erreur"}),e.jsx("p",{className:"text-gray-700",children:Q}),e.jsx("button",{onClick:()=>p(`/compagnie/${h}`),className:`mt-4 px-4 py-2 rounded ${f.button}`,style:{backgroundColor:r.primary,color:r.textOnPrimary},children:"Retour à la compagnie"})]})});const ie=(t,l,i,c,o,x,T)=>{const I=l.length>0;return e.jsxs("div",{className:`p-4 rounded-xl mb-6 ${f.card}`,children:[e.jsx("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:e.jsxs("span",{children:[N," → ",k]})}),d&&e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 rounded-full",style:{backgroundColor:y(r.primary,.1),color:r.primary},children:e.jsx(ve,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-gray-800",children:[e.jsx("h3",{className:"font-semibold",children:d.nomAgence}),e.jsxs("p",{className:"text-sm opacity-80",children:[d.ville,", ",d.quartier," • ☎ ",d.telephone]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2 text-gray-800",children:[e.jsx(we,{className:"h-5 w-5",style:{color:r.primary}}),"Dates disponibles"]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-4 scrollbar-hide",children:o.map(s=>e.jsxs("button",{onClick:()=>c(s),className:`flex flex-col items-center min-w-[90px] p-3 rounded-xl border transition-all flex-shrink-0 ${i===s?"shadow-md":"bg-white hover:bg-gray-50 border-gray-200 text-gray-800"}`,style:{backgroundColor:i===s?r.primary:void 0,borderColor:i===s?r.primary:void 0,color:i===s?r.textOnPrimary:void 0},children:[e.jsx("span",{className:"text-xs font-medium",children:le(s)}),e.jsx("span",{className:"text-sm mt-1",children:new Date(s).toLocaleDateString("fr-FR",{day:"numeric"})})]},s))})]}),I?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:`rounded-xl overflow-hidden ${f.card}`,children:[e.jsxs("div",{className:"p-4 border-b",style:{borderColor:y(r.primary,.1)},children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2 mb-3 text-gray-800",children:[e.jsx(J,{className:"h-5 w-5",style:{color:r.primary}}),"Heures de départ"]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-2",children:l.sort((s,g)=>s.time.localeCompare(g.time)).map(s=>e.jsxs("button",{onClick:()=>T(s.time),disabled:P(s.date,s.time),className:`p-3 rounded-lg border flex flex-col items-center transition ${x===s.time?"bg-blue-50 text-blue-600":P(s.date,s.time)?"bg-gray-50 text-gray-400":"border-gray-200 hover:border-blue-300 hover:bg-blue-50 text-gray-800"}`,style:{borderColor:x===s.time?r.primary:void 0,backgroundColor:x===s.time?y(r.primary,.1):void 0},children:[e.jsx("span",{className:"font-medium",children:s.time}),e.jsxs("span",{className:"text-xs mt-1",children:[s.places," places"]})]},s.id))})]}),l.filter(s=>s.time===x&&!P(s.date,s.time)).map(s=>e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4 text-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full",style:{backgroundColor:y(r.primary,.1),color:r.primary},children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium opacity-80",children:"Prix"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:[s.price.toLocaleString()," FCFA"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full",style:{backgroundColor:y(r.primary,.1),color:r.primary},children:e.jsx(Ce,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium opacity-90",children:"Places disponibles"}),e.jsx("p",{className:`text-lg font-bold ${s.places===0?"text-red-600":s.places<=10?"text-yellow-600":"text-green-600"}`,children:s.places})]})]})]})},s.id))]})}):e.jsxs("div",{className:`p-6 rounded-xl text-center ${f.card} text-gray-800`,children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-full inline-flex mb-3",children:e.jsx(J,{className:"h-6 w-6 text-gray-500"})}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"Aucun trajet disponible pour cette date"}),e.jsx("p",{className:"text-sm opacity-80",children:"Veuillez choisir une autre date"})]})]})};return e.jsxs("div",{className:"min-h-screen",style:{background:r.background,color:r.text},children:[e.jsx("header",{className:f.header,style:{backgroundColor:y(r.primary,.95),color:r.textOnPrimary,backdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex items-center gap-4 max-w-7xl mx-auto",children:[e.jsx("button",{onClick:()=>p(`/compagnie/${h}`),className:"p-2 rounded-full hover:bg-white/10 transition",style:{color:r.textOnPrimary},children:e.jsx(je,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.logoUrl&&e.jsx(Ne.LazyLoadImage,{src:a.logoUrl,alt:`Logo ${a.nom}`,effect:"blur",className:"h-8 w-8 rounded-full object-cover border-2",style:{borderColor:r.textOnPrimary,backgroundColor:y(r.primary,.2)}}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:a.nom}),e.jsx("p",{className:"text-8sm font-medium text-white opacity-100",children:"Résultats"})]})]})]})}),e.jsxs("main",{className:"max-w-4xl mx-auto p-4 sm:p-6 pb-24",children:[ie(`${N} → ${k}`,u,S,_,se,v,A),e.jsx("div",{className:"sticky bottom-6 bg-white shadow-lg p-4 border-t border-gray-200",children:e.jsxs("div",{className:"max-w-4xl mx-auto flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[ne.toLocaleString()," FCFA"]})]}),e.jsx("button",{onClick:()=>oe(u.find(t=>t.time===v)||null),disabled:!v,className:`px-6 py-3 rounded-lg font-bold ${f.button} ${v?"":"opacity-50 cursor-not-allowed"}`,style:{backgroundColor:r.primary,color:r.textOnPrimary},children:"Réserver maintenant"})]})})]})]})};export{Ie as default};
