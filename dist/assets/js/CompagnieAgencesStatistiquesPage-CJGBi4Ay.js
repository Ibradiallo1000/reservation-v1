import{r as d,j as t}from"./react-Bg_vEni-.js";import{h as p,q as h,w as m,f as g}from"./firebase-C3aZpI0W.js";import{u as v,d as j}from"../index-Dgt8Lr4V.js";import{R as N,B as w,X as C,Y as S,T as A,a as R}from"./BarChart-C-khxpHp.js";import{C as M}from"./CartesianGrid-DsUeTV-4.js";import"./vendor-D_4iK-Jm.js";const F=()=>{const{user:o}=v(),[i,u]=d.useState([]),[b,x]=d.useState(!0),y=async()=>{if(!(o!=null&&o.companyId))return;x(!0);const l=(await p(h(g(j,"agences"),m("companyId","==",o.companyId)))).docs.map(e=>({id:e.id,ville:e.data().ville})),c=await p(h(g(j,"reservations"),m("compagnieId","==",o.companyId),m("statut","==","pay√©"))),a={};l.forEach(e=>{a[e.id]={id:e.id,ville:e.ville,totalReservations:0,totalMontant:0,totalPassagers:0}}),c.docs.forEach(e=>{const s=e.data(),r=s.agencyId;a[r]&&(a[r].totalReservations+=1,a[r].totalMontant+=s.montant||0,a[r].totalPassagers+=s.seatsGo||1)}),u(Object.values(a)),x(!1)},f=()=>{const l=[["Agence","Billets vendus","Passagers","Montant total (FCFA)"],...i.map(s=>[s.ville,s.totalReservations,s.totalPassagers,s.totalMontant])].map(s=>s.join(",")).join(`
`),c=new Blob([l],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(c),e=document.createElement("a");e.setAttribute("href",a),e.setAttribute("download","statistiques_agences.csv"),document.body.appendChild(e),e.click(),document.body.removeChild(e)};return d.useEffect(()=>{y()},[]),t.jsxs("div",{className:"p-6",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Statistiques par Agence"}),t.jsxs("div",{className:"flex justify-end gap-2 mb-4",children:[t.jsx("button",{onClick:f,className:"bg-green-600 text-white px-4 py-2 rounded text-sm",children:"üì• Export CSV"}),t.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded text-sm",children:"üñ®Ô∏è Imprimer"})]}),b?t.jsx("p",{children:"Chargement..."}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"overflow-x-auto mb-6",children:t.jsxs("table",{className:"w-full border text-sm",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"border px-3 py-2",children:"Agence"}),t.jsx("th",{className:"border px-3 py-2",children:"R√©servations"}),t.jsx("th",{className:"border px-3 py-2",children:"Passagers"}),t.jsx("th",{className:"border px-3 py-2",children:"Montant encaiss√© (FCFA)"})]})}),t.jsx("tbody",{children:i.map(n=>t.jsxs("tr",{className:"text-center",children:[t.jsx("td",{className:"border px-3 py-2",children:n.ville}),t.jsx("td",{className:"border px-3 py-2",children:n.totalReservations}),t.jsx("td",{className:"border px-3 py-2",children:n.totalPassagers}),t.jsx("td",{className:"border px-3 py-2 font-semibold text-green-600",children:n.totalMontant.toLocaleString()})]},n.id))})]})}),t.jsxs("div",{className:"bg-white shadow p-4 rounded-lg",children:[t.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Visualisation graphique"}),t.jsx(N,{width:"100%",height:300,children:t.jsxs(w,{data:i,margin:{top:10,right:30,left:0,bottom:0},children:[t.jsx(M,{strokeDasharray:"3 3"}),t.jsx(C,{dataKey:"ville"}),t.jsx(S,{}),t.jsx(A,{}),t.jsx(R,{dataKey:"totalMontant",fill:"#facc15",name:"Montant encaiss√©"})]})})]})]})]})};export{F as default};
