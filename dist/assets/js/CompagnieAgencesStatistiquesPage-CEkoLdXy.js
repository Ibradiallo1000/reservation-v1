import{r as c,j as t}from"./react-PtMwKKf1.js";import{l as p,k as x,q as f,w as v}from"./firebase-eGIzIftJ.js";import{u as N,d as h}from"../index-C4y8wfzK.js";import{R as w,B as C,X as S,Y as A,T as R,a as M}from"./BarChart-B1M1C7N-.js";import{C as P}from"./CartesianGrid-Xzbg7DSv.js";import"./vendor-B5FTF_2c.js";const L=()=>{const{user:r}=N(),[i,g]=c.useState([]),[u,d]=c.useState(!0),j=async()=>{if(!(r!=null&&r.companyId))return;d(!0);const l=(await p(x(h,"companies",r.companyId,"agences"))).docs.map(e=>({id:e.id,ville:e.data().ville})),a={};for(const e of l){a[e.id]={id:e.id,ville:e.ville,totalReservations:0,totalMontant:0,totalPassagers:0};const n=f(x(h,"companies",r.companyId,"agences",e.id,"reservations"),v("statut","==","pay√©"));(await p(n)).docs.forEach(y=>{const m=y.data();a[e.id].totalReservations+=1,a[e.id].totalMontant+=m.montant||0,a[e.id].totalPassagers+=m.seatsGo||1})}g(Object.values(a)),d(!1)},b=()=>{const l=[["Agence","Billets vendus","Passagers","Montant total (FCFA)"],...i.map(o=>[o.ville,o.totalReservations,o.totalPassagers,o.totalMontant])].map(o=>o.join(",")).join(`
`),a=new Blob([l],{type:"text/csv;charset=utf-8;"}),e=URL.createObjectURL(a),n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download","statistiques_agences.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n)};return c.useEffect(()=>{j()},[]),t.jsxs("div",{className:"p-6",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Statistiques par Agence"}),t.jsxs("div",{className:"flex justify-end gap-2 mb-4",children:[t.jsx("button",{onClick:b,className:"bg-green-600 text-white px-4 py-2 rounded text-sm",children:"üì• Export CSV"}),t.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded text-sm",children:"üñ®Ô∏è Imprimer"})]}),u?t.jsx("p",{children:"Chargement..."}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"overflow-x-auto mb-6",children:t.jsxs("table",{className:"w-full border text-sm",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"border px-3 py-2",children:"Agence"}),t.jsx("th",{className:"border px-3 py-2",children:"R√©servations"}),t.jsx("th",{className:"border px-3 py-2",children:"Passagers"}),t.jsx("th",{className:"border px-3 py-2",children:"Montant encaiss√© (FCFA)"})]})}),t.jsx("tbody",{children:i.map(s=>t.jsxs("tr",{className:"text-center",children:[t.jsx("td",{className:"border px-3 py-2",children:s.ville}),t.jsx("td",{className:"border px-3 py-2",children:s.totalReservations}),t.jsx("td",{className:"border px-3 py-2",children:s.totalPassagers}),t.jsx("td",{className:"border px-3 py-2 font-semibold text-green-600",children:s.totalMontant.toLocaleString()})]},s.id))})]})}),t.jsxs("div",{className:"bg-white shadow p-4 rounded-lg",children:[t.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Visualisation graphique"}),t.jsx(w,{width:"100%",height:300,children:t.jsxs(C,{data:i,margin:{top:10,right:30,left:0,bottom:0},children:[t.jsx(P,{strokeDasharray:"3 3"}),t.jsx(S,{dataKey:"ville"}),t.jsx(A,{}),t.jsx(R,{}),t.jsx(M,{dataKey:"totalMontant",fill:"#facc15",name:"Montant encaiss√©"})]})})]})]})]})};export{L as default};
