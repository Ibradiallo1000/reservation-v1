import{u as N,h as C,r as p,j as a}from"./react-CdtEOh9s.js";import{h as L,q as S,f as $,d as T,c as F}from"./firebase-C3aZpI0W.js";import{d as j}from"../index-BEWNaqTF.js";import"./vendor-D_1n0kdO.js";const A=()=>{const m=N(),e=C().state,[g,b]=p.useState({}),[v,x]=p.useState(!0),[h,y]=p.useState("");return p.useEffect(()=>{if(!(e!=null&&e.departure)||!(e!=null&&e.arrival)){console.warn("🔁 Redirection car critères absents :",e),m("/");return}(async()=>{const c=s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase(),f=c(e.departure),l=c(e.arrival);x(!0);try{const s=await L(S($(j,"dailyTrips"))),u=new Date,i=[];for(const r of s.docs){const t=r.data();if(t.departure===f&&t.arrival===l&&t.date&&t.time&&t.price&&t.companyId&&new Date(`${t.date}T${t.time}`)>u){const w=T(j,"companies",t.companyId),d=await F(w);i.push({id:r.id,...t,compagnieNom:d.exists()?d.data().nom:"Inconnue",logoUrl:d.exists()?d.data().logoUrl:""})}}const n={};for(const r of i){const t=`${r.companyId}|${r.compagnieNom}|${r.logoUrl||""}`;n[t]||(n[t]=[]),n[t].push(r)}b(n)}catch(s){console.error("Erreur Firestore :",s)}finally{x(!1)}})()},[e,m]),!(e!=null&&e.departure)||!(e!=null&&e.arrival)?null:a.jsxs("div",{className:"p-6",children:[a.jsx("h2",{className:"text-xl font-bold mb-6",children:"Trajets disponibles – Plateforme"}),a.jsx("input",{type:"text",placeholder:"Filtrer par compagnie...",value:h,onChange:o=>y(o.target.value),className:"mb-6 border border-gray-300 rounded px-3 py-2 w-full max-w-md"}),v?a.jsx("p",{children:"Chargement..."}):Object.keys(g).length===0?a.jsx("p",{className:"text-red-600",children:"Aucun trajet trouvé."}):Object.entries(g).filter(([o])=>o.toLowerCase().includes(h.toLowerCase())).map(([o,c])=>{const[f,l,s]=o.split("|"),u=l.toLowerCase().replace(/\s+/g,"-").trim(),i=Math.min(...c.map(n=>n.price));return a.jsxs("div",{className:"border rounded-xl p-4 mb-6 shadow-md bg-white flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[s&&a.jsx("img",{src:s,alt:"Logo",className:"w-12 h-12 rounded-full object-cover"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:l}),a.jsxs("p",{className:"text-sm text-gray-500",children:[e==null?void 0:e.departure," → ",e==null?void 0:e.arrival]}),a.jsxs("p",{className:"text-sm text-green-700 font-semibold",children:["À partir de ",i.toLocaleString()," FCFA"]})]})]}),a.jsx("button",{onClick:()=>m(`/compagnie/${u}/resultats?departure=${e==null?void 0:e.departure}&arrival=${e==null?void 0:e.arrival}`),className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-sm",children:"Réserver"})]},o)})]})};export{A as default};
