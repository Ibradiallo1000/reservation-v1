import{a as w,j as y}from"./react-KXT1Riez.js";import{E as x}from"./vendor-B27hBV_J.js";import{F as I,t as v,x as D}from"./firebase-DYTOaTLw.js";import{u as f,d as j}from"../index-b0dmvJTQ.js";const t=[];for(let e=0;e<256;++e)t.push((e+256).toString(16).slice(1));function C(e,n=0){return(t[e[n+0]]+t[e[n+1]]+t[e[n+2]]+t[e[n+3]]+"-"+t[e[n+4]]+t[e[n+5]]+"-"+t[e[n+6]]+t[e[n+7]]+"-"+t[e[n+8]]+t[e[n+9]]+"-"+t[e[n+10]]+t[e[n+11]]+t[e[n+12]]+t[e[n+13]]+t[e[n+14]]+t[e[n+15]]).toLowerCase()}let d;const R=new Uint8Array(16);function _(){if(!d){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");d=crypto.getRandomValues.bind(crypto)}return d(R)}const A=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),g={randomUUID:A};function E(e,n,i){var o;if(g.randomUUID&&!e)return g.randomUUID();e=e||{};const a=e.random??((o=e.rng)==null?void 0:o.call(e))??_();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,C(a)}const T=({label:e,dossier:n,onUpload:i,className:a})=>{const{user:o}=f(),h=async b=>{var l,m;const c=b.currentTarget,u=(l=c.files)==null?void 0:l[0];if(!u)return;if(!(o!=null&&o.companyId)){alert("Accès refusé");return}const r=new FormData;r.append("file",u),r.append("upload_preset","ml_default"),r.append("public_id",`${n}/${E()}`);try{const p=(await x.post("https://api.cloudinary.com/v1_1/dj697honl/image/upload",r)).data.secure_url,U=((m=window.prompt("Nom de l'image"))==null?void 0:m.trim())||"Image";await I(v(j,"companies",o.companyId,"imagesBibliotheque"),{url:p,nom:U,type:"image",createdAt:D(),uploadedBy:o.uid}),i&&await i(p),alert("✅ Image ajoutée avec succès")}catch(s){console.error("Upload Cloudinary:",s),alert("❌ Erreur lors de l’upload")}finally{c&&(c.value="")}};return w("div",{className:`mb-4 ${a||""}`,children:[y("label",{className:"font-semibold block mb-1",children:e}),y("input",{type:"file",accept:"image/*",onChange:h})]})};export{T as U};
