import{r as s,a as o,j as a,aq as C}from"./react-DB_4kGOy.js";import{z as D,x as F}from"./firebase-lLzYRzUk.js";import{d as w}from"../index-Bkmir__O.js";import{R as B,X as A,Y as E,T as I,j as T,B as u}from"./generateCategoricalChart-B2qQXPfN.js";import{B as j}from"./BarChart-CgOoYHZJ.js";import{C as L}from"./CartesianGrid-D4v3AkFP.js";import"./vendor-C-DAJou6.js";const q=()=>{const[r,y]=s.useState([]),[l,f]=s.useState([]),[m,b]=s.useState("all"),[d,x]=s.useState(""),[p,v]=s.useState("");return s.useEffect(()=>{(async()=>{const n=(await D(F(w,"reservations"))).docs.map(c=>({id:c.id,...c.data()}));y(n)})()},[]),s.useEffect(()=>{const e={};r.forEach(t=>{var h,g;const n=((g=(h=t.createdAt)==null?void 0:h.toDate)==null?void 0:g.call(h))||new Date,c=m==="all"||t.companyId===m,S=(!d||new Date(d)<=n)&&(!p||n<=new Date(p));if(c&&S){const i=t.companyId||"inconnu",N=t.companySlug||"—";e[i]||(e[i]={companyId:i,companySlug:N,total:0,commission:0}),e[i].total+=t.total||0,e[i].commission+=t.commission||0}}),f(Object.values(e))},[r,m,d,p]),o("div",{className:"p-6",children:[a("h1",{className:"text-2xl font-bold mb-4",children:"Finances - Vue globale"}),o("div",{className:"mb-6 flex flex-wrap gap-4 items-center",children:[a("input",{type:"date",value:d,onChange:e=>x(e.target.value),className:"border rounded px-2 py-1"}),a("input",{type:"date",value:p,onChange:e=>v(e.target.value),className:"border rounded px-2 py-1"}),o("select",{value:m,onChange:e=>b(e.target.value),className:"border rounded px-2 py-1",children:[a("option",{value:"all",children:"Toutes les compagnies"}),Array.from(new Set(r.map(e=>e.companyId))).filter(Boolean).map((e,t)=>{var n;return a("option",{value:e,children:((n=r.find(c=>c.companyId===e))==null?void 0:n.companySlug)||e},t)})]})]}),l.length>0&&a("div",{className:"w-full h-[350px] mb-6 bg-white p-4 rounded shadow",children:a(B,{width:"100%",height:"100%",children:o(j,{data:l.map(e=>({compagnie:e.companySlug,total:e.total,commission:e.commission,benefice:e.total-e.commission})),children:[a(L,{strokeDasharray:"3 3"}),a(A,{dataKey:"compagnie"}),a(E,{}),a(I,{}),a(T,{}),a(u,{dataKey:"total",fill:"#4F46E5",name:"Total"}),a(u,{dataKey:"commission",fill:"#F59E0B",name:"Commission"}),a(u,{dataKey:"benefice",fill:"#10B981",name:"Bénéfice net"})]})})}),l.length>0&&a("div",{className:"mb-4",children:a(C,{data:l.map(e=>({Compagnie:e.companySlug,Total:e.total,Commission:e.commission,Benefice:e.total-e.commission})),filename:`finances_${new Date().toISOString().slice(0,10)}.csv`,className:"inline-block bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Exporter en CSV"})}),a("div",{className:"overflow-x-auto",children:o("table",{className:"min-w-full table-auto border",children:[a("thead",{className:"bg-gray-100",children:o("tr",{children:[a("th",{className:"border px-4 py-2",children:"Compagnie"}),a("th",{className:"border px-4 py-2",children:"Total"}),a("th",{className:"border px-4 py-2",children:"Commission"}),a("th",{className:"border px-4 py-2",children:"Bénéfice net"})]})}),o("tbody",{children:[l.map((e,t)=>o("tr",{children:[a("td",{className:"border px-4 py-2",children:e.companySlug}),o("td",{className:"border px-4 py-2",children:[e.total.toLocaleString()," FCFA"]}),o("td",{className:"border px-4 py-2",children:[e.commission.toLocaleString()," FCFA"]}),o("td",{className:"border px-4 py-2",children:[(e.total-e.commission).toLocaleString()," FCFA"]})]},t)),l.length===0&&a("tr",{children:a("td",{colSpan:4,className:"text-center p-4 text-gray-500",children:"Aucune donnée trouvée pour cette période."})})]})]})})]})};export{q as default};
