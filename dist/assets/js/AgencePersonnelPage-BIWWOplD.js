import{r as t,a as n,j as r}from"./react-DgrrIcw2.js";import{k as I,l as D,y as P,T as k,A as T,d as $,B as G}from"./firebase-eGIzIftJ.js";import{u as L,d as h,a as M}from"../index-p6Te0bSg.js";import"./vendor-BHjJ2Hjk.js";const O=()=>{const{user:e,company:o}=L(),[y,S]=t.useState([]),[i,f]=t.useState(""),[l,b]=t.useState(""),[x,E]=t.useState("guichetier"),[d,N]=t.useState(""),[w,s]=t.useState(""),[u,v]=t.useState(!1),m={primary:(o==null?void 0:o.couleurPrimaire)||"#3b82f6",secondary:(o==null?void 0:o.couleurSecondaire)||"#6366f1"},g=async()=>{if(!(!(e!=null&&e.companyId)||!(e!=null&&e.agencyId)))try{const a=I(h,"companies",e.companyId,"agences",e.agencyId,"users"),p=(await D(a)).docs.map(A=>({id:A.id,...A.data()}));S(p)}catch(a){console.error("Erreur chargement agents:",a),s("❌ Erreur lors du chargement des agents.")}};t.useEffect(()=>{g()},[e]);const j=async()=>{if(!i||!d||!l||!(e!=null&&e.agencyId)||!(e!=null&&e.companyId)){s("⚠️ Tous les champs sont obligatoires.");return}if(d.length<6){s("⚠️ Le mot de passe doit contenir au moins 6 caractères.");return}v(!0),s("");try{const c={uid:(await P(M,i,d)).user.uid,email:i,displayName:l,role:x,createdAt:k.now().toDate().toISOString()},p=I(h,"companies",e.companyId,"agences",e.agencyId,"users");await T(p,c),s("✅ Agent ajouté avec succès."),f(""),b(""),N(""),g()}catch(a){console.error("Erreur création agent:",a),a.code==="auth/email-already-in-use"?s("⚠️ Cet email est déjà utilisé."):s("❌ Une erreur est survenue. Vérifiez la console.")}finally{v(!1)}},C=async a=>{if(!(!(e!=null&&e.companyId)||!(e!=null&&e.agencyId))&&window.confirm("Supprimer cet agent ?"))try{const c=$(h,"companies",e.companyId,"agences",e.agencyId,"users",a);await G(c),s("✅ Agent supprimé."),g()}catch(c){console.error("Erreur suppression:",c),s("❌ Erreur lors de la suppression.")}};return n("div",{className:"p-6 max-w-4xl mx-auto bg-gray-50 min-h-screen",children:[r("h1",{className:"text-3xl font-bold mb-6",style:{color:m.primary},children:"Gestion du personnel"}),n("div",{className:"mb-8 bg-white p-6 rounded-xl shadow-md border border-gray-200",children:[n("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[r("input",{value:l,onChange:a=>b(a.target.value),placeholder:"Nom complet",className:"border p-3 rounded focus:ring-2 focus:ring-indigo-500"}),r("input",{value:i,onChange:a=>f(a.target.value),placeholder:"Email",type:"email",className:"border p-3 rounded focus:ring-2 focus:ring-indigo-500"}),r("input",{value:d,onChange:a=>N(a.target.value),placeholder:"Mot de passe",type:"password",className:"border p-3 rounded focus:ring-2 focus:ring-indigo-500"}),n("select",{value:x,onChange:a=>E(a.target.value),className:"border p-3 rounded focus:ring-2 focus:ring-indigo-500",children:[r("option",{value:"guichetier",children:"Guichetier"}),r("option",{value:"agentCourrier",children:"Agent de courrier"})]})]}),r("button",{onClick:j,disabled:u,className:`w-full py-3 rounded font-semibold text-white transition ${u?"bg-gray-400 cursor-not-allowed":"hover:opacity-90"}`,style:{background:`linear-gradient(to right, ${m.primary}, ${m.secondary})`},children:u?"⏳ Ajout en cours...":"Ajouter l’agent"}),w&&r("p",{className:"mt-3 text-center text-sm",children:w})]}),r("h2",{className:"text-xl font-semibold mb-4",children:"Agents de cette agence"}),y.length===0?r("p",{className:"text-gray-500",children:"Aucun agent enregistré."}):r("ul",{className:"space-y-2",children:y.map(a=>n("li",{className:"border p-4 rounded flex justify-between items-center bg-white shadow-sm",children:[n("div",{children:[r("p",{className:"font-semibold text-gray-800",children:a.displayName}),n("p",{className:"text-sm text-gray-600",children:[a.email," • ",a.role]})]}),r("button",{onClick:()=>C(a.id),className:"text-red-600 text-sm hover:underline",children:"Supprimer"})]},a.id))})]})};export{O as default};
