import{r as a,j as e}from"./react-BKlva80Y.js";import{q as w,w as C,j as b,k as A,y as I,T}from"./firebase-1zyXmG6H.js";import{u as D,d as g}from"../index-B9wHCq4m.js";import"./vendor-CZDa83Cj.js";const M=()=>{const{user:s}=D(),[n,l]=a.useState(""),[c,o]=a.useState(0),[d,i]=a.useState("dépôt"),[m,p]=a.useState(""),[h,j]=a.useState([]),[y,N]=a.useState(0),x=async()=>{if(!(s!=null&&s.agencyId))return;const t=w(b(g,"recettes"),C("agencyId","==",s.agencyId)),u=(await A(t)).docs.map(r=>({id:r.id,...r.data()}));j(u);const f=u.reduce((r,S)=>r+(S.montant||0),0);N(f)},v=async t=>{t.preventDefault(),s!=null&&s.agencyId&&(await I(b(g,"recettes"),{libelle:n,montant:c,type:d,commentaire:m,agencyId:s.agencyId,createdAt:T.now(),date:new Date().toISOString().split("T")[0]}),l(""),o(0),i("dépôt"),p(""),x())};return a.useEffect(()=>{x()},[s]),e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Enregistrer une recette"}),e.jsxs("form",{onSubmit:v,className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsx("input",{value:n,onChange:t=>l(t.target.value),placeholder:"Libellé",required:!0,className:"border p-2 rounded"}),e.jsx("input",{type:"number",value:c,onChange:t=>o(parseFloat(t.target.value)),placeholder:"Montant",required:!0,className:"border p-2 rounded"}),e.jsxs("select",{value:d,onChange:t=>i(t.target.value),className:"border p-2 rounded",children:[e.jsx("option",{value:"dépôt",children:"Dépôt"}),e.jsx("option",{value:"avance",children:"Avance"}),e.jsx("option",{value:"règlement",children:"Règlement"})]}),e.jsx("input",{value:m,onChange:t=>p(t.target.value),placeholder:"Commentaire (optionnel)",className:"border p-2 rounded"}),e.jsx("button",{type:"submit",className:"col-span-2 bg-green-600 text-white rounded p-2",children:"Ajouter"})]}),e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:["Liste des recettes (",h.length,")"]}),e.jsxs("p",{className:"mb-2 text-green-700 font-bold",children:["Total encaissé : ",y.toLocaleString()," FCFA"]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm bg-white border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"border px-4 py-2",children:"Date"}),e.jsx("th",{className:"border px-4 py-2",children:"Libellé"}),e.jsx("th",{className:"border px-4 py-2",children:"Type"}),e.jsx("th",{className:"border px-4 py-2",children:"Montant"}),e.jsx("th",{className:"border px-4 py-2",children:"Commentaire"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border px-4 py-2",children:t.date}),e.jsx("td",{className:"border px-4 py-2",children:t.libelle}),e.jsx("td",{className:"border px-4 py-2 capitalize",children:t.type}),e.jsxs("td",{className:"border px-4 py-2 text-right",children:[t.montant.toLocaleString()," FCFA"]}),e.jsx("td",{className:"border px-4 py-2",children:t.commentaire||"-"})]},t.id))})]})})]})};export{M as default};
