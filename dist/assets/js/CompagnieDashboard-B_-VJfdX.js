import{r as g,a as l,j as e,av as Ae,b as Ce,ap as De,aw as Se,V as se,T as oe,B as ie,ax as le,ay as Te,az as $e}from"./react-DB_4kGOy.js";import{d as U,u as Re,c as ke}from"../index-Bkmir__O.js";import{o as Me,q as Fe,w as J,x as Q,A as ce,T as de,z as xe,y as ue}from"./firebase-lLzYRzUk.js";import{S as z,C as M,a as F,b as L,c as E}from"./skeleton-DZEhV3nL.js";import{c as Le}from"./utils-CmftarAw.js";import{R as H,X as ne,Y as q,T as X,j as ae,B as ee,k as Ee,l as me}from"./generateCategoricalChart-B2qQXPfN.js";import{C as re}from"./CartesianGrid-D4v3AkFP.js";import{a as he,L as Ie}from"./LineChart-Q1TCdBKb.js";import{B as be}from"./BarChart-CgOoYHZJ.js";import{P as je,a as Pe}from"./PieChart-hJ1LyQz7.js";import"./vendor-C-DAJou6.js";function ze(t){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",maximumFractionDigits:0}).format(t||0)}function Y(t){return(t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/-/g," ").trim()}function te(t){return(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function Ge(t){const s=te(t);return s==="paye"||s==="paid"||s==="payed"}function _(t){const s=t.getFullYear(),c=String(t.getMonth()+1).padStart(2,"0"),h=String(t.getDate()).padStart(2,"0");return`${s}-${c}-${h}`}function ge(t){try{if(!t)return null;if(t instanceof Date)return t;if(typeof(t==null?void 0:t.toDate)=="function")return t.toDate();if(typeof t=="string"){const s=new Date(t);return isNaN(s.getTime())?null:s}return null}catch{return null}}const Be=["reservations","reservation","bookings","reserves","resas"];async function Ke(t,s){const c=[];for(const h of Be){c.push(h);const y=Q(U,`companies/${t}/agences/${s}/${h}`);try{return console.log("‚ñ∂ Test chemin:",`companies/${t}/agences/${s}/${h}`),await xe(J(y)),{ref:y,nameTried:c}}catch(o){console.warn(`‚ö†Ô∏è Chemin refus√© (${h}) ‚Üí`,(o==null?void 0:o.message)||o);continue}}return{ref:null,nameTried:c}}function fe({companyId:t,dateFrom:s,dateTo:c}){const[h,y]=g.useState(!0),[o,u]=g.useState(null),[d,x]=g.useState([]),[S,f]=g.useState([]);g.useEffect(()=>{if(!t)return;console.log("üè¢ Dashboard companyId =",t);const r=Me(U,`companies/${t}`);Fe(r).then(a=>u({id:t,...a.data()})).catch(a=>{console.error("‚úñ get company meta:",a)})},[t]),g.useEffect(()=>{if(!t)return;const r=J(Q(U,`companies/${t}/agences`));console.log("üì° Listen agences:",`companies/${t}/agences`);const a=ce(r,n=>{const i=n.docs.map(p=>({id:p.id,nom:p.data().nom||p.id,ville:p.data().ville}));console.log("‚úÖ Agencies size:",i.length,i.map(p=>p.id)),x(i)},n=>console.error("‚úñ onSnapshot agences:",n));return()=>a()},[t]),g.useEffect(()=>{if(!t)return;y(!0);const r=de.fromDate(s),a=de.fromDate(c);let n=!1;const i=[];return(async()=>{try{const b=(await xe(Q(U,`companies/${t}/agences`))).docs.map(w=>w.id);if(console.log("üìÑ Agences trouv√©es:",b.length,b),b.length===0){n||(f([]),y(!1));return}const m=[];let T=0;for(const w of b){const{ref:D,nameTried:$}=await Ke(t,w);if(!D){console.error("‚úñ Impossible d'ouvrir une sous-collection de r√©servations pour",w," (essay√©:",$.join(", "),")"),T+=1,T===b.length&&!n&&(f(m),y(!1));continue}const K=J(D,ue("createdAt",">=",r),ue("createdAt","<=",a));console.log("üì° Listen r√©servations:",D.path);const v=ce(K,A=>{const ye=A.docs.map(R=>{const C=R.data();return{id:R.id,agencyId:w,agenceId:w,agencyNom:C.agencyNom,agencyVille:C.agencyVille,depart:C.depart,arrival:C.arrival,departNormalized:C.departNormalized,arrivee:C.arrivee,date:C.date,heure:C.heure,canal:C.canal,statut:C.statut,montant:C.montant||0,seatsGo:C.seatsGo||1,clientPhone:C.clientPhone,clientId:C.clientId,createdAt:C.createdAt}}),Ne=m.filter(R=>R.agencyId!==w&&R.agenceId!==w);m.splice(0,m.length,...Ne,...ye);const we=m.filter(R=>{const C=ge(R.createdAt)??(R.date?new Date(`${R.date}T${R.heure||"00:00"}:00`):null);return C?C>=s&&C<=c:!1});n||f(we)},A=>{console.error(`‚úñ onSnapshot r√©servations (${D.path}):`,A)});i.push(v),T+=1}}catch(p){console.error("‚úñ Dashboard attach error:",p)}finally{n||y(!1)}})(),()=>{n=!0,i.forEach(p=>p())}},[t,s.getTime(),c.getTime()]);const N=g.useMemo(()=>S.filter(r=>Ge(r.statut)),[S]),O=d.length,G=g.useMemo(()=>{const r=new Map;return d.forEach(a=>r.set(a.id,{id:a.id,nom:a.nom,ville:a.ville,reservations:0,revenus:0})),N.forEach(a=>{const n=a.agencyId||a.agenceId;if(!n)return;const i=r.get(n)||{id:n,nom:a.agencyNom||n,ville:a.agencyVille,reservations:0,revenus:0};i.reservations+=a.seatsGo||1,i.revenus+=a.montant||0,r.set(n,i)}),Array.from(r.values()).sort((a,n)=>n.revenus-a.revenus)},[d,N]);g.useMemo(()=>{const r=new Set;return N.forEach(a=>{a.clientId?r.add("id:"+a.clientId):a.clientPhone&&r.add("tel:"+a.clientPhone)}),r.size},[N]);const V=g.useMemo(()=>{const r=new Set;return N.forEach(a=>{const n=Y(a.depart||a.departNormalized),i=Y(a.arrival||a.arrivee);n&&r.add(n),i&&r.add(i)}),r.size},[N]),I=g.useMemo(()=>{const r=new Map;return N.forEach(a=>{const n=te(a.canal),i=n.includes("ligne")||n==="online"||n==="web"?"En ligne":n.includes("guichet")?"Guichet":"Autres";r.set(i,(r.get(i)||0)+1)}),Array.from(r).map(([a,n])=>({name:a,value:n})).sort((a,n)=>n.value-a.value)},[N]),j=g.useMemo(()=>{const r=new Map;return S.forEach(a=>{const n=te(a.statut)||"‚Äî";r.set(n,(r.get(n)||0)+1)}),Array.from(r).map(([a,n])=>({name:a,value:n}))},[S]),W=g.useMemo(()=>{const r=N.reduce((v,A)=>v+(A.montant||0),0),a="vs p√©riode pr√©c√©dente",n=N.length,i=new Set;N.forEach(v=>{v.clientId?i.add(`id:${v.clientId}`):v.clientPhone&&i.add(`tel:${v.clientPhone}`)});const p=i.size;N.reduce((v,A)=>v+(A.seatsGo||1),0);const b="N/A",m=new Set;N.forEach(v=>{const A=v.agencyId||v.agenceId;A&&m.add(A)});const T=I.reduce((v,A)=>v+A.value,0),w=I.filter(v=>v.name==="En ligne").reduce((v,A)=>v+A.value,0),D=I.filter(v=>v.name==="Guichet").reduce((v,A)=>v+A.value,0),$=T?Math.round(w/T*100):0,K=T?Math.round(D/T*100):0;return{caPeriode:r,caPeriodeFormatted:ze(r),caDeltaText:a,reservationsCount:n,clientsUniques:p,agencesActives:m.size,totalAgences:O,villesCouvertes:V,tauxRemplissageText:b,parCanal:I,parStatut:j,partEnLigne:$,partGuichet:K}},[N,O,V,I,j]),Z=g.useMemo(()=>{const r=new Map;for(let n=new Date(s);n<=c;n.setDate(n.getDate()+1))r.set(_(n),{reservations:0,revenue:0});return N.forEach(n=>{const i=ge(n.createdAt)??(n.date?new Date(`${n.date}T${n.heure||"00:00"}:00`):new Date),p=_(i),b=r.get(p)||{reservations:0,revenue:0};b.reservations+=n.seatsGo||1,b.revenue+=n.montant||0,r.set(p,b)}),{daily:Array.from(r).map(([n,i])=>({date:n,reservations:i.reservations,revenue:i.revenue}))}},[N,s.getTime(),c.getTime()]),k=g.useMemo(()=>{const r=new Map;return N.forEach(a=>{const n=Y(a.depart||a.departNormalized),i=Y(a.arrival||a.arrivee);if(!n||!i)return;const p=`${n} ‚Üí ${i}`,b=r.get(p)||{reservations:0,revenus:0};b.reservations+=a.seatsGo||1,b.revenus+=a.montant||0,r.set(p,b)}),Array.from(r).map(([a,n])=>({trajet:a,reservations:n.reservations,revenus:n.revenus})).sort((a,n)=>n.reservations-a.reservations).slice(0,12)},[N]),P=g.useMemo(()=>{var p,b;const r=[],a=((p=j.find(m=>m.name.includes("attente")))==null?void 0:p.value)||0;a>50&&r.push({level:"warning",message:`${a} r√©servations en attente`});const n=((b=j.find(m=>m.name.includes("preuve")))==null?void 0:b.value)||0;n>0&&r.push({level:"info",message:`${n} preuve(s) re√ßue(s) √† valider`});const i=G.filter(m=>m.reservations===0);return i.length>0&&r.push({level:"warning",message:`${i.length} agence(s) sans vente`}),r},[G,j]);function B(r){const n=[["id","agencyId","date","heure","depart","arrivee","montant","canal","statut","seatsGo","clientPhone"].join(",")].concat(r.map(m=>[m.id,m.agencyId||m.agenceId||"",m.date||"",m.heure||"",m.depart||m.departNormalized||"",m.arrival||m.arrivee||"",String(m.montant||0),m.canal||"",m.statut||"",String(m.seatsGo||1),m.clientPhone||""].map(T=>`"${String(T).replace(/"/g,'""')}"`).join(","))).join(`
`),i=new Blob([n],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(i),b=document.createElement("a");b.href=p,b.download=`reservations_${_(s)}_${_(c)}.csv`,b.click(),URL.revokeObjectURL(p)}return{loading:h,company:o,kpis:W,series:Z,perAgency:G,topTrajets:k,alerts:P,rawReservations:S,exportCSV:B}}function Oe({range:t,setRange:s,customStart:c,setCustomStart:h,customEnd:y,setCustomEnd:o}){return l("div",{className:"flex flex-wrap items-center gap-2",children:[l("select",{className:"h-9 rounded-lg border bg-white px-3 pr-8 text-sm outline-none shadow-sm",value:t,onChange:u=>s(u.target.value),children:[e("option",{value:"month",children:"Mois en cours"}),e("option",{value:"prev_month",children:"Mois pr√©c√©dent"}),e("option",{value:"ytd",children:"Depuis le 1er janvier"}),e("option",{value:"12m",children:"12 derniers mois"}),e("option",{value:"custom",children:"Plage personnalis√©e‚Ä¶"})]}),t==="custom"&&l("div",{className:"flex items-center gap-2",children:[e("input",{type:"date",className:"h-9 rounded-lg border bg-white px-3 text-sm shadow-sm",value:c??"",onChange:u=>h(u.target.value||null)}),e("span",{className:"text-sm text-muted-foreground",children:"‚Üí"}),e("input",{type:"date",className:"h-9 rounded-lg border bg-white px-3 text-sm shadow-sm",value:y??"",onChange:u=>o(u.target.value||null)})]}),l("div",{className:"ml-auto flex items-center gap-1 text-xs text-muted-foreground",children:[e(Ae,{className:"h-4 w-4"}),e("span",{children:"Changer la p√©riode"})]})]})}function pe({loading:t,couleurPrimaire:s,couleurSecondaire:c,items:h}){const y=Ce();if(t)return e("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:Array.from({length:5}).map((d,x)=>e(z,{className:"h-24 w-full rounded-xl"},x))});const o=s||"#b91c1c",u=c||"#f59e0b";return e("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:h.map((d,x)=>{const S=d.icon,f=!!d.to;return l("div",{role:f?"button":void 0,tabIndex:f?0:-1,onClick:()=>d.to&&y(d.to),onKeyDown:N=>{f&&(N.key==="Enter"||N.key===" ")&&(N.preventDefault(),y(d.to))},className:Le("rounded-xl border bg-white p-4 transition-all duration-200 select-none","flex items-center gap-3",f?"cursor-pointer hover:shadow-md":"cursor-default"),children:[e("div",{className:"h-10 w-10 rounded-lg flex items-center justify-center text-white shrink-0",style:{background:u},children:e(S,{className:"h-5 w-5"})}),l("div",{className:"min-w-0",children:[e("p",{className:"text-xs text-muted-foreground truncate",children:d.label}),e("p",{className:"text-lg font-semibold leading-tight truncate",style:{color:o},children:d.value}),d.sub&&e("p",{className:"text-[11px] text-muted-foreground truncate",children:d.sub})]})]},x)})})}function Ve({data:t,loading:s}){return s?e("div",{className:"h-72 flex items-center justify-center text-sm text-muted-foreground",children:"Chargement‚Ä¶"}):!t||t.length===0?e("div",{className:"h-72 flex items-center justify-center text-sm text-muted-foreground",children:"Aucune donn√©e sur la p√©riode."}):e("div",{className:"h-72",children:e(H,{width:"100%",height:"100%",children:l(Ie,{data:t,margin:{top:10,right:18,bottom:0,left:0},children:[e(re,{strokeDasharray:"3 3"}),e(ne,{dataKey:"date",tick:{fontSize:12}}),e(q,{yAxisId:"left",tick:{fontSize:12}}),e(q,{yAxisId:"right",orientation:"right",tick:{fontSize:12}}),e(X,{}),e(ae,{}),e(he,{yAxisId:"left",type:"monotone",dataKey:"revenue",name:"Chiffre d‚Äôaffaires",stroke:"#ef4444",strokeWidth:2,dot:!1,activeDot:{r:4}}),e(he,{yAxisId:"right",type:"monotone",dataKey:"reservations",name:"R√©servations",stroke:"#3b82f6",strokeWidth:2,dot:!1,activeDot:{r:4}})]})})})}function Ye({data:t,loading:s}){if(s)return e(z,{className:"h-72 w-full rounded-2xl"});const c=t.slice(0,12).map(h=>({name:h.nom||h.id,reservations:h.reservations,revenus:h.revenus}));return e("div",{className:"h-72",children:e(H,{width:"100%",height:"100%",children:l(be,{data:c,children:[e(re,{vertical:!1,strokeDasharray:"3 3"}),e(ne,{dataKey:"name",tickLine:!1,axisLine:!1,interval:0,angle:-25,textAnchor:"end",height:70}),e(q,{tickLine:!1,axisLine:!1}),e(X,{}),e(ae,{}),e(ee,{dataKey:"reservations",name:"R√©servations",radius:[4,4,0,0]}),e(ee,{dataKey:"revenus",name:"CA",radius:[4,4,0,0]})]})})})}const ve=["#2563eb","#16a34a","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#f97316"],_e={"en ligne":"#2563eb",guichet:"#16a34a"};function Ue(t,s){const c=t.toLowerCase();return _e[c]||ve[s%ve.length]}function qe({data:t,loading:s}){if(s)return e(z,{className:"h-72 w-full rounded-2xl"});const c=g.useMemo(()=>{const o=new Map;return t.forEach(d=>{const x=(d.name||"Inconnu").trim()||"Inconnu";o.set(x,(o.get(x)||0)+(Number(d.value)||0))}),Array.from(o,([d,x])=>({name:d,value:x})).sort((d,x)=>x.value-d.value)},[t]),h=g.useMemo(()=>c.reduce((o,u)=>o+u.value,0),[c]);if(!c.length||h===0)return e("div",{className:"h-72 flex items-center justify-center rounded-2xl border bg-muted/20 text-sm text-muted-foreground",children:"Aucune donn√©e de r√©partition des canaux pour la p√©riode."});const y=c.map(o=>({...o,pct:Math.round(o.value/h*100)}));return e("div",{className:"h-72",children:e(H,{width:"100%",height:"100%",children:l(Pe,{children:[l(je,{data:y,dataKey:"value",nameKey:"name",innerRadius:60,outerRadius:90,paddingAngle:1,children:[y.map((o,u)=>e(Ee,{fill:Ue(o.name,u)},`cell-${o.name}-${u}`)),e(me,{value:`${h}`,position:"center",className:"fill-current",fontSize:14}),e(me,{value:"Total",position:"centerTop",dy:-14,className:"fill-current",fontSize:11})]}),e(X,{formatter:(o,u,{payload:d})=>{const x=Number(o)||0,S=(d==null?void 0:d.pct)??Math.round(x/h*100);return[`${x} (${S}%)`,"R√©servations"]},labelFormatter:o=>`${o}`}),e(ae,{verticalAlign:"bottom",align:"center",iconType:"circle",formatter:(o,u,d)=>{var S;const x=((S=y[d])==null?void 0:S.pct)??0;return l("span",{className:"text-xs",children:[o," ‚Äî ",x,"%"]})}})]})})})}function He({data:t,loading:s}){return s?e(z,{className:"h-60 w-full rounded-2xl"}):e("div",{className:"h-60",children:e(H,{width:"100%",height:"100%",children:l(be,{data:t,children:[e(re,{vertical:!1,strokeDasharray:"3 3"}),e(ne,{dataKey:"name",tickLine:!1,axisLine:!1}),e(q,{tickLine:!1,axisLine:!1}),e(X,{}),e(ee,{dataKey:"value",name:"Nombre",radius:[4,4,0,0]})]})})})}function Xe({rows:t,loading:s}){return s?e(z,{className:"h-64 w-full rounded-2xl"}):e("div",{className:"overflow-x-auto",children:l("table",{className:"min-w-full text-sm",children:[e("thead",{children:l("tr",{className:"border-b",children:[e("th",{className:"py-2 text-left",children:"Trajet"}),e("th",{className:"py-2 text-right",children:"R√©servations"}),e("th",{className:"py-2 text-right",children:"CA"})]})}),e("tbody",{children:t.map((c,h)=>l("tr",{className:"border-b last:border-none",children:[e("td",{className:"py-2",children:c.trajet}),e("td",{className:"py-2 text-right",children:c.reservations}),e("td",{className:"py-2 text-right",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",maximumFractionDigits:0}).format(c.revenus)})]},h))})]})})}function We(t){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",maximumFractionDigits:0}).format(t)}function Ze({data:t,loading:s}){if(s)return e(z,{className:"h-48 w-full rounded-2xl"});if(!t||t.length===0)return e("div",{className:"text-sm text-muted-foreground bg-muted/30 rounded-xl p-4",children:"Aucune agence trouv√©e."});const c=g.useMemo(()=>t.reduce((o,u)=>o+(u.revenus||0),0),[t]),h=g.useMemo(()=>[...t].sort((u,d)=>(u.revenus||0)!==(d.revenus||0)?(u.revenus||0)-(d.revenus||0):(u.reservations||0)-(d.reservations||0)).slice(0,5),[t]);return h.every(o=>(o.revenus||0)===0&&(o.reservations||0)===0)?e("div",{className:"text-sm text-muted-foreground bg-muted/30 rounded-xl p-4",children:"Aucune agence √† signaler sur la p√©riode."}):l("div",{className:"overflow-x-auto",children:[l("table",{className:"min-w-full text-sm",children:[e("thead",{children:l("tr",{className:"border-b text-muted-foreground",children:[e("th",{scope:"col",className:"py-2 pr-2 text-left font-medium",children:"Agence"}),e("th",{scope:"col",className:"py-2 pr-2 text-left font-medium",children:"Ville"}),e("th",{scope:"col",className:"py-2 pr-2 text-right font-medium",children:"R√©servations"}),e("th",{scope:"col",className:"py-2 pr-2 text-right font-medium",children:"CA"}),e("th",{scope:"col",className:"py-2 pl-2 text-right font-medium",children:"Part"})]})}),e("tbody",{children:h.map(o=>{const u=o.revenus||0,d=c>0?Math.round(u/c*100):0,x=u===0||o.reservations===0;return l("tr",{className:`border-b last:border-none hover:bg-muted/30 transition-colors ${x?"bg-amber-50/40":""}`,children:[e("td",{className:"py-2 pr-2",children:l("div",{className:"flex items-center gap-2",children:[e("span",{className:"font-medium",children:o.nom}),x&&e("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-amber-100 text-amber-700",children:"√Ä surveiller"})]})}),e("td",{className:"py-2 pr-2",children:o.ville||"‚Äî"}),e("td",{className:"py-2 pr-2 text-right tabular-nums",children:o.reservations}),e("td",{className:"py-2 pr-2 text-right tabular-nums",children:We(u)}),e("td",{className:"py-2 pl-2 text-right",children:l("span",{className:"inline-flex items-center justify-end min-w-[3rem] px-2 py-0.5 rounded bg-muted text-foreground/80",children:[d,"%"]})})]},o.id)})})]}),e("p",{className:"mt-2 text-xs text-muted-foreground",children:"Tri√© par chiffre d‚Äôaffaires croissant (puis r√©servations). ‚Äú√Ä surveiller‚Äù = CA ou r√©servations nuls."})]})}function Je({alerts:t}){return!t||t.length===0?l(E,{children:[e(F,{children:e(M,{children:"Alertes"})}),e(L,{children:e("div",{className:"text-sm text-muted-foreground",children:"Aucune alerte pour la p√©riode s√©lectionn√©e."})})]}):l(E,{children:[e(F,{children:e(M,{children:"Alertes"})}),e(L,{className:"space-y-3",children:t.map((s,c)=>l("div",{className:"flex items-start gap-2 text-sm",children:[s.level==="error"?e(De,{className:"h-4 w-4 mt-0.5"}):e(Se,{className:"h-4 w-4 mt-0.5"}),e("span",{children:s.message})]},c))})]})}const Qe="month";function ut(){const{user:t}=Re(),s=(t==null?void 0:t.companyId)??"",{setHeader:c,resetHeader:h}=ke();g.useEffect(()=>(c({title:"Dashboard Compagnie"}),()=>h()),[c,h]);const[y,o]=g.useState(Qe),[u,d]=g.useState(null),[x,S]=g.useState(null),[f,N]=g.useState(new Date);g.useEffect(()=>{const w=setInterval(()=>N(new Date),6e4);return()=>clearInterval(w)},[]);const{todayFrom:O,todayTo:G,todayLabel:V}=g.useMemo(()=>{const w=new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0,0),D=new Date(f.getFullYear(),f.getMonth(),f.getDate(),23,59,59,999),$=new Intl.DateTimeFormat("fr-FR",{weekday:"long",day:"2-digit",month:"long"}).format(w);return{todayFrom:w,todayTo:D,todayLabel:$}},[f]),{dateFrom:I,dateTo:j,periodLabel:W}=g.useMemo(()=>{const w=new Date(f.getFullYear(),f.getMonth(),f.getDate(),23,59,59,999);let D=new Date(f.getFullYear(),f.getMonth(),1),$=w;if(y==="prev_month"){const v=f.getFullYear(),A=f.getMonth();D=new Date(v,A-1,1),$=new Date(v,A,0,23,59,59,999)}else y==="ytd"?(D=new Date(f.getFullYear(),0,1),$=w):y==="12m"?(D=new Date(f.getFullYear(),f.getMonth()-11,1),$=w):y==="custom"&&u&&x&&(D=new Date(`${u}T00:00:00`),$=new Date(`${x}T23:59:59`));const K=new Intl.DateTimeFormat("fr-FR",{month:"long",year:"numeric"}).format(D);return{dateFrom:D,dateTo:$,periodLabel:K}},[y,u,x,f]);if(!s)return l("div",{className:"p-6",children:[e("h1",{className:"text-xl font-semibold mb-2",children:"Dashboard Compagnie"}),l("p",{className:"text-sm text-muted-foreground",children:["Identifiant compagnie introuvable dans l‚Äôauth. V√©rifie ",e("code",{children:"user.companyId"}),"."]})]});const{loading:Z,company:k,kpis:P,alerts:B}=fe({companyId:s,dateFrom:O,dateTo:G}),r=(B==null?void 0:B.length)??0,{loading:a,company:n,kpis:i,series:p,perAgency:b,topTrajets:m,alerts:T}=fe({companyId:s,dateFrom:I,dateTo:j});return l("div",{className:"space-y-5 p-4 md:p-6",children:[l("div",{className:"flex flex-col gap-3",children:[e("div",{className:"flex items-center justify-between",children:l("div",{children:[e("h2",{className:"text-2xl md:text-3xl font-bold",children:"R√©servations du jour"}),e("p",{className:"text-sm text-muted-foreground",children:V})]})}),e(pe,{loading:Z,couleurPrimaire:k==null?void 0:k.couleurPrimaire,couleurSecondaire:k==null?void 0:k.couleurSecondaire,items:[{icon:se,label:"CA (aujourd‚Äôhui)",value:P.caPeriodeFormatted,sub:"",to:"/compagnie/reservations"},{icon:oe,label:"Billets vendus (jour)",value:String(P.reservationsCount||0),sub:"Tous canaux",to:"/compagnie/reservations"},{icon:ie,label:"Agences actives (jour)",value:String(P.agencesActives||0),sub:`${P.totalAgences||0} au total`,to:"/compagnie/agences"},{icon:le,label:"Part en ligne (jour)",value:`${P.partEnLigne??0}%`,sub:"Ventes en ligne",to:"/compagnie/reservations"},{icon:Te,label:"Alertes (jour)",value:String(r),sub:r>0?"√Ä traiter":"RAS",to:"/compagnie/statistiques"}]})]}),l("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[l("div",{className:"flex-1",children:[e("h2",{className:"text-2xl md:text-3xl font-bold",children:"R√©servations du mois"}),l("p",{className:"text-sm text-muted-foreground",children:["P√©riode : ",W]})]}),e("div",{className:"w-full md:w-auto",children:e(Oe,{range:y,setRange:o,customStart:u,setCustomStart:d,customEnd:x,setCustomEnd:S})})]}),e(pe,{loading:a,couleurPrimaire:n==null?void 0:n.couleurPrimaire,couleurSecondaire:n==null?void 0:n.couleurSecondaire,items:[{icon:se,label:"CA (mois en cours)",value:i.caPeriodeFormatted,sub:i.caDeltaText,to:"/compagnie/reservations"},{icon:oe,label:"Billets vendus (mois)",value:String(i.reservationsCount||0),sub:"Tous canaux",to:"/compagnie/reservations"},{icon:le,label:"Taux de remplissage",value:i.tauxRemplissageText,sub:"Moyenne",to:"/compagnie/statistiques"},{icon:ie,label:"Agences actives",value:String(i.agencesActives),sub:`${i.totalAgences} au total`,to:"/compagnie/agences"},{icon:$e,label:"Villes couvertes",value:String(i.villesCouvertes),sub:"R√©seau",to:"/compagnie/agences"}]}),l("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-5",children:[l(E,{className:"xl:col-span-2",children:[e(F,{children:e(M,{children:"√âvolution du CA & des R√©servations"})}),e(L,{children:e(Ve,{data:p.daily,loading:a})})]}),l(E,{children:[e(F,{children:e(M,{children:"R√©partition par canal"})}),e(L,{children:e(qe,{data:i.parCanal,loading:a})})]})]}),l("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-5",children:[l(E,{className:"xl:col-span-2",children:[e(F,{children:e(M,{children:"Performance par agence (p√©riode)"})}),e(L,{children:e(Ye,{data:b,loading:a})})]}),l(E,{children:[e(F,{children:e(M,{children:"R√©servations par statut"})}),e(L,{children:e(He,{data:i.parStatut,loading:a})})]})]}),l("div",{className:"grid grid-cols-1 2xl:grid-cols-3 gap-5",children:[l(E,{className:"2xl:col-span-2",children:[e(F,{children:e(M,{children:"Top trajets (p√©riode)"})}),e(L,{children:e(Xe,{rows:m,loading:a})})]}),l("div",{className:"space-y-5",children:[l(E,{children:[e(F,{children:e(M,{children:"Agences √† surveiller"})}),e(L,{children:e(Ze,{data:b,loading:a})})]}),e(Je,{alerts:T})]})]})]})}export{ut as default};
