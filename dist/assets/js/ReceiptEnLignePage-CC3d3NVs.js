import{b as D,u as R,a as A,r as c,j as e,d as P,M as y,P as L,b6 as M,aR as U,A as F,aw as T,aS as E,aT as H}from"./react-BKlva80Y.js";import{e as p,d as h}from"./firebase-1zyXmG6H.js";import{s as _,h as l,d as g}from"../index-BrxuZDy-.js";import{h as B}from"./html2pdf-DhFgVfJF.js";import{J as I,p as J,a5 as O}from"./vendor-CZDa83Cj.js";import"./jspdf.es.min-HG97Jwyd.js";import"./html2canvas-Ce3uWMAu.js";const Z=()=>{const{id:d,slug:u}=D(),f=R(),N=A(),{companyInfo:v,reservation:C}=N.state||{},[a,w]=c.useState(C||null),[r,k]=c.useState(v||null),[t,S]=c.useState(null),x=c.useRef(null),$=a!=null&&a.date?I(J(a.date),"dd/MM/yyyy",{locale:O}):"",s=(r==null?void 0:r.primaryColor)||"#3b82f6",m={colors:{text:_(s)}};c.useEffect(()=>{(async()=>{let o=a;if(!o&&d){const n=await p(h(g,"reservations",d));n.exists()&&(o={...n.data(),id:n.id},w(o))}if(o!=null&&o.companyId&&!r){const n=await p(h(g,"companies",o.companyId));if(n.exists()){const i=n.data(),b={id:n.id,name:i.name||i.nom||o.companyName||"Nom Compagnie",primaryColor:i.primaryColor,logoUrl:i.logoUrl,telephone:i.telephone};k(b),sessionStorage.setItem("companyInfo",JSON.stringify(b))}}if(o!=null&&o.agencyId){const n=await p(h(g,"agences",o.agencyId));if(n.exists()){const i=n.data();S({id:n.id,nomAgence:i.nomAgence||"Agence",telephone:i.telephone||"",latitude:i.latitude,longitude:i.longitude})}}})()},[d,a,r]);const z=c.useCallback(()=>{if(x.current){const j={margin:10,filename:`reçu-${a==null?void 0:a.referenceCode}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a5",orientation:"portrait"}};B().set(j).from(x.current).save()}},[a]);return!a||!r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-pulse h-12 w-12 mx-auto rounded-full mb-4",style:{backgroundColor:l(s,.1)}}),e.jsx("p",{className:"text-gray-600",children:"Chargement du reçu..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-32",children:[e.jsx("header",{className:"sticky top-0 z-20 px-4 py-4 shadow-sm",style:{backgroundColor:s,color:"#ffffff",borderBottom:`1px solid ${l(s,.2)}`},children:e.jsxs("div",{className:"flex items-center justify-between max-w-2xl mx-auto",children:[e.jsx("button",{onClick:()=>f(-1),className:"p-2 rounded-full",style:{color:"#ffffff"},children:e.jsx(P,{size:24})}),e.jsx("h1",{className:"font-bold text-lg",children:"Reçu de réservation"}),r.logoUrl?e.jsx("img",{src:r.logoUrl,alt:"Logo",className:"h-8 w-8 rounded-full object-cover border",style:{borderColor:l(s,.2)}}):e.jsx("div",{className:"h-8 w-8 rounded-full",style:{backgroundColor:l(s,.1)}})]})}),e.jsx("main",{className:"max-w-2xl mx-auto px-4 py-6",children:e.jsxs("div",{ref:x,className:"bg-white rounded-lg shadow-sm overflow-hidden border",style:{borderColor:l(s,.3)},children:[e.jsxs("div",{className:"p-4 flex items-center gap-3 border-b",style:{borderColor:l(s,.2)},children:[r.logoUrl&&e.jsx("img",{src:r.logoUrl,alt:"Logo",className:"h-20 w-20 rounded-full object-cover border-2",style:{borderColor:"white"}}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-lg",style:{color:s},children:r.name||a.companyName||"Nom Compagnie"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm mt-1",children:[(t==null?void 0:t.nomAgence)&&e.jsxs("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${t.latitude},${t.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-gray-600 hover:underline",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:t.nomAgence})]}),((t==null?void 0:t.telephone)||r.telephone)&&e.jsxs("a",{href:`tel:${(t==null?void 0:t.telephone)||r.telephone}`,className:"flex items-center gap-1 text-gray-600 hover:underline",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:(t==null?void 0:t.telephone)||r.telephone})]})]})]})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center border-b",style:{borderColor:l(s,.2)},children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 rounded-md bg-gray-100",children:[e.jsx(M,{size:16,className:"text-gray-500"}),e.jsx("span",{className:"font-mono text-sm",children:a.referenceCode})]}),e.jsx(U,{value:`${window.location.origin}/${u}/receipt/${d}`,size:80,fgColor:s,level:"H"})]}),e.jsx("div",{className:"p-4 border-b",style:{borderColor:l(s,.2)},children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Nom client"}),e.jsx("p",{className:"font-medium",children:a.nomClient})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Téléphone"}),e.jsx("p",{className:"font-medium",children:a.telephone})]})]})}),e.jsxs("div",{className:"p-4 border-b",style:{borderColor:l(s,.2)},children:[e.jsxs("div",{className:"mb-3 p-3 rounded-lg flex justify-between items-center",style:{backgroundColor:l(s,.05)},children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:a.depart}),e.jsx("p",{className:"text-xs text-gray-500",children:"Départ"})]}),e.jsx(F,{size:20,className:"text-gray-400 mx-2"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:a.arrivee}),e.jsx("p",{className:"text-xs text-gray-500",children:"Destination"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Date"}),e.jsx("p",{className:"font-medium",children:a.date})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Heure"}),e.jsx("p",{className:"font-medium",children:$})]})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-600 mb-2",children:"Montant payé"}),e.jsxs("p",{className:"font-bold text-2xl",style:{color:s},children:[a.montant.toLocaleString()," FCFA"]}),e.jsxs("div",{className:"mt-3 flex justify-between items-center text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Statut paiement"}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:l(s,.1),color:s},children:a.statut||"Non défini"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"Canal"}),e.jsx("span",{className:"font-medium",children:a.canal||"Non défini"})]})]})]}),e.jsxs("div",{className:"p-4 text-center text-sm border-t",style:{backgroundColor:l(s,.05),borderColor:l(s,.2)},children:[e.jsxs("p",{className:"text-gray-600 mb-1",children:["Merci d'avoir choisi ",e.jsx("strong",{children:r.name})," — Bon voyage !"]}),e.jsx("p",{className:"text-xs italic text-gray-500",children:"Veuillez vous présenter à l’agence au moins 1 heure avant le départ."})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t py-3 px-4 shadow-lg grid grid-cols-2 gap-3",style:{borderColor:l(s,.2)},children:[e.jsxs("button",{onClick:z,className:"py-3 rounded-lg font-medium flex items-center justify-center gap-2",style:{backgroundColor:s,color:m.colors.text},children:[e.jsx(T,{size:18}),e.jsx("span",{children:"Télécharger"})]}),t!=null&&t.latitude&&(t!=null&&t.longitude)?e.jsxs("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${t.latitude},${t.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"py-3 rounded-lg font-medium flex items-center justify-center gap-2",style:{backgroundColor:s,color:m.colors.text},children:[e.jsx(y,{size:18}),e.jsx("span",{children:"Itinéraire"})]}):e.jsxs("button",{onClick:()=>window.print(),className:"py-3 rounded-lg font-medium flex items-center justify-center gap-2",style:{backgroundColor:s,color:m.colors.text},children:[e.jsx(E,{size:18}),e.jsx("span",{children:"Imprimer"})]}),e.jsxs("button",{onClick:()=>f(`/${u}`),className:"py-3 rounded-lg font-medium flex items-center justify-center gap-2 col-span-2",style:{backgroundColor:s,color:m.colors.text},children:[e.jsx(H,{size:18}),e.jsx("span",{children:"Retour à l'accueil"})]})]})]})};export{Z as default};
