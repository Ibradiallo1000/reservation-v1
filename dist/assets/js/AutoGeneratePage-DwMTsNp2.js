import{r as A,j as I}from"./react-CdtEOh9s.js";import{h as u,f as i,c as q,d as $,q as T,w as o,e as E}from"./firebase-C3aZpI0W.js";import{d as s}from"../index-_JuAPzwQ.js";import"./vendor-D_1n0kdO.js";const b=["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],G=t=>t.toISOString().split("T")[0],B=async()=>{console.log("🚀 Début génération des dailyTrips...");const t=new Date,d=Array.from({length:8},(n,a)=>{const e=new Date(t);return e.setDate(t.getDate()+a),e}),r=await u(i(s,"weeklyTrips"));if(r.empty){console.log("Aucun weeklyTrip trouvé.");return}for(const n of r.docs){const a=n.data(),{companyId:e,departure:c,arrival:p,price:h,horaires:x}=a,j=n.id,k=a.places||30,y=await q($(s,"companies",e)),S=y.exists()?y.data().nom:"Compagnie",g=await u(T(i(s,"agences"),o("companyId","==",e)));if(g.empty){console.warn(`⚠️ Aucune agence pour la compagnie ${e}`);continue}const v=g.docs[0].id;for(const f of d){const w=b[f.getDay()],l=G(f),D=(x[w]||[]).filter(Boolean).sort();if(D.length!==0)for(const m of D)await C(e,c,p,l,m)||(await E(i(s,"dailyTrips"),{companyId:e,agencyId:v,companyName:S,departure:c,arrival:p,date:l,day:w,time:m,price:h,places:k,active:!0,createdAt:new Date,weeklyTripId:j}),console.log(`✅ Trajet ajouté : ${c} → ${p} à ${m} (${l})`))}}console.log("🎉 Génération des dailyTrips terminée.")},C=async(t,d,r,n,a)=>{const e=T(i(s,"dailyTrips"),o("companyId","==",t),o("departure","==",d),o("arrival","==",r),o("date","==",n),o("time","==",a));return!(await u(e)).empty},_=()=>(A.useEffect(()=>{(async()=>{await B(),console.log("🚀 DailyTrips générés automatiquement")})()},[]),I.jsx("div",{children:"DailyTrips générés automatiquement."}));export{_ as default};
