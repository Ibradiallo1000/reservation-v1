import{r as a,j as e}from"./react-CdtEOh9s.js";import{q as p,w as i,f as x,h as g}from"./firebase-C3aZpI0W.js";import{u as S,d as u}from"../index-_JuAPzwQ.js";import{J as A}from"./vendor-D_1n0kdO.js";const T=()=>{const{user:s}=S(),[j,b]=a.useState([]),[c,N]=a.useState(""),[l,y]=a.useState(()=>A(new Date,"yyyy-MM-dd")),[o,f]=a.useState([]),[w,m]=a.useState(!1),I=async()=>{if(!(s!=null&&s.companyId))return;const t=p(x(u,"agences"),i("companyId","==",s.companyId)),h=(await g(t)).docs.map(d=>({id:d.id,ville:d.data().ville}));b(h)},v=async()=>{if(!l||!(s!=null&&s.companyId))return;m(!0);const t=p(x(u,"reservations"),i("compagnieId","==",s.companyId),i("statut","==","payÃ©")),d=(await g(t)).docs.map(r=>({id:r.id,...r.data()})).filter(r=>r.date===l&&(!c||r.agencyId===c));f(d),m(!1)};a.useEffect(()=>{I()},[]),a.useEffect(()=>{v()},[l,c]);const C=o.reduce((t,n)=>t+(n.montant||0),0);return e.jsxs("div",{className:"p-6 bg-white min-h-screen",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"ðŸ“… Ventes journaliÃ¨res par agence"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("input",{type:"date",value:l,onChange:t=>y(t.target.value),className:"border p-2 rounded"}),e.jsxs("select",{value:c,onChange:t=>N(t.target.value),className:"border p-2 rounded",children:[e.jsx("option",{value:"",children:"Toutes les agences"}),j.map(t=>e.jsx("option",{value:t.id,children:t.ville},t.id))]}),e.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Imprimer"})]}),w?e.jsx("p",{className:"text-gray-600",children:"Chargement..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-right mb-2 font-semibold text-green-700",children:["Total encaissÃ© : ",C.toLocaleString()," FCFA"]}),e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2",children:"#"}),e.jsx("th",{className:"border p-2",children:"Client"}),e.jsx("th",{className:"border p-2",children:"TÃ©lÃ©phone"}),e.jsx("th",{className:"border p-2",children:"Trajet"}),e.jsx("th",{className:"border p-2",children:"Heure"}),e.jsx("th",{className:"border p-2",children:"Montant"}),e.jsx("th",{className:"border p-2",children:"Canal"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center text-gray-500 p-4",children:"Aucune vente trouvÃ©e."})}):o.map((t,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2 text-center",children:n+1}),e.jsx("td",{className:"border p-2",children:t.nomClient}),e.jsx("td",{className:"border p-2",children:t.telephone}),e.jsxs("td",{className:"border p-2",children:[t.depart," â†’ ",t.arrivee]}),e.jsx("td",{className:"border p-2 text-center",children:t.heure}),e.jsx("td",{className:"border p-2 text-right",children:t.montant.toLocaleString()}),e.jsx("td",{className:"border p-2 text-center",children:t.canal==="guichet"?"Guichet":"En ligne"})]},t.id))})]})]})]})};export{T as default};
