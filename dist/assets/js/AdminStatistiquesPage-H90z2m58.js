import{r as n,j as t,a as r}from"./react-KXT1Riez.js";import{u as p,L as B,t as M}from"./firebase-DYTOaTLw.js";import{d as h}from"../index-b0dmvJTQ.js";import{R as u,X as f,Y as g,T as v,j as x,B as k}from"./generateCategoricalChart-BbxwyVEQ.js";import{L as q,a as E}from"./LineChart-BQT43Qvh.js";import{C as y}from"./CartesianGrid-Cw598Xwk.js";import{B as K}from"./BarChart-CTd7zi-K.js";import{f as F}from"./vendor-B27hBV_J.js";import"./clsx-B-dksMZM.js";const H=()=>{const[o,i]=n.useState([]),[c,C]=n.useState([]),[S,N]=n.useState(!0);n.useEffect(()=>{(async()=>{try{const a=(await p(B(h,"reservations"))).docs.map(m=>m.data()),w=(await p(M(h,"companies"))).docs.map(m=>m.data());i(a),C(w)}catch(e){console.error("AdminStatistiquesPage error:",e)}finally{N(!1)}})()},[]);const D=o.length,A=n.useMemo(()=>o.reduce((s,e)=>s+(e.total||0),0),[o]),R=n.useMemo(()=>c.filter(s=>s.status==="actif").length,[c]),L=n.useMemo(()=>{const s={};return o.forEach(e=>{if(!e.createdAt)return;const a=e.createdAt.toDate(),l=F(a,"yyyy-MM");s[l]=(s[l]||0)+(e.total||0)}),Object.entries(s).map(([e,a])=>({month:e,total:a})).sort((e,a)=>e.month.localeCompare(a.month))},[o]),j=n.useMemo(()=>{const s={};return o.forEach(e=>{const a=e.companyName||"Inconnue";s[a]=(s[a]||0)+(e.total||0)}),Object.entries(s).map(([e,a])=>({name:e,total:a})).sort((e,a)=>a.total-e.total).slice(0,5)},[o]);return S?t("div",{className:"p-6",children:"Chargement des statistiques…"}):r("div",{className:"p-6",children:[t("h1",{className:"text-2xl font-bold mb-6",children:"Statistiques générales"}),r("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 mb-10",children:[t(d,{label:"Réservations",value:D,color:"text-blue-600"}),t(d,{label:"Revenus totaux",value:`${A.toLocaleString()} FCFA`,color:"text-green-600"}),t(d,{label:"Compagnies actives",value:R,color:"text-indigo-600"})]}),t(b,{title:"Évolution des revenus par mois",children:t(u,{width:"100%",height:300,children:r(q,{data:L,children:[t(y,{strokeDasharray:"3 3"}),t(f,{dataKey:"month"}),t(g,{}),t(v,{}),t(x,{}),t(E,{type:"monotone",dataKey:"total",stroke:"#10B981",name:"Revenus"})]})})}),t(b,{title:"Top 5 compagnies par revenus",children:t(u,{width:"100%",height:300,children:r(K,{data:j,children:[t(y,{strokeDasharray:"3 3"}),t(f,{dataKey:"name"}),t(g,{}),t(v,{}),t(x,{}),t(k,{dataKey:"total",fill:"#6366F1",name:"CA total"})]})})})]})},d=({label:o,value:i,color:c})=>r("div",{className:"bg-white rounded shadow p-4 text-center",children:[t("h2",{className:"text-lg font-semibold",children:o}),t("p",{className:`text-3xl font-bold ${c}`,children:i})]}),b=({title:o,children:i})=>r("div",{className:"mb-10",children:[t("h2",{className:"text-lg font-semibold mb-2",children:o}),i]});export{H as default};
