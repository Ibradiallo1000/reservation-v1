import{u as B,r as d,j as e,a7 as V,a8 as $,a9 as T,aa as U,ab as G}from"./react-BKlva80Y.js";import{q as O,w as R,j as A,k as Q,m as q,d as v,t as Z,y as _,x as J,z as K}from"./firebase-1zyXmG6H.js";import{u as X,d as u,a as Y}from"../index-DdVw6ij9.js";import"./vendor-CZDa83Cj.js";delete G.Icon.Default.prototype._getIconUrl;G.Icon.Default.mergeOptions({iconRetinaUrl:"/leaflet/marker-icon-2x.png",iconUrl:"/leaflet/marker-icon.png",shadowUrl:"/leaflet/marker-shadow.png"});const re=()=>{const{user:r}=X(),M=B(),[l,P]=d.useState([]),[j,h]=d.useState(!1),[t,g]=d.useState({nomAgence:"",ville:"",pays:"",quartier:"",type:"",emailGerant:"",nomGerant:"",telephone:"",motDePasse:"",latitude:"",longitude:""}),[i,w]=d.useState(null),[c,p]=d.useState(1),[x,L]=d.useState(6),m=(r==null?void 0:r.companyColor)||"#2563eb",D=({onPositionChange:s})=>(U({click(a){s(a.latlng.lat,a.latlng.lng)}}),null),b=async()=>{if(!(r!=null&&r.companyId))return;const s=O(A(u,"agences"),R("companyId","==",r.companyId)),n=(await Q(s)).docs.map(y=>({id:y.id,...y.data()}));P(n),p(1)};d.useEffect(()=>{b()},[r]);const N=c*x,k=N-x,I=l.slice(k,N),f=Math.ceil(l.length/x),o=s=>{const{name:a,value:n}=s.target;g(y=>({...y,[a]:n}))},S=(s,a)=>{g(n=>({...n,latitude:s.toString(),longitude:a.toString()}))},C=()=>{g({nomAgence:"",ville:"",pays:"",quartier:"",type:"",emailGerant:"",nomGerant:"",telephone:"",motDePasse:"",latitude:"",longitude:""}),w(null),h(!1)},F=async s=>{s.preventDefault();try{if(i)await q(v(u,"agences",i),{nomAgence:t.nomAgence,ville:t.ville,pays:t.pays,quartier:t.quartier,type:t.type,nomGerant:t.nomGerant,telephone:t.telephone,latitude:t.latitude?parseFloat(t.latitude):null,longitude:t.longitude?parseFloat(t.longitude):null}),alert("Agence mise à jour avec succès");else{const a=await Z(Y,t.emailGerant,t.motDePasse),n=await _(A(u,"agences"),{nomAgence:t.nomAgence,ville:t.ville,pays:t.pays,quartier:t.quartier,type:t.type,statut:"active",emailGerant:t.emailGerant,nomGerant:t.nomGerant,telephone:t.telephone,companyId:(r==null?void 0:r.companyId)||"",latitude:t.latitude?parseFloat(t.latitude):null,longitude:t.longitude?parseFloat(t.longitude):null});await J(v(u,"users",a.user.uid),{uid:a.user.uid,email:t.emailGerant,nom:t.nomGerant,telephone:t.telephone,role:"chefAgence",companyId:(r==null?void 0:r.companyId)||"",agencyId:n.id}),alert("Agence et gérant créés avec succès")}C(),b()}catch(a){console.error("Erreur:",a.message),alert(`Erreur: ${a.message}`)}},z=s=>{var a,n;g({nomAgence:s.nomAgence,ville:s.ville,pays:s.pays,quartier:s.quartier||"",type:s.type||"",emailGerant:s.emailGerant,nomGerant:s.nomGerant,telephone:s.telephone,motDePasse:"",latitude:((a=s.latitude)==null?void 0:a.toString())||"",longitude:((n=s.longitude)==null?void 0:n.toString())||""}),w(s.id),h(!0),window.scrollTo({top:0,behavior:"smooth"})},E=async s=>{window.confirm("Êtes-vous sûr de vouloir supprimer cette agence ?")&&(await K(v(u,"agences",s)),b())},H=async s=>{const a=s.statut==="active"?"inactive":"active";await q(v(u,"agences",s.id),{statut:a}),b()},W=s=>{console.log("Naviguer vers :",`/agence/${s}/dashboard`),M(`/compagnie/agence/${s}/dashboard`)};return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:m},children:"Gestion des agences"}),e.jsxs("button",{onClick:()=>h(!j),className:"flex items-center px-4 py-2 rounded-md shadow-sm text-white font-medium",style:{backgroundColor:m},children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),j?"Masquer le formulaire":"Ajouter une nouvelle agence"]})]}),j&&e.jsxs("form",{onSubmit:F,className:"bg-white p-6 rounded-lg shadow-md mb-8 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:m},children:i?"Modifier une agence":"Ajouter une nouvelle agence"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nom de l'agence *"}),e.jsx("input",{name:"nomAgence",value:t.nomAgence,onChange:o,className:"form-input w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ville *"}),e.jsx("input",{name:"ville",value:t.ville,onChange:o,className:"form-input w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Pays *"}),e.jsx("input",{name:"pays",value:t.pays,onChange:o,className:"form-input w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quartier"}),e.jsx("input",{name:"quartier",value:t.quartier,onChange:o,className:"form-input w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Type"}),e.jsx("input",{name:"type",value:t.type,onChange:o,className:"form-input w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nom du gérant *"}),e.jsx("input",{name:"nomGerant",value:t.nomGerant,onChange:o,className:"form-input w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email du gérant *"}),e.jsx("input",{name:"emailGerant",type:"email",value:t.emailGerant,onChange:o,className:"form-input w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:i?"Nouveau mot de passe":"Mot de passe *"}),e.jsx("input",{name:"motDePasse",type:"password",value:t.motDePasse,onChange:o,className:"form-input w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!i,placeholder:i?"Laisser vide pour ne pas changer":""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Téléphone *"}),e.jsx("input",{name:"telephone",value:t.telephone,onChange:o,className:"form-input w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["📍 Position géographique ",t.latitude&&t.longitude&&e.jsxs("span",{className:"text-gray-500 ml-2",children:["(",t.latitude,", ",t.longitude,")"]})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Cliquez sur la carte pour positionner l'agence"}),e.jsx("div",{className:"h-64 rounded-lg border border-gray-300 overflow-hidden",children:e.jsxs(V,{center:[t.latitude?parseFloat(t.latitude):12.6392,t.longitude?parseFloat(t.longitude):-8.0029],zoom:t.latitude?15:12,className:"h-full w-full",scrollWheelZoom:!0,children:[e.jsx($,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(D,{onPositionChange:S}),t.latitude&&t.longitude&&e.jsx(T,{position:[parseFloat(t.latitude),parseFloat(t.longitude)]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:C,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Annuler"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-md shadow-sm text-sm font-medium text-white hover:bg-opacity-90",style:{backgroundColor:m},children:i?"Mettre à jour l'agence":"Ajouter l'agence"})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:["Liste des agences (",l.length,")"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{className:"mr-2 text-sm",children:"Agences par page:"}),e.jsxs("select",{value:x,onChange:s=>{L(Number(s.target.value)),p(1)},className:"border rounded p-1 text-sm",children:[e.jsx("option",{value:6,children:"6"}),e.jsx("option",{value:12,children:"12"}),e.jsx("option",{value:24,children:"24"})]})]})]}),l.length===0?e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-sm border border-gray-200 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Aucune agence enregistrée"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Commencez par ajouter votre première agence."}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:()=>h(!0),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white",style:{backgroundColor:m},children:[e.jsx("svg",{className:"-ml-1 mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Ajouter une agence"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:I.map(s=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden border border-gray-200 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:s.nomAgence}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.ville,", ",s.pays]})]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.statut==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.statut==="active"?"Active":"Inactive"})]}),e.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-2",children:[e.jsx("svg",{className:"flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),s.emailGerant]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx("svg",{className:"flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),s.telephone]})]}),e.jsxs("div",{className:"mt-5 flex justify-between space-x-2",children:[e.jsxs("button",{onClick:()=>W(s.id),className:"flex-1 inline-flex justify-center items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx("svg",{className:"-ml-1 mr-2 h-5 w-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"Dashboard"]}),e.jsxs("button",{onClick:()=>z(s),className:"inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white",style:{backgroundColor:m},children:[e.jsx("svg",{className:"-ml-1 mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Modifier"]})]}),e.jsxs("div",{className:"mt-3 flex space-x-2",children:[e.jsx("button",{onClick:()=>H(s),className:`flex-1 px-3 py-2 border rounded-md text-sm font-medium ${s.statut==="active"?"border-yellow-300 text-yellow-700 bg-yellow-100 hover:bg-yellow-200":"border-green-300 text-green-700 bg-green-100 hover:bg-green-200"}`,children:s.statut==="active"?"Désactiver":"Activer"}),e.jsx("button",{onClick:()=>E(s.id),className:"flex-1 px-3 py-2 border border-red-300 rounded-md text-sm font-medium text-red-700 bg-red-100 hover:bg-red-200",children:"Supprimer"})]})]})},s.id))}),l.length>x&&e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Affichage ",k+1,"-",Math.min(N,l.length)," sur ",l.length," agences"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>p(s=>Math.max(s-1,1)),disabled:c===1,className:`px-4 py-2 rounded-md ${c===1?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"Précédent"}),e.jsxs("span",{className:"px-4 py-2 text-gray-700",children:["Page ",c," sur ",f]}),e.jsx("button",{onClick:()=>p(s=>Math.min(s+1,f)),disabled:c===f,className:`px-4 py-2 rounded-md ${c===f?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"Suivant"})]})]})]})]})};export{re as default};
