import{r as c,a as t,j as a}from"./vendor-Bq-8_m9i.js";import{t as f,u as v,r as w,w as I,I as C,G as A,o as D,y as E,T as k}from"./firebase-CURBI7X6.js";import{b as R,e as j,d as y,O as m}from"./agence-Bsj2lp2X.js";import{a9 as $,V as B,_ as T}from"./icons-C0JHUK9Z.js";import"./compagnie-DiuZFnHS.js";import"./router-DoGdw-3y.js";import"./courier-CoQgRaHG.js";function p(e){var l;if(!e)return"—";const n=(l=e==null?void 0:e.toDate)!=null&&l.call(e)?e.toDate():new Date(e);return isNaN(n.getTime())?"—":n.toLocaleString("fr-FR")}const L=()=>{const{user:e,company:n}=R(),l=j(n)||{primary:"#0EA5E9",secondary:"#22D3EE"},[h,u]=c.useState([]),[g,x]=c.useState(!1),r=c.useCallback(async()=>{if(!(!(e!=null&&e.companyId)||!(e!=null&&e.agencyId))){x(!0);try{const s=f(y,`companies/${e.companyId}/agences/${e.agencyId}/shiftReports`),i=await v(w(s,I("status","==","awaiting_manager"),C("endAt","desc"),A(50)));u(i.docs.map(o=>o.data()))}finally{x(!1)}}},[e==null?void 0:e.companyId,e==null?void 0:e.agencyId]);c.useEffect(()=>{r()},[r]);const b=async s=>{if(!(e!=null&&e.companyId)||!(e!=null&&e.agencyId))return;const i=D(y,`companies/${e.companyId}/agences/${e.agencyId}/shiftReports/${s.shiftId}`);await E(i,{status:"validated",managerValidatedAt:k.now()}),await r()};return t("div",{className:"max-w-6xl mx-auto p-4",children:[t("header",{className:"flex items-center justify-between mb-4",children:[t("div",{className:"flex items-center gap-2",children:[a("div",{className:"h-10 w-10 rounded bg-gray-100 grid place-items-center border",children:a($,{className:"h-5 w-5 text-gray-600"})}),a("h1",{className:"text-xl font-bold",children:"Validations – Chef d’agence"})]}),a("button",{onClick:r,className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",children:"Actualiser"})]}),g&&a("div",{className:"text-sm text-gray-600",children:"Chargement…"}),!g&&h.length===0&&a("div",{className:"text-sm text-gray-600",children:"Aucun rapport en attente de validation du chef d’agence."}),a("div",{className:"space-y-4",children:h.map(s=>t("div",{className:"rounded-2xl border bg-white p-5 shadow-sm",children:[t("div",{className:"flex items-center justify-between",children:[t("div",{children:[t("div",{className:"text-lg font-semibold",children:["Session #",s.shiftId.slice(0,6)," – Guichetier ",s.guichetierCode||s.guichetierId]}),t("div",{className:"text-xs text-gray-500",children:["Début : ",p(s.startAt)," • Fin : ",p(s.endAt)]})]}),a("span",{className:"px-3 py-1 rounded-full text-xs font-semibold",style:{background:"#DBEAFE",color:"#1D4ED8"},children:"En attente de validation chef d’agence"})]}),t("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mt-4",children:[t("div",{className:"rounded-xl border p-4 bg-gray-50",children:[a("div",{className:"text-sm text-gray-500",children:"Réservations"}),a("div",{className:"text-2xl font-bold",children:s.reservationsCount})]}),t("div",{className:"rounded-xl border p-4 bg-gray-50",children:[a("div",{className:"text-sm text-gray-500",children:"Billets"}),a("div",{className:"text-2xl font-bold",children:s.ticketsCount})]}),t("div",{className:"rounded-xl border p-4 bg-gray-50",children:[a("div",{className:"text-sm text-gray-500",children:"Montant"}),a("div",{className:"text-2xl font-bold",children:m(s.amountTotal)})]})]}),t("div",{className:"mt-4",children:[a("div",{className:"font-semibold mb-2",children:"Détails par trajet"}),Array.isArray(s.byRoute)&&s.byRoute.length>0?s.byRoute.map((i,o)=>t("div",{className:"mb-3 rounded-lg border overflow-hidden",children:[t("div",{className:"px-3 py-2 bg-gray-50 flex items-center justify-between",children:[t("div",{className:"font-medium",children:[i.depart," → ",i.arrivee]}),t("div",{className:"text-sm",children:[a("b",{children:i.totalBillets})," billets • ",a("b",{children:m(i.totalMontant)})]})]}),t("table",{className:"w-full text-sm",children:[a("thead",{className:"bg-white",children:t("tr",{children:[a("th",{className:"px-3 py-2 text-left",children:"Date"}),a("th",{className:"px-3 py-2 text-left",children:"Heure"}),a("th",{className:"px-3 py-2 text-right",children:"Billets"}),a("th",{className:"px-3 py-2 text-right",children:"Montant"})]})}),a("tbody",{children:i.trips.map((d,N)=>t("tr",{className:"border-t",children:[a("td",{className:"px-3 py-2",children:d.date}),a("td",{className:"px-3 py-2",children:d.heure}),a("td",{className:"px-3 py-2 text-right",children:d.billets}),a("td",{className:"px-3 py-2 text-right",children:m(d.montant)})]},N))})]})]},o)):a("div",{className:"text-gray-500 text-sm",children:"Aucune vente."})]}),t("div",{className:"mt-4 flex gap-2",children:[t("button",{className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",onClick:()=>window.print(),children:[a(B,{className:"h-4 w-4 inline mr-1"})," Imprimer"]}),t("button",{onClick:()=>b(s),className:"px-3 py-2 rounded-lg text-white",style:{background:`linear-gradient(90deg, ${l.primary}, ${l.secondary})`},children:[a(T,{className:"h-4 w-4 inline mr-1"})," Valider (archiver dans Historique)"]})]})]},s.shiftId))})]})};export{L as default};
