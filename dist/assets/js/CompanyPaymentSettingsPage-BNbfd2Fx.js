import{r as u,a as t,j as a}from"./react-KXT1Riez.js";import{r as L,t as A,w as T,u as F,G as O,o as S,y as j,F as K,Y as z}from"./firebase-DYTOaTLw.js";import{u as G,c as V,e as Y,d as g}from"../index-b0dmvJTQ.js";import"./vendor-B27hBV_J.js";const $=r=>r.toLowerCase().trim().replace(/\s+/g,"_");async function v(r,b,n){const P=S(g,"companies",r),U=n===null?{[`paymentMethods.${b}`]:z()}:{[`paymentMethods.${b}`]:n};return j(P,U)}const W=()=>{const{user:r,company:b}=G(),n=V(b),{setHeader:P,resetHeader:U}=Y(),[d,x]=u.useState([]),[c,N]=u.useState({name:"",logoUrl:"",merchantNumber:"",defaultPaymentUrl:"",ussdPattern:""}),[m,M]=u.useState(null),[E,D]=u.useState(!1),[k,p]=u.useState(null);u.useEffect(()=>(P({title:"Moyens de paiement",subtitle:d.length>0?`${d.length} méthode${d.length>1?"s":""} configurée${d.length>1?"s":""}`:"Aucune méthode configurée",bg:`linear-gradient(90deg, ${n.colors.primary} 0%, ${n.colors.secondary} 100%)`,fg:"#fff"}),()=>U()),[d.length,n.colors.primary,n.colors.secondary]),u.useEffect(()=>{(async()=>{if(r!=null&&r.companyId)try{const s=L(A(g,"paymentMethods"),T("companyId","==",r.companyId)),i=(await F(s)).docs.map(l=>({id:l.id,...l.data()}));x(i)}catch(s){console.error("Error fetching payment methods:",s),p("Erreur lors du chargement des méthodes de paiement")}})()},[r==null?void 0:r.companyId]);const f=e=>{const{name:s,value:o}=e.target;N(i=>({...i,[s]:o}))},q=async e=>{if(e.preventDefault(),p(null),!(r!=null&&r.companyId)){p("Aucune compagnie associée.");return}const{name:s,logoUrl:o,merchantNumber:i,ussdPattern:l,defaultPaymentUrl:y}=c;if(!s||!o||!i||!l){p("Veuillez remplir tous les champs obligatoires.");return}D(!0);try{const h={...c,companyId:r.companyId},C=$(s);if(m)await j(S(g,"paymentMethods",m),h),y&&y.trim()!==""?await v(r.companyId,C,{url:y,logoUrl:o,ussdPattern:l}):await v(r.companyId,C,null),x(I=>I.map(w=>w.id===m?{...h,id:m}:w));else{const I=await K(A(g,"paymentMethods"),h);y&&y.trim()!==""&&await v(r.companyId,C,{url:y,logoUrl:o,ussdPattern:l}),x(w=>[{...h,id:I.id},...w])}N({name:"",logoUrl:"",merchantNumber:"",defaultPaymentUrl:"",ussdPattern:""}),M(null)}catch(h){console.error("Error saving payment method:",h),p("Erreur lors de la sauvegarde")}finally{D(!1)}},R=e=>{M(e.id||null),N({name:e.name,logoUrl:e.logoUrl,merchantNumber:e.merchantNumber,defaultPaymentUrl:e.defaultPaymentUrl||"",ussdPattern:e.ussdPattern||""})},H=async e=>{if(!(!e.id||!(r!=null&&r.companyId)||!window.confirm(`Supprimer la méthode ${e.name} ?`)))try{await O(S(g,"paymentMethods",e.id));const o=$(e.name);await v(r.companyId,o,null),x(i=>i.filter(l=>l.id!==e.id)),m===e.id&&(M(null),N({name:"",logoUrl:"",merchantNumber:"",defaultPaymentUrl:"",ussdPattern:""}))}catch(o){console.error("Error deleting payment method:",o),p("Erreur lors de la suppression")}};return t("div",{className:"max-w-4xl mx-auto p-6",children:[k&&a("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded",children:a("p",{children:k})}),t("div",{className:"bg-white p-6 rounded-lg shadow-md mb-8 border border-gray-100",children:[a("h2",{className:"text-xl font-semibold mb-4",children:"Méthodes configurées"}),d.length===0?a("p",{className:"text-gray-500 italic",children:"Aucune méthode de paiement configurée"}):a("ul",{className:"divide-y divide-gray-200",children:d.map(e=>a("li",{className:"py-4",children:t("div",{className:"flex items-center justify-between",children:[t("div",{className:"flex items-center space-x-4 min-w-0",children:[a("img",{src:e.logoUrl,alt:e.name,className:"w-12 h-12 object-contain rounded border"}),t("div",{className:"min-w-0",children:[a("h3",{className:"font-medium text-gray-900 truncate",children:e.name}),t("p",{className:"text-sm text-gray-500 truncate",children:["N° Marchand: ",e.merchantNumber]}),e.ussdPattern&&t("p",{className:"text-xs text-green-600 truncate",children:["USSD: ",e.ussdPattern]}),e.defaultPaymentUrl&&t("p",{className:"text-xs text-blue-600 truncate",children:["URL: ",e.defaultPaymentUrl]})]})]}),t("div",{className:"flex space-x-2 shrink-0",children:[a("button",{onClick:()=>R(e),className:"px-3 py-1 text-sm rounded transition",style:{backgroundColor:`${n.colors.primary}15`,color:n.colors.primary},children:"Modifier"}),a("button",{onClick:()=>H(e),className:"px-3 py-1 text-sm bg-red-50 text-red-700 rounded hover:bg-red-100 transition",children:"Supprimer"})]})]})},e.id))})]}),t("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-100",children:[a("h2",{className:"text-xl font-semibold mb-4",children:m?"Modifier une méthode":"Ajouter une nouvelle méthode"}),t("form",{onSubmit:q,className:"space-y-4",children:[t("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom de la méthode *"}),a("input",{type:"text",name:"name",value:c.name,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-200",placeholder:"Ex: Orange Money",required:!0})]}),t("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL du logo *"}),a("input",{type:"url",name:"logoUrl",value:c.logoUrl,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-200",placeholder:"https://example.com/logo.png",required:!0})]}),t("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Numéro de marchand *"}),a("input",{type:"text",name:"merchantNumber",value:c.merchantNumber,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-200",placeholder:"Ex: 770123456",required:!0})]}),t("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Code USSD (avec MERCHANT et AMOUNT) *"}),a("input",{type:"text",name:"ussdPattern",value:c.ussdPattern,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-200",placeholder:"Ex: *144*8*MERCHANT*AMOUNT#",required:!0})]}),t("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL de paiement par défaut (optionnel)"}),a("input",{type:"url",name:"defaultPaymentUrl",value:c.defaultPaymentUrl,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-200",placeholder:"https://payment.example.com/pay"})]}),a("div",{className:"pt-2",children:a("button",{type:"submit",disabled:E,className:"w-full flex justify-center py-2 px-4 rounded-md text-sm font-medium text-white transition",style:{backgroundColor:E?"#9ca3af":n.colors.primary},children:E?"En cours…":m?"Mettre à jour":"Enregistrer"})})]})]})]})};export{W as default};
