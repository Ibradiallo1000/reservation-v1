import{u as z,R as m,j as a,a as s,ar as E,as as A,ac as $,at as B,af as M,I as U,ae as D,aj as G,G as H,ak as T,m as W,au as _}from"./react-DB_4kGOy.js";import{u as F,b as J,d as w,P as K,c as Q}from"../index-Bkmir__O.js";import{z as V,x as C,w as j,y as I,A as k}from"./firebase-lLzYRzUk.js";import"./vendor-C-DAJou6.js";const se=()=>{var o,h;const l=z(),{user:e,logout:n,company:t}=F(),[r,d]=m.useState(!1),y=J(t),v=c=>l.pathname===c||l.pathname.startsWith(c+"/"),[p,g]=m.useState(0),[x,N]=m.useState(0);return m.useEffect(()=>{if(!(e!=null&&e.companyId))return;let c=[];const u=new Map;return(async()=>(await V(C(w,"companies",e.companyId,"agences"))).docs.map(b=>b.id).forEach(b=>{const R=j(C(w,"companies",e.companyId,"agences",b,"reservations"),I("statut","==","preuve_recue")),L=k(R,P=>{u.set(b,P.size);const S=Array.from(u.values()).reduce((O,q)=>O+q,0);g(S)});c.push(L)}))(),()=>c.forEach(f=>f())},[e==null?void 0:e.companyId]),m.useEffect(()=>{if(!(e!=null&&e.companyId))return;const c=j(C(w,"avis"),I("companyId","==",e.companyId),I("visible","==",!1)),u=k(c,f=>N(f.size));return()=>u()},[e==null?void 0:e.companyId]),a(K,{children:a(X,{theme:y,isActive:v,onlineProofsCount:p,pendingReviewsCount:x,userInitial:((o=e==null?void 0:e.displayName)==null?void 0:o.charAt(0))||((h=e==null?void 0:e.email)==null?void 0:h.charAt(0))||"?",userName:(e==null?void 0:e.displayName)||(e==null?void 0:e.email)||"",userRole:e==null?void 0:e.role,companyName:(t==null?void 0:t.nom)||"Compagnie",logoUrl:t==null?void 0:t.logoUrl,onLogout:n,onOpenMobileMenu:()=>d(!0)})})},X=l=>{const{theme:e,isActive:n,onlineProofsCount:t,pendingReviewsCount:r,userInitial:d,userName:y,userRole:v,companyName:p,logoUrl:g,onLogout:x,onOpenMobileMenu:N}=l,{header:o}=Q(),h=`linear-gradient(90deg, ${e.colors.primary} 0%, ${e.colors.secondary} 100%)`;return s("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[a("aside",{className:"hidden md:flex fixed inset-y-0 left-0 w-64 flex-col justify-between text-white shadow-xl z-40 overflow-y-auto",style:{backgroundColor:e.colors.primary},children:s("div",{className:"flex-1 flex flex-col justify-between",children:[s("div",{children:[s("div",{className:"p-6 border-b border-white/20 flex items-center gap-3",children:[g&&a("img",{src:g,alt:"logo",className:"h-10 w-10 rounded-full shadow"}),a("h1",{className:"text-xl font-bold",children:p})]}),s("nav",{className:"flex flex-col p-4 space-y-2",children:[a(i,{to:"/compagnie/dashboard",label:"Tableau de bord",icon:a(E,{}),active:n("/compagnie/dashboard"),theme:e}),a(i,{to:"/compagnie/reservations-en-ligne",label:"Réservations en ligne",icon:a(A,{}),active:n("/compagnie/reservations-en-ligne"),badge:t,theme:e}),a(i,{to:"/compagnie/reservations",label:"Réservations",icon:a(A,{}),active:n("/compagnie/reservations"),theme:e}),a(i,{to:"/compagnie/agences",label:"Agences",icon:a($,{}),active:n("/compagnie/agences"),theme:e}),a(i,{to:"/compagnie/avis-clients",label:"Avis Clients",icon:a(B,{}),active:n("/compagnie/avis-clients"),badge:r,theme:e}),a(i,{to:"/compagnie/payment-settings",label:"Moyens de paiement",icon:a(M,{}),active:n("/compagnie/payment-settings"),theme:e}),a(i,{to:"/compagnie/parametres",label:"Paramètres",icon:a(M,{}),active:n("/compagnie/parametres"),theme:e}),s("div",{className:"mt-4 pt-4 border-t border-white/20",children:[a("p",{className:"text-xs uppercase opacity-80 px-4 mb-2",children:"Analytique"}),a(i,{to:"/compagnie/images",label:"Médias",icon:a(U,{}),active:n("/compagnie/images"),theme:e}),a(i,{to:"/compagnie/comptabilite",label:"Comptabilité",icon:a(D,{}),active:n("/compagnie/comptabilite"),theme:e})]})]})]}),a("div",{className:"p-4 border-t border-white/20 bg-white/0 sticky bottom-0",children:s("div",{className:"flex items-center justify-between",children:[s("div",{className:"flex items-center gap-3",children:[a("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-medium",style:{backgroundColor:e.colors.secondary},children:d}),s("div",{className:"min-w-0",children:[a("p",{className:"text-sm font-medium truncate",children:y}),a("p",{className:"text-xs opacity-80",children:v})]})]}),a("button",{onClick:x,className:"p-2 rounded-md hover:bg-white/20 transition-colors",children:a(G,{className:"h-4 w-4 text-white"})})]})})]})}),a("main",{className:"md:ml-64",children:s("div",{className:"h-screen flex flex-col",children:[s("header",{className:"bg-white shadow-sm p-4 md:hidden flex items-center justify-between",children:[a("button",{onClick:N,className:"p-2 rounded-md text-gray-500 hover:bg-gray-100",children:a(H,{className:"w-5 h-5"})}),a("h1",{className:"text-lg font-semibold text-gray-900",children:p}),a("div",{className:"w-5 h-5"})]}),a("div",{className:"sticky top-0 z-30",children:s("div",{className:"px-6 py-4 border-b shadow-sm flex flex-col gap-2 md:flex-row md:items-center md:justify-between",style:{background:o.bg||h,color:o.fg||"#fff",borderColor:"rgba(255,255,255,0.15)"},children:[s("div",{children:[a("div",{className:"text-2xl font-bold leading-tight",children:o.title}),o.subtitle&&a("div",{className:"text-sm opacity-90",children:o.subtitle})]}),a("div",{className:"flex items-center gap-2",children:o.right??o.actions})]})}),a("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 bg-gray-50",children:a(T,{})})]})})]})},i=({to:l,label:e,icon:n,active:t,badge:r,theme:d})=>s(_,{to:l,className:`flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 ${t?"font-bold shadow-sm":"opacity-90 hover:opacity-100"}`,style:{backgroundColor:t?d.colors.secondary:"transparent",color:t?"#fff":"#f1f1f1"},children:[a("span",{children:n}),a("span",{className:"flex-1 text-sm",children:e}),typeof r=="number"&&r>0&&a("span",{className:"ml-auto bg-red-500 text-xs text-white px-2 py-1 rounded-full",children:r}),a(W,{className:`w-4 h-4 ${t?"opacity-100 text-yellow-300":"opacity-0"}`})]});export{se as default};
