import{d as P,u as U,b as R,r as l,j as s,a as e,C as T,M as $,U as D,T as E,A,s as L,aT as S,aA as M,aU as F,a4 as q}from"./react-DgrrIcw2.js";import{d as H,f as I}from"./firebase-eGIzIftJ.js";import{s as b,h as u,d as O}from"../index-p6Te0bSg.js";import{h as B}from"./html2pdf-CvzpMzG0.js";import{J as G,p as J,a5 as V}from"./vendor-BHjJ2Hjk.js";import"./jspdf.es.min-Cptl_4Ji.js";import"./html2canvas-CfelDGmq.js";const te=()=>{var g;const{id:i,slug:f}=P(),x=U(),y=R(),{companyInfo:N,reservation:v}=y.state||{},[t,C]=l.useState(v||null),[r,_]=l.useState(N||null),d=l.useRef(null),a=(r==null?void 0:r.couleurPrimaire)||"#3b82f6",o=(r==null?void 0:r.couleurSecondaire)||"#f97316",m=b(a),w=t!=null&&t.date?G(J(t.date),"dd/MM/yyyy",{locale:V}):"",p=l.useCallback(()=>{if(!t)return"BIL-000000";const c=t.depart.slice(0,3).toUpperCase(),h=t.arrivee.slice(0,3).toUpperCase(),n=(t.agenceNom||"ONL").slice(0,3).toUpperCase(),z=t.id.substring(t.id.length-6).toUpperCase();return`${n}-${c}${h}-${z}`},[t]);l.useEffect(()=>{(async()=>{if(!t&&i){const h=H(O,"reservations",i),n=await I(h);n.exists()&&C({...n.data(),id:n.id})}})()},[i,t]);const j=l.useCallback(()=>{if(d.current){const c={margin:2,filename:`recu-${p()}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:[81,200],orientation:"portrait"}};B().set(c).from(d.current).save()}},[p]);if(!t||!r)return s("div",{className:"flex items-center justify-center min-h-screen",children:s("p",{className:"text-gray-600",children:"Chargement du reçu..."})});const k=`${window.location.origin}/compagnie/${f}/receipt/${t.id}`;return e("div",{className:"min-h-screen bg-gray-50",children:[s("header",{className:"sticky top-0 z-20 px-4 py-2 shadow-sm",style:{backgroundColor:a,color:m},children:e("div",{className:"flex items-center justify-between max-w-md mx-auto",children:[s("button",{onClick:()=>x(-1),className:"p-2 rounded-full",children:s(T,{size:22})}),s("h1",{className:"font-bold text-lg",children:"Reçu de réservation"}),r.logoUrl&&s("img",{src:r.logoUrl,alt:"Logo",className:"h-8 w-8 rounded-full object-cover border",style:{borderColor:m}})]})}),s("main",{className:"max-w-md mx-auto px-4 py-6",children:e("div",{ref:d,className:"bg-white rounded-lg shadow-sm border p-4",children:[e("div",{className:"flex justify-between items-center border-b pb-2 mb-2",style:{borderColor:u(a,.3)},children:[e("div",{className:"flex items-center gap-2",children:[r.logoUrl&&s("img",{src:r.logoUrl,alt:r.name,className:"h-8 w-8 object-contain rounded border",style:{borderColor:a}}),e("div",{children:[s("h2",{className:"font-bold text-sm",children:r.name}),e("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[s($,{size:12})," ",t.agenceNom||"Agence Principale"]})]})]}),e("div",{className:"text-right",children:[e("p",{className:"text-xs font-mono",children:["N° ",p()]}),s("span",{className:"px-1 py-0.5 rounded text-[10px] font-medium",style:{backgroundColor:u(a,.15),color:a},children:((g=t.statut)==null?void 0:g.toUpperCase())||"EN ATTENTE"})]})]}),e("div",{className:"mb-3",children:[e("h3",{className:"font-semibold text-sm flex items-center gap-1",style:{color:a},children:[s(D,{size:14,style:{color:o}})," Client"]}),e("div",{className:"flex justify-between text-xs text-black",children:[e("p",{children:["Nom : ",t.nomClient]}),e("p",{children:["Téléphone : ",t.telephone]})]})]}),e("div",{className:"mb-3",children:[e("h3",{className:"font-semibold text-sm flex items-center gap-1",style:{color:a},children:[s(E,{size:14,style:{color:o}})," Voyage"]}),e("p",{className:"text-sm font-medium flex items-center gap-1 text-black",children:[t.depart,s(A,{size:14,style:{color:a}}),t.arrivee]}),e("div",{className:"flex justify-between text-xs text-black",children:[e("p",{children:["Date : ",w]}),e("p",{children:["Heure : ",t.heure]})]}),e("div",{className:"flex justify-between text-xs text-black",children:[e("p",{children:["Places réservées : ",t.seatsGo]}),e("p",{children:["Canal : ",t.canal||"en ligne"]})]})]}),e("div",{className:"mb-3",children:[e("h3",{className:"font-semibold text-sm flex items-center gap-1",style:{color:a},children:[s(L,{size:14,style:{color:o}})," Paiement"]}),e("div",{className:"flex justify-between items-center text-black",children:[e("p",{className:"font-bold text-lg",style:{color:a},children:[t.montant.toLocaleString()," FCFA"]}),e("p",{className:"text-xs",children:["Méthode : ",t.canal==="guichet"?"Espèces":"En ligne"]})]})]}),e("div",{className:"text-center border-t pt-3",children:[s("h3",{className:"text-sm font-semibold mb-2",style:{color:a},children:"Code d'embarquement"}),s("div",{className:"flex justify-center",children:s(S,{value:k,size:80,fgColor:a})})]}),e("div",{className:"mt-3 text-center text-xs text-gray-600",children:[e("p",{children:["Merci d'avoir choisi ",r.name," — Bon voyage !"]}),s("p",{className:"italic",children:"Présentez-vous 1H avant le départ"}),e("p",{className:"mt-1",children:["Pour plus d'infos, contactez :",s("a",{href:`tel:${t.telephone}`,className:"text-blue-600 underline ml-1",children:t.telephone})]})]})]})}),e("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t py-3 px-4 grid grid-cols-3 gap-2",style:{borderColor:u(a,.3)},children:[e("button",{onClick:j,className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1",style:{backgroundColor:a,color:m},children:[s(M,{size:16})," Télécharger"]}),e("button",{onClick:()=>window.print(),className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1",style:{backgroundColor:o,color:b(o)},children:[s(F,{size:16})," Imprimer"]}),e("button",{onClick:()=>x(`/${f}`),className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1 bg-gray-200 text-gray-800",children:[s(q,{size:16})," Retour"]})]})]})};export{te as default};
