import{r as i,a as n,j as t}from"./react-KXT1Riez.js";import{t as b,u as M,r as V,F as Z,T as ee}from"./firebase-DYTOaTLw.js";import{u as te,d as f}from"../index-b0dmvJTQ.js";import{E as ae}from"./jspdf.es.min-CKqfBJjn.js";import{a as re}from"./jspdf.plugin.autotable-CtA5BUKo.js";import{utils as N,writeFile as oe}from"./xlsx-D_0l8YDs.js";import{P as ne,a as se}from"./PieChart-HCzgfpfU.js";import{k as ie,T as x,j as le,R as v,X as $,Y as j,B as de}from"./generateCategoricalChart-BbxwyVEQ.js";import{B as ce}from"./BarChart-CTd7zi-K.js";import{L as me,a as pe}from"./LineChart-BQT43Qvh.js";import{C as he}from"./CartesianGrid-Cw598Xwk.js";import"./vendor-B27hBV_J.js";import"./clsx-B-dksMZM.js";const Ae=()=>{const{user:r,company:l}=te(),[w,C]=i.useState(""),[S,F]=i.useState(0),[I,T]=i.useState("dÃ©pÃ´t"),[A,D]=i.useState(""),[L,E]=i.useState([]),[m,K]=i.useState([]),[p,R]=i.useState(""),[u,_]=i.useState(""),[y,q]=i.useState(""),[g,B]=i.useState(""),[ue,O]=i.useState(0),s={primary:(l==null?void 0:l.couleurPrimaire)||"#2563eb",secondary:(l==null?void 0:l.couleurSecondaire)||"#9333ea"},P=["#3b82f6","#10b981","#f59e0b","#ef4444","#6366f1","#14b8a6"],k=async()=>{if(!(r!=null&&r.companyId)||!(r!=null&&r.agencyId))return;const e=b(f,"companies",r.companyId,"agences",r.agencyId,"recettes"),o=(await M(V(e))).docs.map(h=>({id:h.id,...h.data()}));E(o);const c=o.reduce((h,U)=>h+(U.montant||0),0);O(c)},J=async()=>{if(!(r!=null&&r.companyId)||!(r!=null&&r.agencyId))return;const e=b(f,"companies",r.companyId,"agences",r.agencyId,"users"),o=(await M(e)).docs.map(c=>({id:c.id,displayName:c.data().displayName}));K(o)},X=async e=>{if(e.preventDefault(),!(r!=null&&r.companyId)||!(r!=null&&r.agencyId)||!p)return;const a=m.find(c=>c.id===p),o=b(f,"companies",r.companyId,"agences",r.agencyId,"recettes");await Z(o,{libelle:w,montant:S,type:I,commentaire:A,guichetierId:p,guichetierNom:(a==null?void 0:a.displayName)||"",createdAt:ee.now(),date:new Date().toISOString().split("T")[0]}),C(""),F(0),T("dÃ©pÃ´t"),D(""),R(""),k()};i.useEffect(()=>{k(),J()},[r]);const d=L.filter(e=>{const a=u?e.guichetierId===u:!0,o=y?e.date===y:!0,c=g?e.date.startsWith(g):!0;return a&&o&&c}),Y=d.reduce((e,a)=>e+(a.montant||0),0),G=m.map(e=>({name:e.displayName,value:L.filter(a=>a.guichetierId===e.id).reduce((a,o)=>a+o.montant,0)})).filter(e=>e.value>0),z=["dÃ©pÃ´t","avance","rÃ¨glement"].map(e=>({type:e,montant:d.filter(a=>a.type===e).reduce((a,o)=>a+o.montant,0)})),W=Array.from(new Set(d.map(e=>e.date))).sort().map(e=>({date:e,montant:d.filter(a=>a.date===e).reduce((a,o)=>a+o.montant,0)})),H=()=>{const e=new ae;e.text(`Recettes - ${(l==null?void 0:l.nom)||"Compagnie"}`,14,14),re(e,{head:[["Date","LibellÃ©","Type","Montant","Guichetier","Commentaire"]],body:d.map(a=>[a.date,a.libelle,a.type,`${a.montant.toLocaleString()} FCFA`,a.guichetierNom,a.commentaire||"-"])}),e.save("recettes.pdf")},Q=()=>{const e=N.json_to_sheet(d.map(o=>({Date:o.date,LibellÃ©:o.libelle,Type:o.type,Montant:o.montant,Guichetier:o.guichetierNom,Commentaire:o.commentaire||"-"}))),a=N.book_new();N.book_append_sheet(a,e,"Recettes"),oe(a,"recettes.xlsx")};return n("div",{className:"p-6 bg-gray-50 min-h-screen",children:[n("div",{className:"flex justify-between items-center mb-6",children:[t("h2",{className:"text-2xl font-bold",style:{color:s.primary},children:"Gestion des Recettes"}),n("div",{className:"flex gap-2",children:[t("button",{onClick:H,className:"px-4 py-2 text-white rounded shadow",style:{background:`linear-gradient(to right, ${s.primary}, ${s.secondary})`},children:"ðŸ“„ Exporter PDF"}),t("button",{onClick:Q,className:"px-4 py-2 text-white rounded shadow",style:{background:`linear-gradient(to right, ${s.secondary}, ${s.primary})`},children:"ðŸ“Š Exporter Excel"})]})]}),n("form",{onSubmit:X,className:"grid md:grid-cols-2 gap-4 mb-6 bg-white p-6 rounded-lg shadow border",style:{borderColor:s.secondary},children:[t("input",{value:w,onChange:e=>C(e.target.value),placeholder:"LibellÃ©",required:!0,className:"border p-2 rounded"}),t("input",{type:"number",value:S,onChange:e=>F(parseFloat(e.target.value)),placeholder:"Montant",required:!0,className:"border p-2 rounded"}),n("select",{value:I,onChange:e=>T(e.target.value),className:"border p-2 rounded",children:[t("option",{value:"dÃ©pÃ´t",children:"DÃ©pÃ´t"}),t("option",{value:"avance",children:"Avance"}),t("option",{value:"rÃ¨glement",children:"RÃ¨glement"})]}),n("select",{value:p,onChange:e=>R(e.target.value),required:!0,className:"border p-2 rounded",children:[t("option",{value:"",children:"-- SÃ©lectionner un guichetier --"}),m.map(e=>t("option",{value:e.id,children:e.displayName},e.id))]}),t("input",{value:A,onChange:e=>D(e.target.value),placeholder:"Commentaire (optionnel)",className:"border p-2 rounded col-span-2"}),t("button",{type:"submit",className:"col-span-2 px-4 py-2 text-white font-semibold rounded shadow",style:{background:`linear-gradient(to right, ${s.primary}, ${s.secondary})`},children:"Ajouter"})]}),n("div",{className:"mb-6 flex flex-wrap gap-4 items-center",children:[n("select",{value:u,onChange:e=>_(e.target.value),className:"border p-2 rounded bg-white shadow",children:[t("option",{value:"",children:"Tous les guichetiers"}),m.map(e=>t("option",{value:e.id,children:e.displayName},e.id))]}),t("input",{type:"date",value:y,onChange:e=>q(e.target.value),className:"border p-2 rounded bg-white shadow"}),t("input",{type:"month",value:g,onChange:e=>B(e.target.value),className:"border p-2 rounded bg-white shadow"}),n("p",{className:"text-lg font-bold",style:{color:s.secondary},children:["Total : ",Y.toLocaleString()," FCFA"]})]}),n("div",{className:"grid md:grid-cols-3 gap-6 mb-6",children:[n("div",{className:"bg-white p-4 rounded-lg shadow border col-span-1",children:[t("h3",{className:"text-lg font-semibold mb-4",style:{color:s.primary},children:"Par Guichetier"}),t(v,{width:"100%",height:250,children:n(ne,{children:[t(se,{data:G,dataKey:"value",nameKey:"name",outerRadius:100,label:!0,children:G.map((e,a)=>t(ie,{fill:P[a%P.length]},a))}),t(x,{}),t(le,{})]})})]}),n("div",{className:"bg-white p-4 rounded-lg shadow border col-span-1",children:[t("h3",{className:"text-lg font-semibold mb-4",style:{color:s.primary},children:"Par Type"}),t(v,{width:"100%",height:250,children:n(ce,{data:z,children:[t($,{dataKey:"type"}),t(j,{}),t(x,{}),t(de,{dataKey:"montant",fill:s.secondary})]})})]}),n("div",{className:"bg-white p-4 rounded-lg shadow border col-span-1",children:[t("h3",{className:"text-lg font-semibold mb-4",style:{color:s.primary},children:"Ã‰volution par Jour"}),t(v,{width:"100%",height:250,children:n(me,{data:W,children:[t(he,{strokeDasharray:"3 3"}),t($,{dataKey:"date"}),t(j,{}),t(x,{}),t(pe,{type:"monotone",dataKey:"montant",stroke:s.primary})]})})]})]}),d.length===0?t("p",{className:"text-gray-500",children:"Aucune recette enregistrÃ©e pour le moment."}):t("div",{className:"overflow-auto",children:n("table",{className:"min-w-full text-sm bg-white border rounded shadow",children:[t("thead",{children:n("tr",{style:{backgroundColor:s.secondary,color:"#fff"},children:[t("th",{className:"border px-4 py-2",children:"Date"}),t("th",{className:"border px-4 py-2",children:"LibellÃ©"}),t("th",{className:"border px-4 py-2",children:"Type"}),t("th",{className:"border px-4 py-2",children:"Montant"}),t("th",{className:"border px-4 py-2",children:"Guichetier"}),t("th",{className:"border px-4 py-2",children:"Commentaire"})]})}),t("tbody",{children:d.map(e=>n("tr",{className:"hover:bg-gray-50",children:[t("td",{className:"border px-4 py-2",children:e.date}),t("td",{className:"border px-4 py-2",children:e.libelle}),t("td",{className:"border px-4 py-2 capitalize",children:e.type}),n("td",{className:"border px-4 py-2 text-right",children:[e.montant.toLocaleString()," FCFA"]}),t("td",{className:"border px-4 py-2",children:e.guichetierNom}),t("td",{className:"border px-4 py-2",children:e.commentaire||"-"})]},e.id))})]})})]})};export{Ae as default};
