import{r as o,a as d,j as r}from"./react-DgrrIcw2.js";import{l as w,k as g,A as y,T as v,B as A,d as j}from"./firebase-eGIzIftJ.js";import{d as c}from"../index-p6Te0bSg.js";import{U as E}from"./UploadImageCloudinary-C5Ghklh4.js";import"./vendor-BHjJ2Hjk.js";import"./v4-C6aID195.js";const k=()=>{const[i,f]=o.useState([]),[b,n]=o.useState(!1),[m,u]=o.useState(null),l=async()=>{n(!0),u(null);try{const s=(await w(g(c,"mediaPlatform"))).docs.map(a=>{var t;return{id:a.id,...a.data(),createdAt:(t=a.data().createdAt)==null?void 0:t.toDate()}});s.sort((a,t)=>{var p,h;return(((p=t.createdAt)==null?void 0:p.getTime())||0)-(((h=a.createdAt)==null?void 0:h.getTime())||0)}),f(s)}catch(e){console.error("Erreur chargement médias:",e),u("Erreur lors du chargement des images")}finally{n(!1)}};o.useEffect(()=>{l()},[]);const x=async e=>{if(!(!e.id||!window.confirm(`Supprimer l'image "${e.nom}" ?`)))try{await A(j(c,"mediaPlatform",e.id)),l()}catch(a){console.error("Erreur de suppression:",a),alert("Erreur lors de la suppression")}},N=async(e,s,a)=>{try{await y(g(c,"mediaPlatform"),{url:e,type:s,nom:a,createdAt:v.now()}),l()}catch(t){console.error("Erreur ajout média:",t)}};return d("div",{className:"p-6 max-w-6xl mx-auto",children:[r("h1",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Bibliothèque globale de médias"}),r("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:r(E,{label:"Ajouter une image",dossier:"platform",collectionName:"mediaPlatform",onUpload:e=>N(e,"autre","Nouvelle image"),className:"w-full"})}),m&&r("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4",children:r("p",{children:m})}),b?r("div",{className:"flex justify-center py-8",children:r("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-orange-500"})}):i.length===0?r("div",{className:"bg-orange-50 p-4 rounded-lg text-orange-800",children:r("p",{children:"Aucune image enregistrée pour la plateforme."})}):r("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:i.map(e=>d("div",{className:"border border-gray-200 rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow duration-200 bg-white",children:[r("div",{className:"relative h-40 mb-2",children:r("img",{src:e.url,alt:e.nom,className:"h-full w-full object-cover rounded-md",loading:"lazy"})}),d("div",{className:"mb-1",children:[r("p",{className:"text-sm font-medium text-gray-800 truncate",children:e.nom}),r("span",{className:"text-xs text-gray-500",children:e.type})]}),d("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.createdAt&&r("span",{children:new Date(e.createdAt).toLocaleDateString()}),r("button",{onClick:()=>x(e),className:"text-red-600 hover:text-red-800 hover:underline",children:"Supprimer"})]})]},e.id))})]})};export{k as default};
