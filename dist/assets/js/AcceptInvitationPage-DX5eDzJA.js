import{d as N,b as I,r as i,j as e,a as l}from"./react-KXT1Riez.js";import{o as d,q as A,U as E,v as j,x as g,y as C}from"./firebase-DYTOaTLw.js";import{d as u,a as S}from"../index-CBC3XRHi.js";import"./vendor-B27hBV_J.js";const D=s=>{switch(s){case"admin_compagnie":case"compagnie":return"/compagnie/dashboard";case"chefAgence":case"superviseur":return"/agence/dashboard";case"guichetier":return"/agence/guichet";case"comptable":return"/agence/comptabilite";default:return"/"}},U=()=>{const{invitationId:s}=N(),f=I(),[t,h]=i.useState(null),[o,v]=i.useState(""),[m,y]=i.useState(""),[x,b]=i.useState(!0),[p,a]=i.useState(null);i.useEffect(()=>{s&&(async()=>{try{const r=d(u,"invitations",s),c=await A(r);if(!c.exists()){a("Invitation introuvable.");return}const n=c.data();if(n.status!=="pending"){a("Cette invitation a déjà été utilisée.");return}h(n)}catch{a("Erreur lors du chargement de l’invitation.")}finally{b(!1)}})()},[s]);const w=async r=>{if(r.preventDefault(),!!t){if(a(null),o.length<6){a("Mot de passe trop court (minimum 6 caractères).");return}if(o!==m){a("Les mots de passe ne correspondent pas.");return}try{const n=(await E(S,t.email,o)).user.uid;await j(d(u,"users",n),{uid:n,email:t.email,role:t.role,companyId:t.companyId,agencyId:t.agencyId??null,status:"actif",createdAt:g()}),await C(d(u,"invitations",s),{status:"accepted",acceptedAt:g(),userId:n}),f(D(t.role),{replace:!0})}catch(c){a(c.message||"Erreur lors de l’activation.")}}};return x?e("div",{className:"p-8 text-center",children:"Chargement…"}):p?e("div",{className:"min-h-screen flex items-center justify-center",children:e("div",{className:"bg-white border rounded-xl p-6 text-red-600 font-medium",children:p})}):t?e("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:l("form",{onSubmit:w,className:"bg-white p-8 rounded-2xl shadow w-full max-w-md space-y-5",children:[e("h1",{className:"text-xl font-bold text-center text-orange-600",children:"Activer votre compte"}),l("div",{className:"space-y-1",children:[e("label",{className:"text-sm font-medium text-gray-700",children:"Email"}),e("input",{value:t.email,disabled:!0,className:"w-full border rounded-lg px-3 py-2 bg-gray-100 text-gray-700"})]}),l("div",{className:"space-y-1",children:[e("label",{className:"text-sm font-medium text-gray-700",children:"Mot de passe"}),e("input",{type:"password",value:o,onChange:r=>v(r.target.value),className:"w-full border rounded-lg px-3 py-2",required:!0})]}),l("div",{className:"space-y-1",children:[e("label",{className:"text-sm font-medium text-gray-700",children:"Confirmer le mot de passe"}),e("input",{type:"password",value:m,onChange:r=>y(r.target.value),className:"w-full border rounded-lg px-3 py-2",required:!0})]}),e("button",{type:"submit",className:"w-full bg-orange-600 text-white py-2.5 rounded-lg font-medium hover:bg-orange-700 transition",children:"Activer mon compte"})]})}):null};export{U as default};
