import{r as i,u as N,j as e}from"./react-PtMwKKf1.js";import{l as y,k as v,u,d as x}from"./firebase-eGIzIftJ.js";import{d as m}from"../index-B745l0NT.js";import"./vendor-B5FTF_2c.js";const c={free:{label:"Free",commission:.1},standard:{label:"Standard",commission:.05},premium:{label:"Premium",commission:.02}},$=()=>{const[d,l]=i.useState([]),[h,b]=i.useState(!0),[p,o]=i.useState(""),g=N();i.useEffect(()=>{(async()=>{try{const t=(await y(v(m,"companies"))).docs.map(n=>({id:n.id,...n.data()}));l(t)}catch(a){console.error("Erreur chargement compagnies:",a),o("Erreur lors du chargement des compagnies")}finally{b(!1)}})()},[]);const j=async(s,a)=>{try{const t=a==="actif"?"inactif":"actif";await u(x(m,"companies",s),{status:t}),o(`Statut mis à jour en "${t}"`),l(n=>n.map(r=>r.id===s?{...r,status:t}:r))}catch(t){console.error("Erreur maj statut:",t),o("Erreur lors de la mise à jour du statut")}},f=async(s,a)=>{try{const t=c[a].commission;await u(x(m,"companies",s),{plan:a,commissionRate:t}),o(`Plan changé en "${c[a].label}"`),l(n=>n.map(r=>r.id===s?{...r,plan:a,commissionRate:t}:r))}catch(t){console.error("Erreur maj plan:",t),o("Erreur lors du changement de plan")}};return h?e.jsx("p",{className:"p-6",children:"Chargement des compagnies..."}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Gestion des compagnies"}),e.jsx("button",{onClick:()=>g("/compagnies/ajouter"),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded",children:"+ Ajouter une compagnie"})]}),p&&e.jsx("p",{className:"mb-4 text-blue-600",children:p}),d.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"Aucune compagnie enregistrée"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(s=>e.jsxs("div",{className:"border rounded-lg shadow-md bg-white p-5 hover:shadow-lg transition",children:[e.jsx("h2",{className:"text-lg font-bold text-orange-600",children:s.nom}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Slug : ",s.slug||"—"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Email : ",s.email]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Téléphone : ",s.telephone]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Pays : ",s.pays]}),e.jsxs("p",{className:`text-sm mt-1 ${s.status==="inactif"?"text-red-600":"text-green-600"}`,children:["Statut : ",s.status||"actif"]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm text-gray-700 font-medium",children:"Plan d’abonnement :"}),e.jsx("select",{value:s.plan,onChange:a=>f(s.id,a.target.value),className:"border p-2 rounded mt-1 w-full",children:Object.entries(c).map(([a,t])=>e.jsxs("option",{value:a,children:[t.label," — ",t.commission*100,"% commission"]},a))})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[e.jsx("button",{onClick:()=>g(`/compagnies/${s.id}/modifier`),className:"text-sm px-3 py-1 rounded bg-green-600 text-white hover:bg-green-700",children:"Modifier"}),e.jsx("button",{onClick:()=>j(s.id,s.status),className:"text-sm px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600",children:s.status==="inactif"?"Réactiver":"Désactiver"}),e.jsx("a",{href:`/${s.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Voir site"}),e.jsx("a",{href:`/compagnies/${s.id}/factures`,className:"text-sm px-3 py-1 rounded bg-purple-600 text-white hover:bg-purple-700",children:"Factures"})]})]},s.id))})]})};export{$ as default};
