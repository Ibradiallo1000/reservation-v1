import{b as P,_ as l,a as o,j as e,w as D,x as C,a5 as U,ab as z,k as B,E as A,t as F,ac as T,a8 as W,G as _,a0 as $,O as G,p as H,D as J}from"./react-DgrrIcw2.js";import{u as K,b as Q,d as b}from"../index-p6Te0bSg.js";import{q as I,w as y,k as v,m as q,l as V}from"./firebase-eGIzIftJ.js";import"./vendor-BHjJ2Hjk.js";const se=()=>{var w,N;const r=P(),{user:a,logout:g,company:s}=K(),[d,u]=l.useState(!1),t=Q(s),i=n=>r.pathname===n||r.pathname.startsWith(n+"/"),[S,k]=l.useState(0),x=l.useRef(0),[L,j]=l.useState(0);l.useEffect(()=>{if(!(a!=null&&a.companyId))return;const n=[];return(async()=>{(await V(v(b,"companies",a.companyId,"agences"))).docs.map(f=>f.id).forEach(f=>{const M=I(v(b,"companies",a.companyId,"agences",f,"reservations"),y("statut","==","preuve_recue")),E=q(M,O=>{const h=O.size;h>0&&h>x.current&&R(),x.current=h,k(h)});n.push(E)})})(),()=>n.forEach(p=>p())},[a==null?void 0:a.companyId]),l.useEffect(()=>{if(!(a!=null&&a.companyId))return;const n=I(v(b,"avis"),y("companyId","==",a.companyId),y("visible","==",!1)),m=q(n,p=>{j(p.size)});return()=>m()},[a==null?void 0:a.companyId]);const R=()=>{try{const n=new Audio("/son.mp3");n.volume=.5,n.play().catch(m=>console.warn("Lecture bloquée",m))}catch(n){console.error("Erreur audio",n)}};return o("div",{className:"flex min-h-screen bg-gray-50 text-gray-900",children:[e("aside",{className:"hidden md:flex md:w-64 flex-col justify-between text-white shadow-xl",style:{backgroundColor:t.colors.primary},children:o("div",{className:"flex-1 flex flex-col justify-between",children:[o("div",{children:[o("div",{className:"p-6 border-b border-white/20 flex items-center gap-3",children:[(s==null?void 0:s.logoUrl)&&e("img",{src:s.logoUrl,alt:"logo",className:"h-10 w-10 rounded-full shadow"}),e("h1",{className:"text-xl font-bold",children:(s==null?void 0:s.nom)||"Compagnie"})]}),o("nav",{className:"flex flex-col p-4 space-y-2",children:[e(c,{to:"/compagnie/dashboard",label:"Tableau de bord",icon:e(D,{}),active:i("/compagnie/dashboard"),theme:t}),e(c,{to:"/compagnie/reservations-en-ligne",label:"Réservations en ligne",icon:e(C,{}),active:i("/compagnie/reservations-en-ligne"),badge:S,theme:t}),e(c,{to:"/compagnie/reservations",label:"Réservations",icon:e(C,{}),active:i("/compagnie/reservations"),theme:t}),e(c,{to:"/compagnie/agences",label:"Agences",icon:e(U,{}),active:i("/compagnie/agences"),theme:t}),e(c,{to:"/compagnie/avis-clients",label:"Avis Clients",icon:e(z,{}),active:i("/compagnie/avis-clients"),badge:L,theme:t}),e(c,{to:"/compagnie/personnel",label:"Personnel",icon:e(B,{}),active:i("/compagnie/personnel"),theme:t}),e(c,{to:"/compagnie/payment-settings",label:"Moyens de paiement",icon:e(A,{}),active:i("/compagnie/payment-settings"),theme:t}),e(c,{to:"/compagnie/parametres",label:"Paramètres",icon:e(A,{}),active:i("/compagnie/parametres"),theme:t}),o("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e("p",{className:"text-xs uppercase opacity-80 px-4 mb-2",children:"Analytique"}),e(c,{to:"/compagnie/images",label:"Médias",icon:e(F,{}),active:i("/compagnie/images"),theme:t}),e(c,{to:"/compagnie/finances",label:"Finances",icon:e(T,{}),active:i("/compagnie/finances"),theme:t}),e(c,{to:"/compagnie/statistiques",label:"Statistiques",icon:e(W,{}),active:i("/compagnie/statistiques"),theme:t})]})]})]}),e("div",{className:"p-4 border-t border-white/20 sticky bottom-0 bg-opacity-90",children:o("div",{className:"flex items-center justify-between",children:[o("div",{className:"flex items-center gap-3",children:[e("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-medium",style:{backgroundColor:t.colors.secondary},children:((w=a==null?void 0:a.displayName)==null?void 0:w.charAt(0))||((N=a==null?void 0:a.email)==null?void 0:N.charAt(0))}),o("div",{children:[e("p",{className:"text-sm font-medium truncate",children:(a==null?void 0:a.displayName)||(a==null?void 0:a.email)}),e("p",{className:"text-xs opacity-80",children:a==null?void 0:a.role})]})]}),e("button",{onClick:g,className:"p-2 rounded-md hover:bg-white/20 transition-colors",children:e(_,{className:"h-4 w-4 text-white"})})]})})]})}),e("main",{className:"flex-1 overflow-hidden",children:o("div",{className:"h-full flex flex-col",children:[o("header",{className:"bg-white shadow-sm p-4 md:hidden flex items-center justify-between",children:[e("button",{onClick:()=>u(!0),className:"p-2 rounded-md text-gray-500 hover:bg-gray-100",children:e($,{className:"w-5 h-5"})}),e("h1",{className:"text-lg font-semibold text-gray-900",children:(s==null?void 0:s.nom)||"Compagnie"}),e("div",{className:"w-5 h-5"})]}),e("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 bg-gray-50",children:e(G,{})})]})})]})},c=({to:r,label:a,icon:g,active:s,badge:d,theme:u})=>o(J,{to:r,className:`flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 ${s?"font-bold shadow-sm":"opacity-90 hover:opacity-100"}`,style:{backgroundColor:s?u.colors.secondary:"transparent",color:s?"#fff":"#f1f1f1"},children:[e("span",{children:g}),e("span",{className:"flex-1 text-sm",children:a}),typeof d=="number"&&d>0&&e("span",{className:"ml-auto bg-red-500 text-xs text-white px-2 py-1 rounded-full",children:d}),e(H,{className:`w-4 h-4 ${s?"opacity-100 text-yellow-300":"opacity-0"}`})]});export{se as default};
