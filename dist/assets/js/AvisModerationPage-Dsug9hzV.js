import{r as c,a as l,j as s}from"./react-DB_4kGOy.js";import{x as L,w as x,J as v,y as w,Y as M,z as P,o as N,C as R,G as $}from"./firebase-lLzYRzUk.js";import{u as q,b as z,c as G,d as u}from"../index-Bkmir__O.js";import"./vendor-C-DAJou6.js";const B=()=>{const{user:t,company:A}=q(),i=z(A),{setHeader:C,resetHeader:D}=G(),[a,f]=c.useState([]),[h,g]=c.useState(!0),[y,E]=c.useState(null),[I,S]=c.useState(!0),p=10,d=async(e=!1)=>{if(!(t!=null&&t.companyId))return;g(!0);const n=L(u,"companies",t.companyId,"avis");let m=x(n,w("visible","==",!1),v(p));e&&y&&(m=x(n,w("visible","==",!1),M(y),v(p)));try{const o=await P(m),b=o.docs.map(r=>({id:r.id,...r.data()})).sort((r,H)=>r.nom.localeCompare(H.nom));f(e?r=>[...r,...b]:b),E(o.docs[o.docs.length-1]||null),S(o.size===p)}catch(o){console.error("Erreur de récupération des avis :",o)}finally{g(!1)}};c.useEffect(()=>{d()},[t]),c.useEffect(()=>(C({title:"Avis clients",subtitle:a.length?`${a.length} avis en attente`:"Aucun avis en attente",bg:`linear-gradient(90deg, ${i.colors.primary} 0%, ${i.colors.secondary} 100%)`,fg:"#fff"}),()=>D()),[a.length,i.colors.primary,i.colors.secondary]);const j=async(e,n)=>{if(!(t!=null&&t.companyId))return;const m=N(u,"companies",t.companyId,"avis",e);await R(m,{visible:!n}),d()},k=async e=>{if(!(t!=null&&t.companyId))return;const n=N(u,"companies",t.companyId,"avis",e);await $(n),d()};return l("div",{className:"max-w-4xl mx-auto p-6",children:[h&&a.length===0&&s("p",{children:"Chargement des avis..."}),!h&&a.length===0&&s("p",{children:"Aucun avis en attente pour l’instant ✅"}),s("ul",{className:"space-y-4",children:a.map(e=>l("li",{className:"border p-4 rounded shadow-sm bg-white flex flex-col gap-2",children:[l("div",{className:"flex justify-between items-center",children:[l("h4",{className:"font-semibold",children:[e.nom," — ⭐ ",e.note]}),l("div",{className:"flex gap-2",children:[s("button",{onClick:()=>j(e.id,e.visible),className:`text-sm px-3 py-1 rounded ${e.visible?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:e.visible?"Masquer":"Afficher"}),s("button",{onClick:()=>k(e.id),className:"text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded",children:"Supprimer"})]})]}),s("p",{className:"text-sm text-gray-600 italic",children:e.commentaire})]},e.id))}),I&&s("div",{className:"flex justify-center mt-6",children:s("button",{onClick:()=>d(!0),className:"px-6 py-2 rounded text-white font-medium",style:{backgroundColor:i.colors.primary},children:"Charger plus"})})]})};export{B as default};
