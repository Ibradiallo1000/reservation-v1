import{b as D,u as E,W as $,r as c,a as r,j as e,Y as L,_ as q,J as _,$ as G}from"./react-DB_4kGOy.js";import{z as R,x as B,w as J,L as O,y as S}from"./firebase-lLzYRzUk.js";import{d as z}from"../index-Bkmir__O.js";import"./vendor-C-DAJou6.js";const P=t=>t==null?void 0:t.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),f=t=>t&&t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),K=()=>{const t=D(),T=E(),[C]=$(),l=T.state,u={departure:(C.get("from")||"").trim(),arrival:(C.get("to")||"").trim()},a=c.useMemo(()=>l!=null&&l.departure&&(l!=null&&l.arrival)?l:u.departure&&u.arrival?u:null,[l,u.departure,u.arrival]),[b,N]=c.useState({}),[v,F]=c.useState({}),[A,w]=c.useState(!0),[y,M]=c.useState("");c.useEffect(()=>{if(!(a!=null&&a.departure)||!(a!=null&&a.arrival)){w(!1),N({});return}(async()=>{w(!0);try{const i=(await R(B(z,"companies"))).docs.reduce((m,h)=>(m[h.id]={...h.data(),id:h.id},m),{});F(i);const o=f(P(a.departure)),d=f(P(a.arrival)),p=J(O(z,"weeklyTrips"),S("departure","==",o),S("arrival","==",d)),j=await R(p),g={};j.forEach(m=>{const h=m.data(),x=m.ref.path.split("/")[1],U={...h,id:m.id,companyId:x};(g[x]||(g[x]=[])).push(U)}),N(g)}catch(s){console.error("❌ Erreur Firestore :",s),N({})}finally{w(!1)}})()},[a==null?void 0:a.departure,a==null?void 0:a.arrival]);const k=c.useMemo(()=>{const n=Object.keys(b),s=y.toLowerCase();return n.filter(i=>{var d;const o=v[i];return s?(d=o==null?void 0:o.nom)==null?void 0:d.toLowerCase().includes(s):!0})},[b,v,y]);return!(a!=null&&a.departure)||!(a!=null&&a.arrival)?r("div",{className:"min-h-screen bg-gray-50",children:[e("header",{className:"bg-white shadow-md sticky top-0 z-50",children:r("div",{className:"max-w-5xl mx-auto flex items-center justify-between px-4 py-3",children:[r("button",{onClick:()=>t("/"),className:"flex items-center text-orange-600",children:[e(L,{className:"w-5 h-5 mr-1"})," Retour"]}),r("div",{className:"flex items-center gap-2",children:[e("img",{src:"/icons/icon-192.png",alt:"Teliya",className:"w-7 h-7 object-contain rounded-full"}),e("span",{className:"font-bold text-xl text-orange-600",children:"Teliya"})]})]})}),r("div",{className:"max-w-5xl mx-auto p-6",children:[e("h1",{className:"text-2xl font-bold mb-3",children:"Résultats de recherche"}),e("p",{className:"text-gray-600",children:"Paramètres incomplets. Veuillez relancer une recherche."}),e("button",{onClick:()=>t("/"),className:"mt-4 bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700",children:"Nouvelle recherche"})]})]}):r("div",{className:"min-h-screen bg-gray-50",children:[e("header",{className:"bg-white shadow-md sticky top-0 z-50",children:r("div",{className:"max-w-5xl mx-auto flex items-center justify-between px-4 py-3",children:[r("button",{onClick:()=>t("/"),className:"flex items-center text-orange-600",children:[e(L,{className:"w-5 h-5 mr-1"})," Retour"]}),r("div",{className:"flex items-center gap-2",children:[e("img",{src:"/icons/icon-192.png",alt:"Teliya",className:"w-7 h-7 object-contain rounded-full"}),e("span",{className:"font-bold text-xl text-orange-600",children:"Teliya"})]})]})}),e("div",{className:"max-w-5xl mx-auto px-4 mt-6",children:r("div",{className:"flex flex-col gap-3",children:[r("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center gap-2",children:[e("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-xl bg-orange-50 border border-orange-200 font-semibold text-gray-900 truncate",children:f(a.departure)}),e("div",{className:"flex items-center justify-center",children:e(q,{className:"h-4 w-4 text-gray-400"})}),e("span",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-xl bg-emerald-50 border border-emerald-200 font-semibold text-gray-900 justify-self-end truncate",children:f(a.arrival)})]}),r("div",{className:"relative w-full sm:w-[320px] sm:self-end",children:[e(_,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e("input",{type:"text",placeholder:"Filtrer par compagnie",value:y,onChange:n=>M(n.target.value),className:"pl-9 border border-gray-300 rounded-lg py-2 px-3 text-sm w-full bg-white focus:outline-none focus:ring-2 focus:ring-orange-500"})]})]})}),e("div",{className:"max-w-5xl mx-auto p-4",children:A?e("div",{className:"flex justify-center py-12",children:e("div",{className:"h-10 w-10 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):k.length===0?r("div",{className:"text-center py-12",children:[e("p",{className:"text-gray-600 mb-4",children:"Aucune compagnie disponible pour ce trajet"}),e("button",{onClick:()=>t("/"),className:"bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700",children:"Nouvelle recherche"})]}):e("div",{className:"space-y-3",children:k.map(n=>{const s=v[n],i=b[n],o=Math.min(...i.map(p=>p.price)),d=i.reduce((p,j)=>p+(j.places||0),0);return r("div",{className:"bg-white rounded-xl shadow-sm p-4 flex items-center justify-between border border-gray-200",children:[r("div",{className:"flex items-center gap-4 min-w-0",children:[s.logoUrl?e("img",{src:s.logoUrl,alt:s.nom,className:"w-12 h-12 rounded-full border object-cover flex-none"}):e("div",{className:"w-12 h-12 rounded-full grid place-items-center bg-orange-50 border border-orange-100 flex-none",children:e(G,{className:"w-6 h-6 text-orange-500"})}),r("div",{className:"min-w-0",children:[e("h3",{className:"text-[15px] font-semibold leading-snug break-words",style:{color:s.couleurPrimaire||"#ea580c"},children:s.nom}),r("p",{className:"text-xs text-gray-500 mt-0.5",children:[d," pl. disponibles"]})]})]}),r("div",{className:"flex flex-col items-end w-36",children:[r("div",{className:"text-emerald-600 font-bold leading-none mb-2",children:[o.toLocaleString()," FCFA"]}),e("button",{onClick:()=>t(`/${s.slug}/booking?departure=${encodeURIComponent(a.departure)}&arrival=${encodeURIComponent(a.arrival)}`,{state:{preloaded:!0,company:s,departure:a.departure,arrival:a.arrival,preloadedPrice:o}}),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg text-sm w-full",children:"Réserver"})]})]},n)})})})]})};export{K as default};
