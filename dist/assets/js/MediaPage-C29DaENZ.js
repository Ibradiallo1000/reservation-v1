import{r as u,a as c,j as a}from"./react-DB_4kGOy.js";import{z as j,x as v,q as D,o as w,F,T as I,G as T}from"./firebase-lLzYRzUk.js";import{b as $,c as C,d as g}from"../index-Bkmir__O.js";import{U as M}from"./UploadImageCloudinary-C7LWAJRT.js";import"./vendor-C-DAJou6.js";const z=w(g,"platform","settings"),k=()=>{const p=$(void 0),{setHeader:N,resetHeader:S}=C(),[n,f]=u.useState([]),[A,y]=u.useState(!1),[b,x]=u.useState(null);u.useEffect(()=>(N({title:"Médias plateforme",subtitle:n.length?`${n.length} élément(s)`:"Aucun média",bg:`linear-gradient(90deg, ${p.colors.primary} 0%, ${p.colors.secondary} 100%)`,fg:"#fff"}),()=>S()),[n.length,p.colors.primary,p.colors.secondary]),u.useEffect(()=>{(async()=>{y(!0),x(null);try{const t=(await j(v(g,"mediaPlatform"))).docs.map(r=>{var l,m;const o=r.data();return{id:r.id,url:String(o.url??""),type:o.type||"autre",nom:String(o.nom??"Image"),createdAt:((m=(l=o.createdAt)==null?void 0:l.toDate)==null?void 0:m.call(l))??null,source:"collection"}}),d=await D(z),s=(d.exists()?d.data():{})||{},i=[];s.logoUrl&&i.push({url:s.logoUrl,type:"logo",nom:"Logo plateforme"}),s.faviconUrl&&i.push({url:s.faviconUrl,type:"favicon",nom:"Favicon"}),s.banniereUrl&&i.push({url:s.banniereUrl,type:"banniere",nom:"Bannière"}),(s.imagesSlider||[]).forEach((r,o)=>i.push({url:r,type:"slider",nom:`Slider #${o+1}`}));const U=i.map(r=>({url:r.url,type:r.type,nom:r.nom,createdAt:null,source:"settings"})),h=new Map;[...t,...U].forEach(r=>{h.has(r.url)||h.set(r.url,r)});const P=Array.from(h.values()).sort((r,o)=>{var l,m;return(((l=o.createdAt)==null?void 0:l.getTime())||0)-(((m=r.createdAt)==null?void 0:m.getTime())||0)});f(P)}catch(e){console.error("Erreur chargement médias plateforme:",e),x("Impossible de charger les médias de la plateforme.")}finally{y(!1)}})()},[]);const E=async e=>{if(e.source!=="collection"||!e.id){alert("Cette image provient des paramètres. Modifiez-la depuis Paramètres > Plateforme.");return}if(window.confirm(`Supprimer « ${e.nom} » ?`))try{await T(w(g,"mediaPlatform",e.id));const t=n.filter(d=>d.id!==e.id);f(t)}catch(t){console.error(t),alert("Erreur lors de la suppression.")}};return c("div",{className:"p-4 md:p-6 max-w-6xl mx-auto",children:[a("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-6",children:a(M,{label:"Ajouter une image à la bibliothèque plateforme",dossier:"platform",collectionName:"mediaPlatform",onUpload:async e=>{try{const t=await F(v(g,"mediaPlatform"),{url:e,type:"autre",nom:"Image",createdAt:I.now()});f(d=>[{id:t.id,url:e,type:"autre",nom:"Image",createdAt:new Date,source:"collection"},...d])}catch(t){console.error(t),alert("Erreur lors de l'ajout du média.")}},className:"w-full"})}),b&&a("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg p-4 mb-4",children:b}),A?a("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4",children:Array.from({length:8}).map((e,t)=>a("div",{className:"h-40 w-full rounded bg-gray-100 animate-pulse"},t))}):n.length===0?a("div",{className:"bg-orange-50 border border-orange-200 text-orange-800 rounded-lg p-6",children:"Aucun média de plateforme."}):a("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4",children:n.map(e=>c("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm hover:shadow-md transition overflow-hidden",children:[a("div",{className:"relative h-40",children:a("img",{src:e.url,alt:e.nom,className:"h-full w-full object-cover",loading:"lazy"})}),c("div",{className:"p-3",children:[c("div",{className:"flex items-center justify-between mb-1",children:[a("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.nom}),c("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-700",children:[e.type,e.source==="settings"?" • (paramètres)":""]})]}),c("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[a("span",{children:e.createdAt?e.createdAt.toLocaleDateString("fr-FR"):"—"}),e.source==="collection"?a("button",{onClick:()=>E(e),className:"font-medium hover:underline text-red-600",children:"Supprimer"}):a("span",{className:"opacity-60",children:"géré dans Paramètres"})]})]})]},`${e.source}-${e.id??e.url}`))})]})};export{k as default};
