import{k as E,u as S,r as c,j as e,_ as $}from"./react-Bg_vEni-.js";import{d as j,c as b}from"./firebase-C3aZpI0W.js";import{d as f}from"../index-Dgt8Lr4V.js";import{h as L}from"./html2pdf-DbS8s3Ae.js";import{p as F,J as H,a5 as I}from"./vendor-D_4iK-Jm.js";import"./jspdf.es.min-3c6yj3HK.js";import"./html2canvas-BsqIyKfB.js";const O=()=>{var w,k;const{id:u}=E(),y=S(),[s,C]=c.useState(null),[t,R]=c.useState(null),[r,P]=c.useState(null),[D,h]=c.useState(!0),[N,m]=c.useState(null),p=c.useRef(null),v=(a,n)=>{try{const o=typeof a=="string"?F(a):a;return H(o,n,{locale:I})}catch{return a.toString()}},x=()=>{var l;if(!s)return"GCH-000000";const n=new Date(((l=s.createdAt)==null?void 0:l.seconds)*1e3||Date.now()).getFullYear(),o=s.id.slice(0,6).toUpperCase();return`GCH-${n}-${o}`};c.useEffect(()=>{(async()=>{if(!u){m("ID de réservation manquant"),h(!1);return}try{const n=j(f,"reservations",u),o=await b(n);if(!o.exists()){m("Réservation introuvable"),h(!1);return}const l=o.data();if(l.id=o.id,C(l),l.compagnieId){const g=j(f,"companies",l.compagnieId),d=await b(g);if(d.exists()){const i=d.data();R({nom:i.nom,logoUrl:i.logoUrl,couleurPrimaire:i.couleurPrimaire||"#3b82f6",slug:i.slug,signatureUrl:i.signatureUrl})}else m("Compagnie introuvable")}if(l.agenceId){const g=j(f,"agences",l.agenceId),d=await b(g);if(d.exists()){const i=d.data();P({nom:i.nom,logoUrl:i.logoUrl,signatureUrl:i.signatureUrl})}}}catch(n){console.error("Erreur Firestore :",n),m("Erreur lors du chargement des données")}finally{h(!1)}})()},[u]);const U=()=>{if(p.current){const a={margin:10,filename:`recu-${x()}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,allowTaint:!0},jsPDF:{unit:"mm",format:"a5",orientation:"portrait"}};L().set(a).from(p.current).save()}};if(D)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Chargement du reçu..."})]})});if(N||!s||!t)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center p-6 max-w-md bg-white rounded-lg shadow-md",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Erreur"}),e.jsx("p",{className:"text-gray-600 mb-6",children:N||"Données introuvables"}),e.jsx("button",{onClick:()=>y(`/compagnie/${(t==null?void 0:t.slug)||"default"}/guichet`),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Retour au guichet"})]})});const M=JSON.stringify({receiptNumber:x(),compagnie:t.nom,nom:s.nomClient,tel:s.telephone,date:s.date,heure:s.heure,depart:s.depart,arrivee:s.arrivee,places:`${s.seatsGo} aller${s.seatsReturn?` + ${s.seatsReturn} retour`:""}`,montant:`${(w=s.montant)==null?void 0:w.toLocaleString("fr-FR")} FCFA`,statut:s.statut,paiement:s.paiement});return e.jsxs("div",{className:"bg-gray-50 min-h-screen py-8 px-4 sm:px-6 print:bg-white print:py-0",children:[e.jsxs("div",{ref:p,className:"max-w-2xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden print:shadow-none print:border-none print:rounded-none",style:{borderTop:`8px solid ${t.couleurPrimaire}`},children:[e.jsxs("div",{className:"p-6",style:{backgroundColor:t.couleurPrimaire},children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col items-start space-y-3",children:[r!=null&&r.logoUrl?e.jsx("img",{src:r.logoUrl,alt:`Agence ${r.nom}`,className:"h-12 object-contain bg-white p-1 rounded",onError:a=>{const n=a.target;n.src="/default-agency.png"}}):r!=null&&r.nom?e.jsx("div",{className:"bg-white px-2 py-1 rounded",children:e.jsx("p",{className:"text-xs font-medium",children:r.nom})}):null,e.jsx("div",{className:"text-white text-xs bg-black bg-opacity-20 px-2 py-1 rounded",children:e.jsxs("p",{children:["Émis le ",v(new Date(s.createdAt.seconds*1e3),"dd/MM/yyyy à HH:mm")]})})]}),e.jsx("img",{src:t.logoUrl,alt:t.nom,className:"h-16 object-contain bg-white p-2 rounded-lg shadow",onError:a=>{const n=a.target;n.src="/default-company.png"}})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("h1",{className:"text-3xl font-extrabold text-white uppercase tracking-wide",children:t.nom}),(r==null?void 0:r.nom)&&e.jsx("p",{className:"text-white text-opacity-80 italic mt-1",children:r.nom})]})]}),e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Reçu de réservation"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Numéro: ",x()]})]}),e.jsx("span",{className:"inline-block text-sm font-semibold px-3 py-1 rounded-full",style:{backgroundColor:`${t.couleurPrimaire}20`,color:t.couleurPrimaire},children:"Réservation au guichet"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-gray-50 p-5 rounded-lg border",children:[e.jsx("h2",{className:"font-semibold text-lg mb-3",style:{color:t.couleurPrimaire},children:"Informations passager"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Nom complet :"}),e.jsx("span",{className:"text-gray-800",children:s.nomClient})]}),e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Téléphone :"}),e.jsx("span",{className:"text-gray-800",children:s.telephone})]}),s.guichetier&&e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Guichetier :"}),e.jsx("span",{className:"text-gray-800",children:s.guichetier})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-5 rounded-lg border",children:[e.jsx("h2",{className:"font-semibold text-lg mb-3",style:{color:t.couleurPrimaire},children:"Détails du voyage"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Trajet :"}),e.jsxs("span",{className:"text-gray-800",children:[s.depart," → ",s.arrivee]})]}),e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Date :"}),e.jsx("span",{className:"text-gray-800",children:v(s.date,"EEEE dd MMMM yyyy")})]}),e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Heure :"}),e.jsx("span",{className:"text-gray-800",children:s.heure})]}),e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Places :"}),e.jsxs("span",{className:"text-gray-800",children:[s.seatsGo," aller",s.seatsReturn?` + ${s.seatsReturn} retour`:""]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-5 rounded-lg border",children:[e.jsx("h2",{className:"font-semibold text-lg mb-3",style:{color:t.couleurPrimaire},children:"Détails de paiement"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Montant total :"}),e.jsxs("span",{className:"text-gray-800 font-bold",children:[(k=s.montant)==null?void 0:k.toLocaleString("fr-FR")," FCFA"]})]}),e.jsxs("div",{className:"flex justify-between border-b pb-2",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Mode de paiement :"}),e.jsx("span",{className:"text-gray-800 capitalize",children:s.paiement})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-600",children:"Statut :"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.statut==="payé"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.statut})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-5 rounded-lg border flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"mb-3 text-center",children:[e.jsx("h2",{className:"font-semibold text-lg",style:{color:t.couleurPrimaire},children:"QR Code de validation"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Présentez ce code à l'embarquement"})]}),e.jsx("div",{className:"bg-white p-3 rounded border-2",style:{borderColor:t.couleurPrimaire},children:e.jsx($,{value:M,size:128,fgColor:t.couleurPrimaire})}),e.jsxs("p",{className:"mt-3 text-xs text-gray-500 text-center",children:["Numéro: ",x()]})]})]}),((r==null?void 0:r.signatureUrl)||t.signatureUrl)&&e.jsx("div",{className:"mt-6 pt-4 border-t flex justify-end",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Signature"}),e.jsx("img",{src:(r==null?void 0:r.signatureUrl)||t.signatureUrl,alt:"Signature",className:"h-16 object-contain",onError:a=>{const n=a.target;n.style.display="none"}})]})})]}),e.jsxs("div",{className:"p-4 text-center text-xs text-white",style:{backgroundColor:t.couleurPrimaire},children:[e.jsxs("p",{children:["Merci pour votre confiance • ",t.nom]}),e.jsx("p",{className:"mt-1 opacity-80",children:"Ce ticket est valable uniquement pour le trajet et la date indiqués"})]})]}),e.jsxs("div",{className:"print:hidden flex flex-wrap justify-center gap-4 mt-8",children:[e.jsxs("button",{onClick:()=>window.print(),className:"flex items-center gap-2 px-5 py-2.5 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Imprimer"]}),e.jsxs("button",{onClick:U,className:"flex items-center gap-2 px-5 py-2.5 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})}),"Télécharger PDF"]}),e.jsxs("button",{onClick:()=>y(`/compagnie/${t.slug}/guichet`),className:"flex items-center gap-2 px-5 py-2.5 bg-gray-600 text-white rounded-lg shadow hover:bg-gray-700 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Retour au guichet"]})]})]})};export{O as default};
