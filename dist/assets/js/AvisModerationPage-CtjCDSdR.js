import{r as o,a as c,j as s}from"./react-DgrrIcw2.js";import{k as S,q as x,D as y,w as v,G as j,l as M,d as w,u as k,B as q}from"./firebase-eGIzIftJ.js";import{u as L,d as p}from"../index-p6Te0bSg.js";import"./vendor-BHjJ2Hjk.js";const B=()=>{const{user:t}=L(),[d,u]=o.useState([]),[h,f]=o.useState(!0),[b,N]=o.useState(null),[D,A]=o.useState(!0),m=10,l=async(e=!1)=>{if(!(t!=null&&t.companyId))return;f(!0);const a=S(p,"companies",t.companyId,"avis");let r=x(a,v("visible","==",!1),y(m));e&&b&&(r=x(a,v("visible","==",!1),j(b),y(m)));try{const n=await M(r),g=n.docs.map(i=>({id:i.id,...i.data()})).sort((i,E)=>i.nom.localeCompare(E.nom));u(e?i=>[...i,...g]:g),N(n.docs[n.docs.length-1]||null),A(n.size===m)}catch(n){console.error("Erreur de récupération des avis :",n)}finally{f(!1)}};o.useEffect(()=>{l()},[t]);const I=async(e,a)=>{if(!(t!=null&&t.companyId))return;const r=w(p,"companies",t.companyId,"avis",e);await k(r,{visible:!a}),l()},C=async e=>{if(!(t!=null&&t.companyId))return;const a=w(p,"companies",t.companyId,"avis",e);await q(a),l()};return c("div",{className:"max-w-4xl mx-auto p-6",children:[s("h2",{className:"text-2xl font-bold mb-4",children:"Modération des avis clients"}),h&&d.length===0&&s("p",{children:"Chargement des avis..."}),!h&&d.length===0&&s("p",{children:"Aucun avis en attente pour l’instant ✅"}),s("ul",{className:"space-y-4",children:d.map(e=>c("li",{className:"border p-4 rounded shadow-sm bg-white flex flex-col gap-2",children:[c("div",{className:"flex justify-between items-center",children:[c("h4",{className:"font-semibold",children:[e.nom," — ⭐ ",e.note]}),c("div",{className:"flex gap-2",children:[s("button",{onClick:()=>I(e.id,e.visible),className:`text-sm px-3 py-1 rounded ${e.visible?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:e.visible?"Masquer":"Afficher"}),s("button",{onClick:()=>C(e.id),className:"text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded",children:"Supprimer"})]})]}),s("p",{className:"text-sm text-gray-600 italic",children:e.commentaire})]},e.id))}),D&&s("div",{className:"flex justify-center mt-6",children:s("button",{onClick:()=>l(!0),className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Charger plus"})})]})};export{B as default};
