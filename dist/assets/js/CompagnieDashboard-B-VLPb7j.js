import{j as e,a2 as be,n as k,a3 as oe,a4 as je,r as T,a5 as we,a6 as Ne,u as Ae}from"./react-BKlva80Y.js";import{q as Q,w as z,j as J,k as Z,T as le}from"./firebase-1zyXmG6H.js";import{u as De,d as ee}from"../index-DdVw6ij9.js";import{u as ke}from"./useCompanyTheme-DWKbV_iC.js";import{a5 as Se,a6 as Ce,a7 as Pe,a8 as re}from"./vendor-CZDa83Cj.js";import{D as Le,f as Oe,E as Re,L as te,a as q,C as Ee,i as K,h as _e,b as Te,g as he,u as Fe,G as Ie,c as ce,d as $e,X as se,Y as ie,e as Be,R as pe,T as xe,B as Me,j as Ve}from"./BarChart-DU1kYjQd.js";import{C as fe}from"./CartesianGrid-DTCiKGP3.js";const We=({dateRange:t,setDateRange:r,colors:a,className:n="",companyName:s})=>{const i=o=>{o[0]&&o[1]&&r([o[0],o[1]])};return e.jsxs("div",{className:`flex flex-col md:flex-row justify-between items-center rounded-lg shadow-sm p-6 transition-colors duration-200 ${n}`,style:{backgroundColor:a.background,borderBottom:`4px solid ${a.primary}`},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-1 flex items-center gap-2",style:{color:"#111"},children:[s&&e.jsx("span",{className:"text-sm font-normal bg-gray-100 px-2 py-1 rounded-md",style:{color:a.primary},children:s}),"Tableau de bord"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Période du ",t[0].toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})," au ",t[1].toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})]})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx(be,{selectsRange:!0,startDate:t[0],endDate:t[1],onChange:i,locale:Se,dateFormat:"dd/MM/yyyy",className:"border border-gray-300 p-2 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",wrapperClassName:"date-picker",isClearable:!0,withPortal:!0,selectsDisabledDaysInRange:!0,disabledKeyboardNavigation:!0,dropdownMode:"select"})})]})},X=({title:t,value:r,icon:a,isCurrency:n=!1,trend:s,trendType:i,content:o,themeColor:l,className:d="",onClick:h})=>{const p=n?`${r.toLocaleString("fr-FR")} FCFA`:r.toLocaleString("fr-FR");return e.jsx("div",{onClick:h,className:`cursor-pointer rounded-xl p-6 shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-md ${d}`,style:l?{borderTop:`4px solid ${l}`}:{},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider",children:t}),o?e.jsx("div",{className:"mt-2",children:o}):e.jsxs("div",{className:"mt-2 flex items-baseline",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:p}),s&&e.jsx("span",{className:`ml-2 text-sm font-medium ${i==="positive"?"text-green-600":"text-red-600"}`,children:s})]})]}),a&&e.jsx("div",{className:"p-3 rounded-lg bg-opacity-10",style:{backgroundColor:l},children:a})]})})};var ze=["type","layout","connectNulls","ref"],Ke=["key"];function W(t){"@babel/helpers - typeof";return W=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},W(t)}function de(t,r){if(t==null)return{};var a=Ge(t,r),n,s;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(s=0;s<i.length;s++)n=i[s],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}function Ge(t,r){if(t==null)return{};var a={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(r.indexOf(n)>=0)continue;a[n]=t[n]}return a}function G(){return G=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},G.apply(this,arguments)}function ue(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),a.push.apply(a,n)}return a}function S(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?ue(Object(a),!0).forEach(function(n){E(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ue(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}function V(t){return Xe(t)||qe(t)||Ue(t)||He()}function He(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ue(t,r){if(t){if(typeof t=="string")return ae(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor&&(a=t.constructor.name),a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ae(t,r)}}function qe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Xe(t){if(Array.isArray(t))return ae(t)}function ae(t,r){(r==null||r>t.length)&&(r=t.length);for(var a=0,n=new Array(r);a<r;a++)n[a]=t[a];return n}function Ye(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function me(t,r){for(var a=0;a<r.length;a++){var n=r[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ve(n.key),n)}}function Qe(t,r,a){return r&&me(t.prototype,r),a&&me(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function Je(t,r,a){return r=Y(r),Ze(t,ge()?Reflect.construct(r,a||[],Y(t).constructor):r.apply(t,a))}function Ze(t,r){if(r&&(W(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return et(t)}function et(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ge(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ge=function(){return!!t})()}function Y(t){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Y(t)}function tt(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&ne(t,r)}function ne(t,r){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,s){return n.__proto__=s,n},ne(t,r)}function E(t,r,a){return r=ve(r),r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function ve(t){var r=rt(t,"string");return W(r)=="symbol"?r:r+""}function rt(t,r){if(W(t)!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var n=a.call(t,r);if(W(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var H=function(t){function r(){var a;Ye(this,r);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return a=Je(this,r,[].concat(s)),E(a,"state",{isAnimationFinished:!0,totalLength:0}),E(a,"generateSimpleStrokeDasharray",function(o,l){return"".concat(l,"px ").concat(o-l,"px")}),E(a,"getStrokeDasharray",function(o,l,d){var h=d.reduce(function(C,P){return C+P});if(!h)return a.generateSimpleStrokeDasharray(l,o);for(var p=Math.floor(o/h),g=o%h,m=l-o,v=[],u=0,y=0;u<d.length;y+=d[u],++u)if(y+d[u]>g){v=[].concat(V(d.slice(0,u)),[g-y]);break}var x=v.length%2===0?[0,m]:[m];return[].concat(V(r.repeat(d,p)),V(v),x).map(function(C){return"".concat(C,"px")}).join(", ")}),E(a,"id",Fe("recharts-line-")),E(a,"pathRef",function(o){a.mainCurve=o}),E(a,"handleAnimationEnd",function(){a.setState({isAnimationFinished:!0}),a.props.onAnimationEnd&&a.props.onAnimationEnd()}),E(a,"handleAnimationStart",function(){a.setState({isAnimationFinished:!1}),a.props.onAnimationStart&&a.props.onAnimationStart()}),a}return tt(r,t),Qe(r,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var i=this.props,o=i.points,l=i.xAxis,d=i.yAxis,h=i.layout,p=i.children,g=Oe(p,Re);if(!g)return null;var m=function(y,x){return{x:y.x,y:y.y,value:y.value,errorVal:he(y.payload,x)}},v={clipPath:n?"url(#clipPath-".concat(s,")"):null};return k.createElement(te,v,g.map(function(u){return k.cloneElement(u,{key:"bar-".concat(u.props.dataKey),data:o,xAxis:l,yAxis:d,layout:h,dataPointFormatter:m})}))}},{key:"renderDots",value:function(n,s,i){var o=this.props.isAnimationActive;if(o&&!this.state.isAnimationFinished)return null;var l=this.props,d=l.dot,h=l.points,p=l.dataKey,g=q(this.props,!1),m=q(d,!0),v=h.map(function(y,x){var C=S(S(S({key:"dot-".concat(x),r:3},g),m),{},{index:x,cx:y.x,cy:y.y,value:y.value,dataKey:p,payload:y.payload,points:h});return r.renderDotItem(d,C)}),u={clipPath:n?"url(#clipPath-".concat(s?"":"dots-").concat(i,")"):null};return k.createElement(te,G({className:"recharts-line-dots",key:"dots"},u),v)}},{key:"renderCurveStatically",value:function(n,s,i,o){var l=this.props,d=l.type,h=l.layout,p=l.connectNulls;l.ref;var g=de(l,ze),m=S(S(S({},q(g,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:s?"url(#clipPath-".concat(i,")"):null,points:n},o),{},{type:d,layout:h,connectNulls:p});return k.createElement(Ee,G({},m,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,s){var i=this,o=this.props,l=o.points,d=o.strokeDasharray,h=o.isAnimationActive,p=o.animationBegin,g=o.animationDuration,m=o.animationEasing,v=o.animationId,u=o.animateNewValues,y=o.width,x=o.height,C=this.state,P=C.prevPoints,B=C.totalLength;return k.createElement(je,{begin:p,duration:g,isActive:h,easing:m,from:{t:0},to:{t:1},key:"line-".concat(v),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(I){var L=I.t;if(P){var O=P.length/l.length,_=l.map(function(c,w){var R=Math.floor(w*O);if(P[R]){var A=P[R],D=K(A.x,c.x),$=K(A.y,c.y);return S(S({},c),{},{x:D(L),y:$(L)})}if(u){var U=K(y*2,c.x),N=K(x/2,c.y);return S(S({},c),{},{x:U(L),y:N(L)})}return S(S({},c),{},{x:c.x,y:c.y})});return i.renderCurveStatically(_,n,s)}var M=K(0,B),b=M(L),f;if(d){var j="".concat(d).split(/[,\s]+/gim).map(function(c){return parseFloat(c)});f=i.getStrokeDasharray(b,B,j)}else f=i.generateSimpleStrokeDasharray(B,b);return i.renderCurveStatically(l,n,s,{strokeDasharray:f})})}},{key:"renderCurve",value:function(n,s){var i=this.props,o=i.points,l=i.isAnimationActive,d=this.state,h=d.prevPoints,p=d.totalLength;return l&&o&&o.length&&(!h&&p>0||!Pe(h,o))?this.renderCurveWithAnimation(n,s):this.renderCurveStatically(o,n,s)}},{key:"render",value:function(){var n,s=this.props,i=s.hide,o=s.dot,l=s.points,d=s.className,h=s.xAxis,p=s.yAxis,g=s.top,m=s.left,v=s.width,u=s.height,y=s.isAnimationActive,x=s.id;if(i||!l||!l.length)return null;var C=this.state.isAnimationFinished,P=l.length===1,B=oe("recharts-line",d),I=h&&h.allowDataOverflow,L=p&&p.allowDataOverflow,O=I||L,_=re(x)?this.id:x,M=(n=q(o,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},b=M.r,f=b===void 0?3:b,j=M.strokeWidth,c=j===void 0?2:j,w=_e(o)?o:{},R=w.clipDot,A=R===void 0?!0:R,D=f*2+c;return k.createElement(te,{className:B},I||L?k.createElement("defs",null,k.createElement("clipPath",{id:"clipPath-".concat(_)},k.createElement("rect",{x:I?m:m-v/2,y:L?g:g-u/2,width:I?v:v*2,height:L?u:u*2})),!A&&k.createElement("clipPath",{id:"clipPath-dots-".concat(_)},k.createElement("rect",{x:m-D/2,y:g-D/2,width:v+D,height:u+D}))):null,!P&&this.renderCurve(O,_),this.renderErrorBar(O,_),(P||o)&&this.renderDots(O,A,_),(!y||C)&&Te.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,s){return n.animationId!==s.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:s.curPoints}:n.points!==s.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,s){for(var i=n.length%2!==0?[].concat(V(n),[0]):n,o=[],l=0;l<s;++l)o=[].concat(V(o),V(i));return o}},{key:"renderDotItem",value:function(n,s){var i;if(k.isValidElement(n))i=k.cloneElement(n,s);else if(Ce(n))i=n(s);else{var o=s.key,l=de(s,Ke),d=oe("recharts-line-dot",typeof n!="boolean"?n.className:"");i=k.createElement(Le,G({key:o},l,{className:d}))}return i}}])}(T.PureComponent);E(H,"displayName","Line");E(H,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Ie.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});E(H,"getComposedData",function(t){var r=t.props,a=t.xAxis,n=t.yAxis,s=t.xAxisTicks,i=t.yAxisTicks,o=t.dataKey,l=t.bandSize,d=t.displayedData,h=t.offset,p=r.layout,g=d.map(function(m,v){var u=he(m,o);return p==="horizontal"?{x:ce({axis:a,ticks:s,bandSize:l,entry:m,index:v}),y:re(u)?null:n.scale(u),value:u,payload:m}:{x:re(u)?null:a.scale(u),y:ce({axis:n,ticks:i,bandSize:l,entry:m,index:v}),value:u,payload:m}});return S({points:g,layout:p},h)});var at=$e({chartName:"LineChart",GraphicalChild:H,axisComponents:[{axisType:"xAxis",AxisComp:se},{axisType:"yAxis",AxisComp:ie}],formatAxisMap:Be});const nt=({data:t})=>e.jsxs("div",{className:"bg-white rounded shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Évolution des revenus"}),e.jsx(pe,{width:"100%",height:300,children:e.jsxs(at,{data:t,children:[e.jsx(fe,{strokeDasharray:"3 3"}),e.jsx(se,{dataKey:"date"}),e.jsx(ie,{}),e.jsx(xe,{formatter:r=>`${r.toLocaleString()} FCFA`}),e.jsx(H,{type:"monotone",dataKey:"revenue",stroke:"#3b82f6",strokeWidth:2})]})})]}),st=({data:t})=>e.jsxs("div",{className:"bg-white rounded shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Performance par agence"}),e.jsx(pe,{width:"100%",height:300,children:e.jsxs(Me,{data:t,children:[e.jsx(fe,{strokeDasharray:"3 3"}),e.jsx(se,{dataKey:"nom"}),e.jsx(ie,{}),e.jsx(xe,{formatter:r=>`${r.toLocaleString()} FCFA`}),e.jsx(Ve,{dataKey:"revenus",fill:"#10b981"})]})})]}),it=({agencies:t})=>{const r=[...t].sort((a,n)=>n.revenus-a.revenus).slice(0,5);return e.jsxs("div",{className:"bg-white rounded shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Top agences"}),e.jsx("ul",{children:r.map((a,n)=>e.jsx("li",{className:"py-2 border-b last:border-b-0",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[n+1,". ",a.nom," (",a.ville,")"]}),e.jsxs("span",{children:[a.revenus.toLocaleString()," FCFA"]})]})},a.id))})]})},ot=({data:t,className:r="",showActions:a=!1,onRowClick:n})=>{const s=i=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",maximumFractionDigits:0}).format(i);return e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden ${r}`,children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Détails des agences"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agence"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ville"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Réservations"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenus"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Évolution"}),a&&e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(i=>e.jsxs("tr",{className:`hover:bg-gray-50 ${n?"cursor-pointer":""}`,onClick:()=>n&&n(i.id),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:i.nom})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:i.ville})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:i.reservations.toLocaleString("fr-FR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:s(i.revenus)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:i.trend!==void 0&&e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${i.trend>=0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[i.trend>=0?e.jsx(we,{className:"-ml-0.5 mr-1 h-3 w-3 text-green-500"}):e.jsx(Ne,{className:"-ml-0.5 mr-1 h-3 w-3 text-red-500"}),Math.abs(i.trend),"%"]})}),a&&e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-900 mr-3",children:"Voir"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-900",children:"Éditer"})]})]},i.id))})]})}),t.length>0&&e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Affichage de ",e.jsx("span",{className:"font-medium",children:"1"})," à ",e.jsx("span",{className:"font-medium",children:t.length})," agences"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"px-3 py-1 border rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Précédent"}),e.jsx("button",{className:"px-3 py-1 border rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Suivant"})]})]})})]})},xt=()=>{const{user:t}=De(),r=Ae(),[a,n]=T.useState(null),{colors:s,classes:i}=ke(a),[o,l]=T.useState(!0),[d,h]=T.useState(null),[p,g]=T.useState([new Date(new Date().setDate(new Date().getDate()-30)),new Date]),[m,v]=T.useState([]),[u,y]=T.useState([]),[x,C]=T.useState({totalAgencies:0,totalReservations:0,totalRevenue:0,growthRate:0,totalChannels:{}}),P=T.useCallback(async()=>{if(!(t!=null&&t.companyId))return;const b=Q(J(ee,"companies"),z("id","==",t.companyId)),f=await Z(b);if(f.empty)return;const j=f.docs[0],c=j.data();n({id:j.id,slug:c.slug||"",nom:c.nom||"",services:c.services||[],featuredTrips:c.featuredTrips||[],couleurPrimaire:c.couleurPrimaire||"#2563eb",couleurSecondaire:c.couleurSecondaire||"#facc15",couleurAccent:c.couleurAccent||"#10b981",couleurTertiaire:c.couleurTertiaire||"#6366f1",logoUrl:c.logoUrl||"",...c})},[t==null?void 0:t.companyId]),B=async b=>{const f=Q(J(ee,"agences"),z("companyId","==",b));return(await Z(f)).docs.map(c=>({id:c.id,nom:c.data().nom,ville:c.data().ville,companyId:c.data().companyId}))},I=async(b,f)=>{const[j,c]=p;if(!j||!c)return{reservations:0,revenus:0,canaux:{}};const w=await Z(Q(J(ee,"reservations"),z("agencyId","==",b.id),z("createdAt",">=",le.fromDate(j)),z("createdAt","<=",le.fromDate(c)))),R={};return w.forEach(A=>{const $=(A.data().canal||"inconnu").toLowerCase().includes("ligne")?"En ligne":"Guichet";R[$]=(R[$]||0)+1;const N=A.data().createdAt.toDate().toLocaleDateString("fr-FR"),F=A.data().montant||0;f[N]=(f[N]||0)+F}),{reservations:w.size,revenus:w.docs.reduce((A,D)=>A+(D.data().montant||0),0),canaux:R}},L=b=>{if(b.length===0)return 0;const j=b.reduce((c,w)=>c+w.revenus,0)/b.length;return parseFloat((j*.1).toFixed(2))};T.useEffect(()=>{(async()=>{try{if(!(t!=null&&t.companyId))return;const[f,j]=p;if(!f||!j)return;await P(),l(!0),h(null);const c=await B(t.companyId),w=[],R={};for(const N of c){const F=await I(N,R);w.push({...N,...F})}const A=[],D=new Date(f);for(;D<=j;){const N=D.toLocaleDateString("fr-FR");A.push({date:N,revenue:R[N]||0}),D.setDate(D.getDate()+1)}const $={};w.forEach(N=>{Object.entries(N.canaux).forEach(([F,ye])=>{$[F]=($[F]||0)+ye})});const U=w.reduce((N,F)=>({totalReservations:N.totalReservations+F.reservations,totalRevenue:N.totalRevenue+F.revenus}),{totalReservations:0,totalRevenue:0});v(w),y(A),C({totalAgencies:c.length,...U,growthRate:L(w),totalChannels:$})}catch(f){console.error(f),h("Erreur de chargement des données. Veuillez réessayer.")}finally{l(!1)}})()},[t,p,P]);const O=Object.values(x.totalChannels).reduce((b,f)=>b+f,0),_=x.totalChannels.Guichet||0,M=x.totalChannels["En ligne"]||0;return o?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:"Chargement du tableau de bord..."}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Vos données seront bientôt prêtes"})]})}):d?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg max-w-md w-full text-center border-l-4 border-red-500",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:e.jsx("svg",{className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Une erreur est survenue"}),e.jsx("p",{className:"text-gray-600 mb-6",children:d}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:"Réessayer"})]})}):e.jsxs("div",{className:`min-h-screen p-6 space-y-8 ${i} bg-gradient-to-br from-gray-50 to-gray-100`,children:[e.jsx(We,{dateRange:p,setDateRange:g,colors:s,className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(X,{title:"Agences",value:x.totalAgencies,onClick:()=>r("/compagnie/agences"),icon:e.jsx("div",{className:"p-3 rounded-full bg-blue-100 text-blue-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),themeColor:s.primary}),e.jsx(X,{title:"Réservations",value:x.totalReservations,onClick:()=>r("/compagnie/reservations"),trend:x.growthRate>=0?`+${x.growthRate}%`:`${x.growthRate}%`,trendType:x.growthRate>=0?"positive":"negative",icon:e.jsx("div",{className:"p-3 rounded-full bg-green-100 text-green-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),themeColor:s.secondary}),e.jsx(X,{title:"Revenus",value:x.totalRevenue,onClick:()=>r("/compagnie/finances"),isCurrency:!0,icon:e.jsx("div",{className:"p-3 rounded-full bg-purple-100 text-purple-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),themeColor:s.accent}),e.jsx(X,{title:"Répartition",onClick:()=>r("/compagnie/statistiques"),icon:e.jsx("div",{className:"p-3 rounded-full bg-amber-100 text-amber-600",children:e.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"})]})}),content:e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),e.jsx("span",{className:"text-sm",children:"Guichet"})]}),e.jsxs("span",{className:"text-sm font-medium",children:[O?Math.round(_/O*100):0,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("span",{className:"text-sm",children:"En ligne"})]}),e.jsxs("span",{className:"text-sm font-medium",children:[O?Math.round(M/O*100):0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full",style:{width:`${O?_/O*100:50}%`}})})]}),themeColor:s.tertiary,value:0})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Évolution des revenus"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"px-3 py-1 text-xs bg-blue-50 text-blue-600 rounded-md",children:"30j"}),e.jsx("button",{className:"px-3 py-1 text-xs bg-gray-50 text-gray-600 rounded-md",children:"90j"}),e.jsx("button",{className:"px-3 py-1 text-xs bg-gray-50 text-gray-600 rounded-md",children:"1an"})]})]}),e.jsx(nt,{data:u})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Performance des agences"}),e.jsx(st,{data:m})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Top 5 agences"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-800",onClick:()=>r("/compagnie/agences"),children:"Voir tout"})]}),e.jsx(it,{agencies:m.slice(0,5)})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Détails des agences"}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{className:"px-3 py-1 text-xs bg-gray-50 text-gray-600 rounded-md",children:"Exporter"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(ot,{data:m,className:"min-w-full divide-y divide-gray-200"})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{children:["Affichage 1-",Math.min(m.length,10)," sur ",m.length," agences"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"px-3 py-1 bg-gray-50 rounded-md disabled:opacity-50",disabled:!0,children:"Précédent"}),e.jsx("button",{className:"px-3 py-1 bg-gray-50 rounded-md",children:"Suivant"})]})]})]})]})]})};export{xt as default};
