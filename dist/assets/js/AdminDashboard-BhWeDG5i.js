import{r as m,j as s,y as u}from"./react-PtMwKKf1.js";import{l as b,k as S,v as w}from"./firebase-eGIzIftJ.js";import{d as N}from"../index-C4y8wfzK.js";import"./vendor-B5FTF_2c.js";const L=()=>{const[i,j]=m.useState([]),[c,y]=m.useState({total:0,reservations:0,commission:0,compagnies:0});return m.useEffect(()=>{(async()=>{try{const d=(await b(S(N,"companies"))).docs.map(e=>({id:e.id,nom:e.data().nom||"Compagnie",slug:e.data().slug||"—",plan:e.data().plan||"free",status:e.data().status||"actif"})),f=await b(w(N,"reservations"));let p=0,x=0,g=0;const n={};for(const e of f.docs){const t=e.data(),o=t.companyId||"inconnu",l=t.total||t.montant||0,h=t.commission||0;n[o]||(n[o]={companyId:o,companySlug:t.companySlug||"—",companyName:t.companyName||"Compagnie",plan:t.plan||"free",total:0,count:0,commission:0}),n[o].total+=l,n[o].commission+=h,n[o].count+=1,p+=l,g+=h,x++}const v=d.map(e=>{var t,o,l;return{companyId:e.id,companySlug:e.slug,companyName:e.nom,plan:e.plan,total:((t=n[e.id])==null?void 0:t.total)||0,count:((o=n[e.id])==null?void 0:o.count)||0,commission:((l=n[e.id])==null?void 0:l.commission)||0}});j(v),y({total:p,reservations:x,commission:g,compagnies:d.length})}catch(r){console.error("Erreur lors du chargement des stats:",r)}})()},[]),s.jsxs("div",{className:"p-6",children:[s.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Tableau de bord – Administration plateforme"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Suivi global des compagnies, abonnements et revenus."}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[s.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[s.jsx("h2",{className:"text-sm text-gray-500",children:"Total compagnies"}),s.jsx("p",{className:"text-xl font-bold text-purple-600",children:c.compagnies})]}),s.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[s.jsx("h2",{className:"text-sm text-gray-500",children:"Total réservations"}),s.jsx("p",{className:"text-xl font-bold text-blue-600",children:c.reservations})]}),s.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[s.jsx("h2",{className:"text-sm text-gray-500",children:"Montant encaissé"}),s.jsxs("p",{className:"text-xl font-bold text-green-600",children:[c.total.toLocaleString()," FCFA"]})]}),s.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[s.jsx("h2",{className:"text-sm text-gray-500",children:"Commission générée"}),s.jsxs("p",{className:"text-xl font-bold text-orange-600",children:[c.commission.toLocaleString()," FCFA"]})]})]}),s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Compagnies"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:i.length===0?s.jsx("p",{className:"text-gray-500 italic",children:"Aucune donnée disponible"}):i.map(a=>s.jsxs("div",{className:"p-4 border rounded-lg shadow-sm bg-white",children:[s.jsx("h3",{className:"text-lg font-bold text-orange-600 mb-1",children:a.companyName}),s.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:["Plan : ",a.plan]}),s.jsxs("p",{className:"text-sm mt-2 text-gray-700",children:["Réservations : ",a.count]}),s.jsxs("p",{className:"text-sm text-gray-700",children:["Montant : ",a.total.toLocaleString()," FCFA"]}),s.jsxs("p",{className:"text-sm text-gray-700",children:["Commission : ",a.commission.toLocaleString()," FCFA"]}),s.jsxs("div",{className:"flex gap-2 mt-3",children:[s.jsx(u,{to:`/admin/compagnies/${a.companyId}`,className:"text-sm px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Gérer"}),s.jsx(u,{to:`/admin/compagnies/${a.companyId}/factures`,className:"text-sm px-3 py-1 rounded bg-green-600 text-white hover:bg-green-700",children:"Factures"})]})]},a.companyId))})]})};export{L as default};
