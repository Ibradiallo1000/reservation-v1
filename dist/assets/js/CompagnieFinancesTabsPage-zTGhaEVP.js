import{u as T,r as c,j as e,a,au as q,av as H,ad as M,aw as P,ax as O,ay as U}from"./react-DgrrIcw2.js";import{d as V,f as z,l as w,k as R,q as B,w as p,T as D}from"./firebase-eGIzIftJ.js";import{u as G,d as u}from"../index-p6Te0bSg.js";import"./vendor-BHjJ2Hjk.js";const Y=()=>{const{user:s}=G(),F=T(),[S,C]=c.useState(""),[i,A]=c.useState([]),[l,I]=c.useState([new Date(new Date().setDate(new Date().getDate()-30)),new Date]),[m,x]=c.useState(!1),[b,f]=c.useState(null),N=c.useCallback(async()=>{if(s!=null&&s.companyId)try{const t=V(u,"companies",s.companyId),n=await z(t);if(n.exists()){const o=n.data();C(o.nom||"")}}catch(t){console.error("Erreur r√©cup√©ration nom compagnie",t)}},[s==null?void 0:s.companyId]),h=c.useCallback(async()=>{if(s!=null&&s.companyId){x(!0),f(null);try{const[t,n]=l,o=new Date(t);o.setHours(0,0,0,0);const y=new Date(n);y.setHours(23,59,59,999);const L=(await w(R(u,`companies/${s.companyId}/agences`))).docs.map(r=>({id:r.id,nom:r.data().nom||r.data().ville||"Agence"})),$=await w(B(R(u,`companies/${s.companyId}/reservations`),p("createdAt",">=",D.fromDate(o)),p("createdAt","<=",D.fromDate(y)),p("statut","==","pay√©"))),d={};L.forEach(r=>{d[r.id]={id:r.id,nom:r.nom,totalRevenue:0,totalReservations:0}}),$.docs.forEach(r=>{const v=r.data(),g=v.agencyId;d[g]&&(d[g].totalRevenue+=v.montant||0,d[g].totalReservations+=1)}),A(Object.values(d))}catch(t){console.error(t),f("Erreur lors du chargement des donn√©es financi√®res.")}finally{x(!1)}}},[s==null?void 0:s.companyId,l]);c.useEffect(()=>{N(),h()},[N,h]);const k=t=>{const[n,o]=t;n&&o&&I([n,o])},E=i.reduce((t,n)=>t+n.totalRevenue,0),j=i.reduce((t,n)=>t+n.totalReservations,0);return e("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white p-8",children:a("div",{className:"max-w-7xl mx-auto space-y-8",children:[a("div",{className:"flex justify-between items-center",children:[a("div",{children:[a("h1",{className:"text-3xl font-bold text-gray-800",children:["üìä Finances de ",S||"la compagnie"]}),e("p",{className:"text-gray-500 text-sm",children:"Sur la p√©riode s√©lectionn√©e"})]}),a("button",{onClick:h,disabled:m,className:`flex items-center px-4 py-2 rounded-lg text-white shadow ${m?"bg-gray-400 cursor-not-allowed":"bg-yellow-500 hover:bg-yellow-600"} transition-all`,children:[e(q,{className:`mr-2 ${m?"animate-spin":""}`}),m?"Chargement...":"Actualiser"]})]}),a("div",{className:"bg-white p-6 rounded-lg border shadow-sm flex flex-col md:flex-row md:items-center gap-4",children:[a("div",{className:"flex-1",children:[a("label",{className:"text-sm text-gray-600 mb-1 block",children:[e(H,{className:"inline mr-2"}),"S√©lectionner une p√©riode"]}),e(M,{selectsRange:!0,startDate:l[0],endDate:l[1],onChange:k,className:"w-full border p-2 rounded-lg shadow-sm",dateFormat:"dd/MM/yyyy",isClearable:!0})]}),e("div",{className:"text-sm text-gray-500 mt-2 md:mt-0",children:l[0]&&l[1]&&a("span",{children:["Du ",l[0].toLocaleDateString("fr-FR")," au ",l[1].toLocaleDateString("fr-FR")]})})]}),a("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e("div",{className:"bg-white p-6 rounded-lg border-l-4 border-yellow-500 shadow-sm",children:a("div",{className:"flex items-center",children:[e(P,{className:"text-yellow-500 mr-3 text-2xl"}),a("div",{children:[e("p",{className:"text-sm text-gray-500",children:"Recettes totales"}),a("p",{className:"text-2xl font-bold",children:[E.toLocaleString("fr-FR")," FCFA"]})]})]})}),e("div",{className:"bg-white p-6 rounded-lg border-l-4 border-blue-500 shadow-sm",children:a("div",{className:"flex items-center",children:[e(O,{className:"text-blue-500 mr-3 text-2xl"}),a("div",{children:[e("p",{className:"text-sm text-gray-500",children:"R√©servations totales"}),e("p",{className:"text-2xl font-bold",children:j})]})]})})]}),a("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e("h2",{className:"text-lg font-bold mb-4",children:"üìç R√©partition par agence"}),b&&e("p",{className:"text-red-500 mb-4",children:b}),i.length===0?e("p",{className:"text-gray-500",children:"Aucune donn√©e pour cette p√©riode."}):a("table",{className:"w-full border text-sm",children:[e("thead",{className:"bg-gray-50",children:a("tr",{children:[e("th",{className:"border p-2 text-left",children:"Agence"}),e("th",{className:"border p-2 text-left",children:"R√©servations"}),e("th",{className:"border p-2 text-left",children:"Recettes"}),e("th",{className:"border p-2 text-left",children:"Action"})]})}),e("tbody",{children:i.map(t=>a("tr",{className:"hover:bg-gray-50",children:[e("td",{className:"border p-2",children:t.nom}),e("td",{className:"border p-2",children:t.totalReservations}),a("td",{className:"border p-2",children:[t.totalRevenue.toLocaleString("fr-FR")," FCFA"]}),e("td",{className:"border p-2",children:a("button",{onClick:()=>F(`/compagnie/agence/${t.id}/reservations`),className:"text-blue-600 hover:underline flex items-center",children:["Voir d√©tail ",e(U,{className:"ml-1"})]})})]},t.id))})]})]})]})})};export{Y as default};
