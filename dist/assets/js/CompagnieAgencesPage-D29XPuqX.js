import{r as s,j as t}from"./react-CdtEOh9s.js";import{q as K,w as O,f as F,h as X,k as Y,e as Z,m as _,d as p,u as Q,p as ee}from"./firebase-C3aZpI0W.js";import{u as te,d as l,a as ae}from"../index-BEWNaqTF.js";import"./vendor-D_1n0kdO.js";const oe=()=>{const{user:n}=te(),[V,M]=s.useState([]),[v,j]=s.useState(""),[b,y]=s.useState(""),[N,f]=s.useState(""),[w,C]=s.useState(""),[q,S]=s.useState(""),[d,A]=s.useState(""),[m,E]=s.useState(""),[h,D]=s.useState(""),[I,T]=s.useState(""),[g,L]=s.useState(""),[x,P]=s.useState(""),[k,R]=s.useState(null),[U,G]=s.useState(null),[r,i]=s.useState({nomAgence:"",ville:"",quartier:""}),o=async()=>{if(!(n!=null&&n.companyId))return;const e=K(F(l,"agences"),O("companyId","==",n.companyId)),c=(await X(e)).docs.map(u=>({id:u.id,...u.data()}));M(c)};s.useEffect(()=>{o()},[n]);const W=async e=>{e.preventDefault();try{const c=(await Y(ae,d,I)).user.uid,u=await Z(F(l,"agences"),{nomAgence:v,ville:b,pays:N,quartier:w,type:q,statut:"active",emailGerant:d,nomGerant:m,telephone:h,companyId:(n==null?void 0:n.companyId)||"",latitude:g!==""?parseFloat(g):null,longitude:x!==""?parseFloat(x):null});await _(p(l,"users",c),{uid:c,email:d,nom:m,telephone:h,role:"chefAgence",companyId:(n==null?void 0:n.companyId)||"",agencyId:u.id}),alert("Agence et gérant créés."),j(""),y(""),f(""),C(""),S(""),A(""),E(""),D(""),T(""),L(""),P(""),o()}catch(a){console.error("Erreur pendant la création Firestore:",a.message),alert(a.message)}},$=e=>{R(k===e?null:e)},z=async e=>{window.confirm("Supprimer cette agence ?")&&(await ee(p(l,"agences",e)),o())},B=async e=>{const a=e.statut==="active"?"inactive":"active";await Q(p(l,"agences",e.id),{statut:a}),o()},H=e=>{G(e.id),i({nomAgence:e.nomAgence,ville:e.ville,quartier:e.quartier||""})},J=async(e,a)=>{e.preventDefault(),await Q(p(l,"agences",a),{nomAgence:r.nomAgence,ville:r.ville,quartier:r.quartier}),G(null),o()};return t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Gestion des agences"}),t.jsxs("form",{onSubmit:W,className:"grid md:grid-cols-2 gap-4 mb-8",children:[t.jsx("input",{placeholder:"Nom de l’agence",value:v,onChange:e=>j(e.target.value),className:"border p-2 rounded",required:!0}),t.jsx("input",{placeholder:"Ville",value:b,onChange:e=>y(e.target.value),className:"border p-2 rounded",required:!0}),t.jsx("input",{placeholder:"Pays",value:N,onChange:e=>f(e.target.value),className:"border p-2 rounded",required:!0}),t.jsx("input",{placeholder:"Quartier (optionnel)",value:w,onChange:e=>C(e.target.value),className:"border p-2 rounded"}),t.jsx("input",{placeholder:"Type (optionnel)",value:q,onChange:e=>S(e.target.value),className:"border p-2 rounded"}),t.jsx("input",{placeholder:"Latitude (optionnel)",value:g,onChange:e=>L(e.target.value),className:"border p-2 rounded"}),t.jsx("input",{placeholder:"Longitude (optionnel)",value:x,onChange:e=>P(e.target.value),className:"border p-2 rounded"}),t.jsx("input",{placeholder:"Nom du gérant",value:m,onChange:e=>E(e.target.value),className:"border p-2 rounded",required:!0}),t.jsx("input",{placeholder:"Email du gérant",type:"email",value:d,onChange:e=>A(e.target.value),className:"border p-2 rounded",required:!0}),t.jsx("input",{placeholder:"Mot de passe",type:"password",value:I,onChange:e=>T(e.target.value),className:"border p-2 rounded",required:!0}),t.jsx("input",{placeholder:"Téléphone",value:h,onChange:e=>D(e.target.value),className:"border p-2 rounded",required:!0}),t.jsx("button",{type:"submit",className:"bg-green-600 text-white rounded p-2 col-span-2",children:"Ajouter l’agence"})]}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Liste des agences"}),t.jsx("div",{className:"space-y-2",children:V.map(e=>t.jsxs("div",{className:"bg-white border rounded shadow",children:[t.jsxs("div",{onClick:()=>$(e.id),className:"cursor-pointer p-3 flex justify-between items-center hover:bg-gray-50",children:[t.jsx("span",{className:"font-bold text-yellow-800",children:e.nomAgence}),t.jsx("span",{className:`text-sm ${e.statut==="active"?"text-green-600":"text-red-600"}`,children:e.statut})]}),k===e.id&&t.jsxs("div",{className:"p-4 border-t text-sm text-gray-600 space-y-1",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Ville:"})," ",e.ville," – ",t.jsx("strong",{children:"Pays:"})," ",e.pays]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Quartier:"})," ",e.quartier||"-"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Type:"})," ",e.type||"-"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Latitude:"})," ",e.latitude??"-"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Longitude:"})," ",e.longitude??"-"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Email du gérant:"})," ",e.emailGerant]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Téléphone:"})," ",e.telephone]}),U===e.id?t.jsxs("form",{onSubmit:a=>J(a,e.id),className:"grid grid-cols-1 md:grid-cols-2 gap-2 pt-2",children:[t.jsx("input",{value:r.nomAgence,onChange:a=>i({...r,nomAgence:a.target.value}),className:"border p-1 rounded",placeholder:"Nom agence",required:!0}),t.jsx("input",{value:r.ville,onChange:a=>i({...r,ville:a.target.value}),className:"border p-1 rounded",placeholder:"Ville",required:!0}),t.jsx("input",{value:r.quartier,onChange:a=>i({...r,quartier:a.target.value}),className:"border p-1 rounded",placeholder:"Quartier"}),t.jsx("button",{type:"submit",className:"bg-green-600 text-white px-2 py-1 rounded col-span-2",children:"Enregistrer"})]}):t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsx("button",{onClick:()=>B(e),className:"px-2 py-1 rounded bg-yellow-500 text-white",children:e.statut==="active"?"Désactiver":"Activer"}),t.jsx("button",{onClick:()=>H(e),className:"px-2 py-1 rounded bg-blue-600 text-white",children:"Modifier"}),t.jsx("button",{onClick:()=>z(e.id),className:"px-2 py-1 rounded bg-red-600 text-white",children:"Supprimer"})]})]})]},e.id))})]})};export{oe as default};
