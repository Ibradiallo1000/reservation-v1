import{r as n,u as y,j as e}from"./react-Bg_vEni-.js";import{q as w,f as C,w as M,h as R,u as E,d as S}from"./firebase-C3aZpI0W.js";import{d as f}from"../index-Dgt8Lr4V.js";import{d as i}from"./dayjs.min-CjsoaEGR.js";import{M as A}from"./ModifierReservationForm-DLDw0kvU.js";import"./vendor-D_4iK-Jm.js";const H=()=>{const[o,j]=n.useState(""),[l,c]=n.useState([]),[d,u]=n.useState(!1),[m,h]=n.useState(""),[x,p]=n.useState(null),b=y(),v=async()=>{if(o){u(!0),h("");try{const t=w(C(f,"reservations"),M("telephone","==",o)),a=(await R(t)).docs.map(s=>({id:s.id,...s.data()}));c(a)}catch{h("Erreur lors de la recherche.")}u(!1)}},g=t=>{var s;const r=i();return i((s=t==null?void 0:t.toDate)==null?void 0:s.call(t)).diff(r,"hour")>24},N=async t=>{if(window.confirm("Voulez-vous vraiment annuler cette réservation ?"))try{await E(S(f,"reservations",t),{statut:"annulée"}),alert("Réservation annulée."),c(a=>a.map(s=>s.id===t?{...s,statut:"annulée"}:s))}catch{alert("Erreur lors de l'annulation.")}};return e.jsxs("div",{className:"p-4 max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Consulter mes réservations"}),e.jsx("p",{className:"mb-2 text-sm text-gray-600",children:"Entrez votre numéro de téléphone pour afficher vos réservations."}),e.jsxs("div",{className:"flex space-x-2 mb-6",children:[e.jsx("input",{type:"tel",placeholder:"Numéro de téléphone",value:o,onChange:t=>j(t.target.value),className:"border border-gray-300 rounded px-4 py-2 w-full"}),e.jsx("button",{onClick:v,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Rechercher"})]}),d&&e.jsx("p",{children:"Chargement..."}),m&&e.jsx("p",{className:"text-red-500",children:m}),l.length>0&&e.jsx("div",{className:"overflow-auto rounded-lg shadow",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-left",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Date de départ"}),e.jsx("th",{className:"p-3",children:"Trajet"}),e.jsx("th",{className:"p-3",children:"Statut"}),e.jsx("th",{className:"p-3",children:"Action"})]})}),e.jsx("tbody",{children:l.map(t=>{var r,a,s;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3",children:i(typeof((r=t.date_depart)==null?void 0:r.toDate)=="function"?t.date_depart.toDate():t.date_depart).format("DD/MM/YYYY HH:mm")}),e.jsxs("td",{className:"p-3",children:[(a=t.trip)==null?void 0:a.departure," → ",(s=t.trip)==null?void 0:s.arrival]}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-white text-xs ${t.statut==="payée"?"bg-green-500":t.statut==="en attente"?"bg-yellow-500":"bg-red-500"}`,children:t.statut})}),e.jsxs("td",{className:"p-3 space-x-2",children:[e.jsx("button",{onClick:()=>b(`/recu/${t.id}`),className:"text-blue-600 hover:underline text-sm",children:"Voir billet"}),g(t.date_depart)&&t.statut==="payée"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>N(t.id),className:"text-red-600 hover:underline text-sm",children:"Annuler"}),e.jsx("button",{onClick:()=>p(t),className:"text-indigo-600 hover:underline text-sm",children:"✏️ Modifier"})]})]})]},t.id)})})]})}),l.length===0&&!d&&o&&e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"Aucune réservation trouvée pour ce numéro."}),x&&e.jsx(A,{reservation:x,onClose:()=>p(null),onUpdated:v})]})};export{H as default};
