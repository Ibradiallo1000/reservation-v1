import{r as o,j as s}from"./react-PtMwKKf1.js";import{k as I,q as b,D as g,w as y,G as C,l as S,d as j,u as M,B as R}from"./firebase-eGIzIftJ.js";import{u as k,d as m}from"../index-B745l0NT.js";import"./vendor-B5FTF_2c.js";const z=()=>{const{user:t}=k(),[r,p]=o.useState([]),[u,x]=o.useState(!0),[h,v]=o.useState(null),[w,N]=o.useState(!0),d=10,c=async(e=!1)=>{if(!(t!=null&&t.companyId))return;x(!0);const a=I(m,"companies",t.companyId,"avis");let l=b(a,y("visible","==",!1),g(d));e&&h&&(l=b(a,y("visible","==",!1),C(h),g(d)));try{const n=await S(l),f=n.docs.map(i=>({id:i.id,...i.data()})).sort((i,E)=>i.nom.localeCompare(E.nom));p(e?i=>[...i,...f]:f),v(n.docs[n.docs.length-1]||null),N(n.size===d)}catch(n){console.error("Erreur de récupération des avis :",n)}finally{x(!1)}};o.useEffect(()=>{c()},[t]);const D=async(e,a)=>{if(!(t!=null&&t.companyId))return;const l=j(m,"companies",t.companyId,"avis",e);await M(l,{visible:!a}),c()},A=async e=>{if(!(t!=null&&t.companyId))return;const a=j(m,"companies",t.companyId,"avis",e);await R(a),c()};return s.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Modération des avis clients"}),u&&r.length===0&&s.jsx("p",{children:"Chargement des avis..."}),!u&&r.length===0&&s.jsx("p",{children:"Aucun avis en attente pour l’instant ✅"}),s.jsx("ul",{className:"space-y-4",children:r.map(e=>s.jsxs("li",{className:"border p-4 rounded shadow-sm bg-white flex flex-col gap-2",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("h4",{className:"font-semibold",children:[e.nom," — ⭐ ",e.note]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>D(e.id,e.visible),className:`text-sm px-3 py-1 rounded ${e.visible?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:e.visible?"Masquer":"Afficher"}),s.jsx("button",{onClick:()=>A(e.id),className:"text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded",children:"Supprimer"})]})]}),s.jsx("p",{className:"text-sm text-gray-600 italic",children:e.commentaire})]},e.id))}),w&&s.jsx("div",{className:"flex justify-center mt-6",children:s.jsx("button",{onClick:()=>c(!0),className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Charger plus"})})]})};export{z as default};
