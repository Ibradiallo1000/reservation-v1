import{r as x,j as e,a0 as L,a1 as I}from"./react-CdtEOh9s.js";import{q as j,w as o,f,h as w,T as p}from"./firebase-C3aZpI0W.js";import{u as k,d as y}from"../index-_JuAPzwQ.js";import{R as E,B as T,X as $,Y as P,T as B,a as q}from"./BarChart-B68OeDru.js";import"./vendor-D_1n0kdO.js";const Q=()=>{const{user:i}=k(),[u,h]=x.useState(!0),[l,g]=x.useState(null),[c,R]=x.useState([new Date(new Date().setDate(new Date().getDate()-30)),new Date]),[N,b]=x.useState([]),[d,D]=x.useState({totalAgencies:0,totalReservations:0,totalRevenue:0,totalCouriers:0,growthRate:0}),S=async t=>{const a=j(f(y,"agences"),o("companyId","==",t));return(await w(a)).docs.map(s=>({id:s.id,nom:s.data().nom,ville:s.data().ville,companyId:s.data().companyId,statut:s.data().statut}))},A=async t=>{const[a,n]=c,[s,r]=await Promise.all([w(j(f(y,"reservations"),o("agencyId","==",t.id),o("createdAt",">=",p.fromDate(a)),o("createdAt","<=",p.fromDate(n)))),w(j(f(y,"courriers"),o("agencyId","==",t.id),o("createdAt",">=",p.fromDate(a)),o("createdAt","<=",p.fromDate(n))))]);return{reservations:s.size,revenus:s.docs.reduce((m,F)=>m+(F.data().prixTotal||0),0),courriers:r.size}},C=t=>{if(t.length===0)return 0;const n=t.reduce((s,r)=>s+r.revenus,0)/t.length;return parseFloat((n*.1).toFixed(2))};return x.useEffect(()=>{(async()=>{try{if(!(i!=null&&i.companyId))return;h(!0),g(null);const a=await S(i.companyId),n=await Promise.all(a.map(async r=>({...r,...await A(r)}))),s=n.reduce((r,m)=>({totalReservations:r.totalReservations+m.reservations,totalRevenue:r.totalRevenue+m.revenus,totalCouriers:r.totalCouriers+m.courriers}),{totalReservations:0,totalRevenue:0,totalCouriers:0});b(n),D({totalAgencies:a.length,...s,growthRate:C(n)})}catch(a){console.error("Erreur:",a),g("Erreur de chargement des données")}finally{h(!1)}})()},[i,c]),u?e.jsx("div",{className:"p-6 text-center",children:"Chargement en cours..."}):l?e.jsx("div",{className:"p-6 text-red-500",children:l}):e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard Compagnie"}),e.jsxs("p",{className:"text-gray-600",children:["Données du ",c[0].toLocaleDateString()," au ",c[1].toLocaleDateString()]})]}),e.jsx(L,{selectsRange:!0,startDate:c[0],endDate:c[1],onChange:t=>{R(t)},className:"border rounded p-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(v,{title:"Agences",value:d.totalAgencies,icon:e.jsx(I,{className:"h-5 w-5 text-blue-500"})}),e.jsx(v,{title:"Réservations",value:d.totalReservations,trend:`${d.growthRate>=0?"+":""}${d.growthRate}%`}),e.jsx(v,{title:"Revenus",value:d.totalRevenue,isCurrency:!0}),e.jsx(v,{title:"Courriers",value:d.totalCouriers})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Performance par agence"}),e.jsx("div",{className:"h-80",children:e.jsx(E,{width:"100%",height:"100%",children:e.jsxs(T,{data:N,children:[e.jsx($,{dataKey:"nom"}),e.jsx(P,{}),e.jsx(B,{formatter:t=>[Number(t).toLocaleString(),"Revenus (FCFA)"],labelFormatter:t=>`Agence: ${t}`}),e.jsx(q,{dataKey:"revenus",name:"Revenus",fill:"#6366f1",radius:[4,4,0,0]})]})})})]}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agence"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ville"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Réservations"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenus"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Courriers"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.nom}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.ville}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:t.reservations.toLocaleString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:[t.revenus.toLocaleString()," FCFA"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:t.courriers.toLocaleString()})]},t.id))})]})})]})},v=({title:i,value:u,icon:h,trend:l,isCurrency:g=!1})=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:i}),h]}),e.jsxs("div",{className:"mt-2 flex items-baseline",children:[e.jsx("p",{className:"text-2xl font-semibold",children:g?`${u.toLocaleString()} FCFA`:u.toLocaleString()}),l&&e.jsx("span",{className:`ml-2 text-sm ${l.startsWith("+")?"text-green-600":"text-red-600"}`,children:l})]})]});export{Q as default};
