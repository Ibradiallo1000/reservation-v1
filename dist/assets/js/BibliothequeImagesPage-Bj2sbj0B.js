import{r as o,a as s,j as a}from"./react-DB_4kGOy.js";import{w as N,x as w,y as v,z as I,G as A,o as j}from"./firebase-lLzYRzUk.js";import{u as E,d as g}from"../index-Bkmir__O.js";import{U as S}from"./UploadImageCloudinary-C7LWAJRT.js";import"./vendor-C-DAJou6.js";const C=()=>{const{user:r}=E(),[n,b]=o.useState([]),[x,i]=o.useState(!1),[m,u]=o.useState(null),c=async()=>{if(r!=null&&r.companyId){i(!0),u(null);try{const e=N(w(g,"imagesBibliotheque"),v("companyId","==",r.companyId)),d=(await I(e)).docs.map(t=>{var l;return{id:t.id,...t.data(),createdAt:(l=t.data().createdAt)==null?void 0:l.toDate()}});d.sort((t,l)=>{var p,h;return(((p=l.createdAt)==null?void 0:p.getTime())||0)-(((h=t.createdAt)==null?void 0:h.getTime())||0)}),b(d)}catch(e){console.error("Erreur de chargement:",e),u("Erreur lors du chargement des images")}finally{i(!1)}}};o.useEffect(()=>{r!=null&&r.companyId&&c()},[r==null?void 0:r.companyId]);const f=async e=>{if(!(!e.id||e.companyId!==(r==null?void 0:r.companyId)||!window.confirm(`Supprimer l'image "${e.nom}" ?`)))try{await A(j(g,"imagesBibliotheque",e.id)),c()}catch(d){console.error("Erreur de suppression:",d),alert("Erreur lors de la suppression")}};return s("div",{className:"p-6 max-w-5xl mx-auto",children:[a("h1",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Bibliothèque d'images"}),a("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:a(S,{label:"Ajouter une image",dossier:`compagnies/${r==null?void 0:r.companyId}`,onUpload:()=>c(),className:"w-full"})}),a("hr",{className:"my-6 border-gray-200"}),a("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Images enregistrées"}),m&&a("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4",children:a("p",{children:m})}),x?a("div",{className:"flex justify-center py-8",children:a("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):n.length===0?a("div",{className:"bg-blue-50 p-4 rounded-lg text-blue-800",children:a("p",{children:"Aucune image enregistrée pour cette compagnie."})}):a("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:n.map(e=>s("div",{className:"border border-gray-200 rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow duration-200 bg-white",children:[a("div",{className:"relative pb-2/3 h-40 mb-2",children:a("img",{src:e.url,alt:e.nom,className:"absolute h-full w-full object-cover rounded-md",loading:"lazy"})}),s("div",{className:"mb-1",children:[a("p",{className:"text-sm font-medium text-gray-800 truncate",children:e.nom}),s("div",{className:"flex justify-between items-center",children:[a("span",{className:"text-xs text-gray-500",children:e.type}),e.usage&&a("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full",children:e.usage})]})]}),s("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.createdAt&&a("span",{children:new Date(e.createdAt).toLocaleDateString()}),a("button",{onClick:()=>f(e),className:"text-red-600 hover:text-red-800 hover:underline","aria-label":"Supprimer",children:"Supprimer"})]})]},e.id))})]})};export{C as default};
