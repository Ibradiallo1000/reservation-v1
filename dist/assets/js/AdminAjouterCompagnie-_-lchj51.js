import{u as T,r as t,j as a}from"./react-PtMwKKf1.js";import{a as z,d as g}from"../index-C4y8wfzK.js";import{y as I,t as h,d as v,T as b,k as M}from"./firebase-eGIzIftJ.js";import"./vendor-B5FTF_2c.js";const u=[{name:"Mali",code:"+223"},{name:"Sénégal",code:"+221"},{name:"Côte d'Ivoire",code:"+225"},{name:"Burkina Faso",code:"+226"},{name:"Togo",code:"+228"}],U=o=>o.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]/g,"").trim(),W=({onSuccess:o})=>{const C=T(),[n,S]=t.useState(""),[r,A]=t.useState(""),[l,E]=t.useState(""),[x,L]=t.useState(""),[f,q]=t.useState(u[0].name),[N,D]=t.useState(u[0].code),[d,F]=t.useState(""),[c,P]=t.useState(null),[p,$]=t.useState(null),[j,y]=t.useState(!1),B=async e=>{e.preventDefault(),y(!0);try{const i=(await I(z,l,x)).user.uid,m=i,R=U(n);await h(v(g,"companies",m),{nom:n,email:l,pays:f,telephone:`${N}${d}`,responsable:r,plan:"free",createdAt:b.now(),commissionRate:.1,status:"actif",logoUrl:"",banniereUrl:"",description:`Bienvenue chez ${n}`,slug:R,latitude:c||null,longitude:p||null,themeStyle:"moderne",couleurPrimaire:"#3B82F6",couleurSecondaire:"#10B981",police:"sans-serif",publicVisible:!0,vues:0,modifiable:!0});const w=v(M(g,"companies",m,"agences"));await h(w,{nom:"Siège principal",adresse:"",telephone:`${N}${d}`,createdAt:b.now(),latitude:c||null,longitude:p||null,responsable:r,active:!0,slug:"siegeprincipal",isHeadOffice:!0}),await h(v(g,"users",i),{email:l,role:"admin_compagnie",companyId:m,agencyId:w.id,companyName:n,nom:r,createdAt:b.now()}),alert("✅ Compagnie, agence principale et administrateur créés avec succès !"),C("/compagnies"),o&&o()}catch(s){alert("❌ Erreur : "+s.message)}finally{y(!1)}};return a.jsxs("div",{className:"p-6 max-w-2xl mx-auto",children:[a.jsx("h2",{className:"text-xl font-bold mb-4",children:"Ajouter une compagnie"}),a.jsxs("form",{onSubmit:B,className:"grid grid-cols-1 gap-4",children:[a.jsx("input",{required:!0,value:n,onChange:e=>S(e.target.value),placeholder:"Nom de la compagnie",className:"border p-2 rounded"}),a.jsx("input",{required:!0,value:r,onChange:e=>A(e.target.value),placeholder:"Nom du responsable",className:"border p-2 rounded"}),a.jsx("input",{required:!0,type:"email",value:l,onChange:e=>E(e.target.value),placeholder:"Email du responsable",className:"border p-2 rounded"}),a.jsx("input",{required:!0,type:"password",value:x,onChange:e=>L(e.target.value),placeholder:"Mot de passe",className:"border p-2 rounded"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("select",{value:f,onChange:e=>{const s=u.find(i=>i.name===e.target.value);s&&(q(s.name),D(s.code))},className:"border p-2 rounded w-1/2",children:u.map(e=>a.jsx("option",{value:e.name,children:e.name},e.code))}),a.jsx("input",{required:!0,value:d,onChange:e=>F(e.target.value),placeholder:"Numéro de téléphone",className:"border p-2 rounded w-1/2"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"number",step:"any",value:c??"",onChange:e=>P(e.target.value?parseFloat(e.target.value):null),placeholder:"Latitude (optionnel)",className:"border p-2 rounded w-1/2"}),a.jsx("input",{type:"number",step:"any",value:p??"",onChange:e=>$(e.target.value?parseFloat(e.target.value):null),placeholder:"Longitude (optionnel)",className:"border p-2 rounded w-1/2"})]}),a.jsx("button",{type:"submit",disabled:j,className:"bg-orange-600 text-white p-2 rounded hover:bg-orange-700 transition",children:j?"Enregistrement...":"Ajouter la compagnie"})]})]})};export{W as default};
