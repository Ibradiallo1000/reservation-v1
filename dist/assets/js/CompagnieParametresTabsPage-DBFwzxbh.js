import{r as o,j as e,a,af as fe,l as B,A as V,aF as xe,P as F,Z as ve,I as E,aG as Y,s as Ne,U as we,F as M,S as L,aH as ee,aI as Ce}from"./react-DB_4kGOy.js";import{o as I,q as j,C as q,w as ae,y as te,x as re,z as se,P as Se,Q as ke,E as Ie,T as Pe,G as Ae,e as Ee,V as Me,W as je}from"./firebase-lLzYRzUk.js";import{u as D,A as O,m as P,I as De,d as k,a as H,b as Te,c as Ue}from"../index-Bkmir__O.js";import _e from"./ParametresPlan-DKRJDRaz.js";import"./vendor-C-DAJou6.js";const qe=()=>{const{user:r}=D(),[s,d]=o.useState({accroche:"",instructionRecherche:"",nom:"",telephone:"",description:"",logoUrl:"",faviconUrl:"",banniereUrl:"",imagesSlider:[],couleurPrimaire:"#3B82F6",couleurSecondaire:"#10B981",couleurAccent:"#FBBF24",couleurTertiaire:"#F472B6",themeStyle:"moderne",police:"sans-serif",socialMedia:{facebook:"",instagram:"",whatsapp:"",tiktok:"",linkedin:"",youtube:""},footerConfig:{showSocialMedia:!0,showTestimonials:!0,showLegalLinks:!0,showContactForm:!0,customLinks:[]}}),[c,f]=o.useState({text:"",type:""}),[g,m]=o.useState(null),[b,i]=o.useState(null),x=[{name:"moderne",value:"moderne",description:"Style contemporain avec couleurs vives",icon:e(F,{size:16})},{name:"classique",value:"classique",description:"Style traditionnel épuré",icon:e(ee,{size:16})},{name:"sombre",value:"sombre",description:"Mode nuit élégant",icon:e(Y,{size:16})},{name:"contraste",value:"contraste",description:"Fort impact visuel",icon:e(Ce,{size:16})},{name:"minimaliste",value:"minimaliste",description:"Design ultra épuré",icon:e(ee,{size:16})},{name:"glassmorphism",value:"glassmorphism",description:"Effets de transparence moderne",icon:e(F,{size:16})}];o.useEffect(()=>{r!=null&&r.companyId&&(async()=>{const u=I(k,"companies",r.companyId),C=await j(u);C.exists()&&d(A=>({...A,...C.data()}))})()},[r]);const w=async()=>{if(r!=null&&r.companyId){f({text:"Enregistrement en cours...",type:"info"});try{const n=I(k,"companies",r.companyId);await q(n,s),f({text:"Modifications enregistrées avec succès",type:"success"})}catch(n){console.error("Erreur d'enregistrement:",n),f({text:"Échec de l'enregistrement. Veuillez réessayer.",type:"error"})}}},v=n=>{const{name:u,value:C}=n.target;d(A=>({...A,[u]:C}))},N=n=>{g&&(d(u=>({...u,...g==="logo"&&{logoUrl:n},...g==="favicon"&&{faviconUrl:n},...g==="banniereStatique"&&{banniereUrl:n},...g==="banniere"&&{imagesSlider:[...u.imagesSlider,n]}})),m(null))},y=n=>{d(u=>({...u,imagesSlider:u.imagesSlider.filter((C,A)=>A!==n)}))};return e("div",{className:"min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8",children:a(P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},className:"max-w-5xl mx-auto",children:[a("div",{className:"bg-white rounded-xl shadow-md p-6 mb-8 flex items-center gap-4 border-l-4",style:{borderLeftColor:s.couleurPrimaire},children:[e(fe,{className:"h-8 w-8 text-gray-700"}),a("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-800",children:"Personnalisation de la vitrine"}),e("p",{className:"text-gray-500",children:"Configurez l'apparence de votre page publique"})]})]}),e(O,{children:c.text&&e(P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`fixed top-4 right-4 p-4 rounded-md shadow-lg z-50 ${c.type==="success"?"bg-green-100 text-green-800 border-l-4 border-green-500":c.type==="error"?"bg-red-100 text-red-800 border-l-4 border-red-500":"bg-blue-100 text-blue-800 border-l-4 border-blue-500"}`,children:a("div",{className:"flex items-center justify-between gap-4",children:[a("div",{className:"flex items-center",children:[c.type==="success"?e(B,{className:"h-6 w-6 mr-2"}):c.type==="error"?e(V,{className:"h-6 w-6 mr-2"}):e("div",{className:"h-6 w-6 mr-2 animate-spin rounded-full border-t-2 border-b-2 border-blue-500"}),e("span",{children:c.text})]}),c.type==="success"&&e("button",{onClick:()=>f({text:"",type:""}),className:"text-sm underline text-green-800 hover:text-green-900",type:"button",children:"OK"})]})})}),a("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"space-y-6",children:[a("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[a("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-700",children:[e(xe,{className:"text-blue-500"}),"Textes personnalisés"]}),a("div",{className:"space-y-4",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phrase d'accroche (titre principal)"}),e("input",{type:"text",name:"accroche",value:s.accroche,onChange:v,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: Réservez votre billet en un clic"}),e("p",{className:"mt-1 text-xs text-gray-500",children:"Sera affiché en grand sur votre bannière"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Instruction de recherche"}),e("input",{type:"text",name:"instructionRecherche",value:s.instructionRecherche,onChange:v,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: Remplissez les champs ci-dessous pour trouver votre trajet"}),e("p",{className:"mt-1 text-xs text-gray-500",children:"S'affiche au-dessus du formulaire de recherche"})]})]})]}),a("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[a("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-700",children:[e(F,{className:"text-purple-500"}),"Couleurs"]}),e("div",{className:"grid grid-cols-2 gap-4",children:[{name:"Primaire",key:"couleurPrimaire",value:s.couleurPrimaire},{name:"Secondaire",key:"couleurSecondaire",value:s.couleurSecondaire},{name:"Accent",key:"couleurAccent",value:s.couleurAccent},{name:"Tertiaire",key:"couleurTertiaire",value:s.couleurTertiaire}].map(n=>a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n.name}),a("div",{className:"flex items-center gap-3",children:[e("div",{className:"h-10 w-10 rounded-lg cursor-pointer border-2 border-gray-200 shadow-sm",style:{backgroundColor:n.value},onClick:()=>i(n.key)}),e("span",{className:"text-sm font-mono",children:n.value})]}),b===n.key&&a("div",{className:"absolute z-10 mt-2 bg-white p-3 rounded-xl shadow-xl border border-gray-200",children:[e(ve,{color:n.value,onChange:u=>d({...s,[n.key]:u})}),a("div",{className:"mt-3 flex justify-between items-center",children:[e("input",{type:"text",value:n.value,onChange:u=>d({...s,[n.key]:u.target.value}),className:"text-sm border rounded-lg px-3 py-1.5 w-24"}),e("button",{onClick:()=>i(null),className:"text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1.5 rounded-lg",children:"Valider"})]})]})]},n.key))})]}),a("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[a("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-700",children:[e(E,{className:"text-pink-500"}),"Images"]}),a("div",{className:"space-y-6",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo"}),s.logoUrl?a("div",{className:"flex items-center gap-4",children:[e("div",{className:"p-2 border border-gray-200 rounded-lg bg-gray-50",children:e("img",{src:s.logoUrl,alt:"Logo",className:"h-16 w-16 object-contain"})}),a("div",{className:"flex gap-2",children:[e("button",{onClick:()=>m("logo"),className:"text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1.5 rounded-lg",children:"Changer"}),e("button",{onClick:()=>d({...s,logoUrl:""}),className:"text-sm bg-red-50 hover:bg-red-100 text-red-600 px-3 py-1.5 rounded-lg",children:"Supprimer"})]})]}):a("button",{onClick:()=>m("logo"),className:"w-full py-6 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 bg-gray-50 hover:bg-gray-100 transition-all",children:[e(E,{className:"mb-2 h-8 w-8"}),e("span",{className:"font-medium",children:"Ajouter un logo"}),e("span",{className:"text-xs mt-1",children:"Recommandé : 300x300px"})]})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Favicon"}),s.faviconUrl?a("div",{className:"flex items-center gap-4",children:[e("div",{className:"p-2 border border-gray-200 rounded-lg bg-gray-50",children:e("img",{src:s.faviconUrl,alt:"Favicon",className:"h-8 w-8 object-contain"})}),a("div",{className:"flex gap-2",children:[e("button",{onClick:()=>m("favicon"),className:"text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1.5 rounded-lg",children:"Changer"}),e("button",{onClick:()=>d({...s,faviconUrl:""}),className:"text-sm bg-red-50 hover:bg-red-100 text-red-600 px-3 py-1.5 rounded-lg",children:"Supprimer"})]})]}):a("button",{onClick:()=>m("favicon"),className:"w-full py-6 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 bg-gray-50 hover:bg-gray-100 transition-all",children:[e(E,{className:"mb-2 h-8 w-8"}),e("span",{className:"font-medium",children:"Ajouter un favicon"}),e("span",{className:"text-xs mt-1",children:"Recommandé : 32x32px"})]})]})]})]})]}),a(P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.2},className:"space-y-6",children:[a("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[a("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-700",children:[e(Y,{className:"text-indigo-500"}),"Thème graphique"]}),e("div",{className:"grid grid-cols-2 gap-3",children:x.map(n=>a(P.div,{whileHover:{y:-2},onClick:()=>d({...s,themeStyle:n.value}),className:`p-4 border rounded-xl cursor-pointer transition-all ${s.themeStyle===n.value?"ring-2 ring-blue-500 border-transparent bg-blue-50":"hover:shadow-md border-gray-200"}`,children:[a("div",{className:"flex items-center gap-3 mb-2",children:[n.icon,e("span",{className:"capitalize font-medium text-gray-700",children:n.name})]}),e("p",{className:"text-xs text-gray-500",children:n.description})]},n.value))})]}),a("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[a("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-gray-700",children:[e(E,{className:"text-amber-500"}),"Bannière"]}),a("div",{className:"space-y-6",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Image de couverture statique"}),s.banniereUrl?a("div",{className:"flex flex-col gap-3",children:[a("div",{className:"relative rounded-lg overflow-hidden border border-gray-200",children:[e("img",{src:s.banniereUrl,alt:"Bannière",className:"h-40 w-full object-cover"}),e("div",{className:"absolute inset-0 bg-gradient-to-t from-black/40 to-transparent flex items-end p-4",children:e("h3",{className:"text-white font-bold text-lg",children:s.accroche||"Votre phrase d'accroche"})})]}),a("div",{className:"flex gap-2",children:[e("button",{onClick:()=>m("banniereStatique"),className:"text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1.5 rounded-lg",children:"Changer l'image"}),e("button",{onClick:()=>d({...s,banniereUrl:""}),className:"text-sm bg-red-50 hover:bg-red-100 text-red-600 px-3 py-1.5 rounded-lg",children:"Supprimer"})]})]}):a("button",{onClick:()=>m("banniereStatique"),className:"w-full py-8 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 bg-gray-50 hover:bg-gray-100 transition-all",children:[e(E,{className:"mb-2 h-8 w-8"}),e("span",{className:"font-medium",children:"Ajouter une bannière"}),e("span",{className:"text-xs mt-1",children:"Recommandé : 1200x400px"})]})]}),a("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Images du slider (",s.imagesSlider.length,")"]}),s.imagesSlider.length>0?a("div",{className:"space-y-3",children:[e("div",{className:"grid grid-cols-3 gap-2",children:s.imagesSlider.map((n,u)=>a(P.div,{className:"relative group",whileHover:{scale:1.02},children:[e("img",{src:n,alt:`Slide ${u}`,className:"h-24 w-full object-cover rounded-lg border border-gray-200"}),e("button",{onClick:()=>y(u),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition shadow-md hover:bg-red-600",children:e(Ne,{size:14})})]},u))}),a("button",{onClick:()=>m("banniere"),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1.5 mt-2",children:[e(we,{size:14})," Ajouter des images"]})]}):a("button",{onClick:()=>m("banniere"),className:"w-full py-8 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-400 hover:text-gray-600 hover:border-gray-400 bg-gray-50 hover:bg-gray-100 transition-all",children:[e(E,{className:"mb-2 h-8 w-8"}),e("span",{className:"font-medium",children:"Ajouter des images au slider"}),e("span",{className:"text-xs mt-1",children:"Recommandé : 3-5 images"})]})]})]})]})]})]}),e(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-8 flex justify-end",children:e("button",{onClick:w,className:`px-6 py-3 text-white font-medium rounded-lg shadow-md transition flex items-center justify-center gap-2 ${c.type==="success"?"bg-green-500 hover:bg-green-600":c.type==="error"?"bg-red-500 hover:bg-red-600":"bg-blue-600 hover:bg-blue-700"}`,style:{backgroundColor:c.type?void 0:s.couleurPrimaire,minWidth:"200px"},children:c.type==="success"?a(M,{children:[e(B,{className:"h-5 w-5"}),e("span",{children:"Enregistré !"})]}):c.type==="error"?a(M,{children:[e(V,{className:"h-5 w-5"}),e("span",{children:"Réessayer"})]}):a(M,{children:[e(L,{className:"h-5 w-5"}),e("span",{children:"Enregistrer"})]})})}),g&&(r==null?void 0:r.companyId)&&e(De,{companyId:r.companyId,onSelect:N,onClose:()=>m(null)})]})})},Re=/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i,ne=/^\d{8,15}$/,Le=/^\d{6}$/,R=r=>r.trim().replace(/\s+/g," ").toLowerCase().replace(new RegExp("(^|\\s)\\p{L}","gu"),s=>s.toUpperCase()),_=r=>!r||r.trim()==="",ze=()=>{const{user:r}=D(),[s,d]=o.useState([]),[c,f]=o.useState([]),[g,m]=o.useState(!1),[b,i]=o.useState(""),[x,w]=o.useState(""),[v,N]=o.useState(""),[y,n]=o.useState(""),[u,C]=o.useState(""),[A,G]=o.useState("comptable_compagnie"),[T,z]=o.useState(null),[K,W]=o.useState(""),[U,Q]=o.useState(""),[$,Z]=o.useState("comptable_compagnie"),ie=async()=>{if(!(r!=null&&r.companyId))return;const t=ae(re(k,"agences"),te("companyId","==",r.companyId)),h=(await se(t)).docs.map(l=>({id:l.id,nomAgence:l.data().nomAgence,companyId:l.data().companyId}));f(h)},J=async()=>{if(r!=null&&r.companyId)try{const t=ae(re(k,"users"),te("companyId","==",r.companyId)),h=(await se(t)).docs.map(l=>({id:l.id,...l.data()})).filter(l=>l.role!=="admin_plateforme").sort((l,S)=>(l.displayName||"").localeCompare(S.displayName||""));d(h)}catch(t){console.error("loadStaff err:",t),i("❌ Erreur lors du chargement du personnel.")}};o.useEffect(()=>{ie(),J()},[r==null?void 0:r.companyId]);const oe=()=>{w(""),N(""),n(""),C(""),G("comptable_compagnie")},le=()=>{const t=[];return _(x)&&t.push("le nom complet"),(_(v)||!Re.test(v))&&t.push("un email valide"),(_(y)||!ne.test(y))&&t.push("un téléphone composé de 8 à 15 chiffres"),Le.test(u)||t.push("un mot de passe de 6 chiffres"),t.length?(i("⚠️ Merci de renseigner "+t.join(", ")+"."),!1):!0},ce=async()=>{if(!(r!=null&&r.companyId)){i("⚠️ Aucune compagnie associée.");return}if(le()){m(!0),i("");try{const t=R(x),p=await Se(H,v.trim().toLowerCase(),u);await ke(p.user,{displayName:t});const h=p.user.uid,l=I(k,"users",h);await Ie(l,{uid:h,email:v.trim().toLowerCase(),displayName:t,telephone:y.trim(),role:A,active:!0,companyId:r.companyId,agencyId:null,createdAt:Pe.now()},{merge:!0}),i("✅ Personnel ajouté avec succès."),oe(),await J()}catch(t){console.error("handleAdd err:",t),i((t==null?void 0:t.code)==="auth/email-already-in-use"?"⚠️ Cet email est déjà utilisé.":"❌ Ajout impossible. Voir la console.")}finally{m(!1)}}},X=async(t,p)=>{m(!0),i("");try{const h=I(k,"users",t.uid);await q(h,{active:p}),d(l=>l.map(S=>S.uid===t.uid?{...S,active:p}:S))}catch(h){console.error("toggleActive err:",h),i("❌ Erreur lors du changement de statut.")}finally{m(!1)}},de=t=>{z(t.uid),W(t.displayName||""),Q(t.telephone||""),Z(t.role)},me=async()=>{if(!T)return;const t=R(K||"");if(_(t)){i("⚠️ Le nom est obligatoire.");return}if(_(U)||!ne.test(U)){i("⚠️ Téléphone invalide. 8–15 chiffres.");return}m(!0),i("");try{const p=I(k,"users",T);if(!(await j(p)).exists())throw new Error("User introuvable");await q(p,{displayName:t,telephone:U.trim(),role:$}),d(l=>l.map(S=>S.uid===T?{...S,displayName:t,telephone:U.trim(),role:$}:S)),z(null)}catch(p){console.error("edit save err:",p),i("❌ Erreur lors de la modification.")}finally{m(!1)}},ue=async t=>{if(window.confirm(`Supprimer définitivement "${t.displayName}" ?
Cette action effacera aussi son compte d'authentification.`)){m(!0),i("");try{const h=I(k,"users",t.uid);(await j(h)).exists()&&await Ae(h);const S=Ee();await Me(S,"adminDeleteUser")({uid:t.uid}),d(be=>be.filter(ye=>ye.uid!==t.uid)),i("✅ Compte supprimé partout.")}catch(h){console.error("delete err:",h),i("❌ Suppression partielle. Vérifie la console et la Cloud Function.")}finally{m(!1)}}},pe=o.useMemo(()=>{const t=new Map;return c.forEach(p=>t.set(p.id,p.nomAgence)),t},[c]),ge=o.useMemo(()=>{const t={};for(const p of s){const h=p.agencyId?String(p.agencyId):"__company__";t[h]||(t[h]=[]),t[h].push(p)}return Object.values(t).forEach(p=>p.sort((h,l)=>(h.displayName||"").localeCompare(l.displayName||""))),t},[s]),he=o.useMemo(()=>["__company__",...c.map(p=>p.id)],[c]);return a("div",{className:"p-6 max-w-6xl mx-auto",children:[e("h1",{className:"text-3xl font-extrabold mb-6",children:"Paramètres de la compagnie — Personnel"}),a("div",{className:"mb-8 bg-white p-6 rounded-xl shadow-md border",children:[e("h2",{className:"text-lg font-semibold mb-4",children:"Ajouter un membre (niveau compagnie)"}),a("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e("input",{value:x,onChange:t=>w(R(t.target.value)),placeholder:"Nom complet (Ex. Ayoub Diallo)",className:"border p-3 rounded focus:ring-2"}),e("input",{value:v,onChange:t=>N(t.target.value.trim().toLowerCase()),placeholder:"Email (ex. nom@domaine.com)",type:"email",className:"border p-3 rounded focus:ring-2"}),e("input",{value:y,onChange:t=>n(t.target.value.replace(/\D/g,"")),placeholder:"Téléphone (ex. 78953098)",inputMode:"numeric",className:"border p-3 rounded focus:ring-2"}),a("select",{value:A,onChange:t=>G(t.target.value),className:"border p-3 rounded focus:ring-2",children:[e("option",{value:"comptable_compagnie",children:"Comptable (compagnie)"}),e("option",{value:"admin_compagnie",children:"Admin compagnie"})]}),e("input",{value:u,onChange:t=>C(t.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Mot de passe (6 chiffres)",type:"password",className:"border p-3 rounded focus:ring-2 md:col-span-2"})]}),e("button",{onClick:ce,disabled:g,className:"w-full py-3 rounded font-semibold text-white transition disabled:opacity-60 bg-orange-600",children:g?"⏳ Traitement...":"Ajouter l’utilisateur"}),b&&e("p",{className:"mt-3 text-center text-sm text-gray-700",children:b})]}),he.map(t=>{const p=ge[t]||[],h=t==="__company__"?"Niveau compagnie":`Agence : ${pe.get(t)||t}`;return a("div",{className:"bg-white rounded-xl shadow-md border mb-6",children:[e("div",{className:"p-4 border-b",children:e("h2",{className:"text-lg font-semibold",children:h})}),p.length===0?e("p",{className:"p-6 text-gray-500",children:"Aucun personnel."}):e("div",{className:"divide-y",children:p.map(l=>a("div",{className:"p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e("div",{children:T===l.uid?a("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-2",children:[e("input",{value:K,onChange:S=>W(R(S.target.value)),className:"border p-2 rounded"}),e("input",{value:U,onChange:S=>Q(S.target.value.replace(/\D/g,"")),placeholder:"Téléphone",inputMode:"numeric",className:"border p-2 rounded"}),a("select",{value:$,onChange:S=>Z(S.target.value),className:"border p-2 rounded",children:[e("option",{value:"admin_compagnie",children:"Admin compagnie"}),e("option",{value:"comptable_compagnie",children:"Comptable (compagnie)"}),e("option",{value:"chef_agence",children:"Chef d’agence"}),e("option",{value:"comptable_agence",children:"Comptable (agence)"}),e("option",{value:"guichetier",children:"Guichetier"}),e("option",{value:"agent_courrier",children:"Agent de courrier"})]}),a("div",{className:"text-xs text-gray-500 flex items-center",children:["Statut: ",e("span",{className:l.active?"text-green-600":"text-red-600",children:l.active?"Actif":"Désactivé"})]})]}):a(M,{children:[a("p",{className:"font-semibold text-gray-900",children:[l.displayName," ",a("span",{className:"text-gray-500 text-sm",children:["• ",l.role]})]}),a("p",{className:"text-sm text-gray-600",children:[l.email,l.telephone?` • ${l.telephone}`:""]}),a("p",{className:"text-xs",children:["Statut :"," ",e("span",{className:l.active?"text-green-600":"text-red-600",children:l.active?"Actif":"Désactivé"})]})]})}),e("div",{className:"flex flex-wrap gap-2",children:T===l.uid?a(M,{children:[e("button",{onClick:me,disabled:g,className:"px-3 py-1 rounded text-white bg-green-600",children:"Enregistrer"}),e("button",{onClick:()=>z(null),className:"px-3 py-1 rounded border",children:"Annuler"})]}):a(M,{children:[e("button",{onClick:()=>de(l),className:"px-3 py-1 rounded border",children:"Modifier"}),l.active?e("button",{onClick:()=>X(l,!1),disabled:g,className:"px-3 py-1 rounded text-white bg-amber-700",children:"Désactiver"}):e("button",{onClick:()=>X(l,!0),disabled:g,className:"px-3 py-1 rounded text-white bg-green-700",children:"Activer"}),e("button",{onClick:()=>ue(l),disabled:g,className:"px-3 py-1 rounded text-white bg-red-600",children:"Supprimer"})]})})]},l.uid))})]},t)})]})},$e=()=>{const{user:r}=D(),[s,d]=o.useState(""),[c,f]=o.useState(""),[g,m]=o.useState("");return a("div",{children:[e("h2",{className:"text-xl font-bold mb-4",children:"Sécurité"}),e("input",{type:"password",placeholder:"Nouveau mot de passe",value:s,onChange:i=>d(i.target.value),className:"block mb-2 border px-2 py-1"}),e("input",{type:"password",placeholder:"Confirmer le mot de passe",value:c,onChange:i=>f(i.target.value),className:"block mb-2 border px-2 py-1"}),e("button",{onClick:async()=>{if(s!==c){m("Les mots de passe ne correspondent pas.");return}try{H.currentUser&&(await je(H.currentUser,s),m("Mot de passe mis à jour avec succès !"))}catch{m("Erreur lors de la mise à jour du mot de passe.")}},className:"bg-orange-600 text-white px-4 py-1 rounded",children:"Modifier le mot de passe"}),g&&e("p",{className:"mt-2 text-green-600",children:g})]})},Fe=()=>{var m;const{user:r}=D(),[s,d]=o.useState({socialMedia:{facebook:"",instagram:"",whatsapp:"",tiktok:"",linkedin:"",youtube:""},footerConfig:{showSocialMedia:!0}}),[c,f]=o.useState({text:"",type:""});o.useEffect(()=>{r!=null&&r.companyId&&(async()=>{const i=I(k,"companies",r.companyId),x=await j(i);if(x.exists()){const w=x.data();d(v=>({...v,socialMedia:w.socialMedia||v.socialMedia,footerConfig:w.footerConfig||v.footerConfig}))}})()},[r]);const g=async()=>{if(r!=null&&r.companyId){f({text:"Enregistrement...",type:"info"});try{const b=I(k,"companies",r.companyId);await q(b,{socialMedia:s.socialMedia,footerConfig:s.footerConfig}),f({text:"Modifications enregistrées",type:"success"})}catch(b){console.error(b),f({text:"Erreur lors de l'enregistrement",type:"error"})}}};return a("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded shadow",children:[e("h2",{className:"text-xl font-bold mb-6",children:"Réseaux sociaux & affichage"}),e(O,{children:c.text&&e(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`p-4 rounded mb-4 ${c.type==="success"?"bg-green-100 text-green-800":c.type==="error"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:a("div",{className:"flex justify-between items-center",children:[e("span",{children:c.text}),c.type==="success"&&e("button",{onClick:()=>f({text:"",type:""}),className:"text-sm underline",children:"OK"})]})})}),a("div",{className:"space-y-6",children:[a("div",{children:[e("h3",{className:"text-lg font-semibold mb-2",children:"Liens des réseaux sociaux"}),e("div",{className:"space-y-3",children:["facebook","instagram","whatsapp","tiktok","linkedin","youtube"].map(b=>{var i;return e("input",{type:"url",placeholder:`Lien ${b}`,value:((i=s.socialMedia)==null?void 0:i[b])||"",onChange:x=>{const w=x.target.value;d(v=>({...v,socialMedia:{...v.socialMedia,[b]:w}}))},className:"w-full px-3 py-2 border border-gray-300 rounded-md"},b)})})]}),a("div",{children:[e("h3",{className:"text-lg font-semibold mb-2",children:"Affichage dans le pied de page"}),a("label",{className:"inline-flex items-center",children:[e("input",{type:"checkbox",checked:((m=s.footerConfig)==null?void 0:m.showSocialMedia)??!0,onChange:b=>d(i=>({...i,footerConfig:{...i.footerConfig,showSocialMedia:b.target.checked}})),className:"mr-2"})," Afficher les icônes de réseaux sociaux"]})]}),e("div",{className:"flex justify-end",children:a("button",{onClick:g,className:"bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded flex items-center gap-2",children:[e(L,{size:18})," Enregistrer"]})})]})]})},Be=()=>{const{user:r}=D(),[s,d]=o.useState({fr:"",en:""}),[c,f]=o.useState({fr:"",en:""}),[g,m]=o.useState({fr:"",en:""}),[b,i]=o.useState({fr:"",en:""}),[x,w]=o.useState({text:"",type:"info"});o.useEffect(()=>{r!=null&&r.companyId&&(async()=>{const n=I(k,"companies",r.companyId),u=await j(n);if(u.exists()){const C=u.data();d(C.mentionsLegales||{fr:"",en:""}),f(C.politiqueConfidentialite||{fr:"",en:""}),m(C.conditionsUtilisation||{fr:"",en:""}),i(C.politiqueCookies||{fr:"",en:""})}})()},[r]);const v=async()=>{if(r!=null&&r.companyId){w({text:"Enregistrement en cours...",type:"info"});try{const y=I(k,"companies",r.companyId);await q(y,{mentionsLegales:s,politiqueConfidentialite:c,conditionsUtilisation:g,politiqueCookies:b}),w({text:"Mentions mises à jour avec succès.",type:"success"})}catch(y){console.error(y),w({text:"Erreur lors de l'enregistrement.",type:"error"})}}},N=(y,n,u)=>a("div",{children:[e("h3",{className:"text-lg font-semibold mb-2",children:y}),e("label",{className:"text-sm font-medium",children:"🇫🇷 Français"}),e("textarea",{rows:4,className:"w-full mb-4 p-2 border rounded",value:n.fr,onChange:C=>u({...n,fr:C.target.value})}),e("label",{className:"text-sm font-medium",children:"🇬🇧 English"}),e("textarea",{rows:4,className:"w-full p-2 border rounded",value:n.en,onChange:C=>u({...n,en:C.target.value})})]});return a("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded shadow",children:[e("h2",{className:"text-xl font-bold mb-6",children:"Mentions légales & politiques multilingues"}),e(O,{children:x.text&&e(P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`p-4 rounded mb-4 ${x.type==="success"?"bg-green-100 text-green-800":x.type==="error"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:a("div",{className:"flex justify-between items-center",children:[a("div",{className:"flex items-center gap-2",children:[x.type==="success"?e(B,{}):x.type==="error"?e(V,{}):e(L,{}),e("span",{children:x.text})]}),x.type==="success"&&e("button",{onClick:()=>w({text:"",type:"info"}),className:"text-sm underline",children:"OK"})]})})}),a("div",{className:"space-y-8",children:[N("Mentions légales",s,d),N("Politique de confidentialité",c,f),N("Conditions d'utilisation",g,m),N("Politique de cookies",b,i),e("div",{className:"flex justify-end",children:a("button",{onClick:v,className:"bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded flex items-center gap-2",children:[e(L,{size:18})," Enregistrer"]})})]})]})},Ve=[{key:"plan",label:"Plan & abonnement"},{key:"vitrine",label:"Vitrine publique"},{key:"personnel",label:"Personnel"},{key:"securite",label:"Sécurité"},{key:"reseaux",label:"Réseaux sociaux"},{key:"legaux",label:"Mentions & politique"}],Ze=()=>{const[r,s]=o.useState("vitrine"),{user:d,company:c}=D(),[f,g]=o.useState(null),[m,b]=o.useState(!0),i=Te(f||c||void 0),{setHeader:x,resetHeader:w}=Ue();o.useEffect(()=>{(async()=>{if(!(d!=null&&d.companyId)){g(null),b(!1);return}try{const N=I(k,"companies",d.companyId),y=await j(N);y.exists()?g({id:y.id,...y.data()}):g(null)}catch(N){console.error("Erreur chargement compagnie:",N),g(null)}finally{b(!1)}})()},[d==null?void 0:d.companyId]),o.useEffect(()=>(x({title:"Paramètres de la compagnie",bg:`linear-gradient(90deg, ${i.colors.primary} 0%, ${i.colors.secondary} 100%)`,fg:"#fff"}),()=>w()),[x,w,f==null?void 0:f.nom,c==null?void 0:c.nom,i.colors.primary,i.colors.secondary]);const v=()=>{switch(r){case"plan":return e(_e,{});case"vitrine":return e(qe,{});case"personnel":return e(ze,{});case"securite":return e($e,{});case"reseaux":return e(Fe,{});case"legaux":return e(Be,{});default:return null}};return a("div",{className:"max-w-6xl mx-auto p-4 md:p-6",children:[e("div",{className:"flex flex-wrap gap-2 md:gap-3 mb-6",children:Ve.map(N=>{const y=r===N.key;return e("button",{onClick:()=>s(N.key),className:["px-4 py-2 rounded-full text-sm font-medium transition-all border",y?"shadow-sm":"hover:bg-gray-50"].join(" "),style:{backgroundColor:y?i.colors.primary:"#fff",color:y?"#fff":"#1f2937",borderColor:y?`${i.colors.primary}55`:"#e5e7eb"},children:N.label},N.key)})}),m?e("div",{className:"bg-white rounded-xl border p-8 text-center text-gray-600",children:"Chargement…"}):v()]})};export{Ze as default};
