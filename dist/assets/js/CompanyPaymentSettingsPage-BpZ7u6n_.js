import{r as i,a as t,j as a,F as I}from"./react-DgrrIcw2.js";import{q as D,k as U,w as k,l as A,B as j,d as p,u as f,F as q,A as L}from"./firebase-eGIzIftJ.js";import{u as F,d as l}from"../index-p6Te0bSg.js";import"./vendor-BHjJ2Hjk.js";const H=()=>{const{user:r}=F(),[x,M]=i.useState([]),[n,y]=i.useState({name:"",logoUrl:"",merchantNumber:"",defaultPaymentUrl:"",ussdPattern:""}),[h,N]=i.useState(null),[b,w]=i.useState(!1),[v,d]=i.useState(null);i.useEffect(()=>{(async()=>{if(r!=null&&r.companyId)try{const s=D(U(l,"paymentMethods"),k("companyId","==",r.companyId)),u=(await A(s)).docs.map(c=>({id:c.id,...c.data()}));M(u)}catch(s){console.error("Error fetching payment methods:",s),d("Erreur lors du chargement des méthodes de paiement")}})()},[r==null?void 0:r.companyId]);const m=e=>{const{name:s,value:o}=e.target;y(u=>({...u,[s]:o}))},C=async e=>{if(e.preventDefault(),d(null),!(r!=null&&r.companyId)){d("Aucune compagnie associée");return}const{name:s,logoUrl:o,merchantNumber:u,ussdPattern:c}=n;if(!s||!o||!u||!c){d("Veuillez remplir tous les champs obligatoires");return}w(!0);try{const g={...n,companyId:r.companyId},P=s.toLowerCase().replace(/\s+/g,"_");h?(await f(p(l,"paymentMethods",h),g),n.defaultPaymentUrl&&await f(p(l,"companies",r.companyId),{[`paymentMethods.${P}`]:{url:n.defaultPaymentUrl,logoUrl:o,ussdPattern:c}})):(await L(U(l,"paymentMethods"),g),n.defaultPaymentUrl&&await f(p(l,"companies",r.companyId),{[`paymentMethods.${P}`]:{url:n.defaultPaymentUrl,logoUrl:o,ussdPattern:c}})),y({name:"",logoUrl:"",merchantNumber:"",defaultPaymentUrl:"",ussdPattern:""}),N(null),window.location.reload()}catch(g){console.error("Error saving payment method:",g),d("Erreur lors de la sauvegarde")}finally{w(!1)}},E=e=>{N(e.id||null),y({name:e.name,logoUrl:e.logoUrl,merchantNumber:e.merchantNumber,defaultPaymentUrl:e.defaultPaymentUrl||"",ussdPattern:e.ussdPattern||""})},S=async e=>{if(!(!e.id||!(r!=null&&r.companyId)||!window.confirm(`Supprimer la méthode ${e.name} ?`)))try{await j(p(l,"paymentMethods",e.id));const o=e.name.toLowerCase().replace(/\s+/g,"_");await f(p(l,"companies",r.companyId),{[`paymentMethods.${o}`]:q()}),window.location.reload()}catch(o){console.error("Error deleting payment method:",o),d("Erreur lors de la suppression")}};return t("div",{className:"max-w-4xl mx-auto p-6",children:[a("h1",{className:"text-2xl font-bold mb-6",children:"⚙️ Gestion des Moyens de Paiement"}),v&&a("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",children:a("p",{children:v})}),t("div",{className:"bg-white p-6 rounded-lg shadow-md mb-8",children:[a("h2",{className:"text-xl font-semibold mb-4",children:"Méthodes configurées"}),x.length===0?a("p",{className:"text-gray-500 italic",children:"Aucune méthode de paiement configurée"}):a("ul",{className:"divide-y divide-gray-200",children:x.map(e=>a("li",{className:"py-4",children:t("div",{className:"flex items-center justify-between",children:[t("div",{className:"flex items-center space-x-4",children:[a("img",{src:e.logoUrl,alt:e.name,className:"w-12 h-12 object-contain rounded"}),t("div",{children:[a("h3",{className:"font-medium text-gray-900",children:e.name}),t("p",{className:"text-sm text-gray-500",children:["N° Marchand: ",e.merchantNumber]}),e.ussdPattern&&t("p",{className:"text-xs text-green-600 truncate max-w-xs",children:["USSD: ",e.ussdPattern]}),e.defaultPaymentUrl&&t("p",{className:"text-xs text-blue-500 truncate max-w-xs",children:["URL: ",e.defaultPaymentUrl]})]})]}),t("div",{className:"flex space-x-2",children:[a("button",{onClick:()=>E(e),className:"px-3 py-1 text-sm bg-blue-50 text-blue-700 rounded hover:bg-blue-100 transition",children:"Modifier"}),a("button",{onClick:()=>S(e),className:"px-3 py-1 text-sm bg-red-50 text-red-700 rounded hover:bg-red-100 transition",children:"Supprimer"})]})]})},e.id))})]}),t("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[a("h2",{className:"text-xl font-semibold mb-4",children:h?"Modifier une méthode":"Ajouter une nouvelle méthode"}),t("form",{onSubmit:C,className:"space-y-4",children:[t("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom de la méthode *"}),a("input",{type:"text",name:"name",value:n.name,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: Orange Money",required:!0})]}),t("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL du logo *"}),a("input",{type:"url",name:"logoUrl",value:n.logoUrl,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"https://example.com/logo.png",required:!0})]}),t("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Numéro de marchand *"}),a("input",{type:"text",name:"merchantNumber",value:n.merchantNumber,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: 770123456",required:!0})]}),t("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Code USSD (avec MERCHANT et AMOUNT) *"}),a("input",{type:"text",name:"ussdPattern",value:n.ussdPattern||"",onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: *144*8*MERCHANT*AMOUNT#",required:!0})]}),t("div",{children:[a("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL de paiement par défaut (optionnel)"}),a("input",{type:"url",name:"defaultPaymentUrl",value:n.defaultPaymentUrl,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"https://payment.example.com/pay"})]}),a("div",{className:"pt-2",children:a("button",{type:"submit",disabled:b,className:`w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${b?"bg-gray-400":"bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}`,children:b?t(I,{children:[t("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"En cours..."]}):h?"Mettre à jour":"Enregistrer"})})]})]})]})};export{H as default};
