import{r as d,a,j as t,F as N}from"./react-DgrrIcw2.js";import{l as h,k as g,q as w,w as C}from"./firebase-eGIzIftJ.js";import{u as S,d as u}from"../index-p6Te0bSg.js";import{B as A,X as R,Y as j,T as M,a as P,R as k}from"./BarChart-CrYhCjc_.js";import{C as q}from"./CartesianGrid-Baa3W_b2.js";import"./vendor-BHjJ2Hjk.js";const D=()=>{const{user:i}=S(),[l,b]=d.useState([]),[x,m]=d.useState(!0),y=async()=>{if(!(i!=null&&i.companyId))return;m(!0);const c=(await h(g(u,"companies",i.companyId,"agences"))).docs.map(e=>({id:e.id,ville:e.data().ville})),n={};for(const e of c){n[e.id]={id:e.id,ville:e.ville,totalReservations:0,totalMontant:0,totalPassagers:0};const o=w(g(u,"companies",i.companyId,"agences",e.id,"reservations"),C("statut","==","pay√©"));(await h(o)).docs.forEach(v=>{const p=v.data();n[e.id].totalReservations+=1,n[e.id].totalMontant+=p.montant||0,n[e.id].totalPassagers+=p.seatsGo||1})}b(Object.values(n)),m(!1)},f=()=>{const c=[["Agence","Billets vendus","Passagers","Montant total (FCFA)"],...l.map(r=>[r.ville,r.totalReservations,r.totalPassagers,r.totalMontant])].map(r=>r.join(",")).join(`
`),n=new Blob([c],{type:"text/csv;charset=utf-8;"}),e=URL.createObjectURL(n),o=document.createElement("a");o.setAttribute("href",e),o.setAttribute("download","statistiques_agences.csv"),document.body.appendChild(o),o.click(),document.body.removeChild(o)};return d.useEffect(()=>{y()},[]),a("div",{className:"p-6",children:[t("h1",{className:"text-2xl font-bold mb-6",children:"Statistiques par Agence"}),a("div",{className:"flex justify-end gap-2 mb-4",children:[t("button",{onClick:f,className:"bg-green-600 text-white px-4 py-2 rounded text-sm",children:"üì• Export CSV"}),t("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded text-sm",children:"üñ®Ô∏è Imprimer"})]}),x?t("p",{children:"Chargement..."}):a(N,{children:[t("div",{className:"overflow-x-auto mb-6",children:a("table",{className:"w-full border text-sm",children:[t("thead",{className:"bg-gray-100",children:a("tr",{children:[t("th",{className:"border px-3 py-2",children:"Agence"}),t("th",{className:"border px-3 py-2",children:"R√©servations"}),t("th",{className:"border px-3 py-2",children:"Passagers"}),t("th",{className:"border px-3 py-2",children:"Montant encaiss√© (FCFA)"})]})}),t("tbody",{children:l.map(s=>a("tr",{className:"text-center",children:[t("td",{className:"border px-3 py-2",children:s.ville}),t("td",{className:"border px-3 py-2",children:s.totalReservations}),t("td",{className:"border px-3 py-2",children:s.totalPassagers}),t("td",{className:"border px-3 py-2 font-semibold text-green-600",children:s.totalMontant.toLocaleString()})]},s.id))})]})}),a("div",{className:"bg-white shadow p-4 rounded-lg",children:[t("h2",{className:"text-lg font-semibold mb-4",children:"Visualisation graphique"}),t(k,{width:"100%",height:300,children:a(A,{data:l,margin:{top:10,right:30,left:0,bottom:0},children:[t(q,{strokeDasharray:"3 3"}),t(R,{dataKey:"ville"}),t(j,{}),t(M,{}),t(P,{dataKey:"totalMontant",fill:"#facc15",name:"Montant encaiss√©"})]})})]})]})]})};export{D as default};
