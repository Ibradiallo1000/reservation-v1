import{r as i,j as e}from"./react-BKlva80Y.js";import{q as w,j as C,w as l,k as v,m as E,d as b}from"./firebase-1zyXmG6H.js";import{u as N,d as f}from"../index-BlZmgUmn.js";import"./vendor-CZDa83Cj.js";const A=()=>{const{user:t}=N(),[c,d]=i.useState([]),[g,a]=i.useState(!0),[u,s]=i.useState(null),m=()=>t&&t.ville||null,j=async()=>{try{a(!0),s(null);const r=m();if(!r){s("Configuration requise : Votre ville n'est pas d√©finie dans votre profil"),a(!1);return}const n=w(C(f,"courriers"),l("statut","==","en attente"),l("type","==","envoi"),l("ville","==",r)),o=(await v(n)).docs.map(h=>({id:h.id,...h.data()}));d(o)}catch(r){s("Erreur de chargement : "+r.message),console.error("Erreur Firestore:",r)}finally{a(!1)}},y=async r=>{try{if(!window.confirm("Confirmer la r√©ception de ce courrier ?"))return;await E(b(f,"courriers",r),{statut:"re√ßu",receivedAt:new Date().toISOString(),receivedBy:(t==null?void 0:t.uid)||"",agencyReceptId:(t==null?void 0:t.agencyId)||""}),d(x=>x.filter(o=>o.id!==r))}catch(n){s("Erreur lors de la mise √† jour : "+n.message)}};i.useEffect(()=>{j()},[t]);const p=m();return e.jsxs("div",{className:"p-6 max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"üì• R√©ception de courriers"}),u&&e.jsx("p",{className:"text-red-600",children:u}),g?e.jsx("p",{children:"Chargement..."}):p?c.length===0?e.jsxs("p",{children:["Aucun courrier √† r√©ceptionner pour ",p,"."]}):e.jsx("ul",{className:"space-y-4",children:c.map(r=>e.jsxs("li",{className:"border p-4 rounded bg-white shadow",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Exp√©diteur :"})," ",r.expediteur]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Destinataire :"})," ",r.destinataire]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Valeur :"})," ",r.valeur.toLocaleString()," FCFA"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Frais :"})," ",r.montant.toLocaleString()," FCFA"]}),e.jsx("button",{onClick:()=>y(r.id),className:"mt-2 bg-green-600 text-white px-4 py-2 rounded",children:"‚úÖ Marquer comme re√ßu"})]},r.id))}):e.jsx("p",{className:"text-yellow-600",children:"Ville non d√©finie dans le profil utilisateur"})]})};export{A as default};
