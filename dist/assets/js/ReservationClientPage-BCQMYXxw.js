import{d as Na,u as ba,b as va,r as d,j as e,a as t,C as wa,l as se,U as Ke,F as we,a5 as Sa,a6 as Ca,a7 as Ia,a8 as Pa}from"./react-DB_4kGOy.js";import{o as T,H as Ua,E as Ma,T as Se,q as Z,D as Ve,F as Aa,x as q,C as We,z as J,w as oe,y as ce,R as $a,S as Da,U as ja}from"./firebase-lLzYRzUk.js";import{d as N,m as Ea,s as Ta}from"../index-Bkmir__O.js";import{i as Qe,p as ie,a as le,b as za,f as Ra,c as _a}from"./vendor-C-DAJou6.js";function Fa(s){return(s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function ka(s){const p=Fa(s);return p?/(agence\s*)?principal(e)?/.test(p)?"AP":p.split(/\s+/).filter(Boolean).map(U=>U[0]).join("").toUpperCase().slice(0,2):""}async function La(s){const{companyId:p,companyCode:Y,agencyCode:U,agencyName:x,tripInstanceId:ee,sellerCode:z}=s,R=U&&U.trim()?U.toUpperCase():ka(x)||"AG",m=T(N,`companies/${p}/counters/byTrip/trips/${ee}`),ae=await Ua(N,async i=>{const y=await i.get(m),I=(y.exists()&&y.data().lastSeq||0)+1;return y.exists()?i.update(m,{lastSeq:I,updatedAt:Se.now()}):i.set(m,{lastSeq:I,updatedAt:Se.now()}),I}).catch(async()=>(await Ma(m,{lastSeq:1,updatedAt:Se.now()},{merge:!0}),1));return`${Y.toUpperCase()}-${R}-${z}-${String(ae).padStart(4,"0")}`}async function Ha(s){return La({...s,sellerCode:"WEB"})}const pe="pendingReservation",Ie=s=>["en_attente","en_attente_paiement","paiement_en_cours","preuve_recue"].includes(String(s||"").toLowerCase()),Xe=s=>{try{localStorage.setItem(pe,JSON.stringify(s))}catch{}},Ce=()=>{try{const s=localStorage.getItem(pe);return s?JSON.parse(s):null}catch{return null}},Oa=()=>{try{const s=localStorage.getItem(pe);if(!s)return;const p=JSON.parse(s);Ie(p==null?void 0:p.status)||localStorage.removeItem(pe)}catch{}},qa=()=>Math.random().toString(36).slice(2,8).toUpperCase(),de=s=>(s==null?void 0:s.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/-/g," ").replace(/\s+/g," "))||"",Ze=s=>`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`,me=s=>s&&s.charAt(0).toUpperCase()+s.slice(1).toLowerCase(),Ga=(s,p)=>new Date(s.getTime()+p*6e4),Ba=["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"];function Wa(){var He,Oe,qe;const{slug:s,id:p}=Na(),Y=ba(),U=va(),x=Y.state||{},ee=new URLSearchParams(Y.search),z=de(ee.get("departure")||""),R=de(ee.get("arrival")||""),[m,ae]=d.useState({id:"",name:"",couleurPrimaire:"#f43f5e",couleurSecondaire:"#f97316",logoUrl:"",code:"MT"}),i=d.useMemo(()=>({primary:m.couleurPrimaire,secondary:m.couleurSecondaire,lightPrimary:`${m.couleurPrimaire}1A`,lightSecondary:`${m.couleurSecondaire}1A`}),[m]),[y,ue]=d.useState({}),[I,Pe]=d.useState({}),[u,ea]=d.useState(null),[Ue,aa]=d.useState(null),[Me,ta]=d.useState([]),[ra,na]=d.useState([]),[_,Ae]=d.useState(""),[K,ge]=d.useState(""),[$,$e]=d.useState(1),[F,De]=d.useState({fullName:"",phone:""}),[V,je]=d.useState(""),[A,he]=d.useState(null),[D,Ee]=d.useState(null),[te,Te]=d.useState(!1),[W,ze]=d.useState(!1),[sa,j]=d.useState(!0),[re,v]=d.useState(""),[r,oa]=d.useState(null);d.useEffect(()=>{Oa();const a=Ce();a&&Ie(a.status)&&a.slug===s&&!p&&U(`/${s}/reservation/${a.id}`,{replace:!0,state:{companyId:a.companyId,agencyId:a.agencyId}})},[s,U,p]),d.useEffect(()=>{(async()=>{if(p){j(!0);try{if(!x.companyId||!x.agencyId){v("Information manquante (company/agency). Revenez en arrière et réessayez."),j(!1);return}const n=T(N,"companies",x.companyId,"agences",x.agencyId,"reservations",p),c=await Z(n);if(!c.exists()){v("Réservation introuvable."),j(!1);return}const l=c.data(),w=await Z(T(N,"companies",x.companyId)),f=w.exists()?w.data():{};ae({id:x.companyId,name:f.nom||f.name||"",code:(f.code||"MT").toString().toUpperCase(),couleurPrimaire:f.couleurPrimaire||"#f43f5e",couleurSecondaire:f.couleurSecondaire||"#f97316",logoUrl:f.logoUrl||""});const S=await Z(T(N,"companies",x.companyId,"agences",x.agencyId)),g=S.exists()?S.data():{};ue({id:x.agencyId,nom:g.nomAgence||g.nom||g.name||"Agence",telephone:g.telephone,code:(g.code||g.codeAgence||"").toString().toUpperCase()||void 0});const H=await J(oe(q(N,"paymentMethods"),ce("companyId","==",x.companyId))),M={};H.forEach(G=>{const C=G.data();C.name&&(M[C.name]={url:C.defaultPaymentUrl||"",logoUrl:C.logoUrl||"",ussdPattern:C.ussdPattern||"",merchantNumber:C.merchantNumber||""})}),Pe(M),oa({id:p,companyId:x.companyId,agencyId:x.agencyId,canal:l.canal,statut:l.statut,nomClient:l.nomClient,telephone:l.telephone,depart:l.depart,arrivee:l.arrivee||l.arrival,date:l.date,heure:l.heure,montant:l.montant??l.montant_total,seatsGo:l.seatsGo,referenceCode:l.referenceCode}),Ee(p),j(!1)}catch(n){console.error(n),v((n==null?void 0:n.message)||"Erreur de chargement"),j(!1)}}})()},[p,x.companyId,x.agencyId]),d.useEffect(()=>{if(p)return;if(!s||!z||!R){j(!1);return}(async()=>{var n,c,l,w;j(!0);try{const f=await J(oe(q(N,"companies"),ce("slug","==",s)));if(f.empty)throw new Error("Compagnie introuvable");const S=f.docs[0],g=S.data();ae({id:S.id,name:g.nom||g.name||"",code:(g.code||"MT").toString().toUpperCase(),couleurPrimaire:g.couleurPrimaire||"#f43f5e",couleurSecondaire:g.couleurSecondaire||"#f97316",logoUrl:g.logoUrl||""});const M=(await J(q(N,"companies",S.id,"agences"))).docs.map(h=>({id:h.id,...h.data()}));if(M[0]){const h=M[0];ue({id:h.id,nom:h.nomAgence||h.nom||h.name,telephone:h.telephone,code:(h.code||h.codeAgence||"").toString().toUpperCase()||void 0})}const G=await J(oe(q(N,"paymentMethods"),ce("companyId","==",S.id))),C={};G.forEach(h=>{const P=h.data();P.name&&(C[P.name]={url:P.defaultPaymentUrl||"",logoUrl:P.logoUrl||"",ussdPattern:P.ussdPattern||"",merchantNumber:P.merchantNumber||""})}),Pe(C);const ne=Array.from({length:8},(h,P)=>{const X=new Date;return X.setDate(X.getDate()+P),Ze(X)}),B=[];for(const h of M){const[P,X]=await Promise.all([J(oe(q(N,"companies",S.id,"agences",h.id,"weeklyTrips"),ce("active","==",!0))),J(q(N,"companies",S.id,"agences",h.id,"reservations"))]),ga=P.docs.map(b=>({id:b.id,...b.data()})).filter(b=>de(b.depart||b.departure||"")===z&&de(b.arrivee||b.arrival||"")===R),ha=X.docs.map(b=>({id:b.id,...b.data()}));ne.forEach(b=>{const fa=new Date(b),ya=Ba[fa.getDay()];ga.forEach(E=>{var Ge;(((Ge=E.horaires)==null?void 0:Ge[ya])||[]).forEach(be=>{if(b===Ze(new Date)){const O=new Date,ve=le(`${String(O.getHours()).padStart(2,"0")}:${String(O.getMinutes()).padStart(2,"0")}`,"HH:mm",new Date);if(le(be,"HH:mm",new Date)<=ve)return}const Be=`${E.id}_${b}_${be}`,Je=E.places||30,xa=ha.filter(O=>String(O.trajetId)===Be&&["payé","preuve_recue"].includes(String(O.statut).toLowerCase())).reduce((O,ve)=>O+(ve.seatsGo||0),0),Ye=Je-xa;Ye>0&&B.push({id:Be,date:b,time:be,departure:E.depart||E.departure||"",arrival:E.arrivee||E.arrival||"",price:E.price,agencyId:h.id,companyId:S.id,places:Je,remainingSeats:Ye})})})})}const xe=B.sort((h,P)=>h.date.localeCompare(P.date)||h.time.localeCompare(P.time)),Ne=[...new Set(xe.map(h=>h.date))];ta(xe),na(Ne),Ae(Ne[0]||""),sessionStorage.setItem(`preload_${s}_${z}_${R}`,JSON.stringify({company:{id:S.id,name:g.nom||"",couleurPrimaire:g.couleurPrimaire||"#f43f5e",couleurSecondaire:g.couleurSecondaire||"#f97316",logoUrl:g.logoUrl||"",code:(g.code||"MT").toString().toUpperCase()},trips:xe,dates:Ne,agencyInfo:{nom:((n=M[0])==null?void 0:n.nomAgence)||((c=M[0])==null?void 0:c.nom)||"",telephone:((l=M[0])==null?void 0:l.telephone)||"",code:(w=M[0])==null?void 0:w.code}}))}catch(f){v((f==null?void 0:f.message)||"Erreur de chargement")}finally{j(!1)}})()},[s,z,R,p]);const k=d.useMemo(()=>{if(!_)return[];const a=Me.filter(n=>n.date===_);if(Qe(ie(_))){const n=new Date,c=le(`${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}`,"HH:mm",new Date);return a.filter(l=>le(l.time,"HH:mm",new Date)>c)}return a},[Me,_]);d.useEffect(()=>{!p&&k.length&&!K&&ge(k[0].time)},[k,K,p]);const o=k.find(a=>a.time===K),Q=(o==null?void 0:o.price)??((He=k[0])==null?void 0:He.price);Q&&`${Q.toLocaleString("fr-FR")}`;const fe=(a,n)=>{const c=a/n;return c>.7?"#16a34a":c>.3?"#f59e0b":"#dc2626"},Re=a=>{var n;try{const c=(n=a.target.files)==null?void 0:n[0];if(!c)return he(null);if(!["image/jpeg","image/png","application/pdf"].includes(c.type))throw new Error("Fichier non supporté");if(c.size>5*1024*1024)throw new Error("Fichier trop volumineux (5MB max)");he(c),v("")}catch(c){v((c==null?void 0:c.message)||"Erreur fichier"),he(null)}},ca=d.useCallback(async()=>{if(p)return;const a=Ce();if(a&&Ie(a.status)&&a.slug===s){U(`/${s}/reservation/${a.id}`,{replace:!0,state:{companyId:a.companyId,agencyId:a.agencyId}});return}if(o){if(!F.fullName||!F.phone){v("Nom et téléphone requis");return}if(!te){Te(!0),v("");try{const n=await Z(T(N,"companies",o.companyId,"agences",o.agencyId)),c=n.exists()?n.data():{},l=c.nomAgence||c.nom||c.name||"Agence",w=(c.code||c.codeAgence||"").toString().toUpperCase()||void 0,f=await Z(T(N,"companies",o.companyId)),g=((f.exists()?f.data():{}).code||m.code||"MT").toString().toUpperCase(),H=await Ha({companyId:o.companyId,companyCode:g,agencyId:o.agencyId,agencyCode:w,agencyName:l,tripInstanceId:o.id}),M=new Date,G={nomClient:F.fullName,telephone:F.phone,depart:o.departure,arrivee:o.arrival,date:o.date,heure:o.time,montant:o.price*$,seatsGo:$,seatsReturn:0,tripType:"aller_simple",statut:"en_attente_paiement",canal:"en_ligne",companyId:o.companyId,companySlug:s,companyName:m.name,agencyId:o.agencyId,agencyNom:l,nomAgence:l,referenceCode:H,trajetId:o.id,holdUntil:Ga(M,15),createdAt:Ve(),updatedAt:Ve()},C=await Aa(q(N,"companies",o.companyId,"agences",o.agencyId,"reservations"),G),ne=qa(),B=`${window.location.origin}/${s}/mon-billet?r=${encodeURIComponent(ne)}`;await We(T(N,"companies",o.companyId,"agences",o.agencyId,"reservations",C.id),{publicToken:ne,publicUrl:B});try{await navigator.clipboard.writeText(B)}catch{}Ee(C.id),Xe({slug:s,id:C.id,referenceCode:H,status:"en_attente_paiement",companyId:o.companyId,agencyId:o.agencyId}),sessionStorage.setItem("reservationDraft",JSON.stringify({...G,id:C.id,publicUrl:B})),sessionStorage.setItem("companyInfo",JSON.stringify({id:m.id,name:m.name,logoUrl:m.logoUrl,couleurPrimaire:m.couleurPrimaire,couleurSecondaire:m.couleurSecondaire,slug:s}))}catch(n){v((n==null?void 0:n.message)||"Impossible de créer la réservation")}finally{Te(!1)}}}},[p,o,F,$,te,s,m,U]),_e=a=>{var w;ea(a),aa(Date.now());const n=I[a||""];if(!n)return;const c=r?r.montant||0:o?o.price*$:Q||0,l=(w=n.ussdPattern)==null?void 0:w.replace("MERCHANT",n.merchantNumber||"").replace("AMOUNT",String(c));if(n.url)try{new URL(n.url),window.open(n.url,"_blank","noopener,noreferrer")}catch{}else l&&(window.location.href=`tel:${encodeURIComponent(l)}`)},Fe=d.useMemo(()=>{if(!u)return"Choisissez un moyen de paiement pour voir les instructions.";switch(u){case"orangemoney":return"Après votre paiement Orange Money, copiez le code reçu par SMS ou joignez une capture d’écran du message.";case"moov":return"Après votre paiement Moov Money, indiquez la référence reçue par SMS ou joignez une photo du reçu.";case"wave":return"Après votre paiement Wave, copiez le code du reçu ou joignez une capture.";case"cash":return"Paiement au guichet : entrez le n° du reçu ou joignez sa photo.";default:return"Copiez la référence reçue par SMS après paiement ou joignez une capture d’écran."}},[u]),L=d.useMemo(()=>!D||!u?!1:V.trim().length>=4||!!A,[D,u,V,A]),ke=async()=>{const a=(r==null?void 0:r.companyId)||m.id,n=(r==null?void 0:r.agencyId)||(y==null?void 0:y.id);if(!D||!a||!n){v("Réservation introuvable");return}if(!u){v("Sélectionnez un moyen de paiement");return}if(!L){v("Ajoutez la référence du paiement (≥ 4 caractères) ou une capture avant de confirmer.");return}if(!W){ze(!0),v("");try{let c=null;if(A){const f=A.name.split(".").pop(),S=`preuves/preuve_${Date.now()}.${f}`,g=$a(Ta,S),H=await Da(g,A);c=await ja(H.ref)}const l=r!=null&&r.canal&&r.canal.toLowerCase()!=="en_ligne"?r.canal:"en_ligne";await We(T(N,"companies",a,"agences",n,"reservations",D),{statut:"preuve_recue",canal:l,preuveVia:u,preuveMessage:V.trim(),preuveUrl:c||null,paymentHint:u,paymentTriggeredAt:Ue?new Date(Ue):null,updatedAt:new Date});const w=Ce();w&&w.id===D&&Xe({...w,status:"preuve_recue"}),U(`/${s}/reservation/${D}`,{state:{companyId:a,agencyId:n}})}catch{v("Échec de l'envoi de la preuve")}finally{ze(!1)}}},ye=a=>e("section",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm",children:t("div",{className:"flex items-center justify-between gap-4 px-4 sm:px-5 py-3",children:[t("div",{className:"flex items-center gap-3 min-w-0",children:[m.logoUrl&&e("img",{src:m.logoUrl,alt:"",className:"h-8 w-8 rounded-full object-cover ring-1 ring-gray-200"}),t("div",{className:"min-w-0",children:[t("div",{className:"flex items-center text-gray-900 font-semibold",children:[e("span",{className:"truncate",children:r!=null&&r.depart?me(r.depart):me(z)}),e("svg",{viewBox:"0 0 24 24",className:"mx-2 h-5 w-5 shrink-0",style:{color:i.primary},children:e("path",{fill:"currentColor",d:"M5 12h12l-4-4 1.4-1.4L21.8 12l-7.4 5.4L13 16l4-4H5z"})}),e("span",{className:"truncate",children:r!=null&&r.arrivee?me(r.arrivee):me(R)})]}),e("p",{className:"text-xs text-gray-500",children:r!=null&&r.date?`${r.date} · ${r.heure||""}`:"Sélectionnez la date et l’heure"})]})]}),e("div",{className:"text-right",children:a?e("div",{className:"text-lg sm:text-xl font-extrabold",style:{color:i.primary},children:a}):t(we,{children:[e("div",{className:"text-xs text-gray-500",children:"À partir de"}),e("div",{className:"text-lg sm:text-xl font-extrabold",style:{color:i.primary},children:r!=null&&r.montant||Q?`${((r==null?void 0:r.montant)||Q).toLocaleString("fr-FR")} FCFA`:"—"})]})})]})});if(sa)return e("div",{className:"min-h-screen grid place-items-center bg-gray-50",children:e(Ea.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white/70 backdrop-blur rounded-2xl p-6 shadow-sm",children:t("div",{className:"flex items-center gap-3",children:[m.logoUrl&&e("img",{src:m.logoUrl,alt:"",className:"h-10 w-10 rounded-full object-cover ring-1 ring-gray-200"}),t("div",{children:[e("div",{className:"h-4 w-40 bg-gray-200 rounded mb-2"}),e("div",{className:"h-3 w-24 bg-gray-200 rounded"})]})]})})});const ia=e("header",{className:"sticky top-0 z-50 shadow-sm",style:{backgroundColor:i.primary},children:t("div",{className:"max-w-[1100px] mx-auto px-3 sm:px-4 py-2 flex items-center justify-between text-white",children:[e("button",{onClick:()=>U(-1),className:"p-2 rounded-full hover:bg-white/10 transition","aria-label":"Retour",children:e(wa,{className:"h-5 w-5"})}),t("div",{className:"flex items-center gap-2",children:[m.logoUrl&&e("img",{src:m.logoUrl,alt:"",className:"h-7 w-7 rounded-full object-cover ring-1 ring-white/30"}),e("span",{className:"font-semibold tracking-wide",children:m.name||"MALI TRANS"})]}),e("div",{className:"w-9"})]})}),Le=String((r==null?void 0:r.canal)||"").toLowerCase(),la=String((r==null?void 0:r.statut)||"").toLowerCase(),da=["pay","confirm","valid"].some(a=>la.includes(a)),ma=!!r&&(Le==="guichet"||da),pa=r&&t("div",{className:"max-w-[1100px] mx-auto px-3 sm:px-4 py-4 space-y-4",children:[ye("Billet"),t("section",{className:"bg-white rounded-2xl border p-4",children:[t("div",{className:"text-sm text-gray-600 mb-3",children:[e("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700 border border-emerald-200 mr-2",children:Le==="guichet"?"Guichet":"En ligne"}),t("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 border",children:["Référence: ",r.referenceCode||r.id]})]}),t("div",{className:"grid sm:grid-cols-2 gap-3 text-sm",children:[t("div",{children:[e("span",{className:"text-gray-500",children:"Passager"}),e("div",{className:"font-medium",children:r.nomClient||"—"})]}),t("div",{children:[e("span",{className:"text-gray-500",children:"Téléphone"}),e("div",{className:"font-medium",children:r.telephone||"—"})]}),t("div",{children:[e("span",{className:"text-gray-500",children:"Trajet"}),t("div",{className:"font-medium",children:[r.depart," → ",r.arrivee]})]}),t("div",{children:[e("span",{className:"text-gray-500",children:"Date & heure"}),t("div",{className:"font-medium",children:[r.date," · ",r.heure]})]}),t("div",{children:[e("span",{className:"text-gray-500",children:"Places"}),e("div",{className:"font-medium",children:r.seatsGo||1})]}),t("div",{children:[e("span",{className:"text-gray-500",children:"Montant"}),t("div",{className:"font-medium",children:[(r.montant||0).toLocaleString("fr-FR")," FCFA"]})]})]})]})]}),ua=t("div",{className:"max-w-[1100px] mx-auto px-3 sm:px-4 py-4 space-y-4",children:[ye(),(y==null?void 0:y.nom)&&t("div",{className:"text-xs text-gray-500 px-1",children:["Agence : ",y.nom," — ",y.telephone]}),re&&e("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-800",children:re}),t("section",{className:"bg-white rounded-2xl border border-gray-100 p-4",children:[e("h2",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Preuve de paiement"}),e("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2",children:Object.entries(I).map(([a,n])=>n&&t("button",{onClick:()=>_e(a),className:`h-12 px-3 rounded-xl border flex items-center gap-2 text-sm w-full transition ${u===a?"bg-white shadow-sm":"bg-gray-50 hover:bg-gray-100"}`,style:{borderColor:u===a?i.primary:"#e5e7eb"},children:[n.logoUrl?e("img",{src:n.logoUrl,alt:a,className:"h-6 w-6 object-contain rounded"}):e("div",{className:"h-6 w-6 rounded bg-gray-100"}),t("div",{className:"text-left min-w-0",children:[e("div",{className:"font-medium capitalize truncate",children:a.replace(/_/g," ")}),n.merchantNumber&&t("div",{className:"text-[11px] text-gray-500 truncate",children:["N° ",n.merchantNumber]})]}),u===a&&e("div",{className:"ml-auto h-5 w-5 rounded-full flex items-center justify-center",style:{backgroundColor:i.primary,color:"#fff"},children:e(se,{className:"w-3 h-3"})})]},a))}),e("p",{className:"text-xs text-gray-600 mt-3 mb-3",children:Fe}),u&&((Oe=I[u])==null?void 0:Oe.ussdPattern)&&t("div",{className:"mt-1 text-xs text-gray-600",children:["Code USSD :",e("span",{className:"font-mono bg-gray-50 px-2 py-1 rounded ml-2",children:I[u].ussdPattern.replace("MERCHANT",I[u].merchantNumber||"").replace("AMOUNT",String((r==null?void 0:r.montant)||(o?o.price*$:0)))})]}),t("div",{className:"mt-3 grid sm:grid-cols-2 gap-3",children:[e("textarea",{rows:3,className:"w-full border border-gray-200 rounded-lg p-3 text-sm focus:ring-2 focus:outline-none",placeholder:"Ex : code reçu par SMS (ex. 123456) ou n° de transfert",value:V,onChange:a=>je(a.target.value)}),t("label",{className:"border-2 border-dashed rounded-lg h-[104px] grid place-items-center text-sm text-gray-600 cursor-pointer",children:[e("input",{type:"file",className:"hidden",onChange:Re,accept:".png,.jpg,.jpeg,.pdf"}),A?t("span",{className:"flex items-center gap-2 text-gray-800",children:[e(se,{className:"w-4 h-4 text-emerald-600"})," ",A.name]}):t("span",{className:"flex items-center gap-2",children:[e(Ke,{className:"w-4 h-4"})," Capture (PNG, JPG, PDF · 5MB)"]})]})]}),t("div",{className:"mt-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e("div",{className:"text-xs text-amber-600",children:!L&&u&&t("span",{children:["Entrez une référence (≥ 4 caractères) ",e("em",{children:"ou"})," joignez une capture."]})}),e("button",{onClick:ke,disabled:W||!L,title:L?"":"Ajoutez la référence ou une capture",className:"h-11 px-5 rounded-xl font-semibold shadow-sm disabled:opacity-60 disabled:cursor-not-allowed transition hover:brightness-[0.98]",style:{background:`linear-gradient(135deg, ${i.primary}, ${i.secondary})`,color:"#fff"},children:W?"Envoi…":"Confirmer l’envoi"})]})]}),r&&t("div",{className:"text-sm text-gray-600",children:["Statut actuel : ",e("b",{children:r.statut||"—"})," ",r.canal?`• Canal : ${r.canal}`:""]})]});return t("div",{className:"min-h-screen bg-gradient-to-br from-white to-gray-50",children:[ia,r?ma?pa:ua:t("main",{className:"max-w-[1100px] mx-auto px-3 sm:px-4 py-4 space-y-4 sm:space-y-5",children:[ye(),(y==null?void 0:y.nom)&&t("div",{className:"text-xs text-gray-500 px-1",children:["Agence : ",y.nom," — ",y.telephone]}),re&&e("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-800",children:re}),t("section",{className:"bg-white rounded-2xl border border-gray-100 p-4",children:[e("h2",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Choisissez votre date de départ"}),e("div",{className:"flex gap-2 overflow-x-auto scrollbar-none",children:ra.map(a=>t("button",{onClick:()=>{Ae(a),ge("")},className:"h-10 px-3 rounded-xl border text-sm whitespace-nowrap transition",style:{borderColor:_===a?i.primary:"#e5e7eb",color:_===a?"#111827":"#374151",backgroundColor:_===a?i.lightPrimary:"#f9fafb"},children:[e("span",{className:"font-medium",children:Ra(ie(a),"EEE d",{locale:_a})}),Qe(ie(a))&&e("span",{className:"ml-2 text-xs text-gray-500",children:"Aujourd’hui"}),za(ie(a))&&e("span",{className:"ml-2 text-xs text-gray-500",children:"Demain"})]},a))})]}),!!k.length&&t("section",{className:"bg-white rounded-2xl border border-gray-100 p-4",children:[e("h2",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Choisissez votre heure de départ"}),e("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2",children:k.map(a=>e("button",{onClick:()=>ge(a.time),className:"h-11 px-3 rounded-lg border text-sm text-left transition",style:{borderColor:K===a.time?i.secondary:"#e5e7eb",backgroundColor:K===a.time?i.lightSecondary:"#f9fafb"},children:t("div",{className:"flex items-center justify-between",children:[e("span",{className:"font-semibold",children:a.time}),t("span",{className:"text-[11px] px-2 h-5 rounded-md grid place-items-center whitespace-nowrap leading-none",style:{color:fe(a.remainingSeats,a.places),border:`1px solid ${fe(a.remainingSeats,a.places)}`},children:[a.remainingSeats," pl."]})]})},a.id))})]}),o&&t(we,{children:[t("section",{className:"bg-white rounded-2xl border border-gray-100 p-4",children:[e("h2",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Informations personnelles"}),t("p",{className:"text-xs text-gray-500 mb-3",children:["Entrez votre ",e("span",{className:"font-medium",children:"nom complet"})," et votre ",e("span",{className:"font-medium",children:"numéro de téléphone"})," utilisés pour voyager."]}),t("div",{className:"grid sm:grid-cols-2 gap-3",children:[t("div",{className:"relative",children:[e("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e(Sa,{className:"h-5 w-5 text-gray-400"})}),e("input",{className:"h-11 pl-10 pr-3 w-full border border-gray-200 rounded-lg focus:ring-2 focus:outline-none",placeholder:"Nom complet *",value:F.fullName,onChange:a=>De(n=>({...n,fullName:a.target.value}))})]}),t("div",{className:"relative",children:[e("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e(Ca,{className:"h-5 w-5 text-gray-400"})}),e("input",{className:"h-11 pl-10 pr-3 w-full border border-gray-200 rounded-lg focus:ring-2 focus:outline-none",placeholder:"Téléphone *",value:F.phone,onChange:a=>De(n=>({...n,phone:a.target.value}))})]}),t("div",{className:"sm:col-span-2 flex items-center gap-4",children:[e("span",{className:"text-sm text-gray-600",children:"Places"}),e("button",{onClick:()=>$e(a=>Math.max(1,a-1)),className:"w-9 h-9 rounded-full border grid place-items-center hover:bg-gray-50",style:{borderColor:i.lightPrimary,color:i.primary},children:e(Ia,{className:"w-4 h-4"})}),e("span",{className:"px-3 py-1.5 rounded-lg text-sm font-semibold",style:{background:i.lightPrimary,color:i.primary},children:$}),e("button",{onClick:()=>$e(a=>Math.min(Math.min(5,o.remainingSeats),a+1)),className:"w-9 h-9 rounded-full border grid place-items-center hover:bg-gray-50",style:{borderColor:i.lightPrimary,color:i.primary},children:e(Pa,{className:"w-4 h-4"})}),t("span",{className:"text-xs",style:{color:fe(o.remainingSeats,o.places)},children:[o.remainingSeats," pl. dispo"]})]})]})]}),t("section",{className:"bg-white rounded-2xl border border-gray-100 p-4",children:[e("h2",{className:"text-sm font-semibold text-gray-900 mb-2",children:D?"Choisissez le moyen de paiement":"Paiement"}),D?t(we,{children:[e("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2",children:Object.entries(I).map(([a,n])=>n&&t("button",{onClick:()=>_e(a),className:`h-12 px-3 rounded-xl border flex items-center gap-2 text-sm w-full transition ${u===a?"bg-white shadow-sm":"bg-gray-50 hover:bg-gray-100"}`,style:{borderColor:u===a?i.primary:"#e5e7eb"},children:[n.logoUrl?e("img",{src:n.logoUrl,alt:a,className:"h-6 w-6 object-contain rounded"}):e("div",{className:"h-6 w-6 rounded bg-gray-100"}),t("div",{className:"text-left min-w-0",children:[e("div",{className:"font-medium capitalize truncate",children:a.replace(/_/g," ")}),n.merchantNumber&&t("div",{className:"text-[11px] text-gray-500 truncate",children:["N° ",n.merchantNumber]})]}),u===a&&e("div",{className:"ml-auto h-5 w-5 rounded-full flex items-center justify-center",style:{backgroundColor:i.primary,color:"#fff"},children:e(se,{className:"w-3 h-3"})})]},a))}),t("div",{className:"mt-4",children:[e("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Preuve de paiement"}),e("p",{className:"text-xs text-gray-600 mb-3",children:Fe})]}),u&&((qe=I[u])==null?void 0:qe.ussdPattern)&&t("div",{className:"mt-1 text-xs text-gray-600",children:["Code USSD : ",e("span",{className:"font-mono bg-gray-50 px-2 py-1 rounded",children:I[u].ussdPattern.replace("MERCHANT",I[u].merchantNumber||"").replace("AMOUNT",String(o.price*$))})]}),t("div",{className:"mt-3 grid sm:grid-cols-2 gap-3",children:[e("textarea",{rows:3,className:"w-full border border-gray-200 rounded-lg p-3 text-sm focus:ring-2 focus:outline-none",placeholder:"Ex : code reçu par SMS (ex. 123456) ou n° de transfert",value:V,onChange:a=>je(a.target.value)}),t("label",{className:"border-2 border-dashed rounded-lg h-[104px] grid place-items-center text-sm text-gray-600 cursor-pointer",children:[e("input",{type:"file",className:"hidden",onChange:Re,accept:".png,.jpg,.jpeg,.pdf"}),A?t("span",{className:"flex items-center gap-2 text-gray-800",children:[e(se,{className:"w-4 h-4 text-emerald-600"})," ",A.name]}):t("span",{className:"flex items-center gap-2",children:[e(Ke,{className:"w-4 h-4"})," Capture (PNG, JPG, PDF · 5MB)"]})]})]}),t("div",{className:"mt-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e("div",{className:"text-xs text-amber-600",children:!L&&u&&t("span",{children:["Entrez une référence (≥ 4 caractères) ",e("em",{children:"ou"})," joignez une capture."]})}),e("button",{onClick:ke,disabled:W||!L,title:L?"":"Ajoutez la référence ou une capture",className:"h-11 px-5 rounded-xl font-semibold shadow-sm disabled:opacity-60 disabled:cursor-not-allowed transition hover:brightness-[0.98]",style:{background:`linear-gradient(135deg, ${i.primary}, ${i.secondary})`,color:"#fff"},children:W?"Envoi…":"Confirmer l’envoi"})]})]}):t("div",{className:"space-y-3",children:[t("p",{className:"text-sm text-gray-600",children:["Cliquez sur ",e("span",{className:"font-semibold",children:"« Passer au paiement »"})," pour bloquer vos places pendant 15 minutes."]}),e("button",{onClick:ca,disabled:te,className:"w-full h-11 rounded-xl font-semibold shadow-sm disabled:opacity-60 transition hover:brightness-[0.98]",style:{background:`linear-gradient(135deg, ${i.secondary}, ${i.primary})`,color:"#fff"},children:te?"Traitement…":`Passer au paiement (${(o.price*$).toLocaleString("fr-FR")} FCFA)`})]})]})]})]})]})}export{Wa as default};
