import{r as i,j as e}from"./react-BKlva80Y.js";import{q as C,j as v,w as S,k as I,z as D,d as u,m as h,E as k,y as A}from"./firebase-1zyXmG6H.js";import{u as q,d as o}from"../index-BlZmgUmn.js";import"./vendor-CZDa83Cj.js";const T=()=>{const{user:a}=q(),[f,P]=i.useState([]),[s,g]=i.useState({name:"",logoUrl:"",merchantNumber:"",defaultPaymentUrl:"",ussdPattern:""}),[p,b]=i.useState(null),[y,j]=i.useState(!1),[N,l]=i.useState(null);i.useEffect(()=>{(async()=>{if(a!=null&&a.companyId)try{const n=C(v(o,"paymentMethods"),S("companyId","==",a.companyId)),m=(await I(n)).docs.map(d=>({id:d.id,...d.data()}));P(m)}catch(n){console.error("Error fetching payment methods:",n),l("Erreur lors du chargement des méthodes de paiement")}})()},[a==null?void 0:a.companyId]);const c=t=>{const{name:n,value:r}=t.target;g(m=>({...m,[n]:r}))},U=async t=>{if(t.preventDefault(),l(null),!(a!=null&&a.companyId)){l("Aucune compagnie associée");return}const{name:n,logoUrl:r,merchantNumber:m,ussdPattern:d}=s;if(!n||!r||!m||!d){l("Veuillez remplir tous les champs obligatoires");return}j(!0);try{const x={...s,companyId:a.companyId},w=n.toLowerCase().replace(/\s+/g,"_");p?(await h(u(o,"paymentMethods",p),x),s.defaultPaymentUrl&&await h(u(o,"companies",a.companyId),{[`paymentMethods.${w}`]:{url:s.defaultPaymentUrl,logoUrl:r,ussdPattern:d}})):(await A(v(o,"paymentMethods"),x),s.defaultPaymentUrl&&await h(u(o,"companies",a.companyId),{[`paymentMethods.${w}`]:{url:s.defaultPaymentUrl,logoUrl:r,ussdPattern:d}})),g({name:"",logoUrl:"",merchantNumber:"",defaultPaymentUrl:"",ussdPattern:""}),b(null),window.location.reload()}catch(x){console.error("Error saving payment method:",x),l("Erreur lors de la sauvegarde")}finally{j(!1)}},M=t=>{b(t.id||null),g({name:t.name,logoUrl:t.logoUrl,merchantNumber:t.merchantNumber,defaultPaymentUrl:t.defaultPaymentUrl||"",ussdPattern:t.ussdPattern||""})},E=async t=>{if(!(!t.id||!(a!=null&&a.companyId)||!window.confirm(`Supprimer la méthode ${t.name} ?`)))try{await D(u(o,"paymentMethods",t.id));const r=t.name.toLowerCase().replace(/\s+/g,"_");await h(u(o,"companies",a.companyId),{[`paymentMethods.${r}`]:k()}),window.location.reload()}catch(r){console.error("Error deleting payment method:",r),l("Erreur lors de la suppression")}};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"⚙️ Gestion des Moyens de Paiement"}),N&&e.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",children:e.jsx("p",{children:N})}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Méthodes configurées"}),f.length===0?e.jsx("p",{className:"text-gray-500 italic",children:"Aucune méthode de paiement configurée"}):e.jsx("ul",{className:"divide-y divide-gray-200",children:f.map(t=>e.jsx("li",{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:t.logoUrl,alt:t.name,className:"w-12 h-12 object-contain rounded"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["N° Marchand: ",t.merchantNumber]}),t.ussdPattern&&e.jsxs("p",{className:"text-xs text-green-600 truncate max-w-xs",children:["USSD: ",t.ussdPattern]}),t.defaultPaymentUrl&&e.jsxs("p",{className:"text-xs text-blue-500 truncate max-w-xs",children:["URL: ",t.defaultPaymentUrl]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>M(t),className:"px-3 py-1 text-sm bg-blue-50 text-blue-700 rounded hover:bg-blue-100 transition",children:"Modifier"}),e.jsx("button",{onClick:()=>E(t),className:"px-3 py-1 text-sm bg-red-50 text-red-700 rounded hover:bg-red-100 transition",children:"Supprimer"})]})]})},t.id))})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:p?"Modifier une méthode":"Ajouter une nouvelle méthode"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom de la méthode *"}),e.jsx("input",{type:"text",name:"name",value:s.name,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: Orange Money",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL du logo *"}),e.jsx("input",{type:"url",name:"logoUrl",value:s.logoUrl,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"https://example.com/logo.png",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Numéro de marchand *"}),e.jsx("input",{type:"text",name:"merchantNumber",value:s.merchantNumber,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: 770123456",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Code USSD (avec MERCHANT et AMOUNT) *"}),e.jsx("input",{type:"text",name:"ussdPattern",value:s.ussdPattern||"",onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"Ex: *144*8*MERCHANT*AMOUNT#",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL de paiement par défaut (optionnel)"}),e.jsx("input",{type:"url",name:"defaultPaymentUrl",value:s.defaultPaymentUrl,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",placeholder:"https://payment.example.com/pay"})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",disabled:y,className:`w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${y?"bg-gray-400":"bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}`,children:y?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"En cours..."]}):p?"Mettre à jour":"Enregistrer"})})]})]})]})};export{T as default};
