import{u as q,r,d as A,a as s,j as e}from"./react-DgrrIcw2.js";import{q as L,w as R,k,m as P}from"./firebase-eGIzIftJ.js";import{u as $,d as D}from"../index-p6Te0bSg.js";import{J as C}from"./vendor-BHjJ2Hjk.js";const x=15,O=()=>{const{user:a,company:n}=$(),b=q(),[y,S]=r.useState([]),[c,T]=r.useState(""),[i,U]=r.useState(""),[d,H]=r.useState(""),[h,G]=r.useState(""),[u,_]=r.useState(1),[J,E]=r.useState(null),[j,F]=r.useState(!0),{id:N}=A();r.useEffect(()=>{if(!(a!=null&&a.companyId))return;const t=N||(a==null?void 0:a.agencyId);if(!t)return;const o=L(k(D,"companies",a.companyId,"agences",t,"reservations"),R("statut","==","payé")),l=P(o,p=>{const f=p.docs.map(w=>({id:w.id,...w.data()}));S(f),F(!1)});return()=>l()},[a==null?void 0:a.companyId,a==null?void 0:a.agencyId,N]);const g=r.useMemo(()=>y.filter(t=>{const o=c?t.date===c:!0,l=i?t.heure===i:!0,p=d?`${t.depart.toLowerCase()}-${t.arrivee.toLowerCase()}`.includes(d.toLowerCase()):!0,f=h?t.canal===h:!0;return o&&l&&p&&f}),[y,c,i,d,h]),v=r.useMemo(()=>{const t=(u-1)*x;return g.slice(t,t+x)},[g,u]),I=()=>{b("impression-reservations",{state:{reservations:g,date:c,heure:i,trajet:d,agencyName:a==null?void 0:a.agencyName,logoUrl:n==null?void 0:n.logoUrl,companyName:n==null?void 0:n.nom}})},M=C(new Date,"dd/MM/yyyy"),m={primary:(n==null?void 0:n.couleurPrimaire)||"#06b6d4",secondary:(n==null?void 0:n.couleurSecondaire)||"#8b5cf6"};return s("div",{className:"min-h-screen bg-gray-50 p-6 text-gray-800",children:[e("div",{className:"mb-8 p-6 rounded-xl bg-white shadow-md border border-gray-200",children:s("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[s("div",{className:"flex items-center gap-4",children:[(n==null?void 0:n.logoUrl)&&e("img",{src:n.logoUrl,alt:"logo",className:"h-12 w-12 rounded-full object-contain"}),s("div",{children:[e("h1",{className:"text-3xl font-bold",style:{color:m.primary},children:(n==null?void 0:n.nom)||"Compagnie de Transport"}),s("p",{className:"text-sm text-gray-500",children:[a==null?void 0:a.agencyName," • ",M]})]})]}),e("button",{onClick:I,className:"mt-4 md:mt-0 px-6 py-2 text-white font-semibold rounded-lg shadow-md hover:opacity-90 transition-all",style:{background:`linear-gradient(to right, ${m.primary}, ${m.secondary})`},children:"🖨️ Imprimer la liste"})]})}),e("div",{className:"rounded-xl bg-white shadow-md border border-gray-200 overflow-hidden",children:e("div",{className:"overflow-x-auto",children:s("table",{className:"w-full text-sm",children:[e("thead",{children:s("tr",{style:{backgroundColor:m.secondary,color:"#fff"},children:[e("th",{className:"p-4 text-left font-semibold",children:"#"}),e("th",{className:"p-4 text-left font-semibold",children:"Client"}),e("th",{className:"p-4 text-left font-semibold",children:"Contact"}),e("th",{className:"p-4 text-left font-semibold",children:"Trajet"}),e("th",{className:"p-4 text-left font-semibold",children:"Date"}),e("th",{className:"p-4 text-left font-semibold",children:"Heure"}),e("th",{className:"p-4 text-left font-semibold",children:"Canal"}),e("th",{className:"p-4 text-left font-semibold",children:"Statut Embarquement"}),e("th",{className:"p-4 text-right font-semibold",children:"Montant"}),e("th",{className:"p-4 text-center font-semibold",children:"Actions"})]})}),e("tbody",{children:j?e("tr",{children:e("td",{colSpan:10,className:"p-8 text-center",children:"Chargement..."})}):v.length===0?e("tr",{children:e("td",{colSpan:10,className:"p-8 text-center text-gray-400",children:"Aucune réservation trouvée"})}):v.map((t,o)=>{var l;return s("tr",{className:"border-t border-gray-200 hover:bg-gray-50 transition",children:[e("td",{className:"p-4",children:(u-1)*x+o+1}),e("td",{className:"p-4",children:t.nomClient}),e("td",{className:"p-4 text-cyan-600",children:t.telephone}),s("td",{className:"p-4",children:[t.depart," → ",t.arrivee]}),e("td",{className:"p-4",children:C(new Date(t.date),"dd/MM/yyyy")}),e("td",{className:"p-4",children:t.heure}),e("td",{className:"p-4",children:t.canal==="guichet"?e("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Guichet"}):e("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"En ligne"})}),e("td",{className:"p-4",children:e("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.statutEmbarquement==="embarqué"?"bg-green-100 text-green-700":t.statutEmbarquement==="absent"?"bg-red-100 text-red-700":t.statutEmbarquement==="reporté"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-500"}`,children:t.statutEmbarquement||"En attente"})}),s("td",{className:"p-4 text-right",children:[(l=t.montant)==null?void 0:l.toLocaleString()," FCFA"]}),s("td",{className:"p-4 text-center flex justify-center gap-2",children:[e("button",{onClick:()=>b(`/agence/receipt/${t.id}`),className:"text-green-600 hover:text-green-500 font-medium",children:"Voir"}),e("button",{onClick:()=>E(t),className:"text-cyan-600 hover:text-cyan-500 font-medium",children:"Modifier"})]})]},t.id)})})]})})})]})};export{O as default};
