import{b as z,u as R,a as P,r,j as e,C as U,M as $,U as D,T as E,A as T,p as L,aQ as S,ax as A,aR as M,a1 as F}from"./react-PtMwKKf1.js";import{d as q,f as H}from"./firebase-eGIzIftJ.js";import{s as j,h as p,d as I}from"../index-C4y8wfzK.js";import{h as O}from"./html2pdf-BR7FolKG.js";import{J as B,p as G,a5 as J}from"./vendor-B5FTF_2c.js";import"./jspdf.es.min-C1yNX6Vr.js";import"./html2canvas-DMqt7zzs.js";const ee=()=>{var f;const{id:c,slug:h}=z(),u=R(),g=P(),{companyInfo:b,reservation:y}=g.state||{},[s,N]=r.useState(y||null),[a,Q]=r.useState(b||null),i=r.useRef(null),t=(a==null?void 0:a.couleurPrimaire)||"#3b82f6",l=(a==null?void 0:a.couleurSecondaire)||"#f97316",d=j(t),v=s!=null&&s.date?B(G(s.date),"dd/MM/yyyy",{locale:J}):"",m=r.useCallback(()=>{if(!s)return"BIL-000000";const n=s.depart.slice(0,3).toUpperCase(),x=s.arrivee.slice(0,3).toUpperCase(),o=(s.agenceNom||"ONL").slice(0,3).toUpperCase(),k=s.id.substring(s.id.length-6).toUpperCase();return`${o}-${n}${x}-${k}`},[s]);r.useEffect(()=>{(async()=>{if(!s&&c){const x=q(I,"reservations",c),o=await H(x);o.exists()&&N({...o.data(),id:o.id})}})()},[c,s]);const C=r.useCallback(()=>{if(i.current){const n={margin:2,filename:`recu-${m()}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:[81,200],orientation:"portrait"}};O().set(n).from(i.current).save()}},[m]);if(!s||!a)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("p",{className:"text-gray-600",children:"Chargement du reçu..."})});const w=`${window.location.origin}/compagnie/${h}/receipt/${s.id}`;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"sticky top-0 z-20 px-4 py-2 shadow-sm",style:{backgroundColor:t,color:d},children:e.jsxs("div",{className:"flex items-center justify-between max-w-md mx-auto",children:[e.jsx("button",{onClick:()=>u(-1),className:"p-2 rounded-full",children:e.jsx(U,{size:22})}),e.jsx("h1",{className:"font-bold text-lg",children:"Reçu de réservation"}),a.logoUrl&&e.jsx("img",{src:a.logoUrl,alt:"Logo",className:"h-8 w-8 rounded-full object-cover border",style:{borderColor:d}})]})}),e.jsx("main",{className:"max-w-md mx-auto px-4 py-6",children:e.jsxs("div",{ref:i,className:"bg-white rounded-lg shadow-sm border p-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 mb-2",style:{borderColor:p(t,.3)},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.logoUrl&&e.jsx("img",{src:a.logoUrl,alt:a.name,className:"h-8 w-8 object-contain rounded border",style:{borderColor:t}}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-sm",children:a.name}),e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx($,{size:12})," ",s.agenceNom||"Agence Principale"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs font-mono",children:["N° ",m()]}),e.jsx("span",{className:"px-1 py-0.5 rounded text-[10px] font-medium",style:{backgroundColor:p(t,.15),color:t},children:((f=s.statut)==null?void 0:f.toUpperCase())||"EN ATTENTE"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-1",style:{color:t},children:[e.jsx(D,{size:14,style:{color:l}})," Client"]}),e.jsxs("div",{className:"flex justify-between text-xs text-black",children:[e.jsxs("p",{children:["Nom : ",s.nomClient]}),e.jsxs("p",{children:["Téléphone : ",s.telephone]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-1",style:{color:t},children:[e.jsx(E,{size:14,style:{color:l}})," Voyage"]}),e.jsxs("p",{className:"text-sm font-medium flex items-center gap-1 text-black",children:[s.depart,e.jsx(T,{size:14,style:{color:t}}),s.arrivee]}),e.jsxs("div",{className:"flex justify-between text-xs text-black",children:[e.jsxs("p",{children:["Date : ",v]}),e.jsxs("p",{children:["Heure : ",s.heure]})]}),e.jsxs("div",{className:"flex justify-between text-xs text-black",children:[e.jsxs("p",{children:["Places réservées : ",s.seatsGo]}),e.jsxs("p",{children:["Canal : ",s.canal||"en ligne"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-1",style:{color:t},children:[e.jsx(L,{size:14,style:{color:l}})," Paiement"]}),e.jsxs("div",{className:"flex justify-between items-center text-black",children:[e.jsxs("p",{className:"font-bold text-lg",style:{color:t},children:[s.montant.toLocaleString()," FCFA"]}),e.jsxs("p",{className:"text-xs",children:["Méthode : ",s.canal==="guichet"?"Espèces":"En ligne"]})]})]}),e.jsxs("div",{className:"text-center border-t pt-3",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",style:{color:t},children:"Code d'embarquement"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(S,{value:w,size:80,fgColor:t})})]}),e.jsxs("div",{className:"mt-3 text-center text-xs text-gray-600",children:[e.jsxs("p",{children:["Merci d'avoir choisi ",a.name," — Bon voyage !"]}),e.jsx("p",{className:"italic",children:"Présentez-vous 1H avant le départ"}),e.jsxs("p",{className:"mt-1",children:["Pour plus d'infos, contactez :",e.jsx("a",{href:`tel:${s.telephone}`,className:"text-blue-600 underline ml-1",children:s.telephone})]})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t py-3 px-4 grid grid-cols-3 gap-2",style:{borderColor:p(t,.3)},children:[e.jsxs("button",{onClick:C,className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1",style:{backgroundColor:t,color:d},children:[e.jsx(A,{size:16})," Télécharger"]}),e.jsxs("button",{onClick:()=>window.print(),className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1",style:{backgroundColor:l,color:j(l)},children:[e.jsx(M,{size:16})," Imprimer"]}),e.jsxs("button",{onClick:()=>u(`/${h}`),className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1 bg-gray-200 text-gray-800",children:[e.jsx(F,{size:16})," Retour"]})]})]})};export{ee as default};
