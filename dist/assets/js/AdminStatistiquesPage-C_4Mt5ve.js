import{r,f as k,j as e,a as n,v as f,as as B,C as v,X as x,Y as y,T as S,L as C,at as T,au as G,av as I}from"./vendor-Bq-8_m9i.js";import{u as N,M as X,t as Y}from"./firebase-CURBI7X6.js";import{m as F,P as $,w as z,G as H,O as d,d as A}from"./agence-Bsj2lp2X.js";import{A as J}from"./icons-C0JHUK9Z.js";import"./compagnie-DiuZFnHS.js";import"./router-DoGdw-3y.js";import"./courier-CoQgRaHG.js";const te=()=>{const i=F(),[o,l]=r.useState([]),[u,D]=r.useState([]),[w,h]=r.useState(!0),[g,b]=r.useState(null),[q,E]=r.useState(0);r.useEffect(()=>{(async()=>{h(!0),b(null);try{const s=(await N(X(A,"reservations"))).docs.map(m=>m.data()),j=(await N(Y(A,"companies"))).docs.map(m=>m.data());l(s),D(j)}catch(t){console.error("AdminStatistiquesPage error:",t),b(i?"Erreur lors du chargement des statistiques.":"Connexion indisponible. Impossible de charger les statistiques.")}finally{h(!1)}})()},[i,q]);const L=o.length,M=r.useMemo(()=>o.reduce((a,t)=>a+(t.total||0),0),[o]),P=r.useMemo(()=>u.filter(a=>a.status==="actif").length,[u]),K=r.useMemo(()=>{const a={};return o.forEach(t=>{if(!t.createdAt)return;const s=t.createdAt.toDate(),c=k(s,"yyyy-MM");a[c]=(a[c]||0)+(t.total||0)}),Object.entries(a).map(([t,s])=>({month:t,total:s})).sort((t,s)=>t.month.localeCompare(s.month))},[o]),O=r.useMemo(()=>{const a={};return o.forEach(t=>{const s=t.companyName||"Inconnue";a[s]=(a[s]||0)+(t.total||0)}),Object.entries(a).map(([t,s])=>({name:t,total:s})).sort((t,s)=>s.total-t.total).slice(0,5)},[o]);return w?e($,{}):n("div",{className:"p-6",children:[!i&&e("div",{className:"mb-4",children:e(z,{message:"Connexion instable: les statistiques peuvent être incomplètes."})}),g&&e("div",{className:"mb-4",children:e(H,{message:g,onRetry:()=>E(a=>a+1)})}),n("div",{className:"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-start gap-3",children:[e(J,{className:"h-6 w-6 text-amber-600 shrink-0 mt-0.5"}),n("div",{children:[e("p",{className:"font-semibold text-amber-800",children:"Page dépréciée"}),e("p",{className:"text-sm text-amber-700 mt-1",children:"Cette page mélange métriques SaaS et opérationnelles par compagnie. Les indicateurs plateforme (anonymisés) sont disponibles sur le tableau de bord admin."})]})]}),e("h1",{className:"text-2xl font-bold mb-6",children:"Statistiques générales"}),n("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 mb-10",children:[e(p,{label:"Réservations",value:L,color:"text-blue-600"}),e(p,{label:"Revenus totaux",value:d(M),color:"text-green-600"}),e(p,{label:"Compagnies actives",value:P,color:"text-indigo-600"})]}),e(R,{title:"Évolution des revenus par mois",children:e(f,{width:"100%",height:300,children:n(B,{data:K,children:[e(v,{strokeDasharray:"3 3"}),e(x,{dataKey:"month"}),e(y,{}),e(S,{formatter:a=>[d(a),"Revenus"]}),e(C,{}),e(T,{type:"monotone",dataKey:"total",stroke:"#10B981",name:"Revenus"})]})})}),e(R,{title:"Top 5 compagnies par revenus",children:e(f,{width:"100%",height:300,children:n(G,{data:O,children:[e(v,{strokeDasharray:"3 3"}),e(x,{dataKey:"name"}),e(y,{}),e(S,{formatter:a=>[d(a),"CA total"]}),e(C,{}),e(I,{dataKey:"total",fill:"#6366F1",name:"CA total"})]})})})]})},p=({label:i,value:o,color:l})=>n("div",{className:"bg-white rounded-xl border shadow-sm p-4 text-center",children:[e("h2",{className:"text-lg font-semibold",children:i}),e("p",{className:`text-2xl font-bold ${l}`,children:o})]}),R=({title:i,children:o})=>n("div",{className:"mb-10",children:[e("h2",{className:"text-lg font-semibold mb-2",children:i}),o]});export{te as default};
