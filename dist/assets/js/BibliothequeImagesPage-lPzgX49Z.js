import{j as n,r as p}from"./react-Bg_vEni-.js";import{e as I,f as y,q as f,w,h as N,p as U,d as v}from"./firebase-C3aZpI0W.js";import{u as b,d as x}from"../index-Dgt8Lr4V.js";import{a7 as D}from"./vendor-D_4iK-Jm.js";const a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));function q(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}let g;const C=new Uint8Array(16);function S(){if(!g){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");g=crypto.getRandomValues.bind(crypto)}return g(C)}const E=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),h={randomUUID:E};function R(e,t,d){var c;if(h.randomUUID&&!e)return h.randomUUID();e=e||{};const o=e.random??((c=e.rng)==null?void 0:c.call(e))??S();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,q(o)}const V=({label:e,onUpload:t,dossier:d})=>{const{user:o}=b(),c=async r=>{var m;const l=(m=r.target.files)==null?void 0:m[0];if(!l||!(o!=null&&o.companyId))return;const s=new FormData;s.append("file",l),s.append("upload_preset","ml_default"),s.append("public_id",`${d}/${R()}`);try{const i=(await D.post("https://api.cloudinary.com/v1_1/dj697honl/image/upload",s)).data.secure_url,j=prompt("Nom de l'image (ex: logo, bannière, etc.)")||"image";await I(y(x,"imagesBibliotheque"),{companyId:o.companyId,url:i,type:"libre",nom:j,createdAt:new Date}),t&&t(i),alert("Image ajoutée avec succès.")}catch(u){console.error("Erreur lors du téléversement sur Cloudinary :",u),alert("Échec de l'upload. Vérifie ta connexion et ton VPN.")}};return n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"font-semibold block mb-1",children:e}),n.jsx("input",{type:"file",accept:"image/*",onChange:c})]})},k=()=>{const{user:e}=b(),[t,d]=p.useState([]),[o,c]=p.useState(!1),r=async()=>{if(!(e!=null&&e.companyId))return;c(!0);const s=f(y(x,"imagesBibliotheque"),w("companyId","==",e.companyId)),u=(await N(s)).docs.map(i=>({id:i.id,...i.data()}));d(u),c(!1)};p.useEffect(()=>{r()},[e==null?void 0:e.companyId]);const l=async s=>{window.confirm("Supprimer cette image ?")&&(await U(v(x,"imagesBibliotheque",s)),r())};return n.jsxs("div",{className:"p-6 max-w-5xl mx-auto",children:[n.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Bibliothèque d'images"}),n.jsx(V,{label:"Ajouter une image",dossier:`compagnies/${e==null?void 0:e.companyId}`,onUpload:()=>r()}),n.jsx("hr",{className:"my-6"}),n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Images enregistrées"}),o?n.jsx("p",{children:"Chargement..."}):t.length===0?n.jsx("p",{className:"text-gray-500",children:"Aucune image enregistrée pour cette compagnie."}):n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(s=>n.jsxs("div",{className:"border rounded p-2 shadow-sm",children:[n.jsx("img",{src:s.url,alt:s.nom,className:"w-full h-40 object-cover rounded mb-2"}),n.jsx("p",{className:"text-sm font-semibold truncate",children:s.nom}),n.jsx("p",{className:"text-xs text-gray-500",children:s.type}),n.jsx("button",{onClick:()=>l(s.id),className:"text-red-500 text-xs mt-2 hover:underline",children:"Supprimer"})]},s.id))})]})};export{k as default};
