import{r as o,a as t,j as e}from"./vendor-Bq-8_m9i.js";import{r as E,t as L,I as U,u as q}from"./firebase-CURBI7X6.js";import{B as O,O as r,l as u,d as _}from"./agence-Bsj2lp2X.js";import{t as n,C as c,u as $,S as z,q as x,s as g}from"./compagnie-DiuZFnHS.js";import{ad as H,be as I,ae as V,a9 as J,R as K,az as M,aw as Q}from"./icons-C0JHUK9Z.js";import"./router-DoGdw-3y.js";import"./courier-CoQgRaHG.js";function se(){const[m,B]=o.useState([]),[s,G]=o.useState({totalRevenue:0,totalFees:0,totalPayments:0,companiesCount:0,activeCount:0,trialCount:0,graceCount:0,restrictedCount:0,suspendedCount:0}),[f,N]=o.useState(!0),y=async()=>{N(!0);try{const a=E(L(_,"companies"),U("nom","asc")),l=await q(a),h=[];let C=0,w=0,F=0,R=0,S=0,D=0,P=0,j=0;l.docs.forEach(p=>{const i=p.data(),T=Number(i.totalDigitalRevenueGenerated)||0,k=Number(i.totalDigitalFeesCollected)||0,A=Number(i.totalPaymentsReceived)||0,d=i.subscriptionStatus||"active";C+=T,w+=k,F+=A,d==="active"?R++:d==="trial"?S++:d==="grace"?D++:d==="restricted"?P++:d==="suspended"&&j++,h.push({id:p.id,nom:i.nom||p.id,plan:i.plan||"—",subscriptionStatus:d,digitalFeePercent:Number(i.digitalFeePercent)||0,totalDigitalRevenueGenerated:T,totalDigitalFeesCollected:k,totalPaymentsReceived:A})}),B(h),G({totalRevenue:C,totalFees:w,totalPayments:F,companiesCount:h.length,activeCount:R,trialCount:S,graceCount:D,restrictedCount:P,suspendedCount:j})}finally{N(!1)}};o.useEffect(()=>{y()},[]);const v=[...m].sort((a,l)=>l.totalDigitalRevenueGenerated-a.totalDigitalRevenueGenerated).slice(0,5),b=[...m].sort((a,l)=>l.totalDigitalFeesCollected-a.totalDigitalFeesCollected).slice(0,5);return t("div",{className:"space-y-6",children:[t("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[t("div",{children:[e("h1",{className:"text-2xl font-bold text-gray-900",children:"Revenus Teliya"}),e("p",{className:"text-sm text-gray-500 mt-1",children:"Vue consolidée des revenus de la plateforme"})]}),t(O,{variant:"secondary",onClick:y,disabled:f,children:[e(K,{className:`h-4 w-4 mr-2 ${f?"animate-spin":""}`}),"Actualiser"]})]}),t("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e(c,{children:e(n,{className:"p-5",children:t("div",{className:"flex items-center justify-between",children:[t("div",{children:[e("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Revenus digitaux"}),e("p",{className:"text-2xl font-bold mt-1",children:r(s.totalRevenue)}),t("p",{className:"text-xs text-gray-400",children:[u()," (toutes compagnies)"]})]}),e("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e(H,{className:"h-5 w-5 text-blue-600"})})]})})}),e(c,{children:e(n,{className:"p-5",children:t("div",{className:"flex items-center justify-between",children:[t("div",{children:[e("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Frais Teliya collectés"}),e("p",{className:"text-2xl font-bold mt-1 text-[var(--btn-primary,#FF6600)]",children:r(s.totalFees)}),t("p",{className:"text-xs text-gray-400",children:[u()," (revenus plateforme)"]})]}),e("div",{className:"w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center",children:e(I,{className:"h-5 w-5 text-orange-600"})})]})})}),e(c,{children:e(n,{className:"p-5",children:t("div",{className:"flex items-center justify-between",children:[t("div",{children:[e("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Paiements abonnements"}),e("p",{className:"text-2xl font-bold mt-1 text-green-600",children:r(s.totalPayments)}),t("p",{className:"text-xs text-gray-400",children:[u()," (mensualités)"]})]}),e("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e(V,{className:"h-5 w-5 text-green-600"})})]})})}),e(c,{children:e(n,{className:"p-5",children:t("div",{className:"flex items-center justify-between",children:[t("div",{children:[e("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Compagnies"}),e("p",{className:"text-2xl font-bold mt-1",children:s.companiesCount}),t("div",{className:"flex flex-wrap gap-1.5 mt-1",children:[t("span",{className:"text-xs text-green-600",children:[s.activeCount," actives"]}),s.trialCount>0&&t("span",{className:"text-xs text-blue-600",children:[s.trialCount," essai"]}),s.graceCount>0&&t("span",{className:"text-xs text-amber-600",children:[s.graceCount," grâce"]}),s.restrictedCount>0&&t("span",{className:"text-xs text-red-600",children:[s.restrictedCount," restreintes"]})]})]}),e("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center",children:e(J,{className:"h-5 w-5 text-gray-600"})})]})})})]}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t(c,{children:[e(g,{children:t(x,{className:"flex items-center gap-2 text-base",children:[e(M,{className:"h-4 w-4 text-blue-600"}),"Top 5 — Revenus digitaux"]})}),e(n,{children:v.length===0?e("p",{className:"text-sm text-gray-500",children:"Aucune donnée"}):e("div",{className:"space-y-3",children:v.map((a,l)=>t("div",{className:"flex items-center gap-3",children:[e("span",{className:"w-6 h-6 rounded-full bg-blue-100 text-blue-700 text-xs font-bold flex items-center justify-center shrink-0",children:l+1}),t("div",{className:"flex-1 min-w-0",children:[e("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.nom}),t("p",{className:"text-xs text-gray-500",children:[a.plan," — ",a.digitalFeePercent,"%"]})]}),e("span",{className:"text-sm font-bold text-gray-900 shrink-0",children:r(a.totalDigitalRevenueGenerated)})]},a.id))})})]}),t(c,{children:[e(g,{children:t(x,{className:"flex items-center gap-2 text-base",children:[e(Q,{className:"h-4 w-4 text-orange-600"}),"Top 5 — Frais Teliya collectés"]})}),e(n,{children:b.length===0?e("p",{className:"text-sm text-gray-500",children:"Aucune donnée"}):e("div",{className:"space-y-3",children:b.map((a,l)=>t("div",{className:"flex items-center gap-3",children:[e("span",{className:"w-6 h-6 rounded-full bg-orange-100 text-orange-700 text-xs font-bold flex items-center justify-center shrink-0",children:l+1}),t("div",{className:"flex-1 min-w-0",children:[e("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.nom}),t("p",{className:"text-xs text-gray-500",children:[a.plan," — ",a.digitalFeePercent,"%"]})]}),e("span",{className:"text-sm font-bold text-[var(--btn-primary,#FF6600)] shrink-0",children:r(a.totalDigitalFeesCollected)})]},a.id))})})]})]}),t(c,{children:[e(g,{children:e(x,{children:"Détail par compagnie"})}),e(n,{children:e("div",{className:"overflow-x-auto",children:t("table",{className:"w-full text-sm",children:[e("thead",{children:t("tr",{className:"border-b text-left text-gray-500",children:[e("th",{className:"py-2 pr-4 font-medium",children:"Compagnie"}),e("th",{className:"py-2 pr-4 font-medium",children:"Plan"}),e("th",{className:"py-2 pr-4 font-medium",children:"Statut"}),e("th",{className:"py-2 pr-4 font-medium text-right",children:"Frais %"}),e("th",{className:"py-2 pr-4 font-medium text-right",children:"Rev. digital"}),e("th",{className:"py-2 pr-4 font-medium text-right",children:"Frais collectés"}),e("th",{className:"py-2 font-medium text-right",children:"Paiements"})]})}),e("tbody",{children:m.map(a=>{const l=$[a.subscriptionStatus]??"";return t("tr",{className:"border-b border-gray-50 hover:bg-gray-50",children:[e("td",{className:"py-2.5 pr-4 font-medium text-gray-900",children:a.nom}),e("td",{className:"py-2.5 pr-4 text-gray-600",children:a.plan}),e("td",{className:"py-2.5 pr-4",children:e("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ${l}`,children:z[a.subscriptionStatus]})}),t("td",{className:"py-2.5 pr-4 text-right text-[var(--btn-primary,#FF6600)] font-medium",children:[a.digitalFeePercent,"%"]}),e("td",{className:"py-2.5 pr-4 text-right",children:r(a.totalDigitalRevenueGenerated)}),e("td",{className:"py-2.5 pr-4 text-right font-medium text-[var(--btn-primary,#FF6600)]",children:r(a.totalDigitalFeesCollected)}),e("td",{className:"py-2.5 text-right font-medium text-green-600",children:r(a.totalPaymentsReceived)})]},a.id)})})]})})})]})]})}export{se as default};
