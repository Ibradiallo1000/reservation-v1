import{r as l,j as e}from"./react-PtMwKKf1.js";import{q as j,k as y,w as N,l as w,B as v,d as I}from"./firebase-eGIzIftJ.js";import{u as A,d as x}from"../index-B745l0NT.js";import{U as E}from"./UploadImageCloudinary-CNifrssA.js";import"./vendor-B5FTF_2c.js";import"./v4-C6aID195.js";const C=()=>{const{user:a}=A(),[n,h]=l.useState([]),[g,c]=l.useState(!1),[i,m]=l.useState(null),o=async()=>{if(a!=null&&a.companyId){c(!0),m(null);try{const s=j(y(x,"imagesBibliotheque"),N("companyId","==",a.companyId)),t=(await w(s)).docs.map(r=>{var d;return{id:r.id,...r.data(),createdAt:(d=r.data().createdAt)==null?void 0:d.toDate()}});t.sort((r,d)=>{var u,p;return(((u=d.createdAt)==null?void 0:u.getTime())||0)-(((p=r.createdAt)==null?void 0:p.getTime())||0)}),h(t)}catch(s){console.error("Erreur de chargement:",s),m("Erreur lors du chargement des images")}finally{c(!1)}}};l.useEffect(()=>{a!=null&&a.companyId&&o()},[a==null?void 0:a.companyId]);const b=async s=>{if(!(!s.id||s.companyId!==(a==null?void 0:a.companyId)||!window.confirm(`Supprimer l'image "${s.nom}" ?`)))try{await v(I(x,"imagesBibliotheque",s.id)),o()}catch(t){console.error("Erreur de suppression:",t),alert("Erreur lors de la suppression")}};return e.jsxs("div",{className:"p-6 max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Bibliothèque d'images"}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsx(E,{label:"Ajouter une image",dossier:`compagnies/${a==null?void 0:a.companyId}`,onUpload:()=>o(),className:"w-full"})}),e.jsx("hr",{className:"my-6 border-gray-200"}),e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Images enregistrées"}),i&&e.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4",children:e.jsx("p",{children:i})}),g?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):n.length===0?e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg text-blue-800",children:e.jsx("p",{children:"Aucune image enregistrée pour cette compagnie."})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:n.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow duration-200 bg-white",children:[e.jsx("div",{className:"relative pb-2/3 h-40 mb-2",children:e.jsx("img",{src:s.url,alt:s.nom,className:"absolute h-full w-full object-cover rounded-md",loading:"lazy"})}),e.jsxs("div",{className:"mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 truncate",children:s.nom}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-500",children:s.type}),s.usage&&e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full",children:s.usage})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[s.createdAt&&e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("button",{onClick:()=>b(s),className:"text-red-600 hover:text-red-800 hover:underline","aria-label":"Supprimer",children:"Supprimer"})]})]},s.id))})]})};export{C as default};
