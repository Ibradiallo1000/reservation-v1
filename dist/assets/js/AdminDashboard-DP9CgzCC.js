import{r as i,a as t,j as a,D as b}from"./react-DgrrIcw2.js";import{l as N,k as C,v as F}from"./firebase-eGIzIftJ.js";import{d as y}from"../index-p6Te0bSg.js";import"./vendor-BHjJ2Hjk.js";const T=()=>{const[r,f]=i.useState([]),[m,v]=i.useState({total:0,reservations:0,commission:0,compagnies:0});return i.useEffect(()=>{(async()=>{try{const p=(await N(C(y,"companies"))).docs.map(e=>({id:e.id,nom:e.data().nom||"Compagnie",slug:e.data().slug||"—",plan:e.data().plan||"free",status:e.data().status||"actif"})),S=await N(F(y,"reservations"));let g=0,h=0,x=0;const l={};for(const e of S.docs){const s=e.data(),n=s.companyId||"inconnu",c=s.total||s.montant||0,u=s.commission||0;l[n]||(l[n]={companyId:n,companySlug:s.companySlug||"—",companyName:s.companyName||"Compagnie",plan:s.plan||"free",total:0,count:0,commission:0}),l[n].total+=c,l[n].commission+=u,l[n].count+=1,g+=c,x+=u,h++}const w=p.map(e=>{var s,n,c;return{companyId:e.id,companySlug:e.slug,companyName:e.nom,plan:e.plan,total:((s=l[e.id])==null?void 0:s.total)||0,count:((n=l[e.id])==null?void 0:n.count)||0,commission:((c=l[e.id])==null?void 0:c.commission)||0}});f(w),v({total:g,reservations:h,commission:x,compagnies:p.length})}catch(d){console.error("Erreur lors du chargement des stats:",d)}})()},[]),t("div",{className:"p-6",children:[a("h1",{className:"text-2xl font-bold mb-2",children:"Tableau de bord – Administration plateforme"}),a("p",{className:"text-gray-600 mb-6",children:"Suivi global des compagnies, abonnements et revenus."}),t("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[t("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[a("h2",{className:"text-sm text-gray-500",children:"Total compagnies"}),a("p",{className:"text-xl font-bold text-purple-600",children:m.compagnies})]}),t("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[a("h2",{className:"text-sm text-gray-500",children:"Total réservations"}),a("p",{className:"text-xl font-bold text-blue-600",children:m.reservations})]}),t("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[a("h2",{className:"text-sm text-gray-500",children:"Montant encaissé"}),t("p",{className:"text-xl font-bold text-green-600",children:[m.total.toLocaleString()," FCFA"]})]}),t("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[a("h2",{className:"text-sm text-gray-500",children:"Commission générée"}),t("p",{className:"text-xl font-bold text-orange-600",children:[m.commission.toLocaleString()," FCFA"]})]})]}),a("h2",{className:"text-lg font-semibold mb-4",children:"Compagnies"}),a("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:r.length===0?a("p",{className:"text-gray-500 italic",children:"Aucune donnée disponible"}):r.map(o=>t("div",{className:"p-4 border rounded-lg shadow-sm bg-white",children:[a("h3",{className:"text-lg font-bold text-orange-600 mb-1",children:o.companyName}),t("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:["Plan : ",o.plan]}),t("p",{className:"text-sm mt-2 text-gray-700",children:["Réservations : ",o.count]}),t("p",{className:"text-sm text-gray-700",children:["Montant : ",o.total.toLocaleString()," FCFA"]}),t("p",{className:"text-sm text-gray-700",children:["Commission : ",o.commission.toLocaleString()," FCFA"]}),t("div",{className:"flex gap-2 mt-3",children:[a(b,{to:`/admin/compagnies/${o.companyId}`,className:"text-sm px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Gérer"}),a(b,{to:`/admin/compagnies/${o.companyId}/factures`,className:"text-sm px-3 py-1 rounded bg-green-600 text-white hover:bg-green-700",children:"Factures"})]})]},o.companyId))})]})};export{T as default};
