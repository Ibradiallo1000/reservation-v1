import{r as l,j as a,a as n}from"./react-KXT1Riez.js";import{d as i}from"../index-b0dmvJTQ.js";import{o as g,D as x,r as j,E as I,t as u,Z as b,v as $,x as B}from"./firebase-DYTOaTLw.js";import"./vendor-B27hBV_J.js";const N=new Intl.NumberFormat("fr-FR"),Q=({companyId:r})=>{const[s,p]=l.useState(null),[o,v]=l.useState([]),[y,P]=l.useState({agences:0,users:0}),[C,h]=l.useState(!1),[S,A]=l.useState(!0);l.useEffect(()=>{if(!r)return;const e=[],c=g(i,"companies",r),w=x(c,t=>{t.exists()?p({id:t.id,...t.data()}):p(null),A(!1)});e.push(w);const R=j(u(i,"plans"),I("priceMonthly","asc")),E=x(R,t=>{v(t.docs.map(m=>({id:m.id,...m.data()})))});return e.push(E),(async()=>{try{const t=u(i,`companies/${r}/agences`),m=u(i,`companies/${r}/personnel`),[q,D]=await Promise.all([b(t),b(m)]);P({agences:q.data().count,users:D.data().count})}catch{}})(),()=>e.forEach(t=>t())},[r]);const f=l.useMemo(()=>{const e={};return o.forEach(c=>e[c.id]=c),e},[o]),d=l.useMemo(()=>s?s.planId&&f[s.planId]?f[s.planId]:o.find(e=>e.name===s.plan)||null:null,[s,f,o]),F=l.useMemo(()=>s?o.filter(e=>s.planId?e.id!==s.planId:e.name!==s.plan):o,[o,s]),M=async e=>{if(r){h(!0);try{const c=g(u(i,`companies/${r}/billingRequests`));await $(c,{type:"planUpgrade",companyId:r,fromPlanId:(s==null?void 0:s.planId)||null,toPlanId:e.id,toPlanName:e.name,createdAt:B(),status:"pending"}),alert("Demande envoyée avec succès.")}finally{h(!1)}}};return S||!s?a("div",{className:"p-6",children:"Chargement…"}):n("div",{className:"space-y-6",children:[n("section",{className:"bg-white border rounded-xl p-5",children:[a("h2",{className:"text-lg font-semibold mb-4",children:"Votre plan"}),d?n("div",{className:"grid md:grid-cols-3 gap-4",children:[n("div",{className:"border rounded-xl p-4",children:[a("h3",{className:"font-semibold",children:d.name}),n("div",{className:"text-2xl font-bold",children:[N.format(d.priceMonthly)," FCFA"]})]}),n("div",{className:"border rounded-xl p-4",children:[a("p",{className:"text-sm text-gray-500",children:"Agences"}),n("p",{className:"text-xl font-bold",children:[y.agences," /"," ",d.maxAgences]})]}),n("div",{className:"border rounded-xl p-4",children:[a("p",{className:"text-sm text-gray-500",children:"Commission online"}),n("p",{className:"font-bold",children:[Math.round((d.commissionOnline||0)*100),"%"]})]})]}):a("p",{children:"Aucun plan actif."})]}),n("section",{className:"bg-white border rounded-xl p-5",children:[a("h3",{className:"font-semibold mb-4",children:"Autres plans"}),a("div",{className:"grid md:grid-cols-3 gap-4",children:F.map(e=>n("div",{className:"border rounded-xl p-4 flex flex-col",children:[a("h4",{className:"font-semibold",children:e.name}),n("div",{className:"text-xl font-bold",children:[N.format(e.priceMonthly)," FCFA"]}),a("button",{className:"mt-auto px-3 py-2 rounded-lg bg-orange-600 text-white text-sm",disabled:C,onClick:()=>M(e),children:"Demander ce plan"})]},e.id))})]})]})};export{Q as default};
