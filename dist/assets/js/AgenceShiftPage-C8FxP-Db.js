import{b as x,W as N,r as n,a as c,j as t,au as b}from"./react-DB_4kGOy.js";import{F as I,x as v,D as u,C,o as A}from"./firebase-lLzYRzUk.js";import{u as w,d as h}from"../index-Bkmir__O.js";import{u as k}from"./useActiveShift-CKM2FBmt.js";import"./vendor-C-DAJou6.js";const B=()=>{var r,f;const d=x(),[y]=N(),{user:e}=w(),{activeShift:a}=k(),[o,l]=n.useState(!1),i=(e==null?void 0:e.staffCode)||(e==null?void 0:e.codeCourt)||(e==null?void 0:e.code)||"—",s=n.useMemo(()=>!!(e!=null&&e.companyId)&&!!(e!=null&&e.agencyId)&&!!(e!=null&&e.uid),[e==null?void 0:e.companyId,e==null?void 0:e.agencyId,e==null?void 0:e.uid]),m=n.useCallback(async()=>{if(s){l(!0);try{await I(v(h,"companies",e.companyId,"agences",e.agencyId,"shifts"),{isOpen:!0,openedAt:u(),openedBy:{uid:e.uid,displayName:e.displayName||e.email||"—",staffCode:i},companyId:e.companyId,agencyId:e.agencyId}),d("/agence/guichet")}finally{l(!1)}}},[s,d,i,e]),p=n.useCallback(async()=>{if(!(!s||!(a!=null&&a.id))){l(!0);try{await C(A(h,"companies",e.companyId,"agences",e.agencyId,"shifts",a.id),{isOpen:!1,closedAt:u(),closedBy:{uid:e.uid,displayName:e.displayName||e.email||"—",staffCode:i}}),d("/agence/guichet")}finally{l(!1)}}},[a==null?void 0:a.id,s,d,i,e]);return n.useEffect(()=>{const g=y.get("action");g==="open"&&!a&&!o&&m(),g==="close"&&a&&!o&&p()},[y,a,o,m,p]),c("div",{className:"p-6 space-y-6",children:[c("div",{className:"flex items-center justify-between",children:[t("h1",{className:"text-2xl font-bold",children:"Gestion du poste"}),t(b,{to:"/agence/guichet",className:"px-3 py-2 rounded-lg border",children:"Retour guichet"})]}),c("div",{className:"rounded-xl border p-4 space-y-3",children:[c("div",{className:"text-sm text-gray-600",children:["Guichetier : ",t("strong",{children:(e==null?void 0:e.displayName)||(e==null?void 0:e.email)})," (",t("strong",{children:i}),")"]}),c("div",{className:"text-sm",children:["État actuel :"," ",a?c("span",{className:"text-green-700 font-semibold",children:["Poste actif (#",(f=(r=a.id)==null?void 0:r.slice)==null?void 0:f.call(r,0,6),")"]}):t("span",{className:"text-amber-700 font-semibold",children:"Aucun poste ouvert"})]}),c("div",{className:"flex flex-wrap gap-2",children:[t("button",{disabled:o||!!a||!s,onClick:m,className:`px-4 py-2 rounded-lg border ${a?"opacity-50 cursor-not-allowed":""}`,children:"Activer le poste"}),t("button",{disabled:o||!a||!s,onClick:p,className:`px-4 py-2 rounded-lg border ${a?"":"opacity-50 cursor-not-allowed"}`,children:"Clôturer le poste"})]}),!s&&t("div",{className:"text-red-600 text-sm",children:"Impossible d’opérer : informations utilisateur incomplètes."})]})]})};export{B as default};
