import{u as z,a as A,r as i,j as e,$ as D,a0 as N,_ as R}from"./react-PtMwKKf1.js";import{l as w,k as T,q as $,v as q,w as y}from"./firebase-eGIzIftJ.js";import{d as C}from"../index-B745l0NT.js";import"./vendor-B5FTF_2c.js";const S=s=>s==null?void 0:s.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),x=s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase(),H=()=>{const s=z(),a=A().state,[g,k]=i.useState({}),[j,L]=i.useState({}),[F,f]=i.useState(!0),[v,E]=i.useState("");if(i.useEffect(()=>{if(!(a!=null&&a.departure)||!(a!=null&&a.arrival)){s("/");return}(async()=>{f(!0);try{const o=(await w(T(C,"companies"))).docs.reduce((l,c)=>(l[c.id]={...c.data(),id:c.id},l),{});L(o);const d=x(S(a.departure)),u=x(S(a.arrival)),n=$(q(C,"weeklyTrips"),y("departure","==",d),y("arrival","==",u)),h=await w(n),m={};h.forEach(l=>{const c=l.data(),p=l.ref.path.split("/")[1],P={...c,id:l.id,companyId:p};m[p]||(m[p]=[]),m[p].push(P)}),k(m)}catch(t){console.error("❌ Erreur Firestore :",t)}finally{f(!1)}})()},[a,s]),!(a!=null&&a.departure)||!(a!=null&&a.arrival))return null;const b=Object.keys(g).filter(r=>{var o;const t=j[r];return(o=t==null?void 0:t.nom)==null?void 0:o.toLowerCase().includes(v.toLowerCase())});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-md sticky top-0 z-50",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between px-4 py-3",children:[e.jsxs("button",{onClick:()=>s("/"),className:"flex items-center text-orange-600",children:[e.jsx(D,{className:"w-5 h-5 mr-1"})," Retour"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-7 h-7 text-orange-600"}),e.jsx("span",{className:"font-bold text-xl text-orange-600",children:"Teliya"})]})]})}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 mt-6 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-gray-800",children:[e.jsx(N,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{children:[x(a.departure)," → ",x(a.arrival)]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Filtrer par compagnie",value:v,onChange:r=>E(r.target.value),className:"pl-9 border border-gray-300 rounded-lg py-2 px-3 text-sm"})]})]}),e.jsx("div",{className:"max-w-5xl mx-auto p-4",children:F?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"h-10 w-10 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Aucune compagnie disponible pour ce trajet"}),e.jsx("button",{onClick:()=>s("/"),className:"bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700",children:"Nouvelle recherche"})]}):e.jsx("div",{className:"space-y-3",children:b.map(r=>{const t=j[r],o=g[r],d=Math.min(...o.map(n=>n.price)),u=o.reduce((n,h)=>n+(h.places||0),0);return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-3 flex items-center justify-between border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.logoUrl&&e.jsx("img",{src:t.logoUrl,alt:t.nom,className:"w-10 h-10 rounded-full border object-cover"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-bold",style:{color:t.couleurPrimaire||"#ea580c"},children:t.nom}),e.jsxs("p",{className:"text-xs text-gray-500",children:[u," pl. disponibles"]}),e.jsxs("p",{className:"font-semibold text-sm",style:{color:"#16a34a"},children:[d.toLocaleString()," FCFA"]})]})]}),e.jsx("button",{onClick:()=>s(`/${t.slug}/booking?departure=${a.departure}&arrival=${a.arrival}`,{state:{preloaded:!0,company:t,departure:a.departure,arrival:a.arrival,preloadedPrice:d}}),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg text-sm",children:"Réserver"})]},r)})})})]})};export{H as default};
