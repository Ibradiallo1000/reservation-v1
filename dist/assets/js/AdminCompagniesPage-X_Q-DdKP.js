import{r as l,u as v,j as s,a as r}from"./react-DgrrIcw2.js";import{l as w,k as j,u as h,d as x}from"./firebase-eGIzIftJ.js";import{d as c}from"../index-p6Te0bSg.js";import"./vendor-BHjJ2Hjk.js";const d={free:{label:"Free",commission:.1},standard:{label:"Standard",commission:.05},premium:{label:"Premium",commission:.02}},k=()=>{const[p,m]=l.useState([]),[b,f]=l.useState(!0),[g,i]=l.useState(""),u=v();l.useEffect(()=>{(async()=>{try{const t=(await w(j(c,"companies"))).docs.map(o=>({id:o.id,...o.data()}));m(t)}catch(a){console.error("Erreur chargement compagnies:",a),i("Erreur lors du chargement des compagnies")}finally{f(!1)}})()},[]);const N=async(e,a)=>{try{const t=a==="actif"?"inactif":"actif";await h(x(c,"companies",e),{status:t}),i(`Statut mis à jour en "${t}"`),m(o=>o.map(n=>n.id===e?{...n,status:t}:n))}catch(t){console.error("Erreur maj statut:",t),i("Erreur lors de la mise à jour du statut")}},y=async(e,a)=>{try{const t=d[a].commission;await h(x(c,"companies",e),{plan:a,commissionRate:t}),i(`Plan changé en "${d[a].label}"`),m(o=>o.map(n=>n.id===e?{...n,plan:a,commissionRate:t}:n))}catch(t){console.error("Erreur maj plan:",t),i("Erreur lors du changement de plan")}};return b?s("p",{className:"p-6",children:"Chargement des compagnies..."}):r("div",{className:"p-6",children:[r("div",{className:"flex justify-between items-center mb-6",children:[s("h1",{className:"text-2xl font-bold",children:"Gestion des compagnies"}),s("button",{onClick:()=>u("/compagnies/ajouter"),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded",children:"+ Ajouter une compagnie"})]}),g&&s("p",{className:"mb-4 text-blue-600",children:g}),p.length===0?s("p",{className:"text-gray-500 italic",children:"Aucune compagnie enregistrée"}):s("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(e=>r("div",{className:"border rounded-lg shadow-md bg-white p-5 hover:shadow-lg transition",children:[s("h2",{className:"text-lg font-bold text-orange-600",children:e.nom}),r("p",{className:"text-sm text-gray-600",children:["Slug : ",e.slug||"—"]}),r("p",{className:"text-sm text-gray-600",children:["Email : ",e.email]}),r("p",{className:"text-sm text-gray-600",children:["Téléphone : ",e.telephone]}),r("p",{className:"text-sm text-gray-600",children:["Pays : ",e.pays]}),r("p",{className:`text-sm mt-1 ${e.status==="inactif"?"text-red-600":"text-green-600"}`,children:["Statut : ",e.status||"actif"]}),r("div",{className:"mt-3",children:[s("label",{className:"block text-sm text-gray-700 font-medium",children:"Plan d’abonnement :"}),s("select",{value:e.plan,onChange:a=>y(e.id,a.target.value),className:"border p-2 rounded mt-1 w-full",children:Object.entries(d).map(([a,t])=>r("option",{value:a,children:[t.label," — ",t.commission*100,"% commission"]},a))})]}),r("div",{className:"flex flex-wrap gap-2 mt-4",children:[s("button",{onClick:()=>u(`/compagnies/${e.id}/modifier`),className:"text-sm px-3 py-1 rounded bg-green-600 text-white hover:bg-green-700",children:"Modifier"}),s("button",{onClick:()=>N(e.id,e.status),className:"text-sm px-3 py-1 rounded bg-yellow-500 text-white hover:bg-yellow-600",children:e.status==="inactif"?"Réactiver":"Désactiver"}),s("a",{href:`/${e.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Voir site"}),s("a",{href:`/compagnies/${e.id}/factures`,className:"text-sm px-3 py-1 rounded bg-purple-600 text-white hover:bg-purple-700",children:"Factures"})]})]},e.id))})]})};export{k as default};
