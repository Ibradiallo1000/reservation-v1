import{r as a,j as e}from"./react-CdtEOh9s.js";import{q as S,w,f as g,h as D,e as A,T as I}from"./firebase-C3aZpI0W.js";import{u as C,d as b}from"../index-_JuAPzwQ.js";import"./vendor-D_1n0kdO.js";const F=()=>{const{user:s}=C(),[l,d]=a.useState(""),[o,c]=a.useState(0),[i,h]=a.useState("autre"),[p,m]=a.useState(()=>new Date().toISOString().split("T")[0]),[u,j]=a.useState([]),x=async()=>{if(!(s!=null&&s.agencyId))return;const t=S(g(b,"depenses"),w("agencyId","==",s.agencyId)),f=(await D(t)).docs.map(r=>({id:r.id,...r.data()}));j(f.sort((r,v)=>v.createdAt.seconds-r.createdAt.seconds))},N=async t=>{if(t.preventDefault(),!!(s!=null&&s.agencyId))try{await A(g(b,"depenses"),{libelle:l,montant:o,type:i,date:p,agencyId:s.agencyId,createdAt:I.now()}),d(""),c(0),h("autre"),m(new Date().toISOString().split("T")[0]),x()}catch{alert("Erreur lors de l'enregistrement.")}};a.useEffect(()=>{x()},[s]);const y=u.reduce((t,n)=>t+n.montant,0);return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Dépenses de l'agence"}),e.jsxs("form",{onSubmit:N,className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsx("input",{value:l,onChange:t=>d(t.target.value),placeholder:"Libellé",className:"border p-2 rounded",required:!0}),e.jsx("input",{type:"number",value:o,onChange:t=>c(parseFloat(t.target.value)),placeholder:"Montant",className:"border p-2 rounded",required:!0}),e.jsxs("select",{value:i,onChange:t=>h(t.target.value),className:"border p-2 rounded",children:[e.jsx("option",{value:"entretien",children:"Entretien"}),e.jsx("option",{value:"salaire",children:"Salaire"}),e.jsx("option",{value:"charge",children:"Charge"}),e.jsx("option",{value:"autre",children:"Autre"})]}),e.jsx("input",{type:"date",value:p,onChange:t=>m(t.target.value),className:"border p-2 rounded"}),e.jsx("button",{type:"submit",className:"bg-green-600 text-white rounded p-2 col-span-2",children:"Ajouter dépense"})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Liste des dépenses"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left",children:[e.jsx("th",{className:"p-2 border",children:"Date"}),e.jsx("th",{className:"p-2 border",children:"Libellé"}),e.jsx("th",{className:"p-2 border",children:"Type"}),e.jsx("th",{className:"p-2 border",children:"Montant (FCFA)"})]})}),e.jsx("tbody",{children:u.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 border",children:t.date}),e.jsx("td",{className:"p-2 border",children:t.libelle}),e.jsx("td",{className:"p-2 border",children:t.type}),e.jsx("td",{className:"p-2 border text-right",children:t.montant.toLocaleString()})]},t.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-gray-100 font-bold",children:[e.jsx("td",{colSpan:3,className:"p-2 border text-right",children:"Total"}),e.jsxs("td",{className:"p-2 border text-right text-green-700",children:[y.toLocaleString()," FCFA"]})]})})]})})]})};export{F as default};
