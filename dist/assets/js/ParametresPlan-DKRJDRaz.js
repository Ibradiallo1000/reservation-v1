import{r as i,j as s,a as n}from"./react-DB_4kGOy.js";import{u as k,d as u}from"../index-Bkmir__O.js";import{o as v,A as F,w as D,B as G,x as f,Z as A,E as T,D as U}from"./firebase-lLzYRzUk.js";import"./vendor-C-DAJou6.js";const m=new Intl.NumberFormat("fr-FR"),Z=()=>{const{user:o,company:g}=k(),r=(o==null?void 0:o.companyId)||(g==null?void 0:g.id),[a,p]=i.useState(null),[c,C]=i.useState([]),[I,M]=i.useState({agences:0,users:0}),[P,b]=i.useState(!1),[w,N]=i.useState(!0);i.useEffect(()=>{if(!r)return;const e=[],d=v(u,"companies",r),R=F(d,l=>{l.exists()?(p({id:l.id,...l.data()}),N(!1)):(p(null),N(!1))});e.push(R);const q=D(f(u,"plans"),G("priceMonthly","asc")),B=F(q,l=>{C(l.docs.map(h=>({id:h.id,...h.data()})))});return e.push(B),(async()=>{try{const l=f(u,`companies/${r}/agences`),h=f(u,`companies/${r}/personnel`),[E,j]=await Promise.all([A(l),A(h)]);M({agences:E.data().count,users:j.data().count})}catch{}})(),()=>e.forEach(l=>l())},[r]);const x=i.useMemo(()=>{const e={};return c.forEach(d=>e[d.id]=d),e},[c]),t=i.useMemo(()=>a?a.planId&&x[a.planId]?x[a.planId]:c.find(e=>e.name===a.plan)||null:null,[a,x,c]),y=i.useMemo(()=>c.filter(e=>a!=null&&a.planId?e.id!==a.planId:e.name!==(a==null?void 0:a.plan)),[c,a==null?void 0:a.planId,a==null?void 0:a.plan]),S=async e=>{if(!(!r||!a)){b(!0);try{const d=v(f(u,`companies/${r}/billingRequests`));await T(d,{type:"planUpgrade",companyId:r,fromPlanId:a.planId||null,fromPlanName:a.plan||null,toPlanId:e.id,toPlanName:e.name,createdAt:U(),status:"pending",actorUid:(o==null?void 0:o.uid)||null}),alert("Demande envoyée. Notre équipe vous contactera.")}finally{b(!1)}}};return w||!a?s("div",{className:"p-6",children:"Chargement…"}):n("div",{className:"space-y-6",children:[n("section",{className:"bg-white border rounded-xl p-5",children:[s("h2",{className:"text-lg font-semibold mb-4",children:"Votre plan"}),t?n("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n("div",{className:"border rounded-xl p-4",children:[n("div",{className:"flex items-center justify-between mb-1",children:[s("h3",{className:"font-semibold",children:t.name}),s("span",{className:"text-xs px-2 py-0.5 rounded bg-green-100 text-green-700",children:"ACTIF"})]}),n("div",{className:"text-2xl font-extrabold",children:[m.format(t.priceMonthly)," FCFA"]}),s("div",{className:"text-xs text-gray-500",children:"par mois"})]}),n("div",{className:"border rounded-xl p-4",children:[s("p",{className:"text-sm text-gray-500",children:"Agences autorisées"}),n("p",{className:"text-xl font-bold",children:[I.agences," / ",t.maxAgences]})]}),n("div",{className:"border rounded-xl p-4",children:[s("p",{className:"text-sm text-gray-500",children:"Tarifs"}),n("ul",{className:"text-sm",children:[t.features.onlineBooking&&n("li",{children:["Commission en ligne :"," ",n("b",{children:[Math.round((t.commissionOnline||0)*100),"%"]})]}),t.features.guichet&&n("li",{children:["Frais guichet : ",n("b",{children:[m.format(t.feeGuichet)," FCFA"]})]}),n("li",{children:["Minimum mensuel :"," ",s("b",{children:t.minimumMonthly?m.format(t.minimumMonthly)+" FCFA":"—"})]})]})]})]}):n("div",{className:"text-sm text-orange-700",children:["Aucun plan actif trouvé. (Valeur actuelle : ",a.plan||"—",")"]})]}),n("section",{className:"bg-white border rounded-xl p-5",children:[s("h3",{className:"text-md font-semibold mb-4",children:"Autres plans"}),y.length===0?s("p",{className:"text-sm text-gray-500",children:"Aucun autre plan disponible."}):s("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:y.map(e=>n("div",{className:"border rounded-xl p-4 flex flex-col",children:[s("h4",{className:"font-semibold",children:e.name}),n("div",{className:"text-xl font-extrabold mt-1",children:[m.format(e.priceMonthly)," FCFA"]}),s("div",{className:"text-xs text-gray-500 mb-3",children:"par mois"}),n("ul",{className:"text-sm text-gray-700 space-y-1 mb-4",children:[n("li",{children:["Agences max : ",s("b",{children:e.maxAgences})]}),e.features.onlineBooking&&n("li",{children:["Commission online : ",n("b",{children:[Math.round((e.commissionOnline||0)*100),"%"]})]}),e.features.guichet&&n("li",{children:["Frais guichet : ",n("b",{children:[m.format(e.feeGuichet)," FCFA"]})]}),n("li",{children:["Minimum mensuel :"," ",s("b",{children:e.minimumMonthly?m.format(e.minimumMonthly)+" FCFA":"—"})]}),n("li",{children:["Fonctionnalités :"," ",e.features.publicPage?"Vitrine":"—",","," ",e.features.onlineBooking?"Réservation en ligne":"—",","," ",e.features.guichet?"Guichet":"—"]})]}),s("button",{className:"mt-auto px-3 py-2 rounded-lg bg-orange-600 text-white hover:bg-orange-700 text-sm disabled:opacity-60",disabled:P,onClick:()=>S(e),children:"Demander ce plan"})]},e.id))})]})]})};export{Z as default};
