import{j as e,aa as me,ab as xe,ac as he,u as ue,r as u}from"./react-PtMwKKf1.js";import{q as M,w as $,k as E,l as ge,T as q,m as U}from"./firebase-eGIzIftJ.js";import{u as pe,b as be,d as I}from"../index-B745l0NT.js";import{a5 as je}from"./vendor-B5FTF_2c.js";import{R as O,X,Y,T as Q,B as fe,a as ve}from"./BarChart-B1M1C7N-.js";import{L as ye,a as Ne}from"./LineChart-noy9A-wH.js";import{C as J}from"./CartesianGrid-Xzbg7DSv.js";const we=({dateRange:s,setDateRange:t,colors:r,className:i="",companyName:l})=>{const a=x=>{x[0]&&x[1]&&t([x[0],x[1]])};return e.jsxs("div",{className:`flex flex-col md:flex-row justify-between items-center rounded-lg shadow-sm p-6 transition-colors duration-200 ${i}`,style:{backgroundColor:r.background,borderBottom:`4px solid ${r.primary}`},children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-1 flex items-center gap-2",style:{color:"#111"},children:[l&&e.jsx("span",{className:"text-sm font-normal bg-gray-100 px-2 py-1 rounded-md",style:{color:r.primary},children:l}),"Tableau de bord"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Période du ",s[0].toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})," au ",s[1].toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})]})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx(me,{selectsRange:!0,startDate:s[0],endDate:s[1],onChange:a,locale:je,dateFormat:"dd/MM/yyyy",className:"border border-gray-300 p-2 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",wrapperClassName:"date-picker",isClearable:!0,withPortal:!0,selectsDisabledDaysInRange:!0,disabledKeyboardNavigation:!0,dropdownMode:"select"})})]})},L=({title:s,value:t,icon:r,isCurrency:i=!1,trend:l,trendType:a,content:x,themeColor:b,className:k="",onClick:C})=>{const y=i?`${t.toLocaleString("fr-FR")} FCFA`:t.toLocaleString("fr-FR");return e.jsx("div",{onClick:C,className:`cursor-pointer rounded-xl p-6 shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-md ${k}`,style:b?{borderTop:`4px solid ${b}`}:{},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider",children:s}),x?e.jsx("div",{className:"mt-2",children:x}):e.jsxs("div",{className:"mt-2 flex items-baseline",children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:y}),l&&e.jsx("span",{className:`ml-2 text-sm font-medium ${a==="positive"?"text-green-600":"text-red-600"}`,children:l})]})]}),r&&e.jsx("div",{className:"p-3 rounded-lg bg-opacity-10",style:{backgroundColor:b},children:r})]})})},ke=({data:s})=>e.jsxs("div",{className:"bg-white rounded shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Évolution des revenus"}),e.jsx(O,{width:"100%",height:300,children:e.jsxs(ye,{data:s,children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(X,{dataKey:"date"}),e.jsx(Y,{}),e.jsx(Q,{formatter:t=>`${t.toLocaleString()} FCFA`}),e.jsx(Ne,{type:"monotone",dataKey:"revenue",stroke:"#3b82f6",strokeWidth:2})]})})]}),Ce=({data:s})=>e.jsxs("div",{className:"bg-white rounded shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Performance par agence"}),e.jsx(O,{width:"100%",height:300,children:e.jsxs(fe,{data:s,children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(X,{dataKey:"nom"}),e.jsx(Y,{}),e.jsx(Q,{formatter:t=>`${t.toLocaleString()} FCFA`}),e.jsx(ve,{dataKey:"revenus",fill:"#10b981"})]})})]}),De=({agencies:s})=>{const t=[...s].sort((r,i)=>i.revenus-r.revenus).slice(0,5);return e.jsxs("div",{className:"bg-white rounded shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Top agences"}),e.jsx("ul",{children:t.map((r,i)=>e.jsx("li",{className:"py-2 border-b last:border-b-0",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[i+1,". ",r.nom," (",r.ville,")"]}),e.jsxs("span",{children:[r.revenus.toLocaleString()," FCFA"]})]})},r.id))})]})},Re=({data:s,className:t="",showActions:r=!1,onRowClick:i})=>{const l=a=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",maximumFractionDigits:0}).format(a);return e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden ${t}`,children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Détails des agences"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agence"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ville"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Réservations"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenus"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Évolution"}),r&&e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(a=>e.jsxs("tr",{className:`hover:bg-gray-50 ${i?"cursor-pointer":""}`,onClick:()=>i&&i(a.id),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.nom})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:a.ville})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:a.reservations.toLocaleString("fr-FR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:l(a.revenus)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:a.trend!==void 0&&e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a.trend>=0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[a.trend>=0?e.jsx(xe,{className:"-ml-0.5 mr-1 h-3 w-3 text-green-500"}):e.jsx(he,{className:"-ml-0.5 mr-1 h-3 w-3 text-red-500"}),Math.abs(a.trend),"%"]})}),r&&e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-900 mr-3",children:"Voir"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-900",children:"Éditer"})]})]},a.id))})]})}),s.length>0&&e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Affichage de ",e.jsx("span",{className:"font-medium",children:"1"})," à ",e.jsx("span",{className:"font-medium",children:s.length})," agences"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"px-3 py-1 border rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Précédent"}),e.jsx("button",{className:"px-3 py-1 border rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Suivant"})]})]})})]})},Ie=()=>{const{user:s}=pe(),t=ue(),[r,i]=u.useState(null),{colors:l,classes:a}=be(r),[x,b]=u.useState(!0),[k,C]=u.useState(null),[y,Z]=u.useState([new Date(new Date().setDate(new Date().getDate()-30)),new Date]),[N,_]=u.useState([]),[ee,se]=u.useState([]),[c,V]=u.useState({totalAgencies:0,totalReservations:0,totalRevenue:0,growthRate:0,totalChannels:{}}),P=u.useCallback(async()=>{if(!(s!=null&&s.companyId))return;const o=M(E(I,"companies"),$("id","==",s.companyId)),h=await ge(o);if(h.empty)return;const m=h.docs[0],n=m.data();i({id:m.id,slug:n.slug,nom:n.nom,services:n.services,featuredTrips:n.featuredTrips,couleurPrimaire:n.couleurPrimaire,couleurSecondaire:n.couleurSecondaire,couleurAccent:n.couleurAccent,couleurTertiaire:n.couleurTertiaire,logoUrl:n.logoUrl,villesDisponibles:n.villesDisponibles||[],imagesSlider:n.imagesSlider||[],sliderImages:n.sliderImages||[],suggestions:n.suggestions||[]})},[s==null?void 0:s.companyId]),te=o=>{if(o.length===0)return 0;const m=o.reduce((n,S)=>n+S.revenus,0)/o.length;return parseFloat((m*.1).toFixed(2))};u.useEffect(()=>{if(!(s!=null&&s.companyId))return;const[o,h]=y;if(!o||!h)return;const m=[],n=q.fromDate(o),S=q.fromDate(h);return(async()=>{try{b(!0),C(null),await P();const w=M(E(I,"companies",s.companyId,"agences")),ae=U(w,ne=>{const z=ne.docs.map(d=>({id:d.id,nom:d.data().nom,ville:d.data().ville,companyId:s.companyId}));V(d=>({...d,totalAgencies:z.length})),m.forEach(d=>d()),m.length=0;const A={},F={};z.forEach(d=>{const ie=M(E(I,"companies",s.companyId,"agences",d.id,"reservations"),$("createdAt",">=",n),$("createdAt","<=",S)),le=U(ie,oe=>{let G=0,K=0;const T={};oe.forEach(f=>{const g=f.data(),p=(g.canal||"inconnu").toLowerCase().includes("ligne")?"En ligne":"Guichet";T[p]=(T[p]||0)+1,A[p]=(A[p]||0)+1;const v=g.montant||0;K+=v,G+=1;const H=g.createdAt.toDate().toLocaleDateString("fr-FR");F[H]=(F[H]||0)+v});const de={...d,reservations:G,revenus:K,canaux:T};_(f=>{const g=[...f.filter(R=>R.id!==d.id),de];return V(R=>({...R,totalReservations:g.reduce((p,v)=>p+v.reservations,0),totalRevenue:g.reduce((p,v)=>p+v.revenus,0),totalChannels:{...A},growthRate:te(g)})),g});const D=new Date(o),ce=new Date(h),W=[];for(;D<=ce;){const f=D.toLocaleDateString("fr-FR");W.push({date:f,revenue:F[f]||0}),D.setDate(D.getDate()+1)}se(W)});m.push(le)})});m.push(ae)}catch(w){console.error("Erreur onSnapshot dashboard compagnie:",w),C("Erreur de chargement des données. Veuillez réessayer.")}finally{b(!1)}})(),()=>{m.forEach(w=>w())}},[s==null?void 0:s.companyId,y,P]);const j=Object.values(c.totalChannels).reduce((o,h)=>o+h,0),B=c.totalChannels.Guichet||0,re=c.totalChannels["En ligne"]||0;return x?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700",children:"Chargement du tableau de bord..."}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Vos données seront bientôt prêtes"})]})}):k?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg max-w-md w-full text-center border-l-4 border-red-500",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:e.jsx("svg",{className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Une erreur est survenue"}),e.jsx("p",{className:"text-gray-600 mb-6",children:k}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:"Réessayer"})]})}):e.jsxs("div",{className:`min-h-screen p-6 space-y-8 ${a} bg-gradient-to-br from-gray-50 to-gray-100`,children:[e.jsx(we,{dateRange:y,setDateRange:Z,colors:l,className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(L,{title:"Agences",value:c.totalAgencies,onClick:()=>t("/compagnie/agences"),icon:e.jsx("div",{className:"p-3 rounded-full bg-blue-100 text-blue-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),themeColor:l.primary}),e.jsx(L,{title:"Réservations",value:c.totalReservations,onClick:()=>t("/compagnie/reservations"),trend:c.growthRate>=0?`+${c.growthRate}%`:`${c.growthRate}%`,trendType:c.growthRate>=0?"positive":"negative",icon:e.jsx("div",{className:"p-3 rounded-full bg-green-100 text-green-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),themeColor:l.secondary}),e.jsx(L,{title:"Revenus",value:c.totalRevenue,onClick:()=>t("/compagnie/finances"),isCurrency:!0,icon:e.jsx("div",{className:"p-3 rounded-full bg-purple-100 text-purple-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),themeColor:l.accent}),e.jsx(L,{title:"Répartition",onClick:()=>t("/compagnie/statistiques"),icon:e.jsx("div",{className:"p-3 rounded-full bg-amber-100 text-amber-600",children:e.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"})]})}),content:e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),e.jsx("span",{className:"text-sm",children:"Guichet"})]}),e.jsxs("span",{className:"text-sm font-medium",children:[j?Math.round(B/j*100):0,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("span",{className:"text-sm",children:"En ligne"})]}),e.jsxs("span",{className:"text-sm font-medium",children:[j?Math.round(re/j*100):0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full",style:{width:`${j?B/j*100:50}%`}})})]}),themeColor:l.tertiary,value:0})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Évolution des revenus"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"px-3 py-1 text-xs bg-blue-50 text-blue-600 rounded-md",children:"30j"}),e.jsx("button",{className:"px-3 py-1 text-xs bg-gray-50 text-gray-600 rounded-md",children:"90j"}),e.jsx("button",{className:"px-3 py-1 text-xs bg-gray-50 text-gray-600 rounded-md",children:"1an"})]})]}),e.jsx(ke,{data:ee})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Performance des agences"}),e.jsx(Ce,{data:N})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Top 5 agences"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-800",onClick:()=>t("/compagnie/agences"),children:"Voir tout"})]}),e.jsx(De,{agencies:N.slice(0,5)})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Détails des agences"}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{className:"px-3 py-1 text-xs bg-gray-50 text-gray-600 rounded-md",children:"Exporter"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Re,{data:N,className:"min-w-full divide-y divide-gray-200"})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{children:["Affichage 1-",Math.min(N.length,10)," sur ",N.length," agences"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"px-3 py-1 bg-gray-50 rounded-md disabled:opacity-50",disabled:!0,children:"Précédent"}),e.jsx("button",{className:"px-3 py-1 bg-gray-50 rounded-md",children:"Suivant"})]})]})]})]})]})};export{Ie as default};
