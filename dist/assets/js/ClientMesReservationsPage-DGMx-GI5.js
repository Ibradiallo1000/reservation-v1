import{g as ie,c as ue,r as H,j as u,a as $,bc as J,u as ce,d as le,C as de}from"./react-DgrrIcw2.js";import{d as he,u as me,l as re,k as ne,q as fe,w as pe}from"./firebase-eGIzIftJ.js";import{d as X,s as se,h as ge}from"../index-p6Te0bSg.js";import"./vendor-BHjJ2Hjk.js";var oe={exports:{}};(function(d,P){(function(N,i){d.exports=i()})(ue,function(){var N=1e3,i=6e4,V=36e5,C="millisecond",S="second",m="minute",k="hour",b="day",x="week",y="month",W="quarter",O="year",_="date",F="Invalid Date",ee=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Z=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,B={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(a){var t=["th","st","nd","rd"],e=a%100;return"["+a+(t[(e-20)%10]||t[e]||t[0])+"]"}},l=function(a,t,e){var n=String(a);return!n||n.length>=t?a:""+Array(t+1-n.length).join(e)+a},Y={s:l,z:function(a){var t=-a.utcOffset(),e=Math.abs(t),n=Math.floor(e/60),r=e%60;return(t<=0?"+":"-")+l(n,2,"0")+":"+l(r,2,"0")},m:function a(t,e){if(t.date()<e.date())return-a(e,t);var n=12*(e.year()-t.year())+(e.month()-t.month()),r=t.clone().add(n,y),s=e-r<0,o=t.clone().add(n+(s?-1:1),y);return+(-(n+(e-r)/(s?r-o:o-r))||0)},a:function(a){return a<0?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:y,y:O,w:x,d:b,D:_,h:k,m,s:S,ms:C,Q:W}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return a===void 0}},j="en",w={};w[j]=B;var T="$isDayjsObject",A=function(a){return a instanceof z||!(!a||!a[T])},R=function a(t,e,n){var r;if(!t)return j;if(typeof t=="string"){var s=t.toLowerCase();w[s]&&(r=s),e&&(w[s]=e,r=s);var o=t.split("-");if(!r&&o.length>1)return a(o[0])}else{var h=t.name;w[h]=t,r=h}return!n&&r&&(j=r),r||!n&&j},p=function(a,t){if(A(a))return a.clone();var e=typeof t=="object"?t:{};return e.date=a,e.args=arguments,new z(e)},c=Y;c.l=R,c.i=A,c.w=function(a,t){return p(a,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var z=function(){function a(e){this.$L=R(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[T]=!0}var t=a.prototype;return t.parse=function(e){this.$d=function(n){var r=n.date,s=n.utc;if(r===null)return new Date(NaN);if(c.u(r))return new Date;if(r instanceof Date)return new Date(r);if(typeof r=="string"&&!/Z$/i.test(r)){var o=r.match(ee);if(o){var h=o[2]-1||0,f=(o[7]||"0").substring(0,3);return s?new Date(Date.UTC(o[1],h,o[3]||1,o[4]||0,o[5]||0,o[6]||0,f)):new Date(o[1],h,o[3]||1,o[4]||0,o[5]||0,o[6]||0,f)}}return new Date(r)}(e),this.init()},t.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},t.$utils=function(){return c},t.isValid=function(){return this.$d.toString()!==F},t.isSame=function(e,n){var r=p(e);return this.startOf(n)<=r&&r<=this.endOf(n)},t.isAfter=function(e,n){return p(e)<this.startOf(n)},t.isBefore=function(e,n){return this.endOf(n)<p(e)},t.$g=function(e,n,r){return c.u(e)?this[n]:this.set(r,e)},t.unix=function(){return Math.floor(this.valueOf()/1e3)},t.valueOf=function(){return this.$d.getTime()},t.startOf=function(e,n){var r=this,s=!!c.u(n)||n,o=c.p(e),h=function(q,M){var L=c.w(r.$u?Date.UTC(r.$y,M,q):new Date(r.$y,M,q),r);return s?L:L.endOf(b)},f=function(q,M){return c.w(r.toDate()[q].apply(r.toDate("s"),(s?[0,0,0,0]:[23,59,59,999]).slice(M)),r)},g=this.$W,v=this.$M,D=this.$D,E="set"+(this.$u?"UTC":"");switch(o){case O:return s?h(1,0):h(31,11);case y:return s?h(1,v):h(0,v+1);case x:var I=this.$locale().weekStart||0,G=(g<I?g+7:g)-I;return h(s?D-G:D+(6-G),v);case b:case _:return f(E+"Hours",0);case k:return f(E+"Minutes",1);case m:return f(E+"Seconds",2);case S:return f(E+"Milliseconds",3);default:return this.clone()}},t.endOf=function(e){return this.startOf(e,!1)},t.$set=function(e,n){var r,s=c.p(e),o="set"+(this.$u?"UTC":""),h=(r={},r[b]=o+"Date",r[_]=o+"Date",r[y]=o+"Month",r[O]=o+"FullYear",r[k]=o+"Hours",r[m]=o+"Minutes",r[S]=o+"Seconds",r[C]=o+"Milliseconds",r)[s],f=s===b?this.$D+(n-this.$W):n;if(s===y||s===O){var g=this.clone().set(_,1);g.$d[h](f),g.init(),this.$d=g.set(_,Math.min(this.$D,g.daysInMonth())).$d}else h&&this.$d[h](f);return this.init(),this},t.set=function(e,n){return this.clone().$set(e,n)},t.get=function(e){return this[c.p(e)]()},t.add=function(e,n){var r,s=this;e=Number(e);var o=c.p(n),h=function(v){var D=p(s);return c.w(D.date(D.date()+Math.round(v*e)),s)};if(o===y)return this.set(y,this.$M+e);if(o===O)return this.set(O,this.$y+e);if(o===b)return h(1);if(o===x)return h(7);var f=(r={},r[m]=i,r[k]=V,r[S]=N,r)[o]||1,g=this.$d.getTime()+e*f;return c.w(g,this)},t.subtract=function(e,n){return this.add(-1*e,n)},t.format=function(e){var n=this,r=this.$locale();if(!this.isValid())return r.invalidDate||F;var s=e||"YYYY-MM-DDTHH:mm:ssZ",o=c.z(this),h=this.$H,f=this.$m,g=this.$M,v=r.weekdays,D=r.months,E=r.meridiem,I=function(M,L,U,Q){return M&&(M[L]||M(n,s))||U[L].slice(0,Q)},G=function(M){return c.s(h%12||12,M,"0")},q=E||function(M,L,U){var Q=M<12?"AM":"PM";return U?Q.toLowerCase():Q};return s.replace(Z,function(M,L){return L||function(U){switch(U){case"YY":return String(n.$y).slice(-2);case"YYYY":return c.s(n.$y,4,"0");case"M":return g+1;case"MM":return c.s(g+1,2,"0");case"MMM":return I(r.monthsShort,g,D,3);case"MMMM":return I(D,g);case"D":return n.$D;case"DD":return c.s(n.$D,2,"0");case"d":return String(n.$W);case"dd":return I(r.weekdaysMin,n.$W,v,2);case"ddd":return I(r.weekdaysShort,n.$W,v,3);case"dddd":return v[n.$W];case"H":return String(h);case"HH":return c.s(h,2,"0");case"h":return G(1);case"hh":return G(2);case"a":return q(h,f,!0);case"A":return q(h,f,!1);case"m":return String(f);case"mm":return c.s(f,2,"0");case"s":return String(n.$s);case"ss":return c.s(n.$s,2,"0");case"SSS":return c.s(n.$ms,3,"0");case"Z":return o}return null}(M)||o.replace(":","")})},t.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},t.diff=function(e,n,r){var s,o=this,h=c.p(n),f=p(e),g=(f.utcOffset()-this.utcOffset())*i,v=this-f,D=function(){return c.m(o,f)};switch(h){case O:s=D()/12;break;case y:s=D();break;case W:s=D()/3;break;case x:s=(v-g)/6048e5;break;case b:s=(v-g)/864e5;break;case k:s=v/V;break;case m:s=v/i;break;case S:s=v/N;break;default:s=v}return r?s:c.a(s)},t.daysInMonth=function(){return this.endOf(y).$D},t.$locale=function(){return w[this.$L]},t.locale=function(e,n){if(!e)return this.$L;var r=this.clone(),s=R(e,n,!0);return s&&(r.$L=s),r},t.clone=function(){return c.w(this.$d,this)},t.toDate=function(){return new Date(this.valueOf())},t.toJSON=function(){return this.isValid()?this.toISOString():null},t.toISOString=function(){return this.$d.toISOString()},t.toString=function(){return this.$d.toUTCString()},a}(),te=z.prototype;return p.prototype=te,[["$ms",C],["$s",S],["$m",m],["$H",k],["$W",b],["$M",y],["$y",O],["$D",_]].forEach(function(a){te[a[1]]=function(t){return this.$g(t,a[0],a[1])}}),p.extend=function(a,t){return a.$i||(a(t,z,p),a.$i=!0),p},p.locale=R,p.isDayjs=A,p.unix=function(a){return p(1e3*a)},p.en=w[j],p.Ls=w,p.p={},p})})(oe);var ye=oe.exports;const ae=ie(ye),ve=({reservation:d,onClose:P,onUpdated:N})=>{const[i,V]=H.useState({nomClient:d.nomClient||"",telephone:d.telephone||"",depart:d.depart||"",arrivee:d.arrivee||"",date:d.date||"",heure:d.heure||"",seatsGo:d.seatsGo||1,seatsReturn:d.seatsReturn||0,typeVoyage:d.seatsReturn>0?"aller-retour":"aller-simple"}),[C,S]=H.useState(!1),m=b=>{const{name:x,value:y}=b.target;V({...i,[x]:x.includes("seats")?Math.max(0,parseInt(y)):y})};return u("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:$("form",{onSubmit:async b=>{if(b.preventDefault(),!i.nomClient||!i.telephone||!i.depart||!i.arrivee||!i.date||!i.heure){J.error("Veuillez remplir tous les champs obligatoires.");return}if(i.seatsGo<=0){J.error("Le nombre de places aller doit être supérieur à zéro.");return}if(i.typeVoyage==="aller-retour"&&i.seatsReturn<=0){J.error("Le nombre de places retour doit être supérieur à zéro.");return}S(!0);try{const x=he(X,"companies",d.companyId,"agences",d.agencyId,"reservations",d.id);await me(x,{nomClient:i.nomClient,telephone:i.telephone,depart:i.depart,arrivee:i.arrivee,date:i.date,heure:i.heure,seatsGo:i.seatsGo,seatsReturn:i.typeVoyage==="aller-retour"?i.seatsReturn:0,updatedAt:new Date().toISOString()}),J.success("Réservation mise à jour avec succès ✅"),N(),P()}catch(x){console.error(x),J.error("Erreur lors de la mise à jour.")}finally{S(!1)}},className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-xl space-y-4",children:[u("h2",{className:"text-xl font-bold",children:"Modifier la réservation"}),$("div",{className:"grid grid-cols-2 gap-4",children:[u("input",{name:"nomClient",value:i.nomClient,onChange:m,placeholder:"Nom",className:"border p-2 rounded",required:!0}),u("input",{name:"telephone",value:i.telephone,onChange:m,placeholder:"Téléphone",className:"border p-2 rounded",required:!0}),u("input",{name:"depart",value:i.depart,onChange:m,placeholder:"Départ",className:"border p-2 rounded",required:!0}),u("input",{name:"arrivee",value:i.arrivee,onChange:m,placeholder:"Arrivée",className:"border p-2 rounded",required:!0}),u("input",{name:"date",type:"date",value:i.date,onChange:m,className:"border p-2 rounded",required:!0}),u("input",{name:"heure",type:"time",value:i.heure,onChange:m,className:"border p-2 rounded",required:!0})]}),$("div",{className:"flex gap-4 items-center",children:[$("label",{children:[u("input",{type:"radio",name:"typeVoyage",value:"aller-simple",checked:i.typeVoyage==="aller-simple",onChange:m})," Aller simple"]}),$("label",{children:[u("input",{type:"radio",name:"typeVoyage",value:"aller-retour",checked:i.typeVoyage==="aller-retour",onChange:m})," Aller-retour"]})]}),$("div",{className:"grid grid-cols-2 gap-4",children:[u("input",{name:"seatsGo",type:"number",value:i.seatsGo,onChange:m,placeholder:"Places aller",className:"border p-2 rounded",min:1,required:!0}),i.typeVoyage==="aller-retour"&&u("input",{name:"seatsReturn",type:"number",value:i.seatsReturn,onChange:m,placeholder:"Places retour",className:"border p-2 rounded",min:1,required:!0})]}),$("div",{className:"flex justify-end gap-4",children:[u("button",{type:"button",onClick:P,disabled:C,className:"text-gray-500",children:"Annuler"}),u("button",{type:"submit",disabled:C,className:`px-4 py-2 rounded text-white ${C?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:C?"Enregistrement...":"Enregistrer"})]})]})})},K=d=>d?typeof d=="string"?ae(d):typeof d=="object"&&"seconds"in d?ae(new Date(d.seconds*1e3)):null:null,Se=()=>{var Z,B;const[d,P]=H.useState(""),[N,i]=H.useState([]),[V,C]=H.useState(!1),[S,m]=H.useState(""),[k,b]=H.useState(null),x=ce(),{slug:y}=le(),W=async()=>{if(d){C(!0),m("");try{let l=[];const Y=await re(ne(X,"companies"));for(const w of Y.docs){const T=w.id,A=w.data(),R=await re(ne(X,"companies",T,"agences"));for(const p of R.docs){const c=p.id,z=fe(ne(X,"companies",T,"agences",c,"reservations"),pe("telephone","==",d)),a=(await re(z)).docs.map(t=>({...t.data(),id:t.id,companyId:T,agencyId:c,companySlug:A.slug??"compagnie",couleurPrimaire:A.couleurPrimaire||"#3b82f6",couleurSecondaire:A.couleurSecondaire||"#f97316"}));l=[...l,...a]}}l.length===0&&m("Aucune réservation trouvée pour ce numéro.");const j=l.sort((w,T)=>{var A,R;return(((A=K(T.date))==null?void 0:A.unix())||0)-(((R=K(w.date))==null?void 0:R.unix())||0)});i(j)}catch(l){console.error("Erreur recherche réservations :",l),m("Erreur lors de la recherche.")}C(!1)}},O=l=>{const Y=ae(),j=K(l);return j?j.diff(Y,"hour")>24:!1},_=((Z=N[0])==null?void 0:Z.couleurPrimaire)||"#3b82f6",F=((B=N[0])==null?void 0:B.couleurSecondaire)||"#f97316",ee=se(_);return $("div",{className:"min-h-screen bg-gray-50",children:[u("header",{className:"sticky top-0 z-20 px-4 py-3 shadow-sm",style:{backgroundColor:_,color:ee},children:$("div",{className:"flex items-center max-w-3xl mx-auto",children:[u("button",{onClick:()=>x(`/${y}`),className:"p-2 rounded-full hover:bg-white/10",children:u(de,{size:22})}),u("h1",{className:"ml-4 font-bold text-lg",children:"Mes réservations"})]})}),$("div",{className:"p-4 max-w-3xl mx-auto",children:[u("p",{className:"mb-2 text-sm text-gray-600",children:"Entrez votre numéro de téléphone pour afficher vos réservations."}),$("div",{className:"flex space-x-2 mb-6",children:[u("input",{type:"tel",placeholder:"Numéro de téléphone",value:d,onChange:l=>P(l.target.value),className:"border border-gray-300 rounded px-4 py-2 w-full"}),u("button",{onClick:W,className:"px-4 py-2 rounded",style:{backgroundColor:F,color:se(F)},children:"Rechercher"})]}),V&&u("p",{children:"Chargement..."}),S&&u("p",{className:"text-red-500",children:S}),N.length>0&&u("div",{className:"overflow-auto rounded-lg shadow",children:$("table",{className:"min-w-full bg-white text-sm",children:[u("thead",{style:{backgroundColor:ge(_,.1)},className:"text-left",children:$("tr",{children:[u("th",{className:"p-3",children:"Date"}),u("th",{className:"p-3",children:"Trajet"}),u("th",{className:"p-3",children:"Statut"}),u("th",{className:"p-3",children:"Action"})]})}),u("tbody",{children:N.map(l=>{var Y;return $("tr",{className:"border-t",children:[u("td",{className:"p-3",children:((Y=K(l.date))==null?void 0:Y.format("DD/MM/YYYY"))||"--/--/----"}),$("td",{className:"p-3",children:[l.departure," → ",l.arrival]}),u("td",{className:"p-3",children:u("span",{className:"px-2 py-1 rounded-full text-white text-xs",style:{backgroundColor:l.statut==="payé"?"#16a34a":l.statut==="en_attente"?"#eab308":"#dc2626"},children:l.statut})}),$("td",{className:"p-3 space-x-2",children:[u("button",{onClick:()=>x(l.statut==="en_attente"?`/reservation/${l.id}`:`/compagnie/${l.companySlug}/receipt/${l.id}`,{state:{reservation:l,companyInfo:l}}),className:"text-blue-600 hover:underline text-sm",children:"Voir billet"}),O(l.date)&&l.statut==="payé"&&u("button",{onClick:()=>alert("Fonction annuler à implémenter"),className:"text-red-600 hover:underline text-sm",children:"Annuler"})]})]},l.id)})})]})}),N.length===0&&!V&&d&&u("p",{className:"text-gray-500 text-sm mt-4",children:"Aucune réservation trouvée pour ce numéro."}),k&&u(ve,{reservation:k,onClose:()=>b(null),onUpdated:W})]})]})};export{Se as default};
