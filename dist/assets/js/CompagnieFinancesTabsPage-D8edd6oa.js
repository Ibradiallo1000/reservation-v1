import{u as P,r,j as e,aq as z,ar as Q,a2 as U,as as V,at as B,au as G}from"./react-BKlva80Y.js";import{k as x,q as h,w as l,j as g,T as w}from"./firebase-1zyXmG6H.js";import{u as J,d as p}from"../index-BlZmgUmn.js";import"./vendor-CZDa83Cj.js";const Y=()=>{const{user:t}=J(),R=P(),[D,F]=r.useState(""),[c,S]=r.useState([]),[n,C]=r.useState([new Date(new Date().setDate(new Date().getDate()-30)),new Date]),[o,u]=r.useState(!1),[j,b]=r.useState(null),f=r.useCallback(async()=>{if(!(t!=null&&t.companyId))return;const s=await x(h(g(p,"companies"),l("id","==",t.companyId)));if(!s.empty){const a=s.docs[0].data();F(a.nom||"")}},[t==null?void 0:t.companyId]),i=r.useCallback(async()=>{if(t!=null&&t.companyId){u(!0),b(null);try{const s=new Date(n[0]);s.setHours(0,0,0,0);const a=new Date(n[1]);a.setHours(23,59,59,999);const d=h(g(p,"agences"),l("companyId","==",t.companyId)),E=await x(d),N=[];for(const m of E.docs){const y=m.id,L=m.data().nom||m.data().ville||"Agence",q=h(g(p,"reservations"),l("agencyId","==",y),l("createdAt",">=",w.fromDate(s)),l("createdAt","<=",w.fromDate(a)),l("statut","==","pay√©")),v=await x(q),T=v.size,$=v.docs.reduce((H,M)=>H+(M.data().montant||0),0);N.push({id:y,nom:L,totalRevenue:$,totalReservations:T})}S(N)}catch(s){console.error(s),b("Erreur lors du chargement des donn√©es financi√®res.")}finally{u(!1)}}},[t==null?void 0:t.companyId,n]);r.useEffect(()=>{f(),i()},[f,i]);const A=s=>{const[a,d]=s;a&&d&&C([a,d])},I=c.reduce((s,a)=>s+a.totalRevenue,0),k=c.reduce((s,a)=>s+a.totalReservations,0);return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800",children:["üìä Finances de ",D||"la compagnie"]}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Sur la p√©riode s√©lectionn√©e"})]}),e.jsxs("button",{onClick:i,disabled:o,className:`flex items-center px-4 py-2 rounded-lg text-white shadow ${o?"bg-gray-400 cursor-not-allowed":"bg-yellow-500 hover:bg-yellow-600"} transition-all`,children:[e.jsx(z,{className:`mr-2 ${o?"animate-spin":""}`}),o?"Chargement...":"Actualiser"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border shadow-sm flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:[e.jsx(Q,{className:"inline mr-2"}),"S√©lectionner une p√©riode"]}),e.jsx(U,{selectsRange:!0,startDate:n[0],endDate:n[1],onChange:A,className:"w-full border p-2 rounded-lg shadow-sm",dateFormat:"dd/MM/yyyy",isClearable:!0})]}),e.jsx("div",{className:"text-sm text-gray-500 mt-2 md:mt-0",children:n[0]&&n[1]&&e.jsxs("span",{children:["Du ",n[0].toLocaleDateString("fr-FR")," au ",n[1].toLocaleDateString("fr-FR")]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg border-l-4 border-yellow-500 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"text-yellow-500 mr-3 text-2xl"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Recettes totales"}),e.jsxs("p",{className:"text-2xl font-bold",children:[I.toLocaleString("fr-FR")," FCFA"]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border-l-4 border-blue-500 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"text-blue-500 mr-3 text-2xl"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"R√©servations totales"}),e.jsx("p",{className:"text-2xl font-bold",children:k})]})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"üìç R√©partition par agence"}),j&&e.jsx("p",{className:"text-red-500 mb-4",children:j}),c.length===0?e.jsx("p",{className:"text-gray-500",children:"Aucune donn√©e pour cette p√©riode."}):e.jsxs("table",{className:"w-full border text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Agence"}),e.jsx("th",{className:"border p-2 text-left",children:"R√©servations"}),e.jsx("th",{className:"border p-2 text-left",children:"Recettes"}),e.jsx("th",{className:"border p-2 text-left",children:"Action"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border p-2",children:s.nom}),e.jsx("td",{className:"border p-2",children:s.totalReservations}),e.jsxs("td",{className:"border p-2",children:[s.totalRevenue.toLocaleString("fr-FR")," FCFA"]}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>R(`/compagnie/agence/${s.id}/reservations`),className:"text-blue-600 hover:underline flex items-center",children:["Voir d√©tail ",e.jsx(G,{className:"ml-1"})]})})]},s.id))})]})]})]})})};export{Y as default};
