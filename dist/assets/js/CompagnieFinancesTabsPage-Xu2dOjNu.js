import{u as $,r as l,j as e,ar as T,as as q,aa as H,at as M,au as P,av as O}from"./react-PtMwKKf1.js";import{d as U,f as V,l as y,k as v,q as z,w as h,T as w}from"./firebase-eGIzIftJ.js";import{u as B,d as g}from"../index-C4y8wfzK.js";import"./vendor-B5FTF_2c.js";const X=()=>{const{user:a}=B(),R=$(),[D,F]=l.useState(""),[d,S]=l.useState([]),[r,C]=l.useState([new Date(new Date().setDate(new Date().getDate()-30)),new Date]),[i,p]=l.useState(!1),[u,j]=l.useState(null),b=l.useCallback(async()=>{if(a!=null&&a.companyId)try{const s=U(g,"companies",a.companyId),t=await V(s);if(t.exists()){const c=t.data();F(c.nom||"")}}catch(s){console.error("Erreur r√©cup√©ration nom compagnie",s)}},[a==null?void 0:a.companyId]),m=l.useCallback(async()=>{if(a!=null&&a.companyId){p(!0),j(null);try{const[s,t]=r,c=new Date(s);c.setHours(0,0,0,0);const f=new Date(t);f.setHours(23,59,59,999);const k=(await y(v(g,`companies/${a.companyId}/agences`))).docs.map(n=>({id:n.id,nom:n.data().nom||n.data().ville||"Agence"})),L=await y(z(v(g,`companies/${a.companyId}/reservations`),h("createdAt",">=",w.fromDate(c)),h("createdAt","<=",w.fromDate(f)),h("statut","==","pay√©"))),o={};k.forEach(n=>{o[n.id]={id:n.id,nom:n.nom,totalRevenue:0,totalReservations:0}}),L.docs.forEach(n=>{const N=n.data(),x=N.agencyId;o[x]&&(o[x].totalRevenue+=N.montant||0,o[x].totalReservations+=1)}),S(Object.values(o))}catch(s){console.error(s),j("Erreur lors du chargement des donn√©es financi√®res.")}finally{p(!1)}}},[a==null?void 0:a.companyId,r]);l.useEffect(()=>{b(),m()},[b,m]);const A=s=>{const[t,c]=s;t&&c&&C([t,c])},E=d.reduce((s,t)=>s+t.totalRevenue,0),I=d.reduce((s,t)=>s+t.totalReservations,0);return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800",children:["üìä Finances de ",D||"la compagnie"]}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Sur la p√©riode s√©lectionn√©e"})]}),e.jsxs("button",{onClick:m,disabled:i,className:`flex items-center px-4 py-2 rounded-lg text-white shadow ${i?"bg-gray-400 cursor-not-allowed":"bg-yellow-500 hover:bg-yellow-600"} transition-all`,children:[e.jsx(T,{className:`mr-2 ${i?"animate-spin":""}`}),i?"Chargement...":"Actualiser"]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border shadow-sm flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-sm text-gray-600 mb-1 block",children:[e.jsx(q,{className:"inline mr-2"}),"S√©lectionner une p√©riode"]}),e.jsx(H,{selectsRange:!0,startDate:r[0],endDate:r[1],onChange:A,className:"w-full border p-2 rounded-lg shadow-sm",dateFormat:"dd/MM/yyyy",isClearable:!0})]}),e.jsx("div",{className:"text-sm text-gray-500 mt-2 md:mt-0",children:r[0]&&r[1]&&e.jsxs("span",{children:["Du ",r[0].toLocaleDateString("fr-FR")," au ",r[1].toLocaleDateString("fr-FR")]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg border-l-4 border-yellow-500 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"text-yellow-500 mr-3 text-2xl"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Recettes totales"}),e.jsxs("p",{className:"text-2xl font-bold",children:[E.toLocaleString("fr-FR")," FCFA"]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border-l-4 border-blue-500 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"text-blue-500 mr-3 text-2xl"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"R√©servations totales"}),e.jsx("p",{className:"text-2xl font-bold",children:I})]})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"üìç R√©partition par agence"}),u&&e.jsx("p",{className:"text-red-500 mb-4",children:u}),d.length===0?e.jsx("p",{className:"text-gray-500",children:"Aucune donn√©e pour cette p√©riode."}):e.jsxs("table",{className:"w-full border text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Agence"}),e.jsx("th",{className:"border p-2 text-left",children:"R√©servations"}),e.jsx("th",{className:"border p-2 text-left",children:"Recettes"}),e.jsx("th",{className:"border p-2 text-left",children:"Action"})]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border p-2",children:s.nom}),e.jsx("td",{className:"border p-2",children:s.totalReservations}),e.jsxs("td",{className:"border p-2",children:[s.totalRevenue.toLocaleString("fr-FR")," FCFA"]}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>R(`/compagnie/agence/${s.id}/reservations`),className:"text-blue-600 hover:underline flex items-center",children:["Voir d√©tail ",e.jsx(O,{className:"ml-1"})]})})]},s.id))})]})]})]})})};export{X as default};
