import{g as oe,c as ie,r as q,j as s,b9 as U,u as ue,b as ce,C as le}from"./react-PtMwKKf1.js";import{d as de,u as he,l as te,k as re,q as me,w as fe}from"./firebase-eGIzIftJ.js";import{d as K,s as se,h as pe}from"../index-B745l0NT.js";import"./vendor-B5FTF_2c.js";var ae={exports:{}};(function(d,z){(function(D,u){d.exports=u()})(ie,function(){var D=1e3,u=6e4,L=36e5,S="millisecond",j="second",m="minute",N="hour",v="day",$="week",x="month",P="quarter",C="year",k="date",W="Invalid Date",X=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,J=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Z={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(a){var t=["th","st","nd","rd"],e=a%100;return"["+a+(t[(e-20)%10]||t[e]||t[0])+"]"}},l=function(a,t,e){var n=String(a);return!n||n.length>=t?a:""+Array(t+1-n.length).join(e)+a},R={s:l,z:function(a){var t=-a.utcOffset(),e=Math.abs(t),n=Math.floor(e/60),r=e%60;return(t<=0?"+":"-")+l(n,2,"0")+":"+l(r,2,"0")},m:function a(t,e){if(t.date()<e.date())return-a(e,t);var n=12*(e.year()-t.year())+(e.month()-t.month()),r=t.clone().add(n,x),o=e-r<0,i=t.clone().add(n+(o?-1:1),x);return+(-(n+(e-r)/(o?r-i:i-r))||0)},a:function(a){return a<0?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:x,y:C,w:$,d:v,D:k,h:N,m,s:j,ms:S,Q:P}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return a===void 0}},O="en",M={};M[O]=Z;var Y="$isDayjsObject",_=function(a){return a instanceof E||!(!a||!a[Y])},A=function a(t,e,n){var r;if(!t)return O;if(typeof t=="string"){var o=t.toLowerCase();M[o]&&(r=o),e&&(M[o]=e,r=o);var i=t.split("-");if(!r&&i.length>1)return a(i[0])}else{var h=t.name;M[h]=t,r=h}return!n&&r&&(O=r),r||!n&&O},p=function(a,t){if(_(a))return a.clone();var e=typeof t=="object"?t:{};return e.date=a,e.args=arguments,new E(e)},c=R;c.l=A,c.i=_,c.w=function(a,t){return p(a,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var E=function(){function a(e){this.$L=A(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[Y]=!0}var t=a.prototype;return t.parse=function(e){this.$d=function(n){var r=n.date,o=n.utc;if(r===null)return new Date(NaN);if(c.u(r))return new Date;if(r instanceof Date)return new Date(r);if(typeof r=="string"&&!/Z$/i.test(r)){var i=r.match(X);if(i){var h=i[2]-1||0,f=(i[7]||"0").substring(0,3);return o?new Date(Date.UTC(i[1],h,i[3]||1,i[4]||0,i[5]||0,i[6]||0,f)):new Date(i[1],h,i[3]||1,i[4]||0,i[5]||0,i[6]||0,f)}}return new Date(r)}(e),this.init()},t.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},t.$utils=function(){return c},t.isValid=function(){return this.$d.toString()!==W},t.isSame=function(e,n){var r=p(e);return this.startOf(n)<=r&&r<=this.endOf(n)},t.isAfter=function(e,n){return p(e)<this.startOf(n)},t.isBefore=function(e,n){return this.endOf(n)<p(e)},t.$g=function(e,n,r){return c.u(e)?this[n]:this.set(r,e)},t.unix=function(){return Math.floor(this.valueOf()/1e3)},t.valueOf=function(){return this.$d.getTime()},t.startOf=function(e,n){var r=this,o=!!c.u(n)||n,i=c.p(e),h=function(I,b){var T=c.w(r.$u?Date.UTC(r.$y,b,I):new Date(r.$y,b,I),r);return o?T:T.endOf(v)},f=function(I,b){return c.w(r.toDate()[I].apply(r.toDate("s"),(o?[0,0,0,0]:[23,59,59,999]).slice(b)),r)},g=this.$W,y=this.$M,w=this.$D,H="set"+(this.$u?"UTC":"");switch(i){case C:return o?h(1,0):h(31,11);case x:return o?h(1,y):h(0,y+1);case $:var V=this.$locale().weekStart||0,F=(g<V?g+7:g)-V;return h(o?w-F:w+(6-F),y);case v:case k:return f(H+"Hours",0);case N:return f(H+"Minutes",1);case m:return f(H+"Seconds",2);case j:return f(H+"Milliseconds",3);default:return this.clone()}},t.endOf=function(e){return this.startOf(e,!1)},t.$set=function(e,n){var r,o=c.p(e),i="set"+(this.$u?"UTC":""),h=(r={},r[v]=i+"Date",r[k]=i+"Date",r[x]=i+"Month",r[C]=i+"FullYear",r[N]=i+"Hours",r[m]=i+"Minutes",r[j]=i+"Seconds",r[S]=i+"Milliseconds",r)[o],f=o===v?this.$D+(n-this.$W):n;if(o===x||o===C){var g=this.clone().set(k,1);g.$d[h](f),g.init(),this.$d=g.set(k,Math.min(this.$D,g.daysInMonth())).$d}else h&&this.$d[h](f);return this.init(),this},t.set=function(e,n){return this.clone().$set(e,n)},t.get=function(e){return this[c.p(e)]()},t.add=function(e,n){var r,o=this;e=Number(e);var i=c.p(n),h=function(y){var w=p(o);return c.w(w.date(w.date()+Math.round(y*e)),o)};if(i===x)return this.set(x,this.$M+e);if(i===C)return this.set(C,this.$y+e);if(i===v)return h(1);if(i===$)return h(7);var f=(r={},r[m]=u,r[N]=L,r[j]=D,r)[i]||1,g=this.$d.getTime()+e*f;return c.w(g,this)},t.subtract=function(e,n){return this.add(-1*e,n)},t.format=function(e){var n=this,r=this.$locale();if(!this.isValid())return r.invalidDate||W;var o=e||"YYYY-MM-DDTHH:mm:ssZ",i=c.z(this),h=this.$H,f=this.$m,g=this.$M,y=r.weekdays,w=r.months,H=r.meridiem,V=function(b,T,G,B){return b&&(b[T]||b(n,o))||G[T].slice(0,B)},F=function(b){return c.s(h%12||12,b,"0")},I=H||function(b,T,G){var B=b<12?"AM":"PM";return G?B.toLowerCase():B};return o.replace(J,function(b,T){return T||function(G){switch(G){case"YY":return String(n.$y).slice(-2);case"YYYY":return c.s(n.$y,4,"0");case"M":return g+1;case"MM":return c.s(g+1,2,"0");case"MMM":return V(r.monthsShort,g,w,3);case"MMMM":return V(w,g);case"D":return n.$D;case"DD":return c.s(n.$D,2,"0");case"d":return String(n.$W);case"dd":return V(r.weekdaysMin,n.$W,y,2);case"ddd":return V(r.weekdaysShort,n.$W,y,3);case"dddd":return y[n.$W];case"H":return String(h);case"HH":return c.s(h,2,"0");case"h":return F(1);case"hh":return F(2);case"a":return I(h,f,!0);case"A":return I(h,f,!1);case"m":return String(f);case"mm":return c.s(f,2,"0");case"s":return String(n.$s);case"ss":return c.s(n.$s,2,"0");case"SSS":return c.s(n.$ms,3,"0");case"Z":return i}return null}(b)||i.replace(":","")})},t.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},t.diff=function(e,n,r){var o,i=this,h=c.p(n),f=p(e),g=(f.utcOffset()-this.utcOffset())*u,y=this-f,w=function(){return c.m(i,f)};switch(h){case C:o=w()/12;break;case x:o=w();break;case P:o=w()/3;break;case $:o=(y-g)/6048e5;break;case v:o=(y-g)/864e5;break;case N:o=y/L;break;case m:o=y/u;break;case j:o=y/D;break;default:o=y}return r?o:c.a(o)},t.daysInMonth=function(){return this.endOf(x).$D},t.$locale=function(){return M[this.$L]},t.locale=function(e,n){if(!e)return this.$L;var r=this.clone(),o=A(e,n,!0);return o&&(r.$L=o),r},t.clone=function(){return c.w(this.$d,this)},t.toDate=function(){return new Date(this.valueOf())},t.toJSON=function(){return this.isValid()?this.toISOString():null},t.toISOString=function(){return this.$d.toISOString()},t.toString=function(){return this.$d.toUTCString()},a}(),ee=E.prototype;return p.prototype=ee,[["$ms",S],["$s",j],["$m",m],["$H",N],["$W",v],["$M",x],["$y",C],["$D",k]].forEach(function(a){ee[a[1]]=function(t){return this.$g(t,a[0],a[1])}}),p.extend=function(a,t){return a.$i||(a(t,E,p),a.$i=!0),p},p.locale=A,p.isDayjs=_,p.unix=function(a){return p(1e3*a)},p.en=M[O],p.Ls=M,p.p={},p})})(ae);var ge=ae.exports;const ne=oe(ge),xe=({reservation:d,onClose:z,onUpdated:D})=>{const[u,L]=q.useState({nomClient:d.nomClient||"",telephone:d.telephone||"",depart:d.depart||"",arrivee:d.arrivee||"",date:d.date||"",heure:d.heure||"",seatsGo:d.seatsGo||1,seatsReturn:d.seatsReturn||0,typeVoyage:d.seatsReturn>0?"aller-retour":"aller-simple"}),[S,j]=q.useState(!1),m=v=>{const{name:$,value:x}=v.target;L({...u,[$]:$.includes("seats")?Math.max(0,parseInt(x)):x})},N=async v=>{if(v.preventDefault(),!u.nomClient||!u.telephone||!u.depart||!u.arrivee||!u.date||!u.heure){U.error("Veuillez remplir tous les champs obligatoires.");return}if(u.seatsGo<=0){U.error("Le nombre de places aller doit être supérieur à zéro.");return}if(u.typeVoyage==="aller-retour"&&u.seatsReturn<=0){U.error("Le nombre de places retour doit être supérieur à zéro.");return}j(!0);try{const $=de(K,"companies",d.companyId,"agences",d.agencyId,"reservations",d.id);await he($,{nomClient:u.nomClient,telephone:u.telephone,depart:u.depart,arrivee:u.arrivee,date:u.date,heure:u.heure,seatsGo:u.seatsGo,seatsReturn:u.typeVoyage==="aller-retour"?u.seatsReturn:0,updatedAt:new Date().toISOString()}),U.success("Réservation mise à jour avec succès ✅"),D(),z()}catch($){console.error($),U.error("Erreur lors de la mise à jour.")}finally{j(!1)}};return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("form",{onSubmit:N,className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-xl space-y-4",children:[s.jsx("h2",{className:"text-xl font-bold",children:"Modifier la réservation"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx("input",{name:"nomClient",value:u.nomClient,onChange:m,placeholder:"Nom",className:"border p-2 rounded",required:!0}),s.jsx("input",{name:"telephone",value:u.telephone,onChange:m,placeholder:"Téléphone",className:"border p-2 rounded",required:!0}),s.jsx("input",{name:"depart",value:u.depart,onChange:m,placeholder:"Départ",className:"border p-2 rounded",required:!0}),s.jsx("input",{name:"arrivee",value:u.arrivee,onChange:m,placeholder:"Arrivée",className:"border p-2 rounded",required:!0}),s.jsx("input",{name:"date",type:"date",value:u.date,onChange:m,className:"border p-2 rounded",required:!0}),s.jsx("input",{name:"heure",type:"time",value:u.heure,onChange:m,className:"border p-2 rounded",required:!0})]}),s.jsxs("div",{className:"flex gap-4 items-center",children:[s.jsxs("label",{children:[s.jsx("input",{type:"radio",name:"typeVoyage",value:"aller-simple",checked:u.typeVoyage==="aller-simple",onChange:m})," Aller simple"]}),s.jsxs("label",{children:[s.jsx("input",{type:"radio",name:"typeVoyage",value:"aller-retour",checked:u.typeVoyage==="aller-retour",onChange:m})," Aller-retour"]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx("input",{name:"seatsGo",type:"number",value:u.seatsGo,onChange:m,placeholder:"Places aller",className:"border p-2 rounded",min:1,required:!0}),u.typeVoyage==="aller-retour"&&s.jsx("input",{name:"seatsReturn",type:"number",value:u.seatsReturn,onChange:m,placeholder:"Places retour",className:"border p-2 rounded",min:1,required:!0})]}),s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx("button",{type:"button",onClick:z,disabled:S,className:"text-gray-500",children:"Annuler"}),s.jsx("button",{type:"submit",disabled:S,className:`px-4 py-2 rounded text-white ${S?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:S?"Enregistrement...":"Enregistrer"})]})]})})},Q=d=>d?typeof d=="string"?ne(d):typeof d=="object"&&"seconds"in d?ne(new Date(d.seconds*1e3)):null:null,je=()=>{var J,Z;const[d,z]=q.useState(""),[D,u]=q.useState([]),[L,S]=q.useState(!1),[j,m]=q.useState(""),[N,v]=q.useState(null),$=ue(),{slug:x}=ce(),P=async()=>{if(d){S(!0),m("");try{let l=[];const R=await te(re(K,"companies"));for(const M of R.docs){const Y=M.id,_=M.data(),A=await te(re(K,"companies",Y,"agences"));for(const p of A.docs){const c=p.id,E=me(re(K,"companies",Y,"agences",c,"reservations"),fe("telephone","==",d)),a=(await te(E)).docs.map(t=>({...t.data(),id:t.id,companyId:Y,agencyId:c,companySlug:_.slug??"compagnie",couleurPrimaire:_.couleurPrimaire||"#3b82f6",couleurSecondaire:_.couleurSecondaire||"#f97316"}));l=[...l,...a]}}l.length===0&&m("Aucune réservation trouvée pour ce numéro.");const O=l.sort((M,Y)=>{var _,A;return(((_=Q(Y.date))==null?void 0:_.unix())||0)-(((A=Q(M.date))==null?void 0:A.unix())||0)});u(O)}catch(l){console.error("Erreur recherche réservations :",l),m("Erreur lors de la recherche.")}S(!1)}},C=l=>{const R=ne(),O=Q(l);return O?O.diff(R,"hour")>24:!1},k=((J=D[0])==null?void 0:J.couleurPrimaire)||"#3b82f6",W=((Z=D[0])==null?void 0:Z.couleurSecondaire)||"#f97316",X=se(k);return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("header",{className:"sticky top-0 z-20 px-4 py-3 shadow-sm",style:{backgroundColor:k,color:X},children:s.jsxs("div",{className:"flex items-center max-w-3xl mx-auto",children:[s.jsx("button",{onClick:()=>$(`/${x}`),className:"p-2 rounded-full hover:bg-white/10",children:s.jsx(le,{size:22})}),s.jsx("h1",{className:"ml-4 font-bold text-lg",children:"Mes réservations"})]})}),s.jsxs("div",{className:"p-4 max-w-3xl mx-auto",children:[s.jsx("p",{className:"mb-2 text-sm text-gray-600",children:"Entrez votre numéro de téléphone pour afficher vos réservations."}),s.jsxs("div",{className:"flex space-x-2 mb-6",children:[s.jsx("input",{type:"tel",placeholder:"Numéro de téléphone",value:d,onChange:l=>z(l.target.value),className:"border border-gray-300 rounded px-4 py-2 w-full"}),s.jsx("button",{onClick:P,className:"px-4 py-2 rounded",style:{backgroundColor:W,color:se(W)},children:"Rechercher"})]}),L&&s.jsx("p",{children:"Chargement..."}),j&&s.jsx("p",{className:"text-red-500",children:j}),D.length>0&&s.jsx("div",{className:"overflow-auto rounded-lg shadow",children:s.jsxs("table",{className:"min-w-full bg-white text-sm",children:[s.jsx("thead",{style:{backgroundColor:pe(k,.1)},className:"text-left",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3",children:"Date"}),s.jsx("th",{className:"p-3",children:"Trajet"}),s.jsx("th",{className:"p-3",children:"Statut"}),s.jsx("th",{className:"p-3",children:"Action"})]})}),s.jsx("tbody",{children:D.map(l=>{var R;return s.jsxs("tr",{className:"border-t",children:[s.jsx("td",{className:"p-3",children:((R=Q(l.date))==null?void 0:R.format("DD/MM/YYYY"))||"--/--/----"}),s.jsxs("td",{className:"p-3",children:[l.departure," → ",l.arrival]}),s.jsx("td",{className:"p-3",children:s.jsx("span",{className:"px-2 py-1 rounded-full text-white text-xs",style:{backgroundColor:l.statut==="payé"?"#16a34a":l.statut==="en_attente"?"#eab308":"#dc2626"},children:l.statut})}),s.jsxs("td",{className:"p-3 space-x-2",children:[s.jsx("button",{onClick:()=>$(l.statut==="en_attente"?`/reservation/${l.id}`:`/compagnie/${l.companySlug}/receipt/${l.id}`,{state:{reservation:l,companyInfo:l}}),className:"text-blue-600 hover:underline text-sm",children:"Voir billet"}),C(l.date)&&l.statut==="payé"&&s.jsx("button",{onClick:()=>alert("Fonction annuler à implémenter"),className:"text-red-600 hover:underline text-sm",children:"Annuler"})]})]},l.id)})})]})}),D.length===0&&!L&&d&&s.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"Aucune réservation trouvée pour ce numéro."}),N&&s.jsx(xe,{reservation:N,onClose:()=>v(null),onUpdated:P})]})]})};export{je as default};
