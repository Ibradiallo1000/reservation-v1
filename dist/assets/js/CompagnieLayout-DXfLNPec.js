import{u as H,d as W,R as b,j as e,a as s,_ as P,aS as G,$ as Q,B as Y,aM as J,aT as K,aU as X,aL as Z,aV as ee,W as ae,m as se,as as te}from"./react-KXT1Riez.js";import{u as le,c as ne,d as w,P as oe,e as ce}from"../index-CBC3XRHi.js";import{u as ie,t as A,r as k,w as M,D as j,q as re,o as de}from"./firebase-DYTOaTLw.js";import"./vendor-B27hBV_J.js";const me={admin_compagnie:"CEO",admin_platforme:"Admin Plateforme",chefAgence:"Chef d'agence",comptable:"Comptable",superviseur:"Superviseur",guichetier:"Guichetier",compagnie:"Compte Compagnie"},pe=t=>{const l=t?`/compagnie/${t}`:"/compagnie";return[{label:"Tableau de bord",path:`${l}/dashboard`,icon:K},{label:"RÃ©servations",path:`${l}/reservations`,icon:X},{label:"Agences",path:`${l}/agences`,icon:Z},{label:"Avis clients",path:`${l}/avis-clients`,icon:ee},{label:"Configuration",path:`${l}/parametres`,icon:ae}]},he=t=>{const l=t?`/compagnie/${t}`:"/compagnie";return[{label:"MÃ©dias",path:`${l}/images`,icon:Y},{label:"ComptabilitÃ©",path:`${l}/comptabilite`,icon:J}]},E=({isImpersonationMode:t})=>t?e("div",{className:"absolute -top-1 -right-1",children:s("span",{className:"relative flex h-3 w-3",children:[e("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"}),e("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-yellow-500"})]})}):null,Ne=()=>{var $,L;const t=H(),l=W(),{user:a,logout:p,company:r,loading:y}=le(),o=l.companyId,f=a==null?void 0:a.companyId,c=o||f,h=!!((a==null?void 0:a.role)==="admin_platforme"&&o),[d,x]=b.useState(r),[S,N]=b.useState(!1);b.useEffect(()=>{if(!o||o===f){x(r);return}(async()=>{try{const i=await re(de(w,"companies",o));if(i.exists()){const m=i.data();x({id:i.id,nom:m.nom||"",slug:m.slug||"",logoUrl:m.logoUrl,...m})}}catch(i){console.error("Erreur lors du chargement de la compagnie:",i)}})()},[o,f,r]);const C=ne(d),g=pe(o),n=he(o),O=u=>t.pathname===u||t.pathname.startsWith(u+"/"),[R,q]=b.useState(0),[B,U]=b.useState(0);return b.useEffect(()=>{if(!c)return;let u=[];const i=new Map;return(async()=>(await ie(A(w,"companies",c,"agences"))).docs.map(v=>v.id).forEach(v=>{const _=k(A(w,"companies",c,"agences",v,"reservations"),M("statut","==","preuve_recue")),D=j(_,T=>{i.set(v,T.size);const V=Array.from(i.values()).reduce((z,F)=>z+F,0);q(V)});u.push(D)}))(),()=>u.forEach(m=>m())},[c]),b.useEffect(()=>{if(!c)return;const u=k(A(w,"companies",c,"avis"),M("visible","==",!1)),i=j(u,m=>U(m.size));return()=>i()},[c]),y?e("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:s("div",{className:"text-center",children:[e("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e("p",{className:"text-gray-600",children:"Chargement de l'espace compagnie..."})]})}):e(oe,{children:e(ue,{theme:C,isActive:O,onlineProofsCount:R,pendingReviewsCount:B,userInitial:(($=a==null?void 0:a.displayName)==null?void 0:$.charAt(0))||((L=a==null?void 0:a.email)==null?void 0:L.charAt(0))||"?",userName:(a==null?void 0:a.displayName)||(a==null?void 0:a.email)||"",userRole:a==null?void 0:a.role,companyName:(d==null?void 0:d.nom)||"Compagnie",logoUrl:d==null?void 0:d.logoUrl,isImpersonationMode:h,navItems:g,navAnalytics:n,onLogout:p,onExitImpersonation:()=>window.location.href="/admin/compagnies",onOpenMobileMenu:()=>N(!0)})})},ue=({theme:t,isActive:l,onlineProofsCount:a,pendingReviewsCount:p,userInitial:r,userName:y,userRole:o,companyName:f,logoUrl:c,isImpersonationMode:h,navItems:d,navAnalytics:x,onLogout:S,onExitImpersonation:N,onOpenMobileMenu:C})=>{const{header:g}=ce();return s("div",{className:"min-h-screen bg-gray-50 text-gray-900",children:[e("aside",{className:"hidden md:flex fixed inset-y-0 left-0 w-64 flex-col text-white shadow-xl z-40",style:{backgroundColor:t.colors.primary},children:s("div",{className:"flex-1 flex flex-col",children:[s("div",{className:"p-6 border-b border-white/20 flex items-center gap-3 relative",children:[s("div",{className:"relative",children:[c&&e("img",{src:c,alt:"logo",className:"h-10 w-10 rounded-full"}),e(E,{isImpersonationMode:h})]}),s("div",{className:"min-w-0",children:[e("h1",{className:"text-lg font-bold truncate",children:f}),h&&e("p",{className:"text-xs opacity-80 text-yellow-200",children:"Mode inspection"})]})]}),s("nav",{className:"flex-1 p-4 space-y-1",children:[d.map(n=>e(I,{to:n.path,label:n.label,icon:e(n.icon,{}),active:l(n.path),theme:t,badge:n.path.includes("/reservations")?a:n.path.includes("/avis-clients")?p:void 0},n.path)),s("div",{className:"mt-6 pt-4 border-t border-white/20",children:[e("p",{className:"text-xs uppercase opacity-80 px-3 mb-2",children:"Analytique"}),x.map(n=>e(I,{to:n.path,label:n.label,icon:e(n.icon,{}),active:l(n.path),theme:t},n.path))]})]}),e("div",{className:"p-4 border-t border-white/20",children:s("div",{className:"flex items-center justify-between",children:[s("div",{className:"flex items-center gap-3",children:[s("div",{className:"relative",children:[e("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-medium",style:{backgroundColor:t.colors.secondary},children:r}),e(E,{isImpersonationMode:h})]}),s("div",{className:"min-w-0",children:[e("p",{className:"text-sm font-medium truncate",children:y}),e("p",{className:"text-xs opacity-80",children:me[o??""]??o})]})]}),s("div",{className:"flex items-center gap-1",children:[h&&e("button",{onClick:N,className:"p-2 rounded-md hover:bg-white/20 text-yellow-300",title:"Quitter le mode inspection",children:e(P,{className:"h-4 w-4"})}),e("button",{onClick:S,className:"p-2 rounded-md hover:bg-white/20",title:"Se dÃ©connecter",children:e(P,{className:"h-4 w-4"})})]})]})})]})}),e("main",{className:"md:ml-64",children:s("div",{className:"h-screen flex flex-col",children:[s("header",{className:"bg-white shadow-sm p-4 md:hidden flex justify-between items-center",children:[e("button",{onClick:C,children:e(G,{className:"w-5 h-5"})}),s("div",{className:"text-center",children:[e("h1",{className:"font-semibold",children:f}),h&&e("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full",children:"Mode inspection"})]}),e("div",{className:"w-5"})," "]}),h&&e("div",{className:"bg-yellow-50 border-b border-yellow-200 px-6 py-2",children:s("div",{className:"flex items-center justify-between",children:[e("div",{className:"flex items-center gap-2",children:s("span",{className:"text-yellow-800",children:["ðŸ” Vous Ãªtes en mode inspection de ",e("strong",{children:f})]})}),e("button",{onClick:N,className:"text-sm bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700",children:"Retour Ã  l'admin"})]})}),s("div",{className:"px-6 py-4 shadow-sm",style:{background:g.bg,color:g.fg||"#fff"},children:[e("div",{className:"text-2xl font-bold",children:g.title}),g.subtitle&&e("div",{className:"text-sm opacity-90",children:g.subtitle})]}),e("div",{className:"flex-1 overflow-y-auto p-6",children:e(Q,{})})]})})]})},I=({to:t,label:l,icon:a,active:p,badge:r,theme:y})=>s(te,{to:t,className:`flex items-center gap-3 px-3 py-2.5 rounded-lg transition ${p?"font-bold":"opacity-90 hover:opacity-100"}`,style:{backgroundColor:p?y.colors.secondary:"transparent",color:p?"#fff":"#f1f1f1"},children:[a,e("span",{className:"flex-1 text-sm",children:l}),typeof r=="number"&&r>0&&e("span",{className:"bg-red-500 text-xs px-2 py-0.5 rounded-full",children:r}),e(se,{className:`w-4 h-4 ${p?"opacity-100":"opacity-0"}`})]});export{Ne as default};
