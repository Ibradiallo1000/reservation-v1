import{r as o,j as e,a7 as S}from"./react-PtMwKKf1.js";import{l as N,k as C}from"./firebase-eGIzIftJ.js";import{d as D}from"../index-B745l0NT.js";import{R as F,B as w,X as A,Y as B,T as E,L as I,a as x}from"./BarChart-B1M1C7N-.js";import{C as L}from"./CartesianGrid-Xzbg7DSv.js";import"./vendor-B5FTF_2c.js";const X=()=>{const[i,u]=o.useState([]),[n,j]=o.useState([]),[r,g]=o.useState("all"),[d,y]=o.useState(""),[m,f]=o.useState("");return o.useEffect(()=>{(async()=>{const t=(await N(C(D,"reservations"))).docs.map(l=>({id:l.id,...l.data()}));u(t)})()},[]),o.useEffect(()=>{const a={};i.forEach(s=>{var p,h;const t=((h=(p=s.createdAt)==null?void 0:p.toDate)==null?void 0:h.call(p))||new Date,l=r==="all"||s.companyId===r,b=(!d||new Date(d)<=t)&&(!m||t<=new Date(m));if(l&&b){const c=s.companyId||"inconnu",v=s.companySlug||"—";a[c]||(a[c]={companyId:c,companySlug:v,total:0,commission:0}),a[c].total+=s.total||0,a[c].commission+=s.commission||0}}),j(Object.values(a))},[i,r,d,m]),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Finances - Vue globale"}),e.jsxs("div",{className:"mb-6 flex flex-wrap gap-4 items-center",children:[e.jsx("input",{type:"date",value:d,onChange:a=>y(a.target.value),className:"border rounded px-2 py-1"}),e.jsx("input",{type:"date",value:m,onChange:a=>f(a.target.value),className:"border rounded px-2 py-1"}),e.jsxs("select",{value:r,onChange:a=>g(a.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"all",children:"Toutes les compagnies"}),Array.from(new Set(i.map(a=>a.companyId))).filter(Boolean).map((a,s)=>{var t;return e.jsx("option",{value:a,children:((t=i.find(l=>l.companyId===a))==null?void 0:t.companySlug)||a},s)})]})]}),n.length>0&&e.jsx("div",{className:"w-full h-[350px] mb-6 bg-white p-4 rounded shadow",children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(w,{data:n.map(a=>({compagnie:a.companySlug,total:a.total,commission:a.commission,benefice:a.total-a.commission})),children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"compagnie"}),e.jsx(B,{}),e.jsx(E,{}),e.jsx(I,{}),e.jsx(x,{dataKey:"total",fill:"#4F46E5",name:"Total"}),e.jsx(x,{dataKey:"commission",fill:"#F59E0B",name:"Commission"}),e.jsx(x,{dataKey:"benefice",fill:"#10B981",name:"Bénéfice net"})]})})}),n.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx(S,{data:n.map(a=>({Compagnie:a.companySlug,Total:a.total,Commission:a.commission,Benefice:a.total-a.commission})),filename:`finances_${new Date().toISOString().slice(0,10)}.csv`,className:"inline-block bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Exporter en CSV"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"Compagnie"}),e.jsx("th",{className:"border px-4 py-2",children:"Total"}),e.jsx("th",{className:"border px-4 py-2",children:"Commission"}),e.jsx("th",{className:"border px-4 py-2",children:"Bénéfice net"})]})}),e.jsxs("tbody",{children:[n.map((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:a.companySlug}),e.jsxs("td",{className:"border px-4 py-2",children:[a.total.toLocaleString()," FCFA"]}),e.jsxs("td",{className:"border px-4 py-2",children:[a.commission.toLocaleString()," FCFA"]}),e.jsxs("td",{className:"border px-4 py-2",children:[(a.total-a.commission).toLocaleString()," FCFA"]})]},s)),n.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center p-4 text-gray-500",children:"Aucune donnée trouvée pour cette période."})})]})]})})]})};export{X as default};
