import{r as m,j as e,a}from"./vendor-Bq-8_m9i.js";import{a as q,u as G,b as Z}from"./router-DoGdw-3y.js";import{B as S,O as _,d as k}from"./agence-Bsj2lp2X.js";import{u as P,t as J,M}from"./firebase-CURBI7X6.js";import{ai as Y,J as H,S as K,j as T,aZ as $,aY as E,aT as I,aW as L,aV as z}from"./icons-C0JHUK9Z.js";import"./compagnie-DiuZFnHS.js";import"./courier-CoQgRaHG.js";const N=i=>i==null?void 0:i.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),A=i=>i?i.charAt(0).toUpperCase()+i.slice(1).toLowerCase():"",B={wifi:{icon:z,label:"Wi-Fi",color:"text-purple-600"},wifi_gratuit:{icon:z,label:"Wi-Fi gratuit",color:"text-purple-600"},climatisation:{icon:L,label:"Climatisation",color:"text-blue-600"},clim:{icon:L,label:"Climatisation",color:"text-blue-600"},prise_usb:{icon:I,label:"Prise USB",color:"text-yellow-600"},usb:{icon:I,label:"Prise USB",color:"text-yellow-600"},sieges_confort:{icon:E,label:"Sièges confort",color:"text-green-600"},sieges:{icon:E,label:"Sièges confort",color:"text-green-600"},ecran_tv:{icon:$,label:"Écran TV",color:"text-red-600"},tv:{icon:$,label:"Écran TV",color:"text-red-600"}},oe=()=>{const i=q(),F=G(),[R]=Z(),d=F.state,x={departure:R.get("from")||"",arrival:R.get("to")||""},t=m.useMemo(()=>d!=null&&d.departure&&(d!=null&&d.arrival)?d:x.departure&&x.arrival?x:null,[d,x.departure,x.arrival]),[w,W]=m.useState({}),[y,C]=m.useState({}),[D,j]=m.useState(!0),[v,V]=m.useState(""),[Q,O]=m.useState({});m.useEffect(()=>{if(!(t!=null&&t.departure)||!(t!=null&&t.arrival)){C({}),j(!1);return}(async()=>{j(!0);try{const r=await P(J(k,"companies")),u={};r.forEach(l=>{const o=l.data();u[l.id]={...o,id:l.id}}),W(u);const p=await P(M(k,"weeklyTrips")),n={},f=N(t.departure),h=N(t.arrival);p.forEach(l=>{const o=l.data();if(N(o.departure)!==f||N(o.arrival)!==h)return;const g=l.ref.path.split("/")[1];(n[g]||(n[g]=[])).push({id:l.id,companyId:g,departure:o.departure,arrival:o.arrival,price:o.price,places:o.places||0})}),C(n);const b=await P(M(k,"reservations")),s={};b.forEach(l=>{const o=l.data();if(!["en_attente","payé","preuve_recue"].includes(o.statut))return;const g=`${o.companyId}_${o.weeklyTripId}`;s[g]=(s[g]||0)+(o.places||0)}),O(s)}catch(r){console.error("❌ Erreur recherche plateforme:",r),C({})}finally{j(!1)}})()},[t==null?void 0:t.departure,t==null?void 0:t.arrival]);const U=m.useMemo(()=>{const c=Object.keys(y);return v.trim()?c.filter(r=>{var u,p;return(p=(u=w[r])==null?void 0:u.nom)==null?void 0:p.toLowerCase().includes(v.toLowerCase())}):c},[y,w,v]);return t?a("div",{className:"min-h-screen bg-gray-50",children:[e("header",{className:"bg-white shadow sticky top-0 z-50",children:a("div",{className:"max-w-7xl mx-auto flex items-center justify-between px-4 py-3",children:[a("button",{onClick:()=>i("/"),className:"flex items-center text-orange-600 hover:text-orange-700 transition-colors",children:[e(Y,{className:"w-5 h-5 mr-1"}),"Retour"]}),e("span",{className:"font-bold text-orange-600 text-xl",children:"Teliya"}),e("div",{className:"w-10"})]})}),a("div",{className:"max-w-7xl mx-auto px-4 mt-4",children:[a("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-2 items-center",children:[e("span",{className:"px-3 py-1.5 rounded-xl bg-orange-50 border border-orange-100 font-semibold truncate",children:A(t.departure)}),e(H,{className:"text-gray-400"}),e("span",{className:"px-3 py-1.5 rounded-xl bg-emerald-50 border border-emerald-100 font-semibold truncate text-right",children:A(t.arrival)})]}),a("div",{className:"relative mt-3 sm:w-[320px] sm:ml-auto",children:[e(K,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e("input",{value:v,onChange:c=>V(c.target.value),placeholder:"Filtrer par compagnie",className:"pl-9 border border-gray-300 rounded-lg py-2 px-3 text-sm w-full focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})]}),e("div",{className:"max-w-7xl mx-auto p-4 pb-6",children:D?e("div",{className:"flex justify-center py-12",children:e("div",{className:"h-10 w-10 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):U.length===0?a("div",{className:"text-center py-12",children:[e("p",{className:"text-gray-600 mb-4",children:"Aucune compagnie disponible pour ce trajet"}),e(S,{variant:"primary",onClick:()=>i("/"),children:"Nouvelle recherche"})]}):e("div",{className:"space-y-3",children:U.map(c=>{const r=w[c],u=y[c],p=Math.min(...u.map(h=>h.price)),n=(r==null?void 0:r.services)||[],f=n.slice(0,5);return a("div",{className:"bg-white rounded-xl shadow-sm p-4 border border-gray-200 hover:shadow-md transition-shadow",children:[a("div",{className:"block md:hidden",children:[e("div",{className:"flex items-start justify-between mb-2",children:a("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[r!=null&&r.logoUrl?e("img",{src:r.logoUrl,alt:r.nom,className:"w-10 h-10 rounded-full object-cover border border-gray-200"}):e("div",{className:"w-10 h-10 rounded-full grid place-items-center bg-orange-50 border border-orange-100",children:e(T,{className:"text-orange-500 w-5 h-5"})}),a("div",{className:"min-w-0",children:[e("h3",{className:"font-semibold truncate text-sm",style:{color:(r==null?void 0:r.couleurPrimaire)||"rgb(234,88,12)"},children:r==null?void 0:r.nom}),f.length>0&&a("div",{className:"flex items-center gap-1 mt-1",children:[f.map((h,b)=>{const s=B[h];if(!s)return null;const l=s.icon;return e("div",{className:`${s.color} p-0.5 rounded`,title:s.label,children:e(l,{className:"w-3 h-3"})},b)}),n.length>5&&a("span",{className:"text-xs text-gray-500 ml-1",children:["+",n.length-5]})]})]})]})}),a("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e("div",{className:"text-emerald-600 font-bold text-base",children:_(p)}),e(S,{variant:"primary",size:"sm",onClick:()=>i(`/${r.slug}/booking?departure=${encodeURIComponent(t.departure)}&arrival=${encodeURIComponent(t.arrival)}`),children:"Réserver"})]})]}),a("div",{className:"hidden md:flex items-center justify-between",children:[a("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[r!=null&&r.logoUrl?e("img",{src:r.logoUrl,alt:r.nom,className:"w-12 h-12 rounded-full object-cover border border-gray-200"}):e("div",{className:"w-12 h-12 rounded-full grid place-items-center bg-orange-50 border border-orange-100",children:e(T,{className:"text-orange-500 w-6 h-6"})}),a("div",{className:"min-w-0",children:[e("h3",{className:"font-semibold truncate",style:{color:(r==null?void 0:r.couleurPrimaire)||"rgb(234,88,12)"},children:r==null?void 0:r.nom}),f.length>0&&a("div",{className:"flex items-center gap-2 mt-1.5",children:[f.map((h,b)=>{const s=B[h];if(!s)return null;const l=s.icon;return a("div",{className:`${s.color} p-1 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors group relative`,title:s.label,children:[e(l,{className:"w-4 h-4"}),e("span",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 px-2 py-1 text-xs text-white bg-gray-800 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10",children:s.label})]},b)}),n.length>5&&a("span",{className:"text-xs text-gray-500 ml-1",children:["+",n.length-5," service",n.length-5>1?"s":""]})]})]})]}),a("div",{className:"flex items-center gap-6",children:[a("div",{className:"text-right",children:[e("div",{className:"text-emerald-600 font-bold text-xl",children:_(p)}),e("div",{className:"text-xs text-gray-500 mt-0.5",children:"À partir de"})]}),e(S,{variant:"primary",onClick:()=>i(`/${r.slug}/booking?departure=${encodeURIComponent(t.departure)}&arrival=${encodeURIComponent(t.arrival)}`),children:"Réserver"})]})]})]},c)})})})]}):e("div",{className:"min-h-screen flex items-center justify-center",children:e("p",{children:"Paramètres manquants"})})};export{oe as default};
