import{b,ay as v,r as l,a as i,j as t,as as I}from"./react-KXT1Riez.js";import{F as C,t as A,x,y as w,o as k}from"./firebase-DYTOaTLw.js";import{u as j,d as N}from"../index-CBC3XRHi.js";import{u as O}from"./useActiveShift-Bq7jzZpU.js";import"./vendor-B27hBV_J.js";const G=()=>{var p,h;const r=b(),[g]=v(),{user:e}=j(),{activeShift:a}=O(),[n,m]=l.useState(!1),d=(e==null?void 0:e.staffCode)||(e==null?void 0:e.codeCourt)||(e==null?void 0:e.code)||"—",s=l.useMemo(()=>!!(e!=null&&e.companyId)&&!!(e!=null&&e.agencyId)&&!!(e!=null&&e.uid),[e==null?void 0:e.companyId,e==null?void 0:e.agencyId,e==null?void 0:e.uid]),c=e==null?void 0:e.companyId,o=e==null?void 0:e.agencyId,f=l.useCallback(async()=>{if(!(!s||!c||!o)){m(!0);try{await C(A(N,"companies",c,"agences",o,"shifts"),{isOpen:!0,openedAt:x(),openedBy:{uid:e.uid,displayName:e.displayName||e.email||"—",staffCode:d},companyId:c,agencyId:o}),r("/agence/guichet")}finally{m(!1)}}},[s,c,o,r,d,e]),y=l.useCallback(async()=>{if(!(!s||!c||!o||!(a!=null&&a.id))){m(!0);try{await w(k(N,"companies",c,"agences",o,"shifts",a.id),{isOpen:!1,closedAt:x(),closedBy:{uid:e.uid,displayName:e.displayName||e.email||"—",staffCode:d}}),r("/agence/guichet")}finally{m(!1)}}},[a==null?void 0:a.id,s,c,o,r,d,e]);return l.useEffect(()=>{const u=g.get("action");u==="open"&&!a&&!n&&f(),u==="close"&&a&&!n&&y()},[g,a,n,f,y]),i("div",{className:"p-6 space-y-6",children:[i("div",{className:"flex items-center justify-between",children:[t("h1",{className:"text-2xl font-bold",children:"Gestion du poste"}),t(I,{to:"/agence/guichet",className:"px-3 py-2 rounded-lg border",children:"Retour guichet"})]}),i("div",{className:"rounded-xl border p-4 space-y-3",children:[i("div",{className:"text-sm text-gray-600",children:["Guichetier :"," ",t("strong",{children:(e==null?void 0:e.displayName)||(e==null?void 0:e.email)})," (",t("strong",{children:d}),")"]}),i("div",{className:"text-sm",children:["État actuel :"," ",a?i("span",{className:"text-green-700 font-semibold",children:["Poste actif (#",(h=(p=a.id)==null?void 0:p.slice)==null?void 0:h.call(p,0,6),")"]}):t("span",{className:"text-amber-700 font-semibold",children:"Aucun poste ouvert"})]}),i("div",{className:"flex flex-wrap gap-2",children:[t("button",{disabled:n||!!a||!s,onClick:f,className:`px-4 py-2 rounded-lg border ${a?"opacity-50 cursor-not-allowed":""}`,children:"Activer le poste"}),t("button",{disabled:n||!a||!s,onClick:y,className:`px-4 py-2 rounded-lg border ${a?"":"opacity-50 cursor-not-allowed"}`,children:"Clôturer le poste"})]}),!s&&t("div",{className:"text-red-600 text-sm",children:"Impossible d’opérer : informations utilisateur incomplètes."})]})]})};export{G as default};
