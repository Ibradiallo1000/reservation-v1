import{u as V,r,j as s}from"./react-A-4nP3fl.js";import{c as _,d as $,q as g,w as t,f as j,e as b}from"./firebase-CbfwkGbo.js";import{u as J,d as x}from"../index-ChphXJpr.js";import"./vendor-CCJV4Wg0.js";const Y=()=>{const{user:n}=J(),A=V(),[E,T]=r.useState([]),[m,R]=r.useState(""),[d,q]=r.useState(""),[i,H]=r.useState(""),[o,y]=r.useState(""),[S,k]=r.useState([]),[w,C]=r.useState([]),[p,f]=r.useState(""),[u,D]=r.useState([]),[G,L]=r.useState(""),h=e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase(),O=()=>{const e=new Date;return Array.from({length:8},(a,c)=>{const l=new Date(e);return l.setDate(e.getDate()+c),l.toISOString().split("T")[0]})},P=async()=>{if(!(n!=null&&n.companyId))return;const e=g(j(x,"agences"),t("companyId","==",n.companyId)),c=(await b(e)).docs.map(l=>({id:l.id,nom:l.data().ville}));T(c)},F=async()=>{if(!m||!d||!i||!(n!=null&&n.companyId))return;const e=g(j(x,"dailyTrips"),t("agencyId","==",m),t("departure","==",h(d)),t("arrival","==",h(i))),a=await b(e),c=new Set;a.forEach(N=>{const v=N.data();v.date&&c.add(v.date)});const l=Array.from(c).filter(N=>O().includes(N)).sort();k(l),y(l[0]||""),C([]),f(""),D([])},U=async()=>{if(!o||!m||!d||!i)return;const e=g(j(x,"dailyTrips"),t("agencyId","==",m),t("departure","==",h(d)),t("arrival","==",h(i)),t("date","==",o)),a=await b(e),c=[];a.forEach(l=>c.push(l.data().time)),C(c),f(c[0]||"")},z=async()=>{if(!p||!o)return;const e=g(j(x,"dailyTrips"),t("agencyId","==",m),t("departure","==",h(d)),t("arrival","==",h(i)),t("date","==",o),t("time","==",p)),a=await b(e);if(a.empty)return;const c=a.docs[0].id,l=g(j(x,"reservations"),t("trajetId","==",c),t("statut","==","payé")),v=(await b(l)).docs.map(I=>({id:I.id,...I.data()}));D(v)};r.useEffect(()=>{o&&U()},[o]),r.useEffect(()=>{p&&z()},[p]),r.useEffect(()=>{P(),n!=null&&n.companyId&&_($(x,"companies",n.companyId)).then(e=>{e.exists()&&L(e.data().nom)})},[]);const B=u.reduce((e,a)=>e+(a.seatsGo||1),0),M=u.reduce((e,a)=>e+(a.montant||0),0);return n?s.jsxs("div",{className:"p-6 bg-white min-h-screen",children:[s.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Toutes les réservations de la compagnie"}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-3 mb-4",children:[s.jsxs("select",{value:m,onChange:e=>R(e.target.value),className:"border p-2 rounded",children:[s.jsx("option",{value:"",children:"Sélectionner une agence"}),E.map(e=>s.jsx("option",{value:e.id,children:e.nom},e.id))]}),s.jsx("input",{value:d,onChange:e=>q(e.target.value),placeholder:"Départ",className:"border p-2 rounded"}),s.jsx("input",{value:i,onChange:e=>H(e.target.value),placeholder:"Arrivée",className:"border p-2 rounded"}),s.jsx("button",{onClick:F,className:"bg-yellow-500 text-white rounded px-4",children:"Rechercher"})]}),S.length>0&&s.jsx("div",{className:"flex gap-2 flex-wrap mb-4",children:S.map(e=>s.jsx("button",{onClick:()=>y(e),className:`px-3 py-1 rounded-full text-sm border ${o===e?"bg-yellow-600 text-white":"bg-yellow-100 text-yellow-800"}`,children:e},e))}),w.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"text-sm",children:"Choisir une heure :"}),s.jsx("select",{value:p,onChange:e=>f(e.target.value),className:"border p-2 rounded",children:w.map(e=>s.jsx("option",{value:e,children:e},e))})]}),s.jsxs("div",{className:"mb-4 flex justify-between",children:[s.jsx("button",{onClick:()=>A(-1),className:"text-sm text-blue-500 underline",children:"← Retour"}),s.jsx("button",{onClick:()=>window.print(),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Imprimer"})]}),s.jsxs("div",{className:"border rounded-xl p-4",children:[s.jsxs("h2",{className:"text-center font-bold text-lg mb-2",children:[(G||"COMPAGNIE").toUpperCase()," - LISTE GLOBALE DES RÉSERVATIONS"]}),s.jsxs("div",{className:"text-center text-sm text-gray-600 mb-4",children:[o&&p&&s.jsxs("span",{children:[o," • ",p," • ",d," → ",i]}),s.jsx("br",{}),s.jsxs("span",{children:[u.length," réservations — ",B," passagers — ",M," FCFA"]})]}),s.jsxs("table",{className:"w-full text-sm border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-100",children:[s.jsx("th",{className:"border p-2",children:"#"}),s.jsx("th",{className:"border p-2",children:"Nom"}),s.jsx("th",{className:"border p-2",children:"Téléphone"}),s.jsx("th",{className:"border p-2",children:"Trajet"}),s.jsx("th",{className:"border p-2",children:"Date"}),s.jsx("th",{className:"border p-2",children:"Heure"}),s.jsx("th",{className:"border p-2",children:"Canal"})]})}),s.jsx("tbody",{children:u.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:7,className:"text-center p-4 text-gray-500",children:"Aucune réservation trouvée."})}):u.map((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{className:"border p-2 text-center",children:a+1}),s.jsx("td",{className:"border p-2",children:e.nomClient}),s.jsx("td",{className:"border p-2",children:e.telephone}),s.jsxs("td",{className:"border p-2",children:[e.depart," → ",e.arrivee]}),s.jsx("td",{className:"border p-2",children:e.date}),s.jsx("td",{className:"border p-2",children:e.heure}),s.jsx("td",{className:"border p-2 text-center",children:e.canal==="guichet"?"🧾 Guichet":"🌐 En ligne"})]},e.id))})]}),s.jsx("div",{className:"mt-6 text-right text-sm italic",children:"Signature et cachet de la compagnie"})]})]}):s.jsx("div",{className:"p-6",children:"Chargement des données..."})};export{Y as default};
