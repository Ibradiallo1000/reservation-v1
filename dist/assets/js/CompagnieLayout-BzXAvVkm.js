import{a as O,Q as c,j as e,t as P,v as w,a2 as z,a8 as D,i as U,z as N,q as B,a9 as F,a5 as T,D as W,Y as $,O as Q,y as Y,n as _}from"./react-PtMwKKf1.js";import{u as G,b as H,d as u}from"../index-B745l0NT.js";import{q as C,w as f,k as j,m as A,l as J}from"./firebase-eGIzIftJ.js";import"./vendor-B5FTF_2c.js";const se=()=>{var y,v;const l=O(),{user:s,logout:p,company:a}=G(),[r,h]=c.useState(!1),t=H(a),o=n=>l.pathname===n||l.pathname.startsWith(n+"/"),[I,q]=c.useState(0),b=c.useRef(0),[S,L]=c.useState(0);c.useEffect(()=>{if(!(s!=null&&s.companyId))return;const n=[];return(async()=>{(await J(j(u,"companies",s.companyId,"agences"))).docs.map(g=>g.id).forEach(g=>{const k=C(j(u,"companies",s.companyId,"agences",g,"reservations"),f("statut","==","preuve_recue")),M=A(k,E=>{const x=E.size;x>0&&x>b.current&&R(),b.current=x,q(x)});n.push(M)})})(),()=>n.forEach(m=>m())},[s==null?void 0:s.companyId]),c.useEffect(()=>{if(!(s!=null&&s.companyId))return;const n=C(j(u,"avis"),f("companyId","==",s.companyId),f("visible","==",!1)),d=A(n,m=>{L(m.size)});return()=>d()},[s==null?void 0:s.companyId]);const R=()=>{try{const n=new Audio("/son.mp3");n.volume=.5,n.play().catch(d=>console.warn("Lecture bloquée",d))}catch(n){console.error("Erreur audio",n)}};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50 text-gray-900",children:[e.jsx("aside",{className:"hidden md:flex md:w-64 flex-col justify-between text-white shadow-xl",style:{backgroundColor:t.colors.primary},children:e.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"p-6 border-b border-white/20 flex items-center gap-3",children:[(a==null?void 0:a.logoUrl)&&e.jsx("img",{src:a.logoUrl,alt:"logo",className:"h-10 w-10 rounded-full shadow"}),e.jsx("h1",{className:"text-xl font-bold",children:(a==null?void 0:a.nom)||"Compagnie"})]}),e.jsxs("nav",{className:"flex flex-col p-4 space-y-2",children:[e.jsx(i,{to:"/compagnie/dashboard",label:"Tableau de bord",icon:e.jsx(P,{}),active:o("/compagnie/dashboard"),theme:t}),e.jsx(i,{to:"/compagnie/reservations-en-ligne",label:"Réservations en ligne",icon:e.jsx(w,{}),active:o("/compagnie/reservations-en-ligne"),badge:I,theme:t}),e.jsx(i,{to:"/compagnie/reservations",label:"Réservations",icon:e.jsx(w,{}),active:o("/compagnie/reservations"),theme:t}),e.jsx(i,{to:"/compagnie/agences",label:"Agences",icon:e.jsx(z,{}),active:o("/compagnie/agences"),theme:t}),e.jsx(i,{to:"/compagnie/avis-clients",label:"Avis Clients",icon:e.jsx(D,{}),active:o("/compagnie/avis-clients"),badge:S,theme:t}),e.jsx(i,{to:"/compagnie/personnel",label:"Personnel",icon:e.jsx(U,{}),active:o("/compagnie/personnel"),theme:t}),e.jsx(i,{to:"/compagnie/payment-settings",label:"Moyens de paiement",icon:e.jsx(N,{}),active:o("/compagnie/payment-settings"),theme:t}),e.jsx(i,{to:"/compagnie/parametres",label:"Paramètres",icon:e.jsx(N,{}),active:o("/compagnie/parametres"),theme:t}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/20",children:[e.jsx("p",{className:"text-xs uppercase opacity-80 px-4 mb-2",children:"Analytique"}),e.jsx(i,{to:"/compagnie/images",label:"Médias",icon:e.jsx(B,{}),active:o("/compagnie/images"),theme:t}),e.jsx(i,{to:"/compagnie/finances",label:"Finances",icon:e.jsx(F,{}),active:o("/compagnie/finances"),theme:t}),e.jsx(i,{to:"/compagnie/statistiques",label:"Statistiques",icon:e.jsx(T,{}),active:o("/compagnie/statistiques"),theme:t})]})]})]}),e.jsx("div",{className:"p-4 border-t border-white/20 sticky bottom-0 bg-opacity-90",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-medium",style:{backgroundColor:t.colors.secondary},children:((y=s==null?void 0:s.displayName)==null?void 0:y.charAt(0))||((v=s==null?void 0:s.email)==null?void 0:v.charAt(0))}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium truncate",children:(s==null?void 0:s.displayName)||(s==null?void 0:s.email)}),e.jsx("p",{className:"text-xs opacity-80",children:s==null?void 0:s.role})]})]}),e.jsx("button",{onClick:p,className:"p-2 rounded-md hover:bg-white/20 transition-colors",children:e.jsx(W,{className:"h-4 w-4 text-white"})})]})})]})}),e.jsx("main",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("header",{className:"bg-white shadow-sm p-4 md:hidden flex items-center justify-between",children:[e.jsx("button",{onClick:()=>h(!0),className:"p-2 rounded-md text-gray-500 hover:bg-gray-100",children:e.jsx($,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:(a==null?void 0:a.nom)||"Compagnie"}),e.jsx("div",{className:"w-5 h-5"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 bg-gray-50",children:e.jsx(Q,{})})]})})]})},i=({to:l,label:s,icon:p,active:a,badge:r,theme:h})=>e.jsxs(Y,{to:l,className:`flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 ${a?"font-bold shadow-sm":"opacity-90 hover:opacity-100"}`,style:{backgroundColor:a?h.colors.secondary:"transparent",color:a?"#fff":"#f1f1f1"},children:[e.jsx("span",{children:p}),e.jsx("span",{className:"flex-1 text-sm",children:s}),typeof r=="number"&&r>0&&e.jsx("span",{className:"ml-auto bg-red-500 text-xs text-white px-2 py-1 rounded-full",children:r}),e.jsx(_,{className:`w-4 h-4 ${a?"opacity-100 text-yellow-300":"opacity-0"}`})]});export{se as default};
