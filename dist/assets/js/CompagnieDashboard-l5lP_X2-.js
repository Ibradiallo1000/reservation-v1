import{a as t,j as e,ad as he,ae as ue,af as ge,u as pe,r as p}from"./react-DgrrIcw2.js";import{q as $,w as E,k as I,l as xe,T as U,m as O}from"./firebase-eGIzIftJ.js";import{u as be,b as fe,d as V}from"../index-p6Te0bSg.js";import{a5 as ve}from"./vendor-BHjJ2Hjk.js";import{L as ye,a as Ne}from"./LineChart-Cmjn5Xlf.js";import{C as X}from"./CartesianGrid-Baa3W_b2.js";import{X as Y,Y as Q,T as J,R as Z,B as we,a as ke}from"./BarChart-CrYhCjc_.js";const Ce=({dateRange:r,setDateRange:a,colors:s,className:l="",companyName:o})=>{const n=u=>{u[0]&&u[1]&&a([u[0],u[1]])};return t("div",{className:`flex flex-col md:flex-row justify-between items-center rounded-lg shadow-sm p-6 transition-colors duration-200 ${l}`,style:{backgroundColor:s.background,borderBottom:`4px solid ${s.primary}`},children:[t("div",{className:"flex-1",children:[t("h1",{className:"text-2xl font-bold mb-1 flex items-center gap-2",style:{color:"#111"},children:[o&&e("span",{className:"text-sm font-normal bg-gray-100 px-2 py-1 rounded-md",style:{color:s.primary},children:o}),"Tableau de bord"]}),t("p",{className:"text-sm text-gray-600",children:["Période du ",r[0].toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})," au ",r[1].toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})]})]}),e("div",{className:"mt-4 md:mt-0",children:e(he,{selectsRange:!0,startDate:r[0],endDate:r[1],onChange:n,locale:ve,dateFormat:"dd/MM/yyyy",className:"border border-gray-300 p-2 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",wrapperClassName:"date-picker",isClearable:!0,withPortal:!0,selectsDisabledDaysInRange:!0,disabledKeyboardNavigation:!0,dropdownMode:"select"})})]})},A=({title:r,value:a,icon:s,isCurrency:l=!1,trend:o,trendType:n,content:u,themeColor:f,className:D="",onClick:R})=>{const w=l?`${a.toLocaleString("fr-FR")} FCFA`:a.toLocaleString("fr-FR");return e("div",{onClick:R,className:`cursor-pointer rounded-xl p-6 shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-md ${D}`,style:f?{borderTop:`4px solid ${f}`}:{},children:t("div",{className:"flex justify-between items-start",children:[t("div",{children:[e("h4",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider",children:r}),u?e("div",{className:"mt-2",children:u}):t("div",{className:"mt-2 flex items-baseline",children:[e("p",{className:"text-2xl font-semibold text-gray-900",children:w}),o&&e("span",{className:`ml-2 text-sm font-medium ${n==="positive"?"text-green-600":"text-red-600"}`,children:o})]})]}),s&&e("div",{className:"p-3 rounded-lg bg-opacity-10",style:{backgroundColor:f},children:s})]})})},De=({data:r})=>t("div",{className:"bg-white rounded shadow p-4",children:[e("h3",{className:"font-semibold mb-2",children:"Évolution des revenus"}),e(Z,{width:"100%",height:300,children:t(ye,{data:r,children:[e(X,{strokeDasharray:"3 3"}),e(Y,{dataKey:"date"}),e(Q,{}),e(J,{formatter:a=>`${a.toLocaleString()} FCFA`}),e(Ne,{type:"monotone",dataKey:"revenue",stroke:"#3b82f6",strokeWidth:2})]})})]}),Re=({data:r})=>t("div",{className:"bg-white rounded shadow p-4",children:[e("h3",{className:"font-semibold mb-2",children:"Performance par agence"}),e(Z,{width:"100%",height:300,children:t(we,{data:r,children:[e(X,{strokeDasharray:"3 3"}),e(Y,{dataKey:"nom"}),e(Q,{}),e(J,{formatter:a=>`${a.toLocaleString()} FCFA`}),e(ke,{dataKey:"revenus",fill:"#10b981"})]})})]}),Le=({agencies:r})=>{const a=[...r].sort((s,l)=>l.revenus-s.revenus).slice(0,5);return t("div",{className:"bg-white rounded shadow p-4",children:[e("h3",{className:"font-semibold mb-2",children:"Top agences"}),e("ul",{children:a.map((s,l)=>e("li",{className:"py-2 border-b last:border-b-0",children:t("div",{className:"flex justify-between",children:[t("span",{children:[l+1,". ",s.nom," (",s.ville,")"]}),t("span",{children:[s.revenus.toLocaleString()," FCFA"]})]})},s.id))})]})},Se=({data:r,className:a="",showActions:s=!1,onRowClick:l})=>{const o=n=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",maximumFractionDigits:0}).format(n);return t("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden ${a}`,children:[e("div",{className:"px-6 py-4 border-b border-gray-200",children:e("h3",{className:"text-lg font-semibold text-gray-900",children:"Détails des agences"})}),e("div",{className:"overflow-x-auto",children:t("table",{className:"min-w-full divide-y divide-gray-200",children:[e("thead",{className:"bg-gray-50",children:t("tr",{children:[e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agence"}),e("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ville"}),e("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Réservations"}),e("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenus"}),e("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Évolution"}),s&&e("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(n=>t("tr",{className:`hover:bg-gray-50 ${l?"cursor-pointer":""}`,onClick:()=>l&&l(n.id),children:[e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"text-sm font-medium text-gray-900",children:n.nom})}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:e("div",{className:"text-sm text-gray-500",children:n.ville})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:n.reservations.toLocaleString("fr-FR")}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:o(n.revenus)}),e("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm",children:n.trend!==void 0&&t("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${n.trend>=0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[n.trend>=0?e(ue,{className:"-ml-0.5 mr-1 h-3 w-3 text-green-500"}):e(ge,{className:"-ml-0.5 mr-1 h-3 w-3 text-red-500"}),Math.abs(n.trend),"%"]})}),s&&t("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e("button",{className:"text-blue-600 hover:text-blue-900 mr-3",children:"Voir"}),e("button",{className:"text-indigo-600 hover:text-indigo-900",children:"Éditer"})]})]},n.id))})]})}),r.length>0&&e("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-200",children:t("div",{className:"flex items-center justify-between",children:[t("div",{className:"text-sm text-gray-500",children:["Affichage de ",e("span",{className:"font-medium",children:"1"})," à ",e("span",{className:"font-medium",children:r.length})," agences"]}),t("div",{className:"flex space-x-2",children:[e("button",{className:"px-3 py-1 border rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Précédent"}),e("button",{className:"px-3 py-1 border rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Suivant"})]})]})})]})},Ve=()=>{const{user:r}=be(),a=pe(),[s,l]=p.useState(null),{colors:o,classes:n}=fe(s),[u,f]=p.useState(!0),[D,R]=p.useState(null),[w,_]=p.useState([new Date(new Date().setDate(new Date().getDate()-30)),new Date]),[k,ee]=p.useState([]),[te,re]=p.useState([]),[m,P]=p.useState({totalAgencies:0,totalReservations:0,totalRevenue:0,growthRate:0,totalChannels:{}}),B=p.useCallback(async()=>{if(!(r!=null&&r.companyId))return;const d=$(I(V,"companies"),E("id","==",r.companyId)),g=await xe(d);if(g.empty)return;const h=g.docs[0],i=h.data();l({id:h.id,slug:i.slug,nom:i.nom,services:i.services,featuredTrips:i.featuredTrips,couleurPrimaire:i.couleurPrimaire,couleurSecondaire:i.couleurSecondaire,couleurAccent:i.couleurAccent,couleurTertiaire:i.couleurTertiaire,logoUrl:i.logoUrl,villesDisponibles:i.villesDisponibles||[],imagesSlider:i.imagesSlider||[],sliderImages:i.sliderImages||[],suggestions:i.suggestions||[]})},[r==null?void 0:r.companyId]),ae=d=>{if(d.length===0)return 0;const h=d.reduce((i,j)=>i+j.revenus,0)/d.length;return parseFloat((h*.1).toFixed(2))};p.useEffect(()=>{if(!(r!=null&&r.companyId))return;const[d,g]=w;if(!d||!g)return;const h=[],i=U.fromDate(d),j=U.fromDate(g);return(async()=>{try{f(!0),R(null),await B();const C=$(I(V,"companies",r.companyId,"agences")),ne=O(C,ie=>{const G=ie.docs.map(c=>({id:c.id,nom:c.data().nom,ville:c.data().ville,companyId:r.companyId}));P(c=>({...c,totalAgencies:G.length})),h.forEach(c=>c()),h.length=0;const F={},T={};G.forEach(c=>{const le=$(I(V,"companies",r.companyId,"agences",c.id,"reservations"),E("createdAt",">=",i),E("createdAt","<=",j)),oe=O(le,de=>{let K=0,W=0;const M={};de.forEach(y=>{const x=y.data(),b=(x.canal||"inconnu").toLowerCase().includes("ligne")?"En ligne":"Guichet";M[b]=(M[b]||0)+1,F[b]=(F[b]||0)+1;const N=x.montant||0;W+=N,K+=1;const q=x.createdAt.toDate().toLocaleDateString("fr-FR");T[q]=(T[q]||0)+N});const ce={...c,reservations:K,revenus:W,canaux:M};ee(y=>{const x=[...y.filter(S=>S.id!==c.id),ce];return P(S=>({...S,totalReservations:x.reduce((b,N)=>b+N.reservations,0),totalRevenue:x.reduce((b,N)=>b+N.revenus,0),totalChannels:{...F},growthRate:ae(x)})),x});const L=new Date(d),me=new Date(g),H=[];for(;L<=me;){const y=L.toLocaleDateString("fr-FR");H.push({date:y,revenue:T[y]||0}),L.setDate(L.getDate()+1)}re(H)});h.push(oe)})});h.push(ne)}catch(C){console.error("Erreur onSnapshot dashboard compagnie:",C),R("Erreur de chargement des données. Veuillez réessayer.")}finally{f(!1)}})(),()=>{h.forEach(C=>C())}},[r==null?void 0:r.companyId,w,B]);const v=Object.values(m.totalChannels).reduce((d,g)=>d+g,0),z=m.totalChannels.Guichet||0,se=m.totalChannels["En ligne"]||0;return u?e("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:t("div",{className:"text-center",children:[e("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"}),e("h2",{className:"text-xl font-semibold text-gray-700",children:"Chargement du tableau de bord..."}),e("p",{className:"text-gray-500 mt-2",children:"Vos données seront bientôt prêtes"})]})}):D?e("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 p-4",children:t("div",{className:"bg-white p-8 rounded-xl shadow-lg max-w-md w-full text-center border-l-4 border-red-500",children:[e("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:e("svg",{className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Une erreur est survenue"}),e("p",{className:"text-gray-600 mb-6",children:D}),e("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:"Réessayer"})]})}):t("div",{className:`min-h-screen p-6 space-y-8 ${n} bg-gradient-to-br from-gray-50 to-gray-100`,children:[e(Ce,{dateRange:w,setDateRange:_,colors:o,className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100"}),t("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e(A,{title:"Agences",value:m.totalAgencies,onClick:()=>a("/compagnie/agences"),icon:e("div",{className:"p-3 rounded-full bg-blue-100 text-blue-600",children:e("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),themeColor:o.primary}),e(A,{title:"Réservations",value:m.totalReservations,onClick:()=>a("/compagnie/reservations"),trend:m.growthRate>=0?`+${m.growthRate}%`:`${m.growthRate}%`,trendType:m.growthRate>=0?"positive":"negative",icon:e("div",{className:"p-3 rounded-full bg-green-100 text-green-600",children:e("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),themeColor:o.secondary}),e(A,{title:"Revenus",value:m.totalRevenue,onClick:()=>a("/compagnie/finances"),isCurrency:!0,icon:e("div",{className:"p-3 rounded-full bg-purple-100 text-purple-600",children:e("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),themeColor:o.accent}),e(A,{title:"Répartition",onClick:()=>a("/compagnie/statistiques"),icon:e("div",{className:"p-3 rounded-full bg-amber-100 text-amber-600",children:t("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"}),e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"})]})}),content:t("div",{className:"mt-2",children:[t("div",{className:"flex items-center justify-between mb-1",children:[t("div",{className:"flex items-center",children:[e("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),e("span",{className:"text-sm",children:"Guichet"})]}),t("span",{className:"text-sm font-medium",children:[v?Math.round(z/v*100):0,"%"]})]}),t("div",{className:"flex items-center justify-between",children:[t("div",{className:"flex items-center",children:[e("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e("span",{className:"text-sm",children:"En ligne"})]}),t("span",{className:"text-sm font-medium",children:[v?Math.round(se/v*100):0,"%"]})]}),e("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full",style:{width:`${v?z/v*100:50}%`}})})]}),themeColor:o.tertiary,value:0})]}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[t("div",{className:"flex items-center justify-between mb-4",children:[e("h3",{className:"text-lg font-semibold text-gray-800",children:"Évolution des revenus"}),t("div",{className:"flex space-x-2",children:[e("button",{className:"px-3 py-1 text-xs bg-blue-50 text-blue-600 rounded-md",children:"30j"}),e("button",{className:"px-3 py-1 text-xs bg-gray-50 text-gray-600 rounded-md",children:"90j"}),e("button",{className:"px-3 py-1 text-xs bg-gray-50 text-gray-600 rounded-md",children:"1an"})]})]}),e(De,{data:te})]}),t("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Performance des agences"}),e(Re,{data:k})]})]}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[t("div",{className:"flex items-center justify-between mb-4",children:[e("h3",{className:"text-lg font-semibold text-gray-800",children:"Top 5 agences"}),e("button",{className:"text-sm text-blue-600 hover:text-blue-800",onClick:()=>a("/compagnie/agences"),children:"Voir tout"})]}),e(Le,{agencies:k.slice(0,5)})]}),t("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[t("div",{className:"flex items-center justify-between mb-4",children:[e("h3",{className:"text-lg font-semibold text-gray-800",children:"Détails des agences"}),e("div",{className:"flex space-x-2",children:e("button",{className:"px-3 py-1 text-xs bg-gray-50 text-gray-600 rounded-md",children:"Exporter"})})]}),e("div",{className:"overflow-x-auto",children:e(Se,{data:k,className:"min-w-full divide-y divide-gray-200"})}),t("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-600",children:[t("div",{children:["Affichage 1-",Math.min(k.length,10)," sur ",k.length," agences"]}),t("div",{className:"flex space-x-2",children:[e("button",{className:"px-3 py-1 bg-gray-50 rounded-md disabled:opacity-50",disabled:!0,children:"Précédent"}),e("button",{className:"px-3 py-1 bg-gray-50 rounded-md",children:"Suivant"})]})]})]})]})]})};export{Ve as default};
