import{r as i,a as g,j as r}from"./react-KXT1Riez.js";import{u as E,t as v,q as I,o as w,F as T,T as $,G as j}from"./firebase-DYTOaTLw.js";import{c as D,e as C,d as u}from"../index-CBC3XRHi.js";import{U as F}from"./UploadImageCloudinary-B0II4DGr.js";import"./vendor-B27hBV_J.js";const P=w(u,"platform","settings"),k=()=>{const m=D(void 0),{setHeader:x,resetHeader:S}=C(),[n,p]=i.useState([]),[A,h]=i.useState(!1),[y,b]=i.useState(null);i.useEffect(()=>(x({title:"Médias plateforme",subtitle:n.length?`${n.length} élément(s)`:"Aucun média",bg:`linear-gradient(90deg, ${m.colors.primary} 0%, ${m.colors.secondary} 100%)`,fg:"#fff"}),()=>S()),[n.length,m.colors.primary,m.colors.secondary]),i.useEffect(()=>{(async()=>{h(!0),b(null);try{const d=(await E(v(u,"medias"))).docs.map(a=>{var s,c;const o=a.data();return{id:a.id,url:String(o.url??""),type:o.type||"autre",nom:String(o.nom??"Image"),createdAt:((c=(s=o.createdAt)==null?void 0:s.toDate)==null?void 0:c.call(s))??null,source:"collection"}}),l=await I(P),t=l.exists()?l.data():{},U=[t.logoUrl&&{url:t.logoUrl,type:"logo",nom:"Logo plateforme"},t.faviconUrl&&{url:t.faviconUrl,type:"favicon",nom:"Favicon"},t.banniereUrl&&{url:t.banniereUrl,type:"banniere",nom:"Bannière"},...(t.imagesSlider||[]).map((a,o)=>({url:a,type:"slider",nom:`Slider #${o+1}`}))].filter(Boolean).map(a=>({...a,createdAt:null,source:"settings"})),f=new Map;[...d,...U].forEach(a=>{f.has(a.url)||f.set(a.url,a)}),p(Array.from(f.values()).sort((a,o)=>{var s,c;return(((s=o.createdAt)==null?void 0:s.getTime())||0)-(((c=a.createdAt)==null?void 0:c.getTime())||0)}))}catch(e){console.error("Erreur chargement médias plateforme:",e),b("Impossible de charger les médias de la plateforme.")}finally{h(!1)}})()},[]);const N=async e=>{if(e.source!=="collection"||!e.id){alert("Image gérée depuis Paramètres > Plateforme.");return}window.confirm(`Supprimer « ${e.nom} » ?`)&&(await j(w(u,"medias",e.id)),p(d=>d.filter(l=>l.id!==e.id)))};return g("div",{className:"p-4 md:p-6 max-w-6xl mx-auto",children:[r("div",{className:"bg-white p-4 rounded-xl shadow-sm border mb-6",children:r(F,{label:"Ajouter une image à la bibliothèque plateforme",dossier:"platform",collectionName:"medias",onUpload:async e=>{const d=await T(v(u,"medias"),{url:e,type:"autre",nom:"Image",createdAt:$.now()});p(l=>[{id:d.id,url:e,type:"autre",nom:"Image",createdAt:new Date,source:"collection"},...l])}})}),y&&r("div",{className:"bg-red-50 text-red-700 p-4 rounded mb-4",children:y}),A?r("p",{children:"Chargement…"}):n.length===0?r("div",{className:"bg-orange-50 p-6 rounded",children:"Aucun média de plateforme."}):r("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:n.map(e=>g("div",{className:"border rounded overflow-hidden",children:[r("img",{src:e.url,alt:e.nom,className:"h-40 w-full object-cover"}),g("div",{className:"p-2 text-sm flex justify-between",children:[r("span",{children:e.nom}),e.source==="collection"&&r("button",{onClick:()=>N(e),className:"text-red-600",children:"Supprimer"})]})]},`${e.source}-${e.id??e.url}`))})]})};export{k as default};
