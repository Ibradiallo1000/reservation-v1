import{b as V,u as q,ay as G,r as m,j as r,a,az as O,aA as Z,a2 as H,aB as U,aC as _,aD as F,at as L,aE as $,aF as E}from"./react-KXT1Riez.js";import{u as j,t as J,L as M}from"./firebase-DYTOaTLw.js";import{d as k}from"../index-b0dmvJTQ.js";import"./vendor-B27hBV_J.js";const N=n=>n==null?void 0:n.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),T=n=>n?n.charAt(0).toUpperCase()+n.slice(1).toLowerCase():"",A={wifi:{icon:E,label:"Wi-Fi",color:"text-purple-600"},wifi_gratuit:{icon:E,label:"Wi-Fi gratuit",color:"text-purple-600"},climatisation:{icon:$,label:"Climatisation",color:"text-blue-600"},clim:{icon:$,label:"Climatisation",color:"text-blue-600"},prise_usb:{icon:L,label:"Prise USB",color:"text-yellow-600"},usb:{icon:L,label:"Prise USB",color:"text-yellow-600"},sieges_confort:{icon:F,label:"Sièges confort",color:"text-green-600"},sieges:{icon:F,label:"Sièges confort",color:"text-green-600"},ecran_tv:{icon:_,label:"Écran TV",color:"text-red-600"},tv:{icon:_,label:"Écran TV",color:"text-red-600"}},re=()=>{const n=V(),I=q(),[P]=G(),d=I.state,b={departure:P.get("from")||"",arrival:P.get("to")||""},t=m.useMemo(()=>d!=null&&d.departure&&(d!=null&&d.arrival)?d:b.departure&&b.arrival?b:null,[d,b.departure,b.arrival]),[w,z]=m.useState({}),[y,C]=m.useState({}),[D,S]=m.useState(!0),[v,B]=m.useState(""),[K,W]=m.useState({});m.useEffect(()=>{if(!(t!=null&&t.departure)||!(t!=null&&t.arrival)){C({}),S(!1);return}(async()=>{S(!0);try{const e=await j(J(k,"companies")),u={};e.forEach(l=>{const o=l.data();u[l.id]={...o,id:l.id}}),z(u);const p=await j(M(k,"weeklyTrips")),i={},x=N(t.departure),g=N(t.arrival);p.forEach(l=>{const o=l.data();if(N(o.departure)!==x||N(o.arrival)!==g)return;const h=l.ref.path.split("/")[1];(i[h]||(i[h]=[])).push({id:l.id,companyId:h,departure:o.departure,arrival:o.arrival,price:o.price,places:o.places||0})}),C(i);const f=await j(M(k,"reservations")),s={};f.forEach(l=>{const o=l.data();if(!["en_attente","payé","preuve_recue"].includes(o.statut))return;const h=`${o.companyId}_${o.weeklyTripId}`;s[h]=(s[h]||0)+(o.places||0)}),W(s)}catch(e){console.error("❌ Erreur recherche plateforme:",e),C({})}finally{S(!1)}})()},[t==null?void 0:t.departure,t==null?void 0:t.arrival]);const R=m.useMemo(()=>{const c=Object.keys(y);return v.trim()?c.filter(e=>{var u,p;return(p=(u=w[e])==null?void 0:u.nom)==null?void 0:p.toLowerCase().includes(v.toLowerCase())}):c},[y,w,v]);return t?a("div",{className:"min-h-screen bg-gray-50",children:[r("header",{className:"bg-white shadow sticky top-0 z-50",children:a("div",{className:"max-w-6xl mx-auto flex items-center justify-between px-4 py-3",children:[a("button",{onClick:()=>n("/"),className:"flex items-center text-orange-600 hover:text-orange-700 transition-colors",children:[r(O,{className:"w-5 h-5 mr-1"}),"Retour"]}),r("span",{className:"font-bold text-orange-600 text-xl",children:"Teliya"}),r("div",{className:"w-10"})]})}),a("div",{className:"max-w-6xl mx-auto px-4 mt-4",children:[a("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-2 items-center",children:[r("span",{className:"px-3 py-1.5 rounded-xl bg-orange-50 border border-orange-100 font-semibold truncate",children:T(t.departure)}),r(Z,{className:"text-gray-400"}),r("span",{className:"px-3 py-1.5 rounded-xl bg-emerald-50 border border-emerald-100 font-semibold truncate text-right",children:T(t.arrival)})]}),a("div",{className:"relative mt-3 sm:w-[320px] sm:ml-auto",children:[r(H,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),r("input",{value:v,onChange:c=>B(c.target.value),placeholder:"Filtrer par compagnie",className:"pl-9 border border-gray-300 rounded-lg py-2 px-3 text-sm w-full focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})]}),r("div",{className:"max-w-6xl mx-auto p-4 pb-6",children:D?r("div",{className:"flex justify-center py-12",children:r("div",{className:"h-10 w-10 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):R.length===0?a("div",{className:"text-center py-12",children:[r("p",{className:"text-gray-600 mb-4",children:"Aucune compagnie disponible pour ce trajet"}),r("button",{onClick:()=>n("/"),className:"bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded-lg transition-colors",children:"Nouvelle recherche"})]}):r("div",{className:"space-y-3",children:R.map(c=>{const e=w[c],u=y[c],p=Math.min(...u.map(g=>g.price)),i=(e==null?void 0:e.services)||[],x=i.slice(0,5);return a("div",{className:"bg-white rounded-xl shadow-sm p-4 border border-gray-200 hover:shadow-md transition-shadow",children:[a("div",{className:"block md:hidden",children:[r("div",{className:"flex items-start justify-between mb-2",children:a("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e!=null&&e.logoUrl?r("img",{src:e.logoUrl,alt:e.nom,className:"w-10 h-10 rounded-full object-cover border border-gray-200"}):r("div",{className:"w-10 h-10 rounded-full grid place-items-center bg-orange-50 border border-orange-100",children:r(U,{className:"text-orange-500 w-5 h-5"})}),a("div",{className:"min-w-0",children:[r("h3",{className:"font-semibold truncate text-sm",style:{color:(e==null?void 0:e.couleurPrimaire)||"rgb(234,88,12)"},children:e==null?void 0:e.nom}),x.length>0&&a("div",{className:"flex items-center gap-1 mt-1",children:[x.map((g,f)=>{const s=A[g];if(!s)return null;const l=s.icon;return r("div",{className:`${s.color} p-0.5 rounded`,title:s.label,children:r(l,{className:"w-3 h-3"})},f)}),i.length>5&&a("span",{className:"text-xs text-gray-500 ml-1",children:["+",i.length-5]})]})]})]})}),a("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[a("div",{className:"text-emerald-600 font-bold text-base",children:[p.toLocaleString()," FCFA"]}),r("button",{onClick:()=>n(`/${e.slug}/booking?departure=${encodeURIComponent(t.departure)}&arrival=${encodeURIComponent(t.arrival)}`),className:"bg-orange-600 hover:bg-orange-700 text-white px-3 py-1.5 rounded-lg text-xs font-medium transition-colors",children:"Réserver"})]})]}),a("div",{className:"hidden md:flex items-center justify-between",children:[a("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e!=null&&e.logoUrl?r("img",{src:e.logoUrl,alt:e.nom,className:"w-12 h-12 rounded-full object-cover border border-gray-200"}):r("div",{className:"w-12 h-12 rounded-full grid place-items-center bg-orange-50 border border-orange-100",children:r(U,{className:"text-orange-500 w-6 h-6"})}),a("div",{className:"min-w-0",children:[r("h3",{className:"font-semibold truncate",style:{color:(e==null?void 0:e.couleurPrimaire)||"rgb(234,88,12)"},children:e==null?void 0:e.nom}),x.length>0&&a("div",{className:"flex items-center gap-2 mt-1.5",children:[x.map((g,f)=>{const s=A[g];if(!s)return null;const l=s.icon;return a("div",{className:`${s.color} p-1 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors group relative`,title:s.label,children:[r(l,{className:"w-4 h-4"}),r("span",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 px-2 py-1 text-xs text-white bg-gray-800 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10",children:s.label})]},f)}),i.length>5&&a("span",{className:"text-xs text-gray-500 ml-1",children:["+",i.length-5," service",i.length-5>1?"s":""]})]})]})]}),a("div",{className:"flex items-center gap-6",children:[a("div",{className:"text-right",children:[a("div",{className:"text-emerald-600 font-bold text-xl",children:[p.toLocaleString()," FCFA"]}),r("div",{className:"text-xs text-gray-500 mt-0.5",children:"À partir de"})]}),r("button",{onClick:()=>n(`/${e.slug}/booking?departure=${encodeURIComponent(t.departure)}&arrival=${encodeURIComponent(t.arrival)}`),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2.5 rounded-lg font-medium transition-colors whitespace-nowrap text-sm",children:"Réserver"})]})]})]},c)})})})]}):r("div",{className:"min-h-screen flex items-center justify-center",children:r("p",{children:"Paramètres manquants"})})};export{re as default};
