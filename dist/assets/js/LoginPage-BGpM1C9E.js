import{r as o,b as F,j as e,a as s,a0 as z,a1 as B,a2 as T,a3 as O,a4 as U,A as W,F as V,L as J}from"./react-DB_4kGOy.js";import{u as G,M as H,N as P,O as K,q as Q,o as X}from"./firebase-lLzYRzUk.js";import{a as g,p as R,d as Y}from"../index-Bkmir__O.js";import"./vendor-C-DAJou6.js";const M=a=>{const r=(a||"user").toString().trim().toLowerCase();return r==="chef_agence"||r==="chefagence"?"chefAgence":r==="admin plateforme"||r==="admin_platforme"?"admin_platforme":r==="admin compagnie"||r==="admin_compagnie"?"admin_compagnie":r==="agent_courrier"||r==="agentcourrier"?"agentCourrier":r==="superviseur"?"superviseur":r==="guichetier"?"guichetier":r==="comptable"?"comptable":r==="compagnie"?"compagnie":r==="embarquement"?"embarquement":"user"},Z=a=>{switch(a){case"admin_platforme":return"/admin/dashboard";case"admin_compagnie":case"compagnie":return"/compagnie/dashboard";case"chefAgence":return"/agence/dashboard";case"guichetier":return"/agence/guichet";case"superviseur":case"agentCourrier":return"/agence/dashboard";case"embarquement":return"/agence/embarquement";case"comptable":return"/agence/comptabilite";default:return"/"}},q=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.trim()),I=6,se=()=>{const[a,N]=o.useState(""),[r,_]=o.useState(""),[f,L]=o.useState(!1),[h,C]=o.useState(!1),[l,p]=o.useState(""),[c,x]=o.useState(""),[S,m]=o.useState(""),[b,u]=o.useState(""),j=F(),E=async t=>{var A;const i=(await P(g.currentUser,!0)).claims;console.log("claims after login:",i);let d=i!=null&&i.role?M(String(i.role)):void 0;if(!d||!(d in R)){const k=await Q(X(Y,"users",t));if(k.exists()){const y=k.data();d=M(y==null?void 0:y.role)}}if(!d||!(d in R)){m("Votre compte n'a pas encore de rôle valide. Contactez un administrateur."),u("error");return}localStorage.setItem("user",JSON.stringify({uid:t,email:(A=g.currentUser)==null?void 0:A.email,role:d,companyId:i&&i.companyId||void 0,agencyId:i&&i.agencyId||void 0})),j(Z(d),{replace:!0})};o.useEffect(()=>{const t=G(g,async n=>{if(n)try{await E(n.uid)}catch(i){console.error("auto-redirect error:",i)}});return()=>t()},[]);const w=(t=a)=>{if(!t.trim())return p("Adresse e-mail requise.");if(!q(t))return p("Adresse e-mail invalide.");p("")},v=(t=r)=>{if(!t)return x("Mot de passe requis.");if(t.length<I)return x(`Au moins ${I} caractères.`);x("")},$=async t=>{if(t.preventDefault(),m(""),u(""),w(),v(),!(!a||!r||l||c)){C(!0);try{const n=await H(g,a.trim(),r);await P(n.user,!0),await E(n.user.uid)}catch(n){console.error("login error:",n),m("Erreur de connexion : "+((n==null?void 0:n.message)||"")),u("error")}finally{C(!1)}}},D=async()=>{if(m(""),u(""),!a.trim()){p("Renseigne ton e-mail pour réinitialiser le mot de passe.");return}if(!q(a)){p("Adresse e-mail invalide.");return}try{await K(g,a.trim()),m("Un e-mail de réinitialisation t'a été envoyé."),u("success")}catch(t){m("Échec de l'envoi : "+((t==null?void 0:t.message)||"")),u("error")}};return h||l||c||a.trim(),e("div",{className:"min-h-screen w-full bg-gradient-to-br from-orange-50 via-white to-amber-50 flex items-center justify-center p-4",children:s("div",{className:"w-full max-w-md",children:[s("div",{className:"relative bg-white border border-orange-100 rounded-2xl shadow-xl shadow-orange-100/50",children:[s("div",{className:"px-8 pt-8 text-center",children:[e("div",{className:"mx-auto h-12 w-12 rounded-2xl bg-orange-500/10 flex items-center justify-center",children:s("svg",{viewBox:"0 0 24 24",className:"h-6 w-6 text-orange-600",children:[e("circle",{cx:"12",cy:"12",r:"9",fill:"currentColor",opacity:"0.15"}),e("circle",{cx:"12",cy:"12",r:"5.5",fill:"none",stroke:"currentColor",strokeWidth:"1.5"}),e("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"})]})}),e("h1",{className:"mt-4 text-2xl font-bold tracking-tight text-slate-900",children:"Connexion"}),e("p",{className:"mt-1 text-sm text-slate-600",children:"Accédez à votre espace en toute sécurité."})]}),s("form",{onSubmit:$,className:"px-8 pb-8 pt-6 space-y-5",children:[s("div",{className:"space-y-2",children:[e("label",{htmlFor:"email",className:"block text-sm font-medium text-slate-700",children:"Adresse e-mail"}),s("div",{className:"relative",children:[e("span",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e(z,{className:"h-4 w-4 text-slate-400"})}),e("input",{id:"email",type:"email",placeholder:"exemple@domaine.com",value:a,onChange:t=>{N(t.target.value),l&&w(t.target.value)},onBlur:()=>w(),className:`w-full rounded-xl border bg-white pl-10 pr-3 py-3 text-sm text-slate-900 placeholder:text-slate-400 outline-none ring-2 ring-transparent transition
                    ${l?"border-red-300 focus:ring-red-100":"border-slate-200 focus:border-orange-500 focus:ring-orange-100"}`,autoComplete:"email"})]}),l&&e("p",{className:"text-xs text-red-600",children:l})]}),s("div",{className:"space-y-2",children:[e("label",{htmlFor:"password",className:"block text-sm font-medium text-slate-700",children:"Mot de passe"}),s("div",{className:"relative",children:[e("span",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e(B,{className:"h-4 w-4 text-slate-400"})}),e("input",{id:"password",type:f?"text":"password",placeholder:"••••••••",value:r,onChange:t=>{_(t.target.value),c&&v(t.target.value)},onBlur:()=>v(),className:`w-full rounded-xl border bg-white pl-10 pr-10 py-3 text-sm text-slate-900 placeholder:text-slate-400 outline-none ring-2 ring-transparent transition
                    ${c?"border-red-300 focus:ring-red-100":"border-slate-200 focus:border-orange-500 focus:ring-orange-100"}`,autoComplete:"current-password"}),e("button",{type:"button",onClick:()=>L(t=>!t),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600 transition","aria-label":f?"Masquer le mot de passe":"Afficher le mot de passe",children:f?e(T,{className:"h-4 w-4"}):e(O,{className:"h-4 w-4"})})]}),c&&e("p",{className:"text-xs text-red-600",children:c})]}),s("div",{className:"flex items-center justify-between",children:[s("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600 select-none",children:[e("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-orange-600 focus:ring-0"}),"Se souvenir de moi"]}),e("button",{type:"button",className:"text-sm font-medium text-orange-600 hover:text-orange-700",onClick:D,children:"Mot de passe oublié ?"})]}),S&&s("div",{className:`flex items-start gap-2 rounded-xl border px-3 py-2.5
                ${b==="success"?"border-emerald-200 bg-emerald-50":"border-red-200 bg-red-50"}`,children:[b==="success"?e(U,{className:"h-4 w-4 text-emerald-600 mt-0.5"}):e(W,{className:"h-4 w-4 text-red-500 mt-0.5"}),e("p",{className:`text-sm ${b==="success"?"text-emerald-800":"text-red-700"}`,children:S})]}),e("button",{type:"submit",disabled:h||!!l||!!c||!a.trim()||!r,className:`w-full inline-flex items-center justify-center gap-2 rounded-xl px-4 py-3 text-sm font-semibold text-white transition
                ${h||l||c||!a.trim()||!r?"bg-orange-300/70 cursor-not-allowed":"bg-orange-600 hover:bg-orange-700 active:bg-orange-800 shadow-lg shadow-orange-600/20"}`,children:h?s(V,{children:[e(J,{className:"h-4 w-4 animate-spin"}),"Connexion en cours..."]}):"Se connecter"}),e("p",{className:"text-center text-xs text-slate-500",children:"En vous connectant, vous acceptez nos Conditions et notre Politique de confidentialité."})]})]}),e("div",{className:"mt-6 text-center",children:s("p",{className:"text-xs text-slate-500",children:["Propulsé par ",e("span",{className:"font-semibold text-orange-700",children:"Teliya"})]})})]})})};export{se as default};
