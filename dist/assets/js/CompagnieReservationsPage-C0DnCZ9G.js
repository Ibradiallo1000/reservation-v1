import{c as C,r as x,j as e,al as W,am as z,an as J,ao as Q,ap as Y}from"./react-BKlva80Y.js";import{q as B,j as P,w as R,k as $}from"./firebase-1zyXmG6H.js";import{u as Z,d as q}from"../index-BlZmgUmn.js";import"./vendor-CZDa83Cj.js";var H={exports:{}};(function(p,T){(function(S,f){f()})(C,function(){function S(a,s){return typeof s>"u"?s={autoBom:!1}:typeof s!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob(["\uFEFF",a],{type:a.type}):a}function f(a,s,d){var n=new XMLHttpRequest;n.open("GET",a),n.responseType="blob",n.onload=function(){h(n.response,s,d)},n.onerror=function(){console.error("could not download file")},n.send()}function F(a){var s=new XMLHttpRequest;s.open("HEAD",a,!1);try{s.send()}catch{}return 200<=s.status&&299>=s.status}function m(a){try{a.dispatchEvent(new MouseEvent("click"))}catch{var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(s)}}var u=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof C=="object"&&C.global===C?C:void 0,N=u.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),h=u.saveAs||(typeof window!="object"||window!==u?function(){}:"download"in HTMLAnchorElement.prototype&&!N?function(a,s,d){var n=u.URL||u.webkitURL,i=document.createElement("a");s=s||a.name||"download",i.download=s,i.rel="noopener",typeof a=="string"?(i.href=a,i.origin===location.origin?m(i):F(i.href)?f(a,s,d):m(i,i.target="_blank")):(i.href=n.createObjectURL(a),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){m(i)},0))}:"msSaveOrOpenBlob"in navigator?function(a,s,d){if(s=s||a.name||"download",typeof a!="string")navigator.msSaveOrOpenBlob(S(a,d),s);else if(F(a))f(a,s,d);else{var n=document.createElement("a");n.href=a,n.target="_blank",setTimeout(function(){m(n)})}}:function(a,s,d,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),typeof a=="string")return f(a,s,d);var i=a.type==="application/octet-stream",k=/constructor/i.test(u.HTMLElement)||u.safari,b=/CriOS\/[\d]+/.test(navigator.userAgent);if((b||i&&k||N)&&typeof FileReader<"u"){var j=new FileReader;j.onloadend=function(){var g=j.result;g=b?g:g.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=g:location=g,n=null},j.readAsDataURL(a)}else{var y=u.URL||u.webkitURL,w=y.createObjectURL(a);n?n.location=w:location.href=w,n=null,setTimeout(function(){y.revokeObjectURL(w)},4e4)}});u.saveAs=h.saveAs=h,p.exports=h})})(H);var ee=H.exports;const re=()=>{const{user:p}=Z(),[T,S]=x.useState([]),[f,F]=x.useState([]),[m,u]=x.useState(null),[N,h]=x.useState({agences:!0,reservations:!0}),[a,s]=x.useState(!1),[d,n]=x.useState(""),[i,k]=x.useState(""),[b,j]=x.useState(""),[y,w]=x.useState(""),[g,G]=x.useState("tous"),[A,L]=x.useState(1),D=10,_=async()=>{if(p!=null&&p.companyId)try{const t=B(P(q,"agences"),R("companyId","==",p.companyId)),o=(await $(t)).docs.map(l=>({id:l.id,nom:l.data().ville||l.data().nom}));S(o)}finally{h(t=>({...t,agences:!1}))}},X=async()=>{if(p!=null&&p.companyId)try{const t=B(P(q,"reservations"),R("companyId","==",p.companyId),R("statut","==","payé")),o=(await $(t)).docs.map(r=>{var U;return{id:r.id,agencyId:r.data().agencyId,nomClient:r.data().nomClient,telephone:r.data().telephone,montant:r.data().montant||0,canal:r.data().canal||"",statut:r.data().statut,depart:r.data().depart||"",arrivee:r.data().arrivee||"",createdAt:((U=r.data().createdAt)==null?void 0:U.toDate())||null}}),l={};o.forEach(r=>{l[r.agencyId]||(l[r.agencyId]=[]),l[r.agencyId].push(r)});const I=Object.keys(l).map(r=>({agencyId:r,reservations:l[r]}));F(I)}finally{h(t=>({...t,reservations:!1}))}};x.useEffect(()=>{_(),X()},[p]);const E=t=>{const c=T.find(o=>o.id===t);return c?c.nom:"Agence inconnue"},v=()=>{var c;let t=((c=f.find(o=>o.agencyId===m))==null?void 0:c.reservations)||[];return d&&(t=t.filter(o=>{var l;return(l=o.depart)==null?void 0:l.toLowerCase().includes(d.toLowerCase())})),i&&(t=t.filter(o=>{var l;return(l=o.arrivee)==null?void 0:l.toLowerCase().includes(i.toLowerCase())})),b&&(t=t.filter(o=>o.createdAt&&new Date(o.createdAt)>=new Date(b))),y&&(t=t.filter(o=>o.createdAt&&new Date(o.createdAt)<=new Date(y))),g!=="tous"&&(t=t.filter(o=>o.canal.toLowerCase()===g.toLowerCase())),t},M=v().slice((A-1)*D,A*D),O=Math.ceil(v().length/D),K=()=>{const t=v();if(t.length===0)return;const c=`Nom,Téléphone,Départ,Arrivée,Canal,Montant,Date
`,o=t.map(r=>[`"${r.nomClient}"`,r.telephone,`"${r.depart}"`,`"${r.arrivee}"`,r.canal,r.montant||0,r.createdAt?new Date(r.createdAt).toLocaleDateString():""].join(",")).join(`
`),l=c+o,I=new Blob([l],{type:"text/csv;charset=utf-8;"});ee.saveAs(I,`reservations-${E(m||"")}-${new Date().toISOString().split("T")[0]}.csv`)},V=v().reduce((t,c)=>t+(c.montant||0),0);return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Gestion des Réservations"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>s(!a),className:"flex items-center px-4 py-2 bg-white border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx(W,{className:"mr-2"}),"Filtres"]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:K,disabled:v().length===0,className:"flex items-center px-4 py-2 bg-white border rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(z,{className:"mr-2"}),"Exporter"]}),e.jsxs("button",{onClick:()=>window.print(),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(J,{className:"mr-2"}),"Imprimer"]})]})]})]}),N.agences||N.reservations?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:f.map(t=>{const c=t.reservations.reduce((o,l)=>o+(l.montant||0),0);return e.jsxs("div",{onClick:()=>{u(m===t.agencyId?null:t.agencyId),L(1),n(""),k(""),j(""),w("")},className:`p-6 bg-white rounded-xl shadow-sm border transition-all cursor-pointer hover:shadow-md ${m===t.agencyId?"border-blue-500 ring-2 ring-blue-100":"border-gray-200"}`,children:[e.jsx("h2",{className:"font-bold text-lg text-gray-800 mb-2",children:E(t.agencyId)}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:[t.reservations.length," réservations"]}),e.jsxs("span",{className:"font-medium",children:[c.toLocaleString()," FCFA"]})]}),e.jsx("div",{className:"mt-4 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500",style:{width:`${Math.min(100,t.reservations.length/50*100)}%`}})})]},t.agencyId)})}),m&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h3",{className:"text-xl font-semibold text-gray-800",children:[E(m),e.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",v().length," réservations - ",V.toLocaleString()," FCFA)"]})]})}),a&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Départ"}),e.jsx("input",{placeholder:"Filtrer par départ",value:d,onChange:t=>n(t.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Arrivée"}),e.jsx("input",{placeholder:"Filtrer par arrivée",value:i,onChange:t=>k(t.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date début"}),e.jsx("input",{type:"date",value:b,onChange:t=>j(t.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date fin"}),e.jsx("input",{type:"date",value:y,onChange:t=>w(t.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Canal"}),e.jsxs("select",{value:g,onChange:t=>G(t.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"tous",children:"Tous les canaux"}),e.jsx("option",{value:"guichet",children:"Guichet"}),e.jsx("option",{value:"en ligne",children:"En ligne"})]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Téléphone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Trajet"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Canal"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:Object.values({filterDepart:d,filterArrivee:i,filterStart:b,filterEnd:y,filterCanal:g}).some(Boolean)?"Aucune réservation ne correspond aux filtres":"Aucune réservation trouvée"})}):M.map(t=>{var c;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.nomClient}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.telephone}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:t.depart})," → ",e.jsx("span",{className:"font-medium",children:t.arrivee})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.canal==="guichet"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:t.canal})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(c=t.montant)==null?void 0:c.toLocaleString()," FCFA"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.createdAt?new Date(t.createdAt).toLocaleDateString("fr-FR"):""})]},t.id)})})]})}),v().length>D&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>L(t=>Math.max(1,t-1)),disabled:A===1,className:"flex items-center px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:[e.jsx(Q,{className:"mr-1"}),"Précédent"]}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",A," sur ",O]}),e.jsxs("button",{onClick:()=>L(t=>t+1),disabled:A===O,className:"flex items-center px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:["Suivant",e.jsx(Y,{className:"ml-1"})]})]})]})]})]})})};export{re as default};
