import{d as H,b as J,r as a,j as n,a as i,as as K}from"./react-KXT1Riez.js";import{u as Q,r as U,E as V,t as B,q as L,o as v,x as T,y as W,F as X}from"./firebase-DYTOaTLw.js";import{d as u}from"../index-b0dmvJTQ.js";import"./vendor-B27hBV_J.js";const Y=new Intl.NumberFormat("fr-FR");function z(o){return o.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"")}const te=()=>{const{id:o}=H(),r=!!o,p=J(),[l,y]=a.useState(""),[m,g]=a.useState(""),[x,b]=a.useState(""),[S,N]=a.useState(""),[E,P]=a.useState(""),[C,w]=a.useState("actif"),[G,O]=a.useState([]),[c,A]=a.useState(""),[s,M]=a.useState(null),[R,D]=a.useState(!0),[f,F]=a.useState(!1),[h,I]=a.useState(null);a.useEffect(()=>{(async()=>{const e=await Q(U(B(u,"plans"),V("priceMonthly","asc")));O(e.docs.map(t=>({id:t.id,name:t.data().name,priceMonthly:t.data().priceMonthly})))})()},[]),a.useEffect(()=>{if(!r){D(!1);return}(async()=>{const e=await L(v(u,"companies",o));if(!e.exists()){p("/admin/compagnies");return}const t=e.data();y(t.nom??""),g(t.slug??""),b(t.email??""),N(t.telephone??""),P(t.pays??""),w(t.status??"actif"),A(t.planId??""),D(!1)})()},[o,r,p]),a.useEffect(()=>{if(!c){M(null);return}(async()=>{const e=await L(v(u,"plans",c));M(e.exists()?e.data():null)})()},[c]),a.useEffect(()=>{!r&&l&&g(z(l))},[l,r]);const j=a.useMemo(()=>l&&m&&s&&!f,[l,m,s,f]);async function $(e){var t,k,q;if(e.preventDefault(),!(!j||!s)){F(!0),I(null);try{const d={nom:l.trim(),slug:m.trim(),email:x.trim()||null,telephone:S.trim()||null,pays:E.trim()||null,status:C,planId:c,plan:s.name,commissionOnline:s.commissionOnline??0,feeGuichet:s.feeGuichet??0,minimumMonthly:s.minimumMonthly??0,maxAgences:s.maxAgences??0,publicPageEnabled:((t=s.features)==null?void 0:t.publicPage)??!1,onlineBookingEnabled:((k=s.features)==null?void 0:k.onlineBooking)??!1,guichetEnabled:((q=s.features)==null?void 0:q.guichet)??!1,updatedAt:T()};r?await W(v(u,"companies",o),d):await X(B(u,"companies"),{...d,createdAt:T()}),p("/admin/compagnies")}catch(d){console.error(d),I({type:"error",text:"Erreur lors de l’enregistrement de la compagnie."})}finally{F(!1)}}}return R?n("div",{className:"p-6",children:"Chargement…"}):i("div",{className:"p-6 max-w-5xl mx-auto",children:[n("h1",{className:"text-2xl font-bold text-orange-700 mb-4",children:r?"Modifier la compagnie":"Ajouter une compagnie"}),i("form",{onSubmit:$,className:"bg-white border rounded-xl p-5 space-y-4",children:[n("input",{className:"input",value:l,onChange:e=>y(e.target.value),placeholder:"Nom de la compagnie *"}),n("input",{className:"input",value:m,onChange:e=>g(z(e.target.value)),placeholder:"Slug *"}),n("input",{className:"input",value:x,onChange:e=>b(e.target.value),placeholder:"Email de contact (vitrine)"}),n("input",{className:"input",value:S,onChange:e=>N(e.target.value),placeholder:"Téléphone"}),n("input",{className:"input",value:E,onChange:e=>P(e.target.value),placeholder:"Pays"}),i("div",{children:[n("label",{className:"block text-sm font-medium mb-1",children:"Plan *"}),i("select",{className:"input",value:c,onChange:e=>A(e.target.value),required:!0,children:[n("option",{value:"",children:"— Sélectionner un plan —"}),G.map(e=>i("option",{value:e.id,children:[e.name," • ",Y.format(e.priceMonthly)," FCFA"]},e.id))]})]}),i("select",{className:"input",value:C,onChange:e=>w(e.target.value),children:[n("option",{value:"actif",children:"Actif"}),n("option",{value:"inactif",children:"Inactif"})]}),i("div",{className:"flex gap-3",children:[n("button",{type:"submit",disabled:!j,className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg",children:f?"Enregistrement…":"Enregistrer"}),n(K,{to:"/admin/compagnies",className:"px-4 py-2 border rounded-lg",children:"Annuler"})]}),h&&n("p",{className:h.type==="error"?"text-red-600":"text-green-600",children:h.text})]})]})};export{te as default};
