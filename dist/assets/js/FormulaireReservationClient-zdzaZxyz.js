import{u as G,s as B,t as H,j as e,r as m,v as D,w as W,x as I,y as J,U as K,P as O,z as Q}from"./react-A-4nP3fl.js";import{e as X,f as L,T as Y,h as Z}from"./firebase-CbfwkGbo.js";import{d as $}from"../index-ChphXJpr.js";import{s as b,h as u}from"./color-CDd1PckM.js";import"./vendor-CCJV4Wg0.js";const le=()=>{const g=G(),v=B(),{slug:N=""}=H(),{tripData:s,companyInfo:a}=v.state||{};if(!v.state||!s||!a)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white p-4",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 text-red-600",children:"Erreur"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Données de trajet manquantes. Veuillez recommencer depuis la page d’accueil."}),e.jsx("button",{onClick:()=>g("/"),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Retour à l'accueil"})]})});const[w,C]=m.useState(!1),[i,P]=m.useState({fullName:"",phone:"",email:""}),[l,F]=m.useState(1),[o,z]=m.useState(1),[t,k]=m.useState("aller_simple"),p=Number((s==null?void 0:s.price)||0),[f,A]=m.useState(p),E={colors:{primary:(a==null?void 0:a.primaryColor)||"#3b82f6",secondary:(a==null?void 0:a.secondaryColor)||"#93c5fd",text:a!=null&&a.primaryColor?b(a.primaryColor):"#ffffff",background:"#ffffff"},classes:{card:"bg-white rounded-xl shadow-sm border border-gray-200",button:"transition-all hover:scale-105 active:scale-95",header:"sticky top-0 z-50 px-4 py-3"}},{colors:r,classes:x}=E;if(m.useEffect(()=>{A(p*((l||0)+(t==="aller_retour"&&o||0)))},[l,o,t,p]),!s||!s.id)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",style:{background:r.background},children:e.jsxs("div",{className:`p-6 rounded-xl text-center ${x.card}`,children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-full inline-flex mb-3",children:e.jsx(D,{className:"h-6 w-6 text-gray-500"})}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"Données du voyage introuvables"}),e.jsx("button",{onClick:()=>g("/"),className:`mt-4 px-4 py-2 rounded-lg ${x.button}`,style:{backgroundColor:r.primary,color:r.text},children:"Retour à l'accueil"})]})});const j=c=>{const{name:n,value:h}=c.target;P(S=>({...S,[n]:h}))},y=(c,n)=>{const h=Math.max(1,Math.min(10,n));c==="go"?F(h):z(h)},M=async c=>{c.preventDefault(),C(!0);try{if(!i.fullName||!i.phone)throw new Error("Veuillez remplir tous les champs obligatoires");const n=l+(t==="aller_retour"?o:0),U=(await X(L($,"reservations"))).docs.map(d=>d.data()).filter(d=>d.trajetId===s.id&&d.date===s.date&&d.heure===s.time&&d.statut==="payé").reduce((d,V)=>d+(V.seatsGo||1),0),_=(s.places||0)-U;if(_<n)throw new Error(`Il ne reste que ${_} place(s) disponible(s)`);const R={nomClient:i.fullName,telephone:i.phone,email:i.email,depart:s.departure,arrivee:s.arrival,date:s.date,heure:s.time,montant:f,seatsGo:l,seatsReturn:t==="aller_retour"?o:0,tripType:t,canal:"en_ligne",statut:"payé",createdAt:Y.now(),companyId:s.companyId,agencyId:s.agencyId,trajetId:s.id,paiement:"mobile_money",commission:f*.05,companySlug:N},T=await Z(L($,"reservations"),R);g(`/reservation-confirmation/${T.id}`,{state:{slug:N,reservation:{...R,id:T.id,companyName:a==null?void 0:a.nom}}})}catch(n){alert(n.message)}finally{C(!1)}},q=c=>new Date(c).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"});return e.jsxs("div",{className:"min-h-screen",style:{background:r.background,color:b(r.background)},children:[e.jsx("header",{className:x.header,style:{backgroundColor:u(r.primary,.95),backdropFilter:"blur(10px)"},children:e.jsxs("div",{className:"flex items-center gap-4 max-w-7xl mx-auto",children:[e.jsx("button",{onClick:()=>g(-1),className:"p-2 rounded-full hover:bg-white/10 transition",style:{color:b(r.primary)},children:e.jsx(W,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[(a==null?void 0:a.logoUrl)&&e.jsx(I.LazyLoadImage,{src:a.logoUrl,alt:`Logo ${a.nom}`,effect:"blur",className:"h-8 w-8 rounded-full object-cover border-2",style:{borderColor:b(r.primary),backgroundColor:u(r.primary,.2)}}),e.jsx("h1",{className:"text-lg font-bold",style:{color:b(r.primary)},children:"Réservation"})]})]})}),e.jsxs("main",{className:"max-w-4xl mx-auto p-4",children:[e.jsx("div",{className:`p-4 rounded-xl mb-4 ${x.card}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-bold",style:{color:r.primary},children:[s.departure," → ",s.arrival]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm mt-1",children:[e.jsx(J,{className:"h-4 w-4 opacity-70"}),e.jsx("span",{children:q(s.date)}),e.jsx(D,{className:"h-4 w-4 opacity-70 ml-2"}),e.jsx("span",{children:s.time})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm opacity-80",children:"Prix unitaire"}),e.jsxs("div",{className:"font-bold",children:[p.toLocaleString()," FCFA"]})]})]})}),e.jsx("div",{className:`rounded-xl overflow-hidden ${x.card}`,children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",style:{color:r.primary},children:"Informations du passager"}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nom complet *"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 opacity-70"}),e.jsx("input",{type:"text",name:"fullName",value:i.fullName,onChange:j,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none",style:{borderColor:u(r.primary,.3)},required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Téléphone *"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 opacity-70"}),e.jsx("input",{type:"tel",name:"phone",value:i.phone,onChange:j,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none",style:{borderColor:u(r.primary,.3)},required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 opacity-70"}),e.jsx("input",{type:"email",name:"email",value:i.email,onChange:j,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none",style:{borderColor:u(r.primary,.3)}})]})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Type de voyage"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",className:`py-2 px-3 rounded-lg text-sm border ${t==="aller_simple"?"border-blue-500 bg-blue-50 font-medium":"border-gray-200"}`,onClick:()=>k("aller_simple"),style:{borderColor:t==="aller_simple"?r.primary:void 0,backgroundColor:t==="aller_simple"?u(r.primary,.1):void 0},children:"Aller simple"}),e.jsx("button",{type:"button",className:`py-2 px-3 rounded-lg text-sm border ${t==="aller_retour"?"border-blue-500 bg-blue-50 font-medium":"border-gray-200"}`,onClick:()=>k("aller_retour"),style:{borderColor:t==="aller_retour"?r.primary:void 0,backgroundColor:t==="aller_retour"?u(r.primary,.1):void 0},children:"Aller-retour"})]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Nombre de places"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 opacity-80",children:"Aller"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"p-1 w-8 h-8 rounded-lg border border-gray-300 hover:bg-gray-50 flex items-center justify-center",onClick:()=>y("go",l-1),disabled:l<=1,children:"-"}),e.jsx("div",{className:"flex-1 text-center font-medium py-1 border border-gray-200 rounded-lg",children:l}),e.jsx("button",{type:"button",className:"p-1 w-8 h-8 rounded-lg border border-gray-300 hover:bg-gray-50 flex items-center justify-center",onClick:()=>y("go",l+1),disabled:l>=10,children:"+"})]})]}),t==="aller_retour"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1 opacity-80",children:"Retour"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"p-1 w-8 h-8 rounded-lg border border-gray-300 hover:bg-gray-50 flex items-center justify-center",onClick:()=>y("return",o-1),disabled:o<=1,children:"-"}),e.jsx("div",{className:"flex-1 text-center font-medium py-1 border border-gray-200 rounded-lg",children:o}),e.jsx("button",{type:"button",className:"p-1 w-8 h-8 rounded-lg border border-gray-300 hover:bg-gray-50 flex items-center justify-center",onClick:()=>y("return",o+1),disabled:o>=10,children:"+"})]})]})]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold",children:[f.toLocaleString()," FCFA"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-3",children:[p.toLocaleString()," FCFA × ",l," place(s)"," ",t==="aller_retour"&&`+ ${o} place(s)`]}),e.jsx("button",{type:"submit",className:`w-full py-3 px-4 rounded-lg font-medium ${x.button}`,style:{backgroundColor:r.primary,color:r.text},disabled:w,children:w?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Traitement..."]}):"Payer avec Mobile Money"}),e.jsxs("div",{className:"mt-2 text-center text-xs text-gray-500",children:[e.jsx("p",{children:"Moyen de paiement mobile money obligatoire"}),e.jsxs("div",{className:"mt-1 inline-flex items-center gap-1 px-2 py-1 rounded-full border border-gray-200",children:[e.jsx("svg",{className:"h-3 w-3 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Paiement sécurisé"]})]})]})]})]})})]})]})};export{le as default};
