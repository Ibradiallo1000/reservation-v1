import{u as z,r as t,a as u,j as a}from"./react-DgrrIcw2.js";import{a as I,d as h}from"../index-p6Te0bSg.js";import{y as M,t as v,d as b,T as f,k as R}from"./firebase-eGIzIftJ.js";import"./vendor-BHjJ2Hjk.js";const d=[{name:"Mali",code:"+223"},{name:"Sénégal",code:"+221"},{name:"Côte d'Ivoire",code:"+225"},{name:"Burkina Faso",code:"+226"},{name:"Togo",code:"+228"}],U=s=>s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]/g,"").trim(),_=({onSuccess:s})=>{const A=z(),[o,j]=t.useState(""),[r,E]=t.useState(""),[l,L]=t.useState(""),[N,q]=t.useState(""),[y,D]=t.useState(d[0].name),[w,F]=t.useState(d[0].code),[c,P]=t.useState(""),[m,$]=t.useState(null),[p,B]=t.useState(null),[S,C]=t.useState(!1);return u("div",{className:"p-6 max-w-2xl mx-auto",children:[a("h2",{className:"text-xl font-bold mb-4",children:"Ajouter une compagnie"}),u("form",{onSubmit:async e=>{e.preventDefault(),C(!0);try{const i=(await M(I,l,N)).user.uid,g=i,T=U(o);await v(b(h,"companies",g),{nom:o,email:l,pays:y,telephone:`${w}${c}`,responsable:r,plan:"free",createdAt:f.now(),commissionRate:.1,status:"actif",logoUrl:"",banniereUrl:"",description:`Bienvenue chez ${o}`,slug:T,latitude:m||null,longitude:p||null,themeStyle:"moderne",couleurPrimaire:"#3B82F6",couleurSecondaire:"#10B981",police:"sans-serif",publicVisible:!0,vues:0,modifiable:!0});const x=b(R(h,"companies",g,"agences"));await v(x,{nom:"Siège principal",adresse:"",telephone:`${w}${c}`,createdAt:f.now(),latitude:m||null,longitude:p||null,responsable:r,active:!0,slug:"siegeprincipal",isHeadOffice:!0}),await v(b(h,"users",i),{email:l,role:"admin_compagnie",companyId:g,agencyId:x.id,companyName:o,nom:r,createdAt:f.now()}),alert("✅ Compagnie, agence principale et administrateur créés avec succès !"),A("/compagnies"),s&&s()}catch(n){alert("❌ Erreur : "+n.message)}finally{C(!1)}},className:"grid grid-cols-1 gap-4",children:[a("input",{required:!0,value:o,onChange:e=>j(e.target.value),placeholder:"Nom de la compagnie",className:"border p-2 rounded"}),a("input",{required:!0,value:r,onChange:e=>E(e.target.value),placeholder:"Nom du responsable",className:"border p-2 rounded"}),a("input",{required:!0,type:"email",value:l,onChange:e=>L(e.target.value),placeholder:"Email du responsable",className:"border p-2 rounded"}),a("input",{required:!0,type:"password",value:N,onChange:e=>q(e.target.value),placeholder:"Mot de passe",className:"border p-2 rounded"}),u("div",{className:"flex gap-2",children:[a("select",{value:y,onChange:e=>{const n=d.find(i=>i.name===e.target.value);n&&(D(n.name),F(n.code))},className:"border p-2 rounded w-1/2",children:d.map(e=>a("option",{value:e.name,children:e.name},e.code))}),a("input",{required:!0,value:c,onChange:e=>P(e.target.value),placeholder:"Numéro de téléphone",className:"border p-2 rounded w-1/2"})]}),u("div",{className:"flex gap-2",children:[a("input",{type:"number",step:"any",value:m??"",onChange:e=>$(e.target.value?parseFloat(e.target.value):null),placeholder:"Latitude (optionnel)",className:"border p-2 rounded w-1/2"}),a("input",{type:"number",step:"any",value:p??"",onChange:e=>B(e.target.value?parseFloat(e.target.value):null),placeholder:"Longitude (optionnel)",className:"border p-2 rounded w-1/2"})]}),a("button",{type:"submit",disabled:S,className:"bg-orange-600 text-white p-2 rounded hover:bg-orange-700 transition",children:S?"Enregistrement...":"Ajouter la compagnie"})]})]})};export{_ as default};
