import{r as t,j as a}from"./react-PtMwKKf1.js";import{k as v,l as C,y as D,T as P,A as k,d as R,B as T}from"./firebase-eGIzIftJ.js";import{u as $,d as p,a as G}from"../index-C4y8wfzK.js";import"./vendor-B5FTF_2c.js";const B=()=>{const{user:e,company:n}=$(),[h,A]=t.useState([]),[c,x]=t.useState(""),[d,y]=t.useState(""),[f,I]=t.useState("guichetier"),[i,b]=t.useState(""),[j,r]=t.useState(""),[l,N]=t.useState(!1),u={primary:(n==null?void 0:n.couleurPrimaire)||"#3b82f6",secondary:(n==null?void 0:n.couleurSecondaire)||"#6366f1"},m=async()=>{if(!(!(e!=null&&e.companyId)||!(e!=null&&e.agencyId)))try{const s=v(p,"companies",e.companyId,"agences",e.agencyId,"users"),g=(await C(s)).docs.map(w=>({id:w.id,...w.data()}));A(g)}catch(s){console.error("Erreur chargement agents:",s),r("❌ Erreur lors du chargement des agents.")}};t.useEffect(()=>{m()},[e]);const S=async()=>{if(!c||!i||!d||!(e!=null&&e.agencyId)||!(e!=null&&e.companyId)){r("⚠️ Tous les champs sont obligatoires.");return}if(i.length<6){r("⚠️ Le mot de passe doit contenir au moins 6 caractères.");return}N(!0),r("");try{const o={uid:(await D(G,c,i)).user.uid,email:c,displayName:d,role:f,createdAt:P.now().toDate().toISOString()},g=v(p,"companies",e.companyId,"agences",e.agencyId,"users");await k(g,o),r("✅ Agent ajouté avec succès."),x(""),y(""),b(""),m()}catch(s){console.error("Erreur création agent:",s),s.code==="auth/email-already-in-use"?r("⚠️ Cet email est déjà utilisé."):r("❌ Une erreur est survenue. Vérifiez la console.")}finally{N(!1)}},E=async s=>{if(!(!(e!=null&&e.companyId)||!(e!=null&&e.agencyId))&&window.confirm("Supprimer cet agent ?"))try{const o=R(p,"companies",e.companyId,"agences",e.agencyId,"users",s);await T(o),r("✅ Agent supprimé."),m()}catch(o){console.error("Erreur suppression:",o),r("❌ Erreur lors de la suppression.")}};return a.jsxs("div",{className:"p-6 max-w-4xl mx-auto bg-gray-50 min-h-screen",children:[a.jsx("h1",{className:"text-3xl font-bold mb-6",style:{color:u.primary},children:"Gestion du personnel"}),a.jsxs("div",{className:"mb-8 bg-white p-6 rounded-xl shadow-md border border-gray-200",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsx("input",{value:d,onChange:s=>y(s.target.value),placeholder:"Nom complet",className:"border p-3 rounded focus:ring-2 focus:ring-indigo-500"}),a.jsx("input",{value:c,onChange:s=>x(s.target.value),placeholder:"Email",type:"email",className:"border p-3 rounded focus:ring-2 focus:ring-indigo-500"}),a.jsx("input",{value:i,onChange:s=>b(s.target.value),placeholder:"Mot de passe",type:"password",className:"border p-3 rounded focus:ring-2 focus:ring-indigo-500"}),a.jsxs("select",{value:f,onChange:s=>I(s.target.value),className:"border p-3 rounded focus:ring-2 focus:ring-indigo-500",children:[a.jsx("option",{value:"guichetier",children:"Guichetier"}),a.jsx("option",{value:"agentCourrier",children:"Agent de courrier"})]})]}),a.jsx("button",{onClick:S,disabled:l,className:`w-full py-3 rounded font-semibold text-white transition ${l?"bg-gray-400 cursor-not-allowed":"hover:opacity-90"}`,style:{background:`linear-gradient(to right, ${u.primary}, ${u.secondary})`},children:l?"⏳ Ajout en cours...":"Ajouter l’agent"}),j&&a.jsx("p",{className:"mt-3 text-center text-sm",children:j})]}),a.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Agents de cette agence"}),h.length===0?a.jsx("p",{className:"text-gray-500",children:"Aucun agent enregistré."}):a.jsx("ul",{className:"space-y-2",children:h.map(s=>a.jsxs("li",{className:"border p-4 rounded flex justify-between items-center bg-white shadow-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-gray-800",children:s.displayName}),a.jsxs("p",{className:"text-sm text-gray-600",children:[s.email," • ",s.role]})]}),a.jsx("button",{onClick:()=>E(s.id),className:"text-red-600 text-sm hover:underline",children:"Supprimer"})]},s.id))})]})};export{B as default};
