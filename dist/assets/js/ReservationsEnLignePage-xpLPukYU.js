import{j as e,h as F,M as P,F as B,W as H,av as q,ac as U,aw as V,ah as z,r as n,e as G,S as W,ax as C,ay as $,a1 as J}from"./react-BKlva80Y.js";import{q as R,B as S,C as L,w as i,j as A,n as K,z as O,d as y,m as _,D as Q,k as X}from"./firebase-1zyXmG6H.js";import{m as d,u as Y,d as u}from"../index-DdVw6ij9.js";import"./vendor-CZDa83Cj.js";const Z={payé:"bg-emerald-100 text-emerald-800",preuve_recue:"bg-amber-100 text-amber-800",annulé:"bg-red-100 text-red-800",refusé:"bg-red-100 text-red-800",en_attente:""},ee=({reservation:s,onValider:h,onRefuser:p,onSupprimer:f})=>{var o;return e.jsxs("div",{className:"bg-white border rounded-xl overflow-hidden shadow-sm hover:shadow-md transition",children:[e.jsx("div",{className:"grid grid-cols-1",children:e.jsxs("div",{className:"p-4 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-slate-800",children:[e.jsx(F,{className:"w-4 h-4 text-slate-400"}),s.nomClient||s.clientNom||"--"]}),e.jsx("p",{className:"text-sm text-slate-500",children:s.telephone||"--"}),s.email&&e.jsx("p",{className:"text-sm text-slate-500",children:s.email}),e.jsx("span",{className:`inline-block text-xs px-2 py-1 rounded-full ${Z[s.statut]}`,children:s.statut.replace("_"," ")})]}),e.jsx("div",{className:"text-right text-xs text-slate-400 font-mono",children:s.referenceCode})]}),e.jsxs("div",{className:"flex justify-between items-center text-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{className:"font-semibold",children:[s.depart," → ",s.arrivee]})]}),e.jsxs("div",{className:"text-sm text-slate-500",children:[s.date," à ",s.heure]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(B,{className:"w-4 h-4 text-slate-400"}),s.agencyNom||"--"]}),e.jsx("div",{className:"text-sm text-slate-500",children:s.agencyTelephone||"--"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(H,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{className:"font-semibold",children:[(o=s.montant)==null?void 0:o.toLocaleString()," FCFA"]})]}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Places : ",s.seatsGo,s.seatsReturn?` + ${s.seatsReturn}`:""]})]}),s.preuveMessage&&e.jsxs("div",{className:"text-sm text-slate-600 bg-slate-50 border p-2 rounded",children:[e.jsx("p",{className:"font-medium text-slate-700 mb-1",children:"Message :"}),s.preuveMessage]})]})}),e.jsxs("div",{className:"border-t px-4 py-3 flex flex-wrap gap-2 bg-slate-50 justify-end",children:[s.statut==="preuve_recue"&&e.jsxs(e.Fragment,{children:[e.jsxs(d.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>h(s.id),className:"px-3 py-2 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-700 flex items-center gap-1",children:[e.jsx(q,{className:"w-4 h-4"})," Valider"]}),e.jsxs(d.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>p(s.id),className:"px-3 py-2 rounded bg-red-600 text-white text-xs hover:bg-red-700 flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4"})," Refuser"]})]}),s.preuveUrl&&e.jsxs("a",{href:s.preuveUrl,target:"_blank",rel:"noreferrer",className:"px-3 py-2 rounded border border-gray-300 text-xs text-slate-600 hover:bg-gray-50 flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"})," Voir preuve"]}),e.jsxs(d.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>f(s.id),className:"px-3 py-2 rounded text-red-600 text-xs hover:text-red-800 flex items-center gap-1",children:[e.jsx(z,{className:"w-4 h-4"})," Supprimer"]})]})]})},v=8,re=()=>{const{user:s}=Y(),[h,p]=n.useState([]),[f,o]=n.useState(null),[g,j]=n.useState(!1),[x,I]=n.useState(""),[c,T]=n.useState("preuve_recue"),[N,b]=n.useState(!0);n.useEffect(()=>{if(!(s!=null&&s.companyId))return;j(!0);const t=R(A(u,"reservations"),i("companyId","==",s.companyId),c?i("statut","==",c):i("statut","in",["preuve_recue","payé","annulé","refusé"]),L("createdAt","desc"),S(v)),a=K(t,r=>{const l=r.docs.map(m=>({id:m.id,...m.data()}));p(l),o(r.docs[r.docs.length-1]||null),b(l.length===v),j(!1)});return()=>a()},[s==null?void 0:s.companyId,c]);const D=async()=>{if(!(s!=null&&s.companyId)||!f||!N)return;j(!0);const t=R(A(u,"reservations"),i("companyId","==",s.companyId),c?i("statut","==",c):i("statut","in",["preuve_recue","payé","annulé","refusé"]),L("createdAt","desc"),Q(f),S(v)),a=await X(t),r=a.docs.map(l=>({id:l.id,...l.data()}));p(l=>[...l,...r]),o(a.docs[a.docs.length-1]||null),b(r.length===v),j(!1)},M=async t=>{await _(y(u,"reservations",t),{statut:"payé",validatedAt:new Date,validatedBy:s==null?void 0:s.uid})},k=async t=>{const a=window.prompt("Raison ?")||"Non spécifié";await _(y(u,"reservations",t),{statut:"refusé",refusalReason:a,refusedAt:new Date,refusedBy:s==null?void 0:s.uid})},E=async t=>{await O(y(u,"reservations",t))},w=h.filter(t=>{var a,r,l,m;return((a=t.nomClient)==null?void 0:a.toLowerCase().includes(x.toLowerCase()))||((r=t.telephone)==null?void 0:r.includes(x))||((l=t.referenceCode)==null?void 0:l.toLowerCase().includes(x.toLowerCase()))||((m=t.email)==null?void 0:m.toLowerCase().includes(x.toLowerCase()))});return e.jsxs("div",{className:"p-4 md:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[(s==null?void 0:s.companyLogo)&&e.jsx(G.LazyLoadImage,{src:s.companyLogo,alt:"Logo",effect:"blur",className:"h-10 w-10 rounded border object-cover"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Réservations en ligne"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Preuves de paiement"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(W,{className:"w-4 h-4 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Rechercher...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-full",value:x,onChange:t=>I(t.target.value)})]}),e.jsxs("select",{value:c,onChange:t=>T(t.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 min-w-[180px]",children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"preuve_recue",children:"Preuve reçue"}),e.jsx("option",{value:"payé",children:"Payé"}),e.jsx("option",{value:"annulé",children:"Annulé"}),e.jsx("option",{value:"refusé",children:"Refusé"})]})]})]}),g&&h.length===0&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(d.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(C,{className:"h-8 w-8 text-blue-600"})})}),!g&&w.length===0&&e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-white rounded-xl border p-8 text-center",children:[e.jsx($,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Aucune réservation trouvée"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:w.map(t=>e.jsx(ee,{reservation:t,onValider:M,onRefuser:k,onSupprimer:E},t.id))}),N&&w.length>0&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx(d.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:D,disabled:g,className:"flex items-center gap-2 px-6 py-3 bg-white border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 font-medium",children:g?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-4 w-4 animate-spin"})," Chargement..."]}):e.jsxs(e.Fragment,{children:["Afficher plus ",e.jsx(J,{className:"h-4 w-4"})]})})})]})};export{re as default};
