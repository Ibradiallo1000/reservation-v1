import{u as E,a as P,r as p,j as e}from"./react-BKlva80Y.js";import{k as w,j as N,q as k,w as y}from"./firebase-1zyXmG6H.js";import{d as C}from"../index-DdVw6ij9.js";import"./vendor-CZDa83Cj.js";const R=()=>{const x=E(),t=P().state,[u,F]=p.useState({}),[h,S]=p.useState({}),[L,g]=p.useState(!0),[j,A]=p.useState("");if(p.useEffect(()=>{if(!(t!=null&&t.departure)||!(t!=null&&t.arrival)){x("/");return}(async()=>{g(!0);try{const c=(await w(N(C,"companies"))).docs.reduce((r,n)=>(r[n.id]={id:n.id,...n.data()},r),{});S(c);const o=r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase(),i=o(t.departure),d=o(t.arrival),$=k(N(C,"dailyTrips"),y("departure","==",i),y("arrival","==",d)),D=await w($),M=new Date,m={};D.forEach(r=>{const n=r.data();if(new Date(`${n.date}T${n.time}`)>M){const l={id:r.id,...n};m[l.companyId]||(m[l.companyId]=[]),m[l.companyId].push(l)}}),Object.values(m).forEach(r=>{r.sort((n,v)=>{const l=n.time.split(":").map(Number),b=v.time.split(":").map(Number);return l[0]*60+l[1]-(b[0]*60+b[1])})}),F(m)}catch(a){console.error("Erreur Firestore :",a)}finally{g(!1)}})()},[t,x]),!(t!=null&&t.departure)||!(t!=null&&t.arrival))return null;const f=Object.keys(u).filter(s=>{const a=h[s];return a==null?void 0:a.nom.toLowerCase().includes(j.toLowerCase())}).sort((s,a)=>{const c=Math.min(...u[s].map(i=>i.price)),o=Math.min(...u[a].map(i=>i.price));return c-o});return e.jsxs("div",{className:"p-4 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:[t.departure," → ",t.arrival]}),e.jsx("input",{type:"text",placeholder:"Filtrer par compagnie...",value:j,onChange:s=>A(s.target.value),className:"border border-gray-300 rounded px-3 py-2 w-64 text-sm"})]}),L?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})}):f.length===0?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"Aucune compagnie disponible pour ce trajet"}),e.jsx("button",{onClick:()=>x("/"),className:"mt-4 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 text-sm",children:"Nouvelle recherche"})]}):e.jsx("div",{className:"space-y-3",children:f.map(s=>{const a=h[s]||{nom:"Compagnie inconnue",logoUrl:"",rating:4},c=u[s],o=Math.min(...c.map(d=>d.price)),i=Math.max(...c.map(d=>d.price));return e.jsxs("div",{className:"flex justify-between items-center border p-4 rounded-lg hover:shadow-md transition-shadow bg-white",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[a.logoUrl&&e.jsx("img",{src:a.logoUrl,alt:a.nom,className:"w-12 h-12 rounded-full object-cover border"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-semibold",children:a.nom}),a.rating&&e.jsxs("span",{className:"flex items-center text-sm text-gray-500",children:[e.jsx("span",{className:"text-yellow-500",children:"★"})," ",a.rating.toFixed(1)]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500 mt-1",children:[e.jsxs("span",{children:[c.length," départs aujourd'hui"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:o===i?`${o.toLocaleString()} FCFA`:`${o.toLocaleString()} - ${i.toLocaleString()} FCFA`})]})]})]}),e.jsx("button",{onClick:()=>x(`/compagnie/${a.nom.toLowerCase().replace(/\s+/g,"-")}/resultats?departure=${t.departure}&arrival=${t.arrival}`),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm whitespace-nowrap ml-4",children:"Voir les horaires"})]},s)})}),e.jsx("div",{className:"mt-6 text-center text-sm text-gray-500",children:e.jsx("p",{children:"Prix affichés en Francs CFA (FCFA)"})})]})};export{R as default};
