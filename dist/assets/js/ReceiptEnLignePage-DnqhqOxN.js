import{d as B,b as J,u as X,r,j as l,a as c,C as K,M as Q,a5 as W,T as Y,_ as Z,p as S,aX as F,ao as v,t as ee,ab as te}from"./react-DB_4kGOy.js";import{o as I,q as z,z as R,w as P,J as A,y as D,L as M}from"./firebase-lLzYRzUk.js";import{e as U,d as p,h as g}from"../index-Bkmir__O.js";import{h as ce}from"./html2pdf-DQqgx56O.js";import{f as x,c as b,p as le}from"./vendor-C-DAJou6.js";import"./jspdf.es.min-Gs4S7Zlz.js";import"./html2canvas-BI8K_7w5.js";const me=()=>{var j;const{id:u,slug:E}=B(),N=J(),_=X(),{companyInfo:L,reservation:a}=_.state||{},[e,C]=r.useState(a||null),[s,T]=r.useState(L||null),[q,y]=r.useState("Agence"),h=r.useRef(null),o=(s==null?void 0:s.couleurPrimaire)||"#8b3a2f",m=(s==null?void 0:s.couleurSecondaire)||"#f59e0b",f=U(o);r.useEffect(()=>{const i=(a==null?void 0:a.nomAgence)||(a==null?void 0:a.agencyNom)||(a==null?void 0:a.agenceNom);i&&y(i)},[a==null?void 0:a.nomAgence,a==null?void 0:a.agencyNom,a==null?void 0:a.agenceNom]),r.useEffect(()=>{(async()=>{if(e||!u)return;let n=await R(P(M(p,"reservations"),D("__name__","==",u),A(1)));if(!n.empty){const t=n.docs[0];C({...t.data(),id:t.id});return}if(n=await R(P(M(p,"reservations"),D("referenceCode","==",u),A(1))),!n.empty){const t=n.docs[0];C({...t.data(),id:t.id})}})()},[u,e]),r.useEffect(()=>{(async()=>{if(s||!(e!=null&&e.companyId))return;const n=await z(I(p,"companies",e.companyId));if(n.exists()){const t=n.data();T({id:n.id,name:(t==null?void 0:t.name)||(t==null?void 0:t.nom)||"Votre compagnie",couleurPrimaire:(t==null?void 0:t.couleurPrimaire)||(t==null?void 0:t.primaryColor),couleurSecondaire:(t==null?void 0:t.couleurSecondaire)||(t==null?void 0:t.secondaryColor),logoUrl:t==null?void 0:t.logoUrl,telephone:t==null?void 0:t.telephone,slug:t==null?void 0:t.slug,code:t==null?void 0:t.code})}})()},[s,e==null?void 0:e.companyId]),r.useEffect(()=>{const i=(e==null?void 0:e.nomAgence)||(e==null?void 0:e.agencyNom)||(e==null?void 0:e.agenceNom);if(i){y(i);return}if(!(e!=null&&e.companyId)||!(e!=null&&e.agencyId))return;const n=e.companyId,t=e.agencyId;(async()=>{try{const O=I(p,"companies",n,"agences",t),k=await z(O);if(k.exists()){const d=k.data();y((d==null?void 0:d.nom)||(d==null?void 0:d.name)||"Agence")}}catch{}})()},[e==null?void 0:e.companyId,e==null?void 0:e.agencyId,e==null?void 0:e.nomAgence,e==null?void 0:e.agencyNom,e==null?void 0:e.agenceNom]);const V=(j=e==null?void 0:e.createdAt)!=null&&j.seconds?x(new Date(e.createdAt.seconds*1e3),"dd/MM/yyyy",{locale:b}):x(new Date,"dd/MM/yyyy",{locale:b}),$=e!=null&&e.date?x(le(e.date),"dd/MM/yyyy",{locale:b}):"",H=r.useCallback(()=>{if(!h.current)return;const n={margin:2,filename:`recu-${(e==null?void 0:e.referenceCode)||(e==null?void 0:e.id)||"billet"}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:[81,200],orientation:"portrait"}};ce().set(n).from(h.current).save()},[e==null?void 0:e.referenceCode,e==null?void 0:e.id]);if(!e||!s)return l("div",{className:"flex items-center justify-center min-h-screen",children:l("p",{className:"text-gray-600",children:"Chargement du reçu..."})});const w=e.referenceCode||"—",G=`${window.location.origin}/r/${encodeURIComponent(w)}`;return c("div",{className:"min-h-screen bg-gray-50",children:[l("header",{className:"sticky top-0 z-20 px-4 py-2 shadow-sm",style:{backgroundColor:o,color:f},children:c("div",{className:"flex items-center justify-between max-w-md mx-auto",children:[l("button",{onClick:()=>N(-1),className:"p-2 rounded-full","aria-label":"Retour",children:l(K,{size:22})}),l("h1",{className:"font-bold text-lg",children:"Reçu de réservation"}),s.logoUrl?l("img",{src:s.logoUrl,alt:"Logo",className:"h-8 w-8 rounded-full object-cover border",style:{borderColor:f}}):l("div",{className:"h-8 w-8 rounded-full grid place-items-center font-bold",style:{background:g(f,.15)},children:(s.name||"C").slice(0,1)})]})}),l("main",{className:"max-w-md mx-auto px-4 py-6",children:c("div",{ref:h,className:"bg-white rounded-lg shadow-sm border p-4",children:[c("div",{className:"flex justify-between items-center border-b pb-2 mb-2",style:{borderColor:g(o,.3)},children:[c("div",{className:"flex items-center gap-2",children:[s.logoUrl&&l("img",{src:s.logoUrl,alt:s.name,className:"h-8 w-8 object-contain rounded border",style:{borderColor:o},onError:i=>i.target.src="/default-company.png"}),c("div",{children:[l("h2",{className:"font-bold text-sm",children:s.name}),c("p",{className:"text-xs text-gray-600 flex items-center gap-1",children:[l(Q,{size:12})," ",q]})]})]}),c("div",{className:"text-right",children:[c("p",{className:"text-xs font-mono",children:["N° ",w]}),l("span",{className:"px-1 py-0.5 rounded text-[10px] font-medium",style:{backgroundColor:g(o,.15),color:o},children:(e.statut||"payé").toString().toUpperCase()})]})]}),c("div",{className:"mb-3",children:[c("h3",{className:"font-semibold text-sm flex items-center gap-1",style:{color:o},children:[l(W,{size:14,style:{color:m}})," Client"]}),c("div",{className:"flex justify-between text-xs text-black",children:[c("p",{children:["Nom : ",e.nomClient]}),c("p",{children:["Téléphone : ",e.telephone]})]})]}),c("div",{className:"mb-3",children:[c("h3",{className:"font-semibold text-sm flex items-center gap-1",style:{color:o},children:[l(Y,{size:14,style:{color:m}})," Voyage"]}),c("p",{className:"text-sm font-medium flex items-center gap-1 text-black",children:[e.depart," ",l(Z,{size:14,style:{color:o}})," ",e.arrivee]}),c("div",{className:"flex justify-between text-xs text-black",children:[c("p",{children:["Date : ",$]}),c("p",{children:["Heure : ",e.heure]})]}),c("div",{className:"flex justify-between text-xs text-black",children:[c("p",{children:["Places réservées : ",e.seatsGo]}),l("p",{children:"Canal : en_ligne"})]})]}),c("div",{className:"mb-3",children:[c("h3",{className:"font-semibold text-sm flex items-center gap-1",style:{color:o},children:[l(S,{size:14,style:{color:m}})," Paiement"]}),c("div",{className:"flex justify-between items-center text-black",children:[c("p",{className:"font-bold text-lg",style:{color:o},children:[e.montant.toLocaleString("fr-FR")," FCFA"]}),l("p",{className:"text-xs",children:"Méthode : En ligne"})]})]}),c("div",{className:"text-center border-t pt-3",children:[l("h3",{className:"text-sm font-semibold mb-2",style:{color:o},children:"Code d'embarquement"}),l("div",{className:"flex justify-center",children:l(F,{value:G,size:80,fgColor:o})}),c("p",{className:"text-xs text-gray-600 mt-2",children:["Date d’émission : ",V]}),l("p",{className:"text-xs text-gray-600",children:"Validité : 1 mois à compter de la date d’émission"})]}),c("div",{className:"mt-3 text-center text-xs text-gray-600",children:[c("p",{children:["Merci d'avoir choisi ",s.name," — Bon voyage !"]}),l("p",{className:"italic",children:"Présentez-vous 1H avant le départ"})]})]})}),c("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t py-3 px-4 grid grid-cols-3 gap-2",style:{borderColor:g(o,.3)},children:[c("button",{onClick:H,className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1",style:{backgroundColor:o,color:f},children:[l(v,{size:16})," Télécharger"]}),c("button",{onClick:()=>window.print(),className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1",style:{backgroundColor:m,color:U(m)},children:[l(ee,{size:16})," Imprimer"]}),c("button",{onClick:()=>N(`/${E}`),className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1 bg-gray-200 text-gray-800",children:[l(te,{size:16})," Retour"]})]})]})};export{me as default};
