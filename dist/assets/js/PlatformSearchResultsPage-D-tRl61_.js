import{u as D,b as E,r as d,a as r,j as a,a2 as T,a3 as y,a1 as q}from"./react-DgrrIcw2.js";import{l as j,k as M,q as R,v as U,w as C}from"./firebase-eGIzIftJ.js";import{d as S}from"../index-p6Te0bSg.js";import"./vendor-BHjJ2Hjk.js";const k=s=>s==null?void 0:s.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),h=s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase(),K=()=>{const s=D(),e=E().state,[f,L]=d.useState({}),[b,F]=d.useState({}),[P,v]=d.useState(!0),[N,z]=d.useState("");if(d.useEffect(()=>{if(!(e!=null&&e.departure)||!(e!=null&&e.arrival)){s("/");return}(async()=>{v(!0);try{const l=(await j(M(S,"companies"))).docs.reduce((n,i)=>(n[i.id]={...i.data(),id:i.id},n),{});F(l);const m=h(k(e.departure)),g=h(k(e.arrival)),c=R(U(S,"weeklyTrips"),C("departure","==",m),C("arrival","==",g)),x=await j(c),p={};x.forEach(n=>{const i=n.data(),u=n.ref.path.split("/")[1],A={...i,id:n.id,companyId:u};p[u]||(p[u]=[]),p[u].push(A)}),L(p)}catch(t){console.error("❌ Erreur Firestore :",t)}finally{v(!1)}})()},[e,s]),!(e!=null&&e.departure)||!(e!=null&&e.arrival))return null;const w=Object.keys(f).filter(o=>{var l;const t=b[o];return(l=t==null?void 0:t.nom)==null?void 0:l.toLowerCase().includes(N.toLowerCase())});return r("div",{className:"min-h-screen bg-gray-50",children:[a("header",{className:"bg-white shadow-md sticky top-0 z-50",children:r("div",{className:"max-w-5xl mx-auto flex items-center justify-between px-4 py-3",children:[r("button",{onClick:()=>s("/"),className:"flex items-center text-orange-600",children:[a(T,{className:"w-5 h-5 mr-1"})," Retour"]}),r("div",{className:"flex items-center gap-2",children:[a(y,{className:"w-7 h-7 text-orange-600"}),a("span",{className:"font-bold text-xl text-orange-600",children:"Teliya"})]})]})}),r("div",{className:"max-w-5xl mx-auto px-4 mt-6 flex justify-between items-center",children:[r("div",{className:"flex items-center gap-2 text-lg font-semibold text-gray-800",children:[a(y,{className:"w-5 h-5 text-orange-600"}),r("span",{children:[h(e.departure)," → ",h(e.arrival)]})]}),r("div",{className:"relative",children:[a(q,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),a("input",{type:"text",placeholder:"Filtrer par compagnie",value:N,onChange:o=>z(o.target.value),className:"pl-9 border border-gray-300 rounded-lg py-2 px-3 text-sm"})]})]}),a("div",{className:"max-w-5xl mx-auto p-4",children:P?a("div",{className:"flex justify-center py-12",children:a("div",{className:"h-10 w-10 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"})}):w.length===0?r("div",{className:"text-center py-12",children:[a("p",{className:"text-gray-600 mb-4",children:"Aucune compagnie disponible pour ce trajet"}),a("button",{onClick:()=>s("/"),className:"bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700",children:"Nouvelle recherche"})]}):a("div",{className:"space-y-3",children:w.map(o=>{const t=b[o],l=f[o],m=Math.min(...l.map(c=>c.price)),g=l.reduce((c,x)=>c+(x.places||0),0);return r("div",{className:"bg-white rounded-lg shadow-sm p-3 flex items-center justify-between border border-gray-200",children:[r("div",{className:"flex items-center gap-3",children:[t.logoUrl&&a("img",{src:t.logoUrl,alt:t.nom,className:"w-10 h-10 rounded-full border object-cover"}),r("div",{children:[a("h3",{className:"text-md font-bold",style:{color:t.couleurPrimaire||"#ea580c"},children:t.nom}),r("p",{className:"text-xs text-gray-500",children:[g," pl. disponibles"]}),r("p",{className:"font-semibold text-sm",style:{color:"#16a34a"},children:[m.toLocaleString()," FCFA"]})]})]}),a("button",{onClick:()=>s(`/${t.slug}/booking?departure=${e.departure}&arrival=${e.arrival}`,{state:{preloaded:!0,company:t,departure:e.departure,arrival:e.arrival,preloadedPrice:m}}),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg text-sm",children:"Réserver"})]},o)})})})]})};export{K as default};
