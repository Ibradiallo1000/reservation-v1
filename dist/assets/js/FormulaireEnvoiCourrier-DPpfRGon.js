import{r as s,j as e}from"./react-BKlva80Y.js";import{q as R,w as _,j as T,k as z,y as B}from"./firebase-1zyXmG6H.js";import{u as G,d as E}from"../index-BlZmgUmn.js";import"./vendor-CZDa83Cj.js";const Q=()=>{const{user:a}=G(),[o,i]=s.useState(""),[c,u]=s.useState(""),[m,p]=s.useState(""),[g,x]=s.useState(""),[h,v]=s.useState(""),[j,b]=s.useState(""),[N,y]=s.useState(""),[f,S]=s.useState("colis"),[C,w]=s.useState("espèces"),[r,I]=s.useState(0),[l,d]=s.useState(null),[D,q]=s.useState(""),[A,M]=s.useState([]);s.useEffect(()=>{r>0?d(Math.ceil(r*.05)):d(null)},[r]),s.useEffect(()=>{(async()=>{const V=R(T(E,"dailyTrips"),_("companyId","==",a==null?void 0:a.companyId)),P=await z(V),O=new Date().toISOString().split("T")[0],k=P.docs.map(n=>({id:n.id,...n.data()})).filter(n=>n.date>=O);M(k)})()},[a==null?void 0:a.companyId]);const F=async t=>{t.preventDefault(),a!=null&&a.agencyId&&(await B(T(E,"courriers"),{expediteur:o,telephone:c,destinataire:m,numeroDestinataire:g,ville:h,adresse:j,description:N,typeColis:f,modePaiement:C,valeur:r,montant:l||0,statut:"en attente",createdAt:new Date().toISOString(),agencyId:a.agencyId,companyId:a.companyId,trajetId:D,type:"envoi"}),alert("📦 Courrier enregistré avec succès !"),i(""),u(""),p(""),x(""),v(""),b(""),y(""),S("colis"),w("espèces"),I(0),d(null),q(""))};return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"📦 Enregistrement d’un envoi"}),e.jsxs("form",{onSubmit:F,className:"space-y-6 bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("fieldset",{className:"border rounded p-4",children:[e.jsx("legend",{className:"text-lg font-semibold text-gray-700",children:"🧍 Informations de l’expéditeur"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("input",{value:o,onChange:t=>i(t.target.value),placeholder:"Nom de l'expéditeur",className:"border p-2 rounded",required:!0}),e.jsx("input",{value:c,onChange:t=>u(t.target.value),placeholder:"Téléphone de l'expéditeur",className:"border p-2 rounded",required:!0})]})]}),e.jsxs("fieldset",{className:"border rounded p-4",children:[e.jsx("legend",{className:"text-lg font-semibold text-gray-700",children:"📬 Destinataire"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("input",{value:m,onChange:t=>p(t.target.value),placeholder:"Nom du destinataire",className:"border p-2 rounded",required:!0}),e.jsx("input",{value:g,onChange:t=>x(t.target.value),placeholder:"Numéro du destinataire",className:"border p-2 rounded",required:!0}),e.jsx("input",{value:h,onChange:t=>v(t.target.value),placeholder:"Ville de destination",className:"border p-2 rounded",required:!0}),e.jsx("input",{value:j,onChange:t=>b(t.target.value),placeholder:"Adresse de livraison",className:"border p-2 rounded"})]})]}),e.jsxs("fieldset",{className:"border rounded p-4",children:[e.jsx("legend",{className:"text-lg font-semibold text-gray-700",children:"📦 Colis"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("input",{value:N,onChange:t=>y(t.target.value),placeholder:"Description du colis",className:"border p-2 rounded"}),e.jsxs("select",{value:f,onChange:t=>S(t.target.value),className:"border p-2 rounded",children:[e.jsx("option",{value:"colis",children:"Colis"}),e.jsx("option",{value:"document",children:"Document"}),e.jsx("option",{value:"autre",children:"Autre"})]})]})]}),e.jsxs("fieldset",{className:"border rounded p-4",children:[e.jsx("legend",{className:"text-lg font-semibold text-gray-700",children:"💰 Paiement"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("input",{type:"number",value:r,onChange:t=>I(Number(t.target.value)),placeholder:"Valeur déclarée (FCFA)",className:"border p-2 rounded",required:!0}),e.jsxs("select",{value:C,onChange:t=>w(t.target.value),className:"border p-2 rounded",children:[e.jsx("option",{value:"espèces",children:"Espèces"}),e.jsx("option",{value:"mobile_money",children:"Mobile Money"}),e.jsx("option",{value:"virement",children:"Virement bancaire"})]})]}),l!==null&&e.jsxs("div",{className:"text-right mt-2 text-green-600 font-semibold",children:["Montant à payer : ",l," FCFA"]})]}),e.jsxs("fieldset",{className:"border rounded p-4",children:[e.jsx("legend",{className:"text-lg font-semibold text-gray-700",children:"🚌 Trajet assigné"}),e.jsxs("select",{value:D,onChange:t=>q(t.target.value),className:"border p-2 rounded w-full mt-4",required:!0,children:[e.jsx("option",{value:"",children:"-- Sélectionner un trajet --"}),A.map(t=>e.jsxs("option",{value:t.id,children:[t.departure," → ",t.arrival," (",t.date," à ",t.time,")"]},t.id))]})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{type:"submit",className:"bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded font-medium",children:"Enregistrer l’envoi"})})]})]})};export{Q as default};
