import{c as ue,g as de,d as me,b as he,r as P,a as y,j as l,C as fe,a6 as pe,J as ye,a9 as ge,F as ve,n as $e,M as xe,aa as be,p as _e}from"./react-DB_4kGOy.js";import{z as V,w as re,x as J,y as ne}from"./firebase-lLzYRzUk.js";import{d as Z}from"../index-Bkmir__O.js";import"./vendor-C-DAJou6.js";var se={exports:{}},oe;function le(){return oe||(oe=1,function(m,M){(function(g,N){m.exports=N()})(ue,function(){var g=1e3,N=6e4,T=36e5,H="millisecond",$="second",L="minute",Y="hour",j="day",A="week",b="month",W="quarter",k="year",I="date",q="Invalid Date",K=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Q=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,te={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(a){var r=["th","st","nd","rd"],e=a%100;return"["+a+(r[(e-20)%10]||r[e]||r[0])+"]"}},c=function(a,r,e){var n=String(a);return!n||n.length>=r?a:""+Array(r+1-n.length).join(e)+a},u={s:c,z:function(a){var r=-a.utcOffset(),e=Math.abs(r),n=Math.floor(e/60),t=e%60;return(r<=0?"+":"-")+c(n,2,"0")+":"+c(t,2,"0")},m:function a(r,e){if(r.date()<e.date())return-a(e,r);var n=12*(e.year()-r.year())+(e.month()-r.month()),t=r.clone().add(n,b),i=e-t<0,o=r.clone().add(n+(i?-1:1),b);return+(-(n+(e-t)/(i?t-o:o-t))||0)},a:function(a){return a<0?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:b,y:k,w:A,d:j,D:I,h:Y,m:L,s:$,ms:H,Q:W}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return a===void 0}},f="en",p={};p[f]=te;var _="$isDayjsObject",C=function(a){return a instanceof X||!(!a||!a[_])},O=function a(r,e,n){var t;if(!r)return f;if(typeof r=="string"){var i=r.toLowerCase();p[i]&&(t=i),e&&(p[i]=e,t=i);var o=r.split("-");if(!t&&o.length>1)return a(o[0])}else{var h=r.name;p[h]=r,t=h}return!n&&t&&(f=t),t||!n&&f},d=function(a,r){if(C(a))return a.clone();var e=typeof r=="object"?r:{};return e.date=a,e.args=arguments,new X(e)},s=u;s.l=O,s.i=C,s.w=function(a,r){return d(a,{locale:r.$L,utc:r.$u,x:r.$x,$offset:r.$offset})};var X=function(){function a(e){this.$L=O(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[_]=!0}var r=a.prototype;return r.parse=function(e){this.$d=function(n){var t=n.date,i=n.utc;if(t===null)return new Date(NaN);if(s.u(t))return new Date;if(t instanceof Date)return new Date(t);if(typeof t=="string"&&!/Z$/i.test(t)){var o=t.match(K);if(o){var h=o[2]-1||0,v=(o[7]||"0").substring(0,3);return i?new Date(Date.UTC(o[1],h,o[3]||1,o[4]||0,o[5]||0,o[6]||0,v)):new Date(o[1],h,o[3]||1,o[4]||0,o[5]||0,o[6]||0,v)}}return new Date(t)}(e),this.init()},r.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},r.$utils=function(){return s},r.isValid=function(){return this.$d.toString()!==q},r.isSame=function(e,n){var t=d(e);return this.startOf(n)<=t&&t<=this.endOf(n)},r.isAfter=function(e,n){return d(e)<this.startOf(n)},r.isBefore=function(e,n){return this.endOf(n)<d(e)},r.$g=function(e,n,t){return s.u(e)?this[n]:this.set(t,e)},r.unix=function(){return Math.floor(this.valueOf()/1e3)},r.valueOf=function(){return this.$d.getTime()},r.startOf=function(e,n){var t=this,i=!!s.u(n)||n,o=s.p(e),h=function(R,S){var E=s.w(t.$u?Date.UTC(t.$y,S,R):new Date(t.$y,S,R),t);return i?E:E.endOf(j)},v=function(R,S){return s.w(t.toDate()[R].apply(t.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(S)),t)},x=this.$W,w=this.$M,D=this.$D,z="set"+(this.$u?"UTC":"");switch(o){case k:return i?h(1,0):h(31,11);case b:return i?h(1,w):h(0,w+1);case A:var F=this.$locale().weekStart||0,U=(x<F?x+7:x)-F;return h(i?D-U:D+(6-U),w);case j:case I:return v(z+"Hours",0);case Y:return v(z+"Minutes",1);case L:return v(z+"Seconds",2);case $:return v(z+"Milliseconds",3);default:return this.clone()}},r.endOf=function(e){return this.startOf(e,!1)},r.$set=function(e,n){var t,i=s.p(e),o="set"+(this.$u?"UTC":""),h=(t={},t[j]=o+"Date",t[I]=o+"Date",t[b]=o+"Month",t[k]=o+"FullYear",t[Y]=o+"Hours",t[L]=o+"Minutes",t[$]=o+"Seconds",t[H]=o+"Milliseconds",t)[i],v=i===j?this.$D+(n-this.$W):n;if(i===b||i===k){var x=this.clone().set(I,1);x.$d[h](v),x.init(),this.$d=x.set(I,Math.min(this.$D,x.daysInMonth())).$d}else h&&this.$d[h](v);return this.init(),this},r.set=function(e,n){return this.clone().$set(e,n)},r.get=function(e){return this[s.p(e)]()},r.add=function(e,n){var t,i=this;e=Number(e);var o=s.p(n),h=function(w){var D=d(i);return s.w(D.date(D.date()+Math.round(w*e)),i)};if(o===b)return this.set(b,this.$M+e);if(o===k)return this.set(k,this.$y+e);if(o===j)return h(1);if(o===A)return h(7);var v=(t={},t[L]=N,t[Y]=T,t[$]=g,t)[o]||1,x=this.$d.getTime()+e*v;return s.w(x,this)},r.subtract=function(e,n){return this.add(-1*e,n)},r.format=function(e){var n=this,t=this.$locale();if(!this.isValid())return t.invalidDate||q;var i=e||"YYYY-MM-DDTHH:mm:ssZ",o=s.z(this),h=this.$H,v=this.$m,x=this.$M,w=t.weekdays,D=t.months,z=t.meridiem,F=function(S,E,G,ee){return S&&(S[E]||S(n,i))||G[E].slice(0,ee)},U=function(S){return s.s(h%12||12,S,"0")},R=z||function(S,E,G){var ee=S<12?"AM":"PM";return G?ee.toLowerCase():ee};return i.replace(Q,function(S,E){return E||function(G){switch(G){case"YY":return String(n.$y).slice(-2);case"YYYY":return s.s(n.$y,4,"0");case"M":return x+1;case"MM":return s.s(x+1,2,"0");case"MMM":return F(t.monthsShort,x,D,3);case"MMMM":return F(D,x);case"D":return n.$D;case"DD":return s.s(n.$D,2,"0");case"d":return String(n.$W);case"dd":return F(t.weekdaysMin,n.$W,w,2);case"ddd":return F(t.weekdaysShort,n.$W,w,3);case"dddd":return w[n.$W];case"H":return String(h);case"HH":return s.s(h,2,"0");case"h":return U(1);case"hh":return U(2);case"a":return R(h,v,!0);case"A":return R(h,v,!1);case"m":return String(v);case"mm":return s.s(v,2,"0");case"s":return String(n.$s);case"ss":return s.s(n.$s,2,"0");case"SSS":return s.s(n.$ms,3,"0");case"Z":return o}return null}(S)||o.replace(":","")})},r.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},r.diff=function(e,n,t){var i,o=this,h=s.p(n),v=d(e),x=(v.utcOffset()-this.utcOffset())*N,w=this-v,D=function(){return s.m(o,v)};switch(h){case k:i=D()/12;break;case b:i=D();break;case W:i=D()/3;break;case A:i=(w-x)/6048e5;break;case j:i=(w-x)/864e5;break;case Y:i=w/T;break;case L:i=w/N;break;case $:i=w/g;break;default:i=w}return t?i:s.a(i)},r.daysInMonth=function(){return this.endOf(b).$D},r.$locale=function(){return p[this.$L]},r.locale=function(e,n){if(!e)return this.$L;var t=this.clone(),i=O(e,n,!0);return i&&(t.$L=i),t},r.clone=function(){return s.w(this.$d,this)},r.toDate=function(){return new Date(this.valueOf())},r.toJSON=function(){return this.isValid()?this.toISOString():null},r.toISOString=function(){return this.$d.toISOString()},r.toString=function(){return this.$d.toUTCString()},a}(),ie=X.prototype;return d.prototype=ie,[["$ms",H],["$s",$],["$m",L],["$H",Y],["$W",j],["$M",b],["$y",k],["$D",I]].forEach(function(a){ie[a[1]]=function(r){return this.$g(r,a[0],a[1])}}),d.extend=function(a,r){return a.$i||(a(r,X,d),a.$i=!0),d},d.locale=O,d.isDayjs=C,d.unix=function(a){return d(1e3*a)},d.en=p[f],d.Ls=p,d.p={},d})}(se)),se.exports}var Me=le();const B=de(Me);var we={exports:{}};(function(m,M){(function(g,N){m.exports=N(le())})(ue,function(g){function N($){return $&&typeof $=="object"&&"default"in $?$:{default:$}}var T=N(g),H={name:"fr",weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function($){return""+$+($===1?"er":"")}};return T.default.locale(H,null,!0),H})})(we);B.locale("fr");const ae=m=>m?typeof m=="string"?B(m):typeof m=="object"&&"seconds"in m?B(m.seconds*1e3):null:null,Ne=m=>(m||"").replace(/[^\d+]/g,"").replace(/^00/,"+").trim(),Se=({s:m})=>{const M=(m||"").toLowerCase(),g=M.includes("pay")||M.includes("confirm")?"bg-emerald-100 text-emerald-700 border border-emerald-200":M.includes("attent")?"bg-amber-100 text-amber-700 border border-amber-200":M.includes("annul")||M.includes("refus")?"bg-rose-100 text-rose-700 border border-rose-200":"bg-slate-100 text-slate-700 border border-slate-200",N=M.includes("pay")?"Payé":M.includes("confirm")?"Confirmée":M.includes("attent")?"En attente":M.includes("annul")?"Annulée":M.includes("refus")?"Refusée":m||"—";return l("span",{className:`inline-flex items-center text-xs px-2 py-0.5 rounded-full ${g}`,children:N})},ce=5,Ce=5,Oe=()=>{const{slug:m}=me(),M=he(),[g,N]=P.useState({primary:"#ea580c",secondary:"#f97316"}),[T,H]=P.useState(""),[$,L]=P.useState(!1),[Y,j]=P.useState([]),[A,b]=P.useState(""),[W,k]=P.useState(ce),I=P.useMemo(()=>m?"Mes réservations":"Retrouver mes réservations",[m]);P.useEffect(()=>{(async()=>{if(m)try{const c=await V(re(J(Z,"companies"),ne("slug","==",m)));if(!c.empty){const u=c.docs[0].data();N(f=>({...f,primary:(u==null?void 0:u.couleurPrimaire)||f.primary,secondary:(u==null?void 0:u.couleurSecondaire)||f.secondary}))}}catch{}})()},[m]);const q=async(c,u)=>{const f=await V(J(Z,"companies",c,"agences")),p=[];for(const _ of f.docs){const C=re(J(Z,"companies",c,"agences",_.id,"reservations"),ne("telephone","==",T));(await V(C)).forEach(d=>{const s=d.data();p.push({id:d.id,companyId:c,agencyId:_.id,companySlug:(u==null?void 0:u.slug)||void 0,couleurPrimaire:u==null?void 0:u.couleurPrimaire,couleurSecondaire:u==null?void 0:u.couleurSecondaire,nomClient:s.nomClient||s.clientNom,telephone:s.telephone,depart:s.depart||s.departure,arrivee:s.arrivee||s.arrival,arrival:s.arrival,date:s.date,heure:s.heure,nombre_places:s.nombre_places??s.seatsGo??s.seats??void 0,seatsGo:s.seatsGo,montant_total:s.montant_total??s.montant??void 0,statut:s.statut,lieu_depart:s.lieu_depart,canal:s.canal||void 0})})}return p},K=async()=>{if(!Ne(T)){b("Entrez le numéro utilisé lors de vos réservations (format local ou international).");return}b(""),L(!0),j([]),k(ce);try{let u=[];if(m){const f=await V(re(J(Z,"companies"),ne("slug","==",m)));if(f.empty)b("Compagnie introuvable.");else{const p=f.docs[0],_=p.data();N(C=>({...C,primary:(_==null?void 0:_.couleurPrimaire)||C.primary,secondary:(_==null?void 0:_.couleurSecondaire)||C.secondary})),u=u.concat(await q(p.id,_))}}else{const f=await V(J(Z,"companies"));for(const p of f.docs)u=u.concat(await q(p.id,p.data()))}u.sort((f,p)=>{var O,d;const _=(((O=ae(f.date))==null?void 0:O.valueOf())||0)+(f.heure?B(`1970-01-01T${f.heure}`).valueOf()%864e5:0);return(((d=ae(p.date))==null?void 0:d.valueOf())||0)+(p.heure?B(`1970-01-01T${p.heure}`).valueOf()%864e5:0)-_}),u.length||b("Aucune réservation trouvée pour ce numéro."),j(u)}catch(u){console.error(u),b("Erreur lors de la recherche. Réessayez.")}finally{L(!1)}},Q=Y.slice(0,W),te=W<Y.length;return y("div",{className:"min-h-screen bg-gray-50",children:[l("header",{className:"sticky top-0 z-20 border-b",style:{backgroundColor:g.primary},children:y("div",{className:"max-w-3xl mx-auto px-3 py-2 flex items-center gap-2 text-white",children:[l("button",{onClick:()=>M(m?`/${m}`:"/"),className:"p-2 rounded hover:bg-white/10",children:l(fe,{className:"w-5 h-5"})}),l("h1",{className:"font-semibold",children:I})]})}),y("main",{className:"max-w-3xl mx-auto p-4 space-y-4",children:[y("section",{className:"bg-white border rounded-xl p-4",children:[l("label",{className:"text-sm font-medium text-gray-800",children:"Numéro de téléphone"}),y("p",{className:"mt-1 text-xs text-gray-500",children:["Saisissez le numéro utilisé lors de vos réservations format local, puis appuyez sur"," ",l("span",{className:"font-medium",children:"Rechercher"}),"."]}),y("div",{className:"mt-3 flex gap-2",children:[y("div",{className:"relative flex-1",children:[l(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),l("input",{type:"tel",value:T,onChange:c=>H(c.target.value),placeholder:"70 00 00 00",className:"w-full h-11 pl-9 pr-3 border rounded-lg focus:ring-2 focus:ring-orange-200 outline-none",onKeyDown:c=>c.key==="Enter"&&K()})]}),y("button",{onClick:K,disabled:$,className:"h-11 px-4 rounded-lg text-white shadow-sm disabled:opacity-60 inline-flex items-center gap-2",style:{background:`linear-gradient(135deg, ${g.secondary}, ${g.primary})`},children:[l(ye,{className:"w-4 h-4"}),"Rechercher"]})]}),A&&l("p",{className:"mt-2 text-sm text-red-600",children:A})]}),y("section",{className:"bg-white border rounded-xl overflow-hidden",children:[y("div",{className:"p-3 border-b flex items-center gap-2 text-gray-800",children:[l(ge,{className:"w-4 h-4",style:{color:g.primary}}),l("span",{className:"text-sm font-medium",children:"Résultats"}),y("span",{className:"ml-auto text-xs text-gray-500",children:[Y.length," élément(s)"]})]}),$?l("div",{className:"p-6 text-sm text-gray-600",children:"Chargement…"}):Q.length===0?l("div",{className:"p-6 text-sm text-gray-500",children:"Aucun résultat."}):y(ve,{children:[l("ul",{className:"",children:Q.map(c=>{var d;const u=((d=ae(c.date))==null?void 0:d.format("dddd D MMMM YYYY"))||"—",f=c.heure||"",p=c.depart||"—",_=c.arrivee||c.arrival||"—",C=c.nombre_places??c.seatsGo??void 0,O=c.montant_total??c.montant??void 0;return l("li",{className:"relative",children:y("div",{className:"m-3 rounded-2xl border bg-white shadow-sm hover:shadow-md transition-all overflow-hidden",style:{borderColor:`${g.primary}30`},children:[l("span",{className:"absolute left-0 top-0 bottom-0 w-1.5 rounded-l-2xl",style:{backgroundColor:g.primary}}),l("div",{className:"p-4 pl-5",children:y("div",{className:"flex items-start justify-between gap-3",children:[y("div",{className:"min-w-0",children:[y("div",{className:"text-sm font-semibold text-gray-900 truncate",children:[p," ",l("span",{className:"text-gray-400",children:"→"})," ",_]}),y("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[y("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border",style:{backgroundColor:`${g.secondary}15`,borderColor:`${g.secondary}30`,color:"#374151"},children:[l($e,{className:"w-3.5 h-3.5"}),u," ",f&&`· ${f}`]}),c.lieu_depart&&y("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border text-gray-700 bg-gray-50",children:[l(xe,{className:"w-3.5 h-3.5 text-gray-500"}),"Départ : ",c.lieu_depart]}),typeof C=="number"&&y("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border text-gray-700 bg-gray-50",children:[l(be,{className:"w-3.5 h-3.5 text-gray-500"}),C," place(s)"]}),typeof O=="number"&&y("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border",style:{backgroundColor:`${g.primary}12`,borderColor:`${g.primary}30`,color:"#374151"},children:[l(_e,{className:"w-3.5 h-3.5"}),O.toLocaleString("fr-FR")," FCFA"]})]}),y("div",{className:"mt-3 flex items-center gap-2",children:[l(Se,{s:c.statut}),c.canal&&l("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-100 border text-gray-700",children:c.canal==="guichet"?"Guichet":"En ligne"})]})]}),l("div",{className:"shrink-0",children:l("button",{onClick:()=>M(`/${c.companySlug||m||""}/reservation/${c.id}`,{state:{companyId:c.companyId,agencyId:c.agencyId}}),className:"text-sm px-3 py-1.5 rounded-lg border shadow-sm hover:bg-gray-50",style:{borderColor:`${g.primary}40`},children:"Voir billet"})})]})})]})},`${c.companyId}_${c.agencyId}_${c.id}`)})}),te&&l("div",{className:"p-4 border-t flex justify-center",children:l("button",{onClick:()=>k(c=>Math.min(c+Ce,Y.length)),className:"text-sm px-4 py-2 rounded-lg border hover:bg-gray-50",style:{borderColor:`${g.primary}40`},children:"Voir plus"})})]})]})]})]})};export{Oe as default};
