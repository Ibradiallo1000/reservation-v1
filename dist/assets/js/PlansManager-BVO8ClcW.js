import{r as c,a as t,j as a,F as S}from"./vendor-Bq-8_m9i.js";import{z as A,O as w,l as x,d,B as o}from"./agence-Bsj2lp2X.js";import{r as B,t as D,I as q,u as E,x as P,v as R,o as C,E as G,K as j}from"./firebase-CURBI7X6.js";import{l as u,a9 as I,aS as O,aT as z,aU as U,a8 as F}from"./icons-C0JHUK9Z.js";import"./compagnie-DiuZFnHS.js";import"./router-DoGdw-3y.js";import"./courier-CoQgRaHG.js";const g={name:"",priceMonthly:0,quotaReservations:0,digitalFeePercent:0,feeGuichet:0,minimumMonthly:0,maxAgences:1,supportLevel:"basic",isTrial:!1,trialDurationDays:0,brandingLocked:!1,features:{publicPage:!0,onlineBooking:!0,guichet:!0}},Q=new Intl.NumberFormat("fr-FR"),k={basic:{label:"Basic",color:"bg-gray-100 text-gray-700"},standard:{label:"Standard",color:"bg-blue-100 text-blue-700"},priority:{label:"Prioritaire",color:"bg-amber-100 text-amber-700"},premium:{label:"Premium",color:"bg-purple-100 text-purple-700"},enterprise:{label:"Enterprise",color:"bg-indigo-100 text-indigo-700"}},_={basic:a(F,{className:"h-3.5 w-3.5"}),standard:a(F,{className:"h-3.5 w-3.5"}),priority:a(U,{className:"h-3.5 w-3.5"}),premium:a(z,{className:"h-3.5 w-3.5"}),enterprise:a(O,{className:"h-3.5 w-3.5"})},l="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 focus:border-[var(--btn-primary,#FF6600)] focus:outline-none focus:ring-2 focus:ring-[var(--btn-primary,#FF6600)]/20 disabled:opacity-50",$=`${l} appearance-none`;function X(){const[b,y]=c.useState([]),[r,i]=c.useState(g),[f,v]=c.useState(!1),p=async()=>{try{const e=B(D(d,"plans"),q("priceMonthly","asc")),m=(await E(e)).docs.map(N=>{const n=N.data();return{id:N.id,name:n.name??n.nom??"",priceMonthly:Number(n.priceMonthly)||0,quotaReservations:Number(n.quotaReservations)||0,digitalFeePercent:Number(n.digitalFeePercent)||0,feeGuichet:Number(n.feeGuichet)||0,minimumMonthly:Number(n.minimumMonthly)||0,maxAgences:Number(n.maxAgences??n.maxAgencies)||1,supportLevel:n.supportLevel||"basic",isTrial:!!n.isTrial,trialDurationDays:Number(n.trialDurationDays)||0,brandingLocked:!!n.brandingLocked,features:{publicPage:!0,onlineBooking:!0,guichet:!0}}});y(m)}catch(e){console.error("Erreur lecture plans:",e),alert("Impossible de charger les plans (voir console)."),y([])}};c.useEffect(()=>{(async()=>(await A,await p()))()},[]);const h=c.useMemo(()=>!!r.id,[r.id]),L=e=>e.name.trim()?e.digitalFeePercent<0||e.digitalFeePercent>100?"Le frais digital doit être entre 0 et 100%.":"":"Le nom du plan est requis.",M=async e=>{e.preventDefault(),v(!0);try{const s={name:r.name.trim(),priceMonthly:Number(r.priceMonthly)||0,quotaReservations:Number(r.quotaReservations)||0,digitalFeePercent:Number(r.digitalFeePercent)||0,feeGuichet:Number(r.feeGuichet)||0,minimumMonthly:Number(r.minimumMonthly)||0,maxAgences:Number(r.maxAgences)||0,supportLevel:r.supportLevel||"basic",isTrial:!!r.isTrial,trialDurationDays:r.isTrial?Number(r.trialDurationDays)||30:0,brandingLocked:!!r.brandingLocked,features:{publicPage:!0,onlineBooking:!0,guichet:!0},updatedAt:P()},m=L(r);if(m){alert(m);return}r.id?await R(C(d,"plans",r.id),s,{merge:!0}):await G(D(d,"plans"),{...s,createdAt:P()}),i(g),await p()}finally{v(!1)}},T=async e=>{confirm("Supprimer ce plan ?")&&(await j(C(d,"plans",e)),await p())};return t("div",{className:"p-4 md:p-6 max-w-7xl mx-auto space-y-6",children:[t("div",{className:"flex items-center justify-between",children:[t("div",{children:[a("h1",{className:"text-2xl font-bold text-gray-900",children:"Plans & Tarifs"}),a("p",{className:"text-sm text-gray-500 mt-1",children:"Modèle dual : abonnement mensuel + frais canal digital (% sur réservations en ligne)"})]}),a(o,{variant:"primary",onClick:()=>i(g),children:"+ Nouveau plan"})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[b.map(e=>{const s=k[e.supportLevel]??k.basic;return t("div",{className:"rounded-xl border border-gray-200 shadow-sm p-5 bg-white flex flex-col",children:[t("div",{className:"flex items-start justify-between mb-3",children:[t("div",{children:[t("div",{className:"flex items-center gap-2",children:[a("h3",{className:"font-semibold text-lg text-gray-900",children:e.name}),e.isTrial&&a("span",{className:"inline-flex items-center gap-1 rounded-full bg-amber-100 px-2 py-0.5 text-xs font-medium text-amber-700",children:"Essai"})]}),a("div",{className:"text-2xl font-bold mt-1",children:e.priceMonthly===0?a("span",{className:"text-green-600",children:"Gratuit"}):t(S,{children:[w(e.priceMonthly),a("span",{className:"text-sm font-normal text-gray-500",children:"/mois"})]})})]}),t("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium ${s.color}`,children:[_[e.supportLevel],s.label]})]}),t("div",{className:"space-y-2 text-sm text-gray-700 flex-1",children:[t("div",{className:"flex justify-between",children:[a("span",{children:"Agences max"}),a("strong",{children:e.maxAgences===0?"Illimité":e.maxAgences})]}),t("div",{className:"flex justify-between",children:[a("span",{children:"Quota réservations / mois"}),a("strong",{children:e.quotaReservations===0?"Illimité":Q.format(e.quotaReservations)})]}),t("div",{className:"flex justify-between",children:[a("span",{className:"text-[var(--btn-primary,#FF6600)] font-medium",children:"Frais canal digital"}),t("strong",{className:"text-[var(--btn-primary,#FF6600)]",children:[e.digitalFeePercent,"%"]})]}),e.feeGuichet>0&&t("div",{className:"flex justify-between",children:[a("span",{children:"Frais guichet"}),t("strong",{children:[w(e.feeGuichet),"/billet"]})]}),e.isTrial&&e.trialDurationDays&&e.trialDurationDays>0&&t("div",{className:"flex justify-between",children:[a("span",{children:"Durée essai"}),t("strong",{children:[e.trialDurationDays," jours"]})]}),e.brandingLocked&&a("div",{className:"text-xs text-amber-600 font-medium mt-1",children:"Branding Teliya verrouillé"})]}),t("div",{className:"flex flex-wrap gap-1.5 mt-3 pt-3 border-t border-gray-100",children:[t("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-0.5 text-xs text-green-700",children:[a(u,{className:"h-3 w-3"})," Gestion interne"]}),t("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-0.5 text-xs text-green-700",children:[a(u,{className:"h-3 w-3"})," Page publique"]}),t("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-0.5 text-xs text-green-700",children:[a(u,{className:"h-3 w-3"})," Réservation en ligne"]}),t("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-2 py-0.5 text-xs text-green-700",children:[a(u,{className:"h-3 w-3"})," Guichet"]})]}),t("div",{className:"mt-4 flex gap-2",children:[a(o,{variant:"secondary",size:"sm",onClick:()=>i(e),children:"Éditer"}),a(o,{variant:"danger",size:"sm",onClick:()=>e.id&&T(e.id),children:"Supprimer"})]})]},e.id)}),b.length===0&&a("div",{className:"text-sm text-gray-500 col-span-full",children:"Aucun plan créé pour le moment."})]}),t("form",{onSubmit:M,className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6 space-y-6",children:[t("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[a(I,{className:"h-5 w-5 text-gray-600"}),h?"Modifier le plan":"Créer un plan"]}),t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t("div",{children:[a("label",{className:"text-sm font-medium text-gray-700",children:"Nom du plan"}),a("input",{className:l,placeholder:"Trial, Starter, Growth, Pro…",value:r.name,onChange:e=>i({...r,name:e.target.value})})]}),t("div",{children:[t("label",{className:"text-sm font-medium text-gray-700",children:["Prix mensuel (",x(),")"]}),a("input",{className:l,type:"number",min:"0",value:r.priceMonthly,onChange:e=>i({...r,priceMonthly:Number(e.target.value)})})]}),t("div",{children:[t("label",{className:"text-sm font-medium text-gray-700",children:["Agences maximum ",a("span",{className:"text-xs text-gray-400",children:"(0 = illimité)"})]}),a("input",{className:l,type:"number",min:"0",value:r.maxAgences,onChange:e=>i({...r,maxAgences:Number(e.target.value)})})]}),t("div",{children:[t("label",{className:"text-sm font-medium text-gray-700",children:["Quota réservations / mois ",a("span",{className:"text-xs text-gray-400",children:"(0 = illimité)"})]}),a("input",{className:l,type:"number",min:"0",value:r.quotaReservations,onChange:e=>i({...r,quotaReservations:Number(e.target.value)})})]}),t("div",{children:[a("label",{className:"text-sm font-medium text-gray-700",children:"Frais canal digital (%)"}),a("input",{className:l,type:"number",step:"0.1",min:"0",max:"100",value:r.digitalFeePercent,onChange:e=>i({...r,digitalFeePercent:Number(e.target.value)})}),a("p",{className:"text-xs text-gray-400 mt-1",children:"Pourcentage prélevé sur chaque réservation en ligne"})]}),t("div",{children:[t("label",{className:"text-sm font-medium text-gray-700",children:["Frais guichet (",x()," / billet)"]}),a("input",{className:l,type:"number",min:"0",value:r.feeGuichet,onChange:e=>i({...r,feeGuichet:Number(e.target.value)})})]}),t("div",{children:[t("label",{className:"text-sm font-medium text-gray-700",children:["Minimum mensuel (",x(),") ",a("span",{className:"text-xs text-gray-400",children:"(0 = aucun)"})]}),a("input",{className:l,type:"number",min:"0",value:r.minimumMonthly,onChange:e=>i({...r,minimumMonthly:Number(e.target.value)})})]}),t("div",{children:[a("label",{className:"text-sm font-medium text-gray-700",children:"Niveau de support"}),t("select",{className:$,value:r.supportLevel,onChange:e=>i({...r,supportLevel:e.target.value}),children:[a("option",{value:"basic",children:"Basic"}),a("option",{value:"standard",children:"Standard"}),a("option",{value:"priority",children:"Prioritaire"}),a("option",{value:"premium",children:"Premium"}),a("option",{value:"enterprise",children:"Enterprise"})]})]}),t("div",{className:"space-y-2",children:[t("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[a("input",{type:"checkbox",className:"rounded",checked:r.isTrial??!1,onChange:e=>i({...r,isTrial:e.target.checked,trialDurationDays:e.target.checked?30:0})}),"Plan d'essai (trial)"]}),r.isTrial&&t("div",{children:[a("label",{className:"text-xs text-gray-500",children:"Durée (jours)"}),a("input",{className:l,type:"number",min:"1",value:r.trialDurationDays||30,onChange:e=>i({...r,trialDurationDays:Number(e.target.value)})})]})]})]}),t("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[a("input",{type:"checkbox",className:"rounded",checked:r.brandingLocked??!1,onChange:e=>i({...r,brandingLocked:e.target.checked})}),"Branding Teliya verrouillé (le CEO ne peut pas personnaliser le thème)"]}),t("div",{className:"rounded-lg bg-green-50 border border-green-200 p-3 text-sm text-green-700",children:[a("strong",{children:"Note :"})," Tous les plans incluent désormais : gestion interne, page publique, réservation en ligne, guichet et tableau de bord. Les plans se différencient par le prix, les quotas et le frais canal digital."]}),t("div",{className:"flex gap-2",children:[a(o,{type:"submit",variant:"primary",disabled:f,children:f?"Enregistrement…":h?"Enregistrer":"Créer le plan"}),h&&a(o,{type:"button",variant:"secondary",onClick:()=>i(g),children:"Annuler"})]})]})]})}export{X as default};
