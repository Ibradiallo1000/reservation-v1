import{a as s,j as t,ar as _,P as O,aA as T,n as q,o as $,aJ as G,bl as K,d as B,b as H,u as J,r,C as V,a5 as Q,K as W,aK as X}from"./react-KXT1Riez.js";import{u as A,r as P,J as M,w as R,L,q as Y,o as Z}from"./firebase-DYTOaTLw.js";import{s as C,d as I}from"../index-CBC3XRHi.js";import{D as N,h as ee}from"./ticketMessages-3kq_IPVw.js";import{f as F,c as U,p as te}from"./vendor-B27hBV_J.js";import"./jspdf.es.min-z1sh-bkM.js";import"./html2canvas-iRN4OxZ6.js";const se=({companyName:i,logoUrl:h,primaryColor:d,secondaryColor:w,agencyName:g,receiptNumber:x,statut:e="CONFIRMÉ",nomClient:v,telephone:n,depart:j,arrivee:k,date:S,heure:f,seats:p,canal:u="EN LIGNE",montant:y,qrValue:m,emissionDate:E,paymentMethod:D="PAIEMENT MOBILE"})=>{const b=C(d),o=w||d,l=(c=>c.toLowerCase().split(" ").map(z=>z.charAt(0).toUpperCase()+z.slice(1)).join(" "))(v);return s("div",{className:"w-full max-w-md mx-auto bg-white rounded-2xl shadow-lg overflow-hidden text-sm",children:[t("div",{className:"px-4 py-3",style:{backgroundColor:d,color:b},children:s("div",{className:"flex items-center justify-between",children:[s("div",{className:"flex items-center gap-2",children:[h&&t("img",{src:h,alt:i,className:"h-8 w-8 rounded-full object-cover border",style:{borderColor:b}}),s("div",{children:[t("h1",{className:"font-bold uppercase text-sm leading-tight",children:i}),g&&t("p",{className:"text-[10px] opacity-90",children:g})]})]}),s("div",{className:"text-right text-[10px] font-mono",children:[t("p",{children:x}),t("p",{children:E})]})]})}),s("div",{className:"px-4 py-1.5 flex justify-between items-center bg-gray-50 border-b text-[10px]",children:[t("span",{className:"font-bold px-2 py-0.5 rounded-full",style:{backgroundColor:o,color:C(o)},children:e}),t("span",{className:"uppercase tracking-wide text-gray-600",children:u})]}),t("div",{className:"px-4 py-3 border-b",children:s("div",{className:"flex justify-between items-center",children:[s("div",{className:"flex items-center gap-2",children:[t(_,{size:14,style:{color:o}}),t("span",{className:"font-semibold",children:l})]}),s("div",{className:"flex items-center gap-2",children:[t(O,{size:14,style:{color:o}}),t("span",{children:n})]})]})}),s("div",{className:"px-4 py-4",children:[s("div",{className:"flex items-center justify-center gap-2 text-base font-bold uppercase mb-3",children:[t("span",{children:j}),t(T,{size:16,style:{color:o}}),t("span",{children:k})]}),s("div",{className:"grid grid-cols-3 gap-2 text-[11px] rounded-xl p-2",style:{backgroundColor:`${o}15`},children:[s("div",{className:"flex flex-col items-center gap-1",children:[t(q,{size:14,style:{color:o}}),t("span",{className:"font-semibold",children:S})]}),s("div",{className:"flex flex-col items-center gap-1",children:[t($,{size:14,style:{color:o}}),t("span",{className:"font-semibold",children:f})]}),s("div",{className:"flex flex-col items-center gap-1",children:[t(G,{size:14,style:{color:o}}),t("span",{className:"font-semibold",children:p})]})]})]}),t("div",{className:"px-4 py-3 border-t border-b bg-gray-50",children:s("div",{className:"flex justify-between items-center",children:[s("p",{className:"text-lg font-bold",style:{color:d},children:[y.toLocaleString("fr-FR")," FCFA"]}),t("span",{className:"text-[10px] text-gray-600 uppercase",children:D})]})}),s("div",{className:"px-4 py-4 text-center",children:[t("p",{className:"text-[10px] uppercase mb-2 font-semibold",style:{color:o},children:"Code d’embarquement"}),t("div",{className:"inline-block bg-white p-2 rounded-xl shadow",children:t(K,{value:m,size:95,fgColor:"#000000",bgColor:"#ffffff",level:"H"})}),t("p",{className:"text-[10px] font-mono mt-2 font-semibold",children:x})]}),s("div",{className:"px-4 py-3 text-center text-[10px] text-gray-600 border-t space-y-1",children:[t("p",{className:"font-semibold",children:N.control}),t("p",{children:N.validity}),s("p",{children:["Merci d’avoir choisi ",i]}),t("p",{className:"italic",children:N.arrival}),t("p",{children:N.keep})]})]})},de=()=>{const{id:i,slug:h}=B(),d=H(),w=J(),{companyInfo:g,reservation:x}=w.state||{},[e,v]=r.useState(x||null),[n,j]=r.useState(g||null),[k,S]=r.useState("Agence"),f=r.useRef(null),p=(n==null?void 0:n.couleurPrimaire)||"#8b3a2f",u=(n==null?void 0:n.couleurSecondaire)||"#f59e0b",y=C(p);r.useEffect(()=>{if(!i||e)return;(async()=>{let l=await A(P(L(I,"reservations"),R("referenceCode","==",i),M(1)));if(l.empty&&(l=await A(P(L(I,"reservations"),R("__name__","==",i),M(1)))),!l.empty){const c=l.docs[0];v({...c.data(),id:c.id})}})()},[i,e]),r.useEffect(()=>{if(!(e!=null&&e.companyId)||n)return;(async()=>{const l=await Y(Z(I,"companies",e.companyId));if(!l.exists())return;const c=l.data();j({id:l.id,name:c.nom||c.name,couleurPrimaire:c.couleurPrimaire||c.primaryColor,couleurSecondaire:c.couleurSecondaire||c.secondaryColor,logoUrl:c.logoUrl,slug:c.slug,telephone:c.telephone})})()},[e==null?void 0:e.companyId,n]),r.useEffect(()=>{const a=(e==null?void 0:e.nomAgence)||(e==null?void 0:e.agencyNom)||(e==null?void 0:e.agenceNom);a&&S(a.toString().trim())},[e]);const m=(e==null?void 0:e.referenceCode)||(e==null?void 0:e.id)||"BIL-INCONNU",E=r.useMemo(()=>`${window.location.origin}/r/${encodeURIComponent(m)}`,[m]),D=r.useMemo(()=>{const a=e==null?void 0:e.createdAt;let l;return a?a instanceof Date?l=a:a!=null&&a.seconds?l=new Date(a.seconds*1e3):l=new Date:l=new Date,F(l,"dd/MM/yyyy",{locale:U})},[e==null?void 0:e.createdAt]),b=e!=null&&e.date?F(te(e.date),"dd/MM/yyyy",{locale:U}):"",o=r.useCallback(()=>{if(!f.current)return;const a={margin:2,filename:`recu-${m}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:[81,200],orientation:"portrait"}};ee().set(a).from(f.current).save()},[m]);return!e||!n?t("div",{className:"flex items-center justify-center min-h-screen",children:"Chargement du reçu..."}):s("div",{className:"min-h-screen bg-gray-50",children:[t("header",{className:"sticky top-0 z-20 px-4 py-2 shadow-sm",style:{backgroundColor:p,color:y},children:s("div",{className:"flex items-center justify-between max-w-md mx-auto",children:[t("button",{onClick:()=>d(-1),className:"p-2 rounded-full",children:t(V,{size:22})}),t("h1",{className:"font-bold text-lg",children:"Reçu de réservation"}),t("div",{className:"w-8"})]})}),t("main",{className:"max-w-md mx-auto px-4 py-6",children:t("div",{ref:f,children:t(se,{companyName:n.name,logoUrl:n.logoUrl,primaryColor:p,secondaryColor:u,agencyName:k,receiptNumber:m,statut:e.statut,nomClient:e.nomClient,telephone:e.telephone,depart:e.depart,arrivee:e.arrivee,date:b,heure:e.heure,seats:e.seatsGo,canal:e.canal||"en_ligne",montant:e.montant,qrValue:E,emissionDate:D})})}),s("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t py-3 px-4 grid grid-cols-3 gap-2",children:[s("button",{onClick:o,className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1",style:{backgroundColor:p,color:y},children:[t(Q,{size:16}),"Télécharger"]}),s("button",{onClick:()=>window.print(),className:"py-2 rounded-lg font-medium flex items-center justify-center gap-1",style:{backgroundColor:u,color:C(u)},children:[t(W,{size:16}),"Imprimer"]}),s("button",{onClick:()=>d(`/${h}`),className:"py-2 rounded-lg bg-gray-200 text-gray-800 flex items-center justify-center gap-1",children:[t(X,{size:16}),"Retour"]})]})]})};export{de as default};
